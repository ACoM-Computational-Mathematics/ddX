\hypertarget{ddx__harmonics_8f90_source}{}\doxysection{ddx\+\_\+harmonics.\+f90}
\label{ddx__harmonics_8f90_source}\index{src/ddx\_harmonics.f90@{src/ddx\_harmonics.f90}}
\mbox{\hyperlink{ddx__harmonics_8f90}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00016}\mbox{\hyperlink{namespaceddx__harmonics}{00016}} \textcolor{keyword}{module} \mbox{\hyperlink{namespaceddx__harmonics}{ddx\_harmonics}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00018}00018 \textcolor{comment}{! Get all compile-\/time definitions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00019}00019 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceddx__definitions}{ddx\_definitions}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00021}00021 \textcolor{comment}{! Disable implicit types}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00022}00022 \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00024}00024 \textcolor{keyword}{contains}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00037}\mbox{\hyperlink{namespaceddx__harmonics_a00c5ff3e46e5eb64eba38eee2b5f0751}{00037}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a00c5ff3e46e5eb64eba38eee2b5f0751}{ylmscale}}(p, vscales, v4pi2lp1, vscales\_rel)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00038}00038     \textcolor{comment}{! Input}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00039}00039     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00040}00040     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00041}00041 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vscales((p+1)**2), v4pi2lp1(p+1), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00042}00042         \& vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00043}00043     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00044}00044 \textcolor{keywordtype}{    real}(dp) :: tmp, twolp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00045}00045     \textcolor{keywordtype}{integer} :: l, ind, m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00046}00046     twolp1 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00047}00047     \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00048}00048         \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00049}00049         ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00050}00050         tmp = fourpi / twolp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00051}00051         v4pi2lp1(l+1) = tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00052}00052         tmp = sqrt(tmp)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00053}00053         vscales\_rel(ind) = tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00054}00054         vscales(ind) = one / tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00055}00055         twolp1 = twolp1 + two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00056}00056         tmp = vscales(ind) * sqrt2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00057}00057         \textcolor{comment}{! m != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00058}00058         \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00059}00059             tmp = -\/tmp / sqrt(dble((l-\/m+1)*(l+m)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00060}00060             vscales(ind+m) = tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00061}00061             vscales(ind-\/m) = tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00062}00062             vscales\_rel(ind+m) = tmp * v4pi2lp1(l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00063}00063             vscales\_rel(ind-\/m) = vscales\_rel(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00064}00064 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00065}00065 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00066}00066 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a00c5ff3e46e5eb64eba38eee2b5f0751}{ylmscale}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00080}\mbox{\hyperlink{namespaceddx__harmonics_ad9d821757cc745908129ffb88fe2678b}{00080}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ad9d821757cc745908129ffb88fe2678b}{fmm\_constants}}(dmax, pm, pl, vcnk, m2l\_ztranslate\_coef, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00081}00081         \& m2l\_ztranslate\_adj\_coef)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00082}00082     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00083}00083     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: dmax, pm, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00084}00084     \textcolor{comment}{! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00085}00085 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vcnk((2*dmax+1)*(dmax+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00086}00086         \& m2l\_ztranslate\_coef(pm+1, pl+1, pl+1), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00087}00087         \& m2l\_ztranslate\_adj\_coef(pl+1, pl+1, pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00088}00088     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00089}00089     \textcolor{keywordtype}{integer} :: i, indi, j, k, n, indjn}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00090}00090 \textcolor{keywordtype}{    real}(dp) :: tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00091}00091     \textcolor{comment}{! Compute combinatorial numbers C\_n\string^k for n=0..dmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00092}00092     \textcolor{comment}{! C\_0\string^0 = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00093}00093     vcnk(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00094}00094     \textcolor{keywordflow}{do} i = 2, 2*dmax+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00095}00095         \textcolor{comment}{! Offset to the C\_\{i-\/2\}\string^\{i-\/2\}, next item to be stored is C\_\{i-\/1\}\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00096}00096         indi = (i-\/1) * i / 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00097}00097         \textcolor{comment}{! C\_\{i-\/1\}\string^0 = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00098}00098         vcnk(indi+1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00099}00099         \textcolor{comment}{! C\_\{i-\/1\}\string^\{i-\/1\} = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00100}00100         vcnk(indi+i) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00101}00101         \textcolor{comment}{! C\_\{i-\/1\}\string^\{j-\/1\} = C\_\{i-\/2\}\string^\{j-\/1\} + C\_\{i-\/2\}\string^\{j-\/2\}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00102}00102         \textcolor{comment}{! Offset to C\_\{i-\/3\}\string^\{i-\/3\} is indi-\/i+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00103}00103         \textcolor{keywordflow}{do} j = 2, i-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00104}00104             vcnk(indi+j) = vcnk(indi-\/i+j+1) + vcnk(indi-\/i+j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00105}00105 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00106}00106 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00107}00107     \textcolor{comment}{! Get square roots of C\_n\string^k. sqrt(one) is one, so no need to update C\_n\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00108}00108     \textcolor{comment}{! and C\_n\string^n}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00109}00109     \textcolor{keywordflow}{do} i = 3, 2*dmax+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00110}00110         indi = (i-\/1) * i / 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00111}00111         \textcolor{keywordflow}{do} j = 2, i-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00112}00112             vcnk(indi+j) = sqrt(vcnk(indi+j))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00113}00113 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00114}00114 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00115}00115     \textcolor{comment}{! Fill in m2l\_ztranslate\_coef and m2l\_ztranslate\_adj\_coef}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00116}00116     \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00117}00117         \textcolor{keywordflow}{do} k = 0, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00118}00118             tmp1 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00119}00119             \textcolor{keywordflow}{do} n = k, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00120}00120                 indjn = (j+n)*(j+n+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00121}00121                 m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1) = \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00122}00122                     \& tmp1 * vcnk(indjn+j-\/k) * vcnk(indjn+j+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00123}00123                 m2l\_ztranslate\_adj\_coef(j-\/k+1, k+1, n-\/k+1) = \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00124}00124                     \& m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00125}00125                 tmp1 = -\/tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00126}00126 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00127}00127 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00128}00128 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00129}00129 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ad9d821757cc745908129ffb88fe2678b}{fmm\_constants}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00142}\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{00142}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(x, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00143}00143     \textcolor{comment}{! Input}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00144}00144 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00145}00145     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00146}00146 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00147}00147     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00148}00148 \textcolor{keywordtype}{    real}(dp) :: max12, ssq12}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00149}00149     \textcolor{comment}{! Check x(1:2) = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00150}00150     \textcolor{keywordflow}{if} ((x(1) .eq. zero) .and. (x(2) .eq. zero)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00151}00151         rho = abs(x(3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00152}00152         ctheta = sign(one, x(3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00153}00153         stheta = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00154}00154         cphi = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00155}00155         sphi = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00156}00156         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00157}00157 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00158}00158     \textcolor{comment}{! In other situations use sum-\/of-\/scaled-\/squares technique}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00159}00159     \textcolor{comment}{! Get norm of x(1:2) and cphi with sphi outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00160}00160     \textcolor{keywordflow}{if} (abs(x(2)) .gt. abs(x(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00161}00161         max12 = abs(x(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00162}00162         ssq12 = one + (x(1)/x(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00163}00163     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00164}00164         max12 = abs(x(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00165}00165         ssq12 = one + (x(2)/x(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00166}00166 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00167}00167     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00168}00168     cphi = x(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00169}00169     sphi = x(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00170}00170     \textcolor{comment}{! Then compute rho, ctheta and stheta outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00171}00171     \textcolor{keywordflow}{if} (abs(x(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00172}00172         rho = one + ssq12*(max12/x(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00173}00173         rho = abs(x(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00174}00174         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00175}00175         ctheta = x(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00176}00176     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00177}00177         rho = ssq12 + (x(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00178}00178         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00179}00179         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00180}00180         ctheta = x(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00181}00181 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00182}00182 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00214}\mbox{\hyperlink{namespaceddx__harmonics_a74a0d8fb15d594b39e7f4872d79846e0}{00214}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a74a0d8fb15d594b39e7f4872d79846e0}{ylmbas}}(x, rho, ctheta, stheta, cphi, sphi, p, vscales, vylm, vplm, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00215}00215         \& vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00216}00216     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00217}00217     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00218}00218 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00219}00219 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00220}00220     \textcolor{comment}{! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00221}00221 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00222}00222 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vylm((p+1)**2), vplm((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00223}00223 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vcos(p+1), vsin(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00224}00224     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00225}00225     \textcolor{keywordtype}{integer} :: l, m, ind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00226}00226 \textcolor{keywordtype}{    real}(dp) :: max12, ssq12, tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00227}00227     \textcolor{comment}{! Get rho cos(theta), sin(theta), cos(phi) and sin(phi) from the cartesian}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00228}00228     \textcolor{comment}{! coordinates of x. To support full range of inputs we do it via a scale}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00229}00229     \textcolor{comment}{! and a sum of squares technique.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00230}00230     \textcolor{comment}{! At first we compute x(1)**2 + x(2)**2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00231}00231     \textcolor{keywordflow}{if} (x(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00232}00232         max12 = abs(x(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00233}00233         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00234}00234     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(x(2)) .gt. abs(x(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00235}00235         max12 = abs(x(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00236}00236         ssq12 = one + (x(1)/x(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00237}00237     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00238}00238         max12 = abs(x(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00239}00239         ssq12 = one + (x(2)/x(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00240}00240 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00241}00241     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00242}00242     \textcolor{keywordflow}{if} (x(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00243}00243         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00244}00244     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(x(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00245}00245         rho = one + ssq12 *(max12/x(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00246}00246         rho = abs(x(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00247}00247     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00248}00248         rho = ssq12 + (x(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00249}00249         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00250}00250 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00251}00251     \textcolor{comment}{! In case x=0 just exit without setting any other variable}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00252}00252     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00253}00253         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00254}00254 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00255}00255     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00256}00256     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00257}00257     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00258}00258     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00259}00259         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00260}00260         cphi = x(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00261}00261         sphi = x(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00262}00262         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00263}00263         ctheta = x(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00264}00264         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00265}00265         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00266}00266         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00267}00267             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00268}00268                 vylm(1) = vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00269}00269                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00270}00270             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00271}00271                 vylm(1) = vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00272}00272                 vylm(2) = -\/ vscales(4) * stheta * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00273}00273                 vylm(3) = vscales(3) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00274}00274                 vylm(4) = -\/ vscales(4) * stheta * cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00275}00275                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00276}00276 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00277}00277         \textcolor{comment}{! Evaluate associated Legendre polynomials, size of temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00278}00278         \textcolor{comment}{! here needs only (p+1) elements so we use vcos as a temporary}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00279}00279         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{polleg\_work}}(ctheta, stheta, p, vplm, vcos)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00280}00280         \textcolor{comment}{! Evaluate cos(m*phi) and sin(m*phi) arrays}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00281}00281         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00282}00282         \textcolor{comment}{! Construct spherical harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00283}00283         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00284}00284         vylm(1) = vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00285}00285         \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00286}00286         vylm(2) = -\/ vscales(4) * stheta * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00287}00287         vylm(3) = vscales(3) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00288}00288         vylm(4) = -\/ vscales(4) * stheta * cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00289}00289         ind = 3}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00290}00290         \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00291}00291             \textcolor{comment}{! Offset of a Y\_l\string^0 harmonic in vplm and vylm arrays}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00292}00292             ind = ind + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00293}00293             \textcolor{comment}{!l**2 + l + 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00294}00294             \textcolor{comment}{! m = 0 implicitly uses `vcos(1) = 1`}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00295}00295             vylm(ind) = vscales(ind) * vplm(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00296}00296             \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00297}00297                 \textcolor{comment}{! only P\_l\string^m for non-\/negative m is used/defined}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00298}00298                 tmp = vplm(ind+m) * vscales(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00299}00299                 \textcolor{comment}{! m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00300}00300                 vylm(ind+m) = tmp * vcos(m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00301}00301                 \textcolor{comment}{! m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00302}00302                 vylm(ind-\/m) = tmp * vsin(m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00303}00303 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00304}00304 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00305}00305     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00306}00306     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00307}00307         \textcolor{comment}{! Set spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00308}00308         cphi = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00309}00309         sphi = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00310}00310         ctheta = sign(one, x(3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00311}00311         stheta = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00312}00312         \textcolor{comment}{! Set output arrays vcos and vsin}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00313}00313         vcos = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00314}00314         vsin = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00315}00315         \textcolor{comment}{! Evaluate spherical harmonics. P\_l\string^m = 0 for m > 0. In the case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00316}00316         \textcolor{comment}{! it depends if l is odd or even. Additionally, vcos = one and vsin =}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00317}00317         \textcolor{comment}{! zero for all elements}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00318}00318         vylm = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00319}00319         vplm = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00320}00320         \textcolor{keywordflow}{do} l = 0, p, 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00321}00321             ind = l**2 + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00322}00322             \textcolor{comment}{! only case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00323}00323             vplm(ind) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00324}00324             vylm(ind) = vscales(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00325}00325 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00326}00326         \textcolor{keywordflow}{do} l = 1, p, 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00327}00327             ind = l**2 + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00328}00328             \textcolor{comment}{! only case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00329}00329             vplm(ind) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00330}00330             vylm(ind) = ctheta * vscales(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00331}00331 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00332}00332 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00333}00333 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a74a0d8fb15d594b39e7f4872d79846e0}{ylmbas}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00334}00334 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00348}\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{00348}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00349}00349     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00350}00350     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00351}00351 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00352}00352     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00353}00353 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vcos(p+1), vsin(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00354}00354     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00355}00355     \textcolor{keywordtype}{integer} :: m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00356}00356 \textcolor{keywordtype}{    real}(dp) :: c4phi, s4phi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00357}00357     \textcolor{comment}{!! Treat values of p from 0 to 3 differently}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00358}00358     \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00359}00359         \textcolor{comment}{! Do nothing if p < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00360}00360         \textcolor{keywordflow}{case} (:-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00361}00361             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00362}00362         \textcolor{comment}{! p = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00363}00363         \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00364}00364             vcos(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00365}00365             vsin(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00366}00366             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00367}00367         \textcolor{comment}{! p = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00368}00368         \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00369}00369             vcos(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00370}00370             vsin(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00371}00371             vcos(2) = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00372}00372             vsin(2) = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00373}00373             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00374}00374         \textcolor{comment}{! p = 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00375}00375         \textcolor{keywordflow}{case} (2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00376}00376             vcos(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00377}00377             vsin(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00378}00378             vcos(2) = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00379}00379             vsin(2) = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00380}00380             vcos(3) = cphi**2 -\/ sphi**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00381}00381             vsin(3) = 2 * cphi * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00382}00382             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00383}00383         \textcolor{comment}{! p = 3}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00384}00384         \textcolor{keywordflow}{case} (3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00385}00385             vcos(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00386}00386             vsin(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00387}00387             vcos(2) = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00388}00388             vsin(2) = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00389}00389             vcos(3) = cphi**2 -\/ sphi**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00390}00390             vsin(3) = 2 * cphi * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00391}00391             vcos(4) = vcos(3)*cphi -\/ vsin(3)*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00392}00392             vsin(4) = vcos(3)*sphi + vsin(3)*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00393}00393             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00394}00394         \textcolor{comment}{! p >= 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00395}00395 \textcolor{keywordflow}{        case default}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00396}00396             vcos(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00397}00397             vsin(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00398}00398             vcos(2) = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00399}00399             vsin(2) = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00400}00400             vcos(3) = cphi**2 -\/ sphi**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00401}00401             vsin(3) = 2 * cphi * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00402}00402             vcos(4) = vcos(3)*cphi -\/ vsin(3)*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00403}00403             vsin(4) = vcos(3)*sphi + vsin(3)*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00404}00404             vcos(5) = vcos(3)**2 -\/ vsin(3)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00405}00405             vsin(5) = 2 * vcos(3) * vsin(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00406}00406             c4phi = vcos(5)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00407}00407             s4phi = vsin(5)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00408}00408 \textcolor{keywordflow}{    end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00409}00409     \textcolor{comment}{! Define cos(m*phi) and sin(m*phi) recurrently 4 values at a time}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00410}00410     \textcolor{keywordflow}{do} m = 6, p-\/2, 4}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00411}00411         vcos(m:m+3) = vcos(m-\/4:m-\/1)*c4phi -\/ vsin(m-\/4:m-\/1)*s4phi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00412}00412         vsin(m:m+3) = vcos(m-\/4:m-\/1)*s4phi + vsin(m-\/4:m-\/1)*c4phi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00413}00413 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00414}00414     \textcolor{comment}{! Work with leftover}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00415}00415     \textcolor{keywordflow}{select case}(m-\/p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00416}00416         \textcolor{keywordflow}{case} (-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00417}00417             vcos(p-\/1) = vcos(p-\/2)*cphi -\/ vsin(p-\/2)*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00418}00418             vsin(p-\/1) = vcos(p-\/2)*sphi + vsin(p-\/2)*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00419}00419             vcos(p) = vcos(p-\/2)*vcos(3) -\/ vsin(p-\/2)*vsin(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00420}00420             vsin(p) = vcos(p-\/2)*vsin(3) + vsin(p-\/2)*vcos(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00421}00421             vcos(p+1) = vcos(p-\/2)*vcos(4) -\/ vsin(p-\/2)*vsin(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00422}00422             vsin(p+1) = vcos(p-\/2)*vsin(4) + vsin(p-\/2)*vcos(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00423}00423         \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00424}00424             vcos(p) = vcos(p-\/1)*cphi -\/ vsin(p-\/1)*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00425}00425             vsin(p) = vcos(p-\/1)*sphi + vsin(p-\/1)*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00426}00426             vcos(p+1) = vcos(p-\/1)*vcos(3) -\/ vsin(p-\/1)*vsin(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00427}00427             vsin(p+1) = vcos(p-\/1)*vsin(3) + vsin(p-\/1)*vcos(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00428}00428         \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00429}00429             vcos(p+1) = vcos(p)*cphi -\/ vsin(p)*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00430}00430             vsin(p+1) = vcos(p)*sphi + vsin(p)*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00431}00431 \textcolor{keywordflow}{    end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00432}00432 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00433}00433 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00452}\mbox{\hyperlink{namespaceddx__harmonics_a7fcf9715c6a0d3dd5c291cafffaa5d1f}{00452}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a7fcf9715c6a0d3dd5c291cafffaa5d1f}{polleg}}(ctheta, stheta, p, vplm)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00453}00453     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00454}00454     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00455}00455 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: ctheta, stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00456}00456     \textcolor{comment}{! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00457}00457 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vplm((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00458}00458     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00459}00459 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00460}00460     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00461}00461     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{polleg\_work}}(ctheta, stheta, p, vplm, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00462}00462 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a7fcf9715c6a0d3dd5c291cafffaa5d1f}{polleg}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00463}00463 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00482}\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{00482}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{polleg\_work}}(ctheta, stheta, p, vplm, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00483}00483     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00484}00484     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00485}00485 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: ctheta, stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00486}00486     \textcolor{comment}{! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00487}00487 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: vplm((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00488}00488     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00489}00489 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00490}00490     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00491}00491     \textcolor{keywordtype}{integer} :: m, l, indlm1, indlm2, indl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00492}00492 \textcolor{keywordtype}{    real}(dp) :: tmp, tmp1, tmp2, tmp3, tmp4, tmp5, fl, pl2m, pl1m, plm, pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00493}00493     \textcolor{comment}{! Easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00494}00494     \textcolor{keywordflow}{select case} (p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00495}00495         \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00496}00496             vplm(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00497}00497             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00498}00498         \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00499}00499             vplm(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00500}00500             vplm(3) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00501}00501             vplm(4) = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00502}00502             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00503}00503         \textcolor{keywordflow}{case} (2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00504}00504             vplm(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00505}00505             vplm(3) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00506}00506             vplm(4) = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00507}00507             tmp1 = three * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00508}00508             tmp2 = ctheta * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00509}00509             vplm(7) = 1.5d0*tmp2 -\/ pt5}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00510}00510             vplm(8) = -\/tmp1 * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00511}00511             vplm(9) = tmp1 * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00512}00512             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00513}00513         \textcolor{keywordflow}{case} (3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00514}00514             vplm(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00515}00515             vplm(3) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00516}00516             vplm(4) = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00517}00517             tmp1 = three * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00518}00518             tmp2 = ctheta * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00519}00519             vplm(7) = 1.5d0*tmp2 -\/ pt5}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00520}00520             vplm(8) = -\/tmp1 * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00521}00521             vplm(9) = tmp1 * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00522}00522             tmp3 = 2.5d0 * tmp2 -\/ pt5}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00523}00523             vplm(13) = tmp3*ctheta -\/ ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00524}00524             vplm(14) = -\/tmp1 * tmp3}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00525}00525             tmp4 = -\/5d0 * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00526}00526             vplm(15) = tmp4 * vplm(8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00527}00527             vplm(16) = tmp4 * vplm(9)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00528}00528             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00529}00529 \textcolor{keywordflow}{    end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00530}00530     \textcolor{comment}{! Now p >= 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00531}00531     \textcolor{comment}{! Precompute temporary values}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00532}00532     \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00533}00533         work(l) = dble(2*l-\/1) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00534}00534 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00535}00535     \textcolor{comment}{! Save P\_m\string^m for the inital loop m=0 which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00536}00536     pmm = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00537}00537     \textcolor{comment}{! Case m < p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00538}00538     \textcolor{keywordflow}{do} m = 0, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00539}00539         \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00540}00540         pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00541}00541         \textcolor{comment}{! P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00542}00542         vplm((m+1)**2) = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00543}00543         \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00544}00544         tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00545}00545         \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00546}00546         pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00547}00547         \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00548}00548         pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00549}00549         \textcolor{comment}{! P\_\{m+1\}\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00550}00550         vplm((m+1)*(m+3)) = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00551}00551         \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00552}00552         \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00553}00553             plm = work(l)*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00554}00554             plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00555}00555             vplm(l*l+l+1+m) = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00556}00556             \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00557}00557             pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00558}00558             pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00559}00559 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00560}00560 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00561}00561     \textcolor{comment}{! Case m=p requires only to store P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00562}00562     vplm((p+1)**2) = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00563}00563 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{polleg\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00564}00564 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00565}00565 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00566}00566 \textcolor{comment}{! Subroutine to compute the Modified Spherical Bessel function of the first kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00567}00567 \textcolor{comment}{! @param[in]  lmax     : Data type}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00568}00568 \textcolor{comment}{! @param[in]  argument : Argument of Bessel function}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00569}00569 \textcolor{comment}{! @param[out] SI       : Modified Bessel function of the first kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00570}00570 \textcolor{comment}{! @param[out] DI       : Derivative of modified Bessel function of the first kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00571}00571 \textcolor{keyword}{subroutine }modified\_spherical\_bessel\_first\_kind(lmax, argument, SI, DI, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00572}00572     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00573}00573     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00574}00574     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: lmax}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00575}00575 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00576}00576     \textcolor{comment}{!! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00577}00577 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(0:lmax)}, \textcolor{keywordtype}{intent(out)} :: SI, DI}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00578}00578     \textcolor{comment}{!! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00579}00579     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{dimension(0:max(1, lmax))}, \textcolor{keywordtype}{intent(out)} :: work}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00580}00580     \textcolor{comment}{!! Local Variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00581}00581     \textcolor{comment}{! Complex\_SI     : Modified Bessel functions of the first kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00582}00582     \textcolor{comment}{! argument       : Argument for Complex\_SI}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00583}00583     \textcolor{comment}{! scaling\_factor : sqrt(pi/2x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00584}00584     \textcolor{comment}{! fnu            : Starting argument for I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00585}00585     \textcolor{comment}{! NZ             : Number of components set to zero due to underflow}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00586}00586     \textcolor{comment}{! ierr           : Erro indicator for I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00587}00587     \textcolor{comment}{! l              : l=0,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00588}00588     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00589}00589 \textcolor{keywordtype}{    real}(dp) :: scaling\_factor}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00590}00590 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: fnu = 1.5d0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00591}00591     \textcolor{keywordtype}{integer} :: NZ, ierr, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00592}00592     \textcolor{comment}{! If argument is zero then SI is e\_1, need to find what is the value of DI}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00593}00593     \textcolor{keywordflow}{if} (argument .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00594}00594         si = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00595}00595         si(0) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00596}00596         di = zero \textcolor{comment}{! ???}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00597}00597         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00598}00598 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00599}00599     \textcolor{comment}{! Compute I\_(0.5+J) for J:1,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00600}00600     \textcolor{comment}{! NOTE: cbesi computes I\_(FNU+J-\/1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00601}00601     \textcolor{comment}{!fnu = 1.5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00602}00602     scaling\_factor = sqrt(pi/(2*argument))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00603}00603     \textcolor{comment}{! NOTE: Complex argument is required to call I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00604}00604     complex\_argument = argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00605}00605     \textcolor{comment}{! Compute for l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00606}00606     \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work(0), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00607}00607     \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of first kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00608}00608     \textcolor{comment}{! Compute for l = 1,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00609}00609     \textcolor{keywordflow}{if} (lmax .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00610}00610         \textcolor{keyword}{call }cbesi(complex\_argument, fnu, 1, lmax, work(1:lmax), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00611}00611         \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of first kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00612}00612     \textcolor{comment}{! l=1 is needed for DI(0)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00613}00613     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00614}00614         \textcolor{keyword}{call }cbesi(complex\_argument, fnu, 1, 1, work(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00615}00615         \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of first kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00616}00616 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00617}00617     \textcolor{comment}{! Store the real part of the complex Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00618}00618     si = real(work(0:lmax))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00619}00619     \textcolor{comment}{! Converting Modified Bessel to Spherical Modified Bessel}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00620}00620     si = scaling\_factor * si}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00621}00621     \textcolor{comment}{! Computation of Derivatives of SI}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00622}00622     di(0) = scaling\_factor * real(work(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00623}00623     \textcolor{keywordflow}{do} l = 1, lmax}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00624}00624         di(l)= si(l-\/1) -\/ ((l+1.0d0)*si(l))/argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00625}00625 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00626}00626 \textcolor{keyword}{end subroutine }modified\_spherical\_bessel\_first\_kind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00627}00627 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00628}00628 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00629}00629 \textcolor{comment}{! Subroutine to compute the Modified Spherical Bessel function of the second kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00630}00630 \textcolor{comment}{! @param[in]  lmax     : Size}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00631}00631 \textcolor{comment}{! @param[in]  argument : Argument of Bessel function}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00632}00632 \textcolor{comment}{! @param[out] SK       : Modified Bessel function of the second kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00633}00633 \textcolor{comment}{! @param[out] DK       : Derivative of modified Bessel function of the second kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00634}00634 \textcolor{keyword}{subroutine }modified\_spherical\_bessel\_second\_kind(lmax, argument, SK, DK, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00635}00635     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00636}00636     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00637}00637     \textcolor{keywordtype}{integer} , \textcolor{keywordtype}{intent(in)} :: lmax}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00638}00638 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00639}00639     \textcolor{comment}{!! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00640}00640 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(0:lmax)}, \textcolor{keywordtype}{intent(out)} :: SK, DK}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00641}00641     \textcolor{comment}{!! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00642}00642     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{dimension(0:max(1, lmax))}, \textcolor{keywordtype}{intent(out)} :: work}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00643}00643     \textcolor{comment}{! Local Variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00644}00644     \textcolor{comment}{! Complex\_SK     : Modified Bessel functions of the second kind}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00645}00645     \textcolor{comment}{! argument       : Argument for Complex\_SK}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00646}00646     \textcolor{comment}{! scaling\_factor : sqrt(pi/2x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00647}00647     \textcolor{comment}{! fnu            : Starting argument for K\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00648}00648     \textcolor{comment}{! NZ             : Number of components set to zero due to underflow}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00649}00649     \textcolor{comment}{! ierr           : Error indicator for K\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00650}00650     \textcolor{comment}{! l              : l=0,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00651}00651     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00652}00652 \textcolor{keywordtype}{    real}(dp) :: scaling\_factor}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00653}00653 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: fnu=1.5d0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00654}00654     \textcolor{keywordtype}{integer} :: NZ, ierr, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00655}00655     \textcolor{comment}{! Compute K\_(0.5+J) for J:1,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00656}00656     \textcolor{comment}{! NOTE: cbesk computes K\_(FNU+J-\/1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00657}00657     scaling\_factor = sqrt(2/(pi*argument))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00658}00658     \textcolor{comment}{! NOTE: Complex argument is required to call K\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00659}00659     complex\_argument = argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00660}00660     \textcolor{comment}{! Compute for l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00661}00661     \textcolor{keyword}{call }cbesk(complex\_argument, pt5, 1, 1, work(0), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00662}00662     \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of second kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00663}00663     \textcolor{comment}{! Compute for l = 1,...,lmax}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00664}00664     \textcolor{keywordflow}{if} (lmax .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00665}00665         \textcolor{keyword}{call }cbesk(complex\_argument, fnu, 1, lmax, work(1:lmax), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00666}00666         \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of second kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00667}00667     \textcolor{comment}{! l=1 is needed for DK(0)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00668}00668     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00669}00669         \textcolor{keyword}{call }cbesk(complex\_argument, fnu, 1, 1, work(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00670}00670         \textcolor{keywordflow}{if} (ierr .ne. 0) stop \textcolor{stringliteral}{'Error in computing Bessel function of second kind'}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00671}00671 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00672}00672     \textcolor{comment}{! Store the real part of the complex Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00673}00673     sk = real(work(0:lmax))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00674}00674     \textcolor{comment}{! Converting Modified Bessel to Spherical Modified Bessel}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00675}00675     sk = scaling\_factor * sk}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00676}00676     \textcolor{comment}{! Computation of Derivatives of SK}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00677}00677     dk(0) = -\/scaling\_factor * real(work(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00678}00678     \textcolor{keywordflow}{do} l = 1, lmax}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00679}00679         dk(l) = -\/sk(l-\/1) -\/ ((l+1.0d0)*sk(l))/argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00680}00680 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00681}00681 \textcolor{keyword}{end subroutine }modified\_spherical\_bessel\_second\_kind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00682}00682 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00709}\mbox{\hyperlink{namespaceddx__harmonics_a4c2f0791982b1533d68d0b245e33f28d}{00709}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a4c2f0791982b1533d68d0b245e33f28d}{fmm\_p2m}}(c, src\_q, dst\_r, p, vscales, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00710}00710     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00711}00711     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00712}00712 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales((p+1)**2), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00713}00713     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00714}00714 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00715}00715     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00716}00716 \textcolor{keywordtype}{    real}(dp) :: work(2*(p+1)*(p+2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00717}00717     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00718}00718     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae1cc4ca98a66bc491b377766715cdb59}{fmm\_p2m\_work}}(c, src\_q, dst\_r, p, vscales, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00719}00719 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a4c2f0791982b1533d68d0b245e33f28d}{fmm\_p2m}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00720}00720 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00748}\mbox{\hyperlink{namespaceddx__harmonics_ae1cc4ca98a66bc491b377766715cdb59}{00748}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae1cc4ca98a66bc491b377766715cdb59}{fmm\_p2m\_work}}(c, src\_q, dst\_r, p, vscales, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00749}00749     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00750}00750     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00751}00751 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales((p+1)**2), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00752}00752     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00753}00753 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00754}00754     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00755}00755 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(p+1)*(p+2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00756}00756     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00757}00757 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, t, rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00758}00758     \textcolor{keywordtype}{integer} :: n, ind, vylm1, vylm2, vplm1, vplm2, vcos1, vcos2, vsin1, vsin2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00759}00759     \textcolor{comment}{! In case src\_q is zero just scale output properly}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00760}00760     \textcolor{keywordflow}{if} (src\_q .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00761}00761         \textcolor{comment}{! Zero init output if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00762}00762         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00763}00763             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00764}00764         \textcolor{comment}{! Scale output by beta otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00765}00765         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00766}00766             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00767}00767 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00768}00768         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00769}00769         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00770}00770 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00771}00771     \textcolor{comment}{! Now src\_q is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00772}00772     \textcolor{comment}{! Mark first and last elements of all work subarrays}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00773}00773     vylm1 = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00774}00774     vylm2 = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00775}00775     vplm1 = vylm2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00776}00776     vplm2 = 2 * vylm2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00777}00777     vcos1 = vplm2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00778}00778     vcos2 = vcos1 + p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00779}00779     vsin1 = vcos2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00780}00780     vsin2 = vsin1 + p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00781}00781     \textcolor{comment}{! Get radius and values of spherical harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00782}00782     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a74a0d8fb15d594b39e7f4872d79846e0}{ylmbas}}(c, rho, ctheta, stheta, cphi, sphi, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00783}00783         \& work(vylm1:vylm2), work(vplm1:vplm2), work(vcos1:vcos2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00784}00784         \& work(vsin1:vsin2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00785}00785     \textcolor{comment}{! Harmonics are available only if rho > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00786}00786     \textcolor{keywordflow}{if} (rho .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00787}00787         rcoef = rho / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00788}00788         t = src\_q / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00789}00789         \textcolor{comment}{! Ignore input `dst\_m` in case of a zero scaling factor beta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00790}00790         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00791}00791             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00792}00792                 ind = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00793}00793                 \textcolor{comment}{! Array vylm is in the beginning of work array}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00794}00794                 dst\_m(ind-\/n:ind+n) = t * work(ind-\/n:ind+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00795}00795                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00796}00796 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00797}00797         \textcolor{comment}{! Update `dst\_m` otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00798}00798         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00799}00799             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00800}00800                 ind = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00801}00801                 \textcolor{comment}{! Array vylm is in the beginning of work array}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00802}00802                 dst\_m(ind-\/n:ind+n) = beta*dst\_m(ind-\/n:ind+n) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00803}00803                     \& t*work(ind-\/n:ind+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00804}00804                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00805}00805 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00806}00806 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00807}00807     \textcolor{comment}{! Naive case of rho = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00808}00808     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00809}00809         \textcolor{comment}{! Ignore input `dst\_m` in case of a zero scaling factor beta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00810}00810         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00811}00811             dst\_m(1) = src\_q / dst\_r / sqrt4pi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00812}00812             dst\_m(2:) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00813}00813         \textcolor{comment}{! Update `m` otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00814}00814         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00815}00815             dst\_m(1) = beta*dst\_m(1) + src\_q/dst\_r/sqrt4pi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00816}00816             dst\_m(2:) = beta * dst\_m(2:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00817}00817 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00818}00818 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00819}00819 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae1cc4ca98a66bc491b377766715cdb59}{fmm\_p2m\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00820}00820 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00847}\mbox{\hyperlink{namespaceddx__harmonics_abd5b67dd330ca6cd8d978cbc917839fd}{00847}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_abd5b67dd330ca6cd8d978cbc917839fd}{fmm\_m2p}}(c, src\_r, p, vscales\_rel, alpha, src\_m, beta, dst\_v)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00848}00848     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00849}00849     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00850}00850 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales\_rel((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00851}00851         \& src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00852}00852     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00853}00853 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00854}00854     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00855}00855 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00856}00856     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00857}00857     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a84bf7c6ebd36d68822a3e81c9d01055f}{fmm\_m2p\_work}}(c, src\_r, p, vscales\_rel, alpha, src\_m, beta, dst\_v, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00858}00858         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00859}00859 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_abd5b67dd330ca6cd8d978cbc917839fd}{fmm\_m2p}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00860}00860 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00890}\mbox{\hyperlink{namespaceddx__harmonics_a84bf7c6ebd36d68822a3e81c9d01055f}{00890}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a84bf7c6ebd36d68822a3e81c9d01055f}{fmm\_m2p\_work}}(c, src\_r, p, vscales\_rel, alpha, src\_m, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00891}00891         \& beta, dst\_v, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00892}00892     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00893}00893     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00894}00894 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales\_rel((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00895}00895         \& src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00896}00896     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00897}00897 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00898}00898     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00899}00899 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00900}00900     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00901}00901 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00902}00902         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00903}00903     \textcolor{keywordtype}{integer} :: l, m, indl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00904}00904     \textcolor{comment}{! Scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00905}00905     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00906}00906         dst\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00907}00907     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00908}00908         dst\_v = beta * dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00909}00909 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00910}00910     \textcolor{comment}{! In case of zero alpha nothing else is required no matter what is the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00911}00911     \textcolor{comment}{! value of the induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00912}00912     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00913}00913         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00914}00914 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00915}00915     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00916}00916     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00917}00917         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00918}00918         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00919}00919     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00920}00920         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00921}00921         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00922}00922     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00923}00923         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00924}00924         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00925}00925 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00926}00926     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00927}00927     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00928}00928         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00929}00929     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00930}00930         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00931}00931         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00932}00932     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00933}00933         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00934}00934         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00935}00935 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00936}00936     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential is infinite and is}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00937}00937     \textcolor{comment}{! not taken into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00938}00938     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00939}00939         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00940}00940 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00941}00941     \textcolor{comment}{! Compute the actual induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00942}00942     rcoef = src\_r / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00943}00943     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00944}00944     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00945}00945     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00946}00946     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00947}00947         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00948}00948         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00949}00949         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00950}00950         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00951}00951         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00952}00952         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00953}00953         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00954}00954         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00955}00955             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00956}00956                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00957}00957                 dst\_v = dst\_v + alpha*rcoef*vscales\_rel(1)*src\_m(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00958}00958                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00959}00959             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00960}00960                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00961}00961                 tmp = src\_m(1) * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00962}00962                 \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00963}00963                 tmp2 = ctheta * src\_m(3) * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00964}00964                 tmp3 = vscales\_rel(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00965}00965                 tmp2 = tmp2 -\/ tmp3*sphi*src\_m(2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00966}00966                 tmp2 = tmp2 -\/ tmp3*cphi*src\_m(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00967}00967                 dst\_v = dst\_v + alpha*rcoef*(tmp+rcoef*tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00968}00968                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00969}00969 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00970}00970         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00971}00971         \textcolor{comment}{! Precompute alpha*rcoef\string^\{l+1\}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00972}00972         work(1) = alpha * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00973}00973         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00974}00974             work(l+1) = rcoef * work(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00975}00975 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00976}00976         \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00977}00977         \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00978}00978         pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00979}00979         dst\_v = dst\_v + work(1)*src\_m(1)*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00980}00980         \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00981}00981         pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00982}00982         \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00983}00983         pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00984}00984         ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00985}00985         dst\_v = dst\_v + work(2)*src\_m(3)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00986}00986         \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00987}00987         \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00988}00988             plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00989}00989             plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00990}00990             ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00991}00991             dst\_v = dst\_v + work(l+1)*src\_m(l*l+l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00992}00992             \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00993}00993             pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00994}00994             pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00995}00995 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00996}00996         \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00997}00997         cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00998}00998         smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l00999}00999         \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01000}01000         \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01001}01001             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01002}01002             pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01003}01003             ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01004}01004             tmp1 = cmphi*src\_m((m+1)**2) + smphi*src\_m(m*m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01005}01005             dst\_v = dst\_v + work(m+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01006}01006             \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01007}01007             tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01008}01008             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01009}01009             pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01010}01010             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01011}01011             pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01012}01012             ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01013}01013             tmp1 = cmphi*src\_m((m+1)*(m+3)) + smphi*src\_m((m+1)*(m+2)+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01014}01014             dst\_v = dst\_v + work(m+2)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01015}01015             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01016}01016             \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01017}01017                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01018}01018                 plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01019}01019                 ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01020}01020                 tmp1 = cmphi*src\_m(l*l+l+1+m) + smphi*src\_m(l*l+l+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01021}01021                 dst\_v = dst\_v + work(l+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01022}01022                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01023}01023                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01024}01024                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01025}01025 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01026}01026             \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01027}01027             tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01028}01028             cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01029}01029             smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01030}01030 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01031}01031         \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01032}01032         ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01033}01033         tmp1 = cmphi*src\_m((p+1)**2) + smphi*src\_m(p*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01034}01034         dst\_v = dst\_v + work(p+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01035}01035     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01036}01036     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01037}01037         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01038}01038         \textcolor{comment}{! account. Y\_l\string^0 = ctheta\string^l in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01039}01039         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef. But before that we}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01040}01040         \textcolor{comment}{! initialize alpha/r factor for l=0 case without taking possible sign}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01041}01041         \textcolor{comment}{! into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01042}01042         t = alpha * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01043}01043         \textcolor{keywordflow}{if} (c(3) .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01044}01044             rcoef = -\/rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01045}01045 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01046}01046         \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01047}01047         indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01048}01048         \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01049}01049             \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01050}01050             indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01051}01051             \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01052}01052             dst\_v = dst\_v + t*src\_m(indl)*vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01053}01053             \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01054}01054             t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01055}01055 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01056}01056 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01057}01057 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a84bf7c6ebd36d68822a3e81c9d01055f}{fmm\_m2p\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01058}01058 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01085}\mbox{\hyperlink{namespaceddx__harmonics_ad316c4006889f94e0626566a4462db49}{01085}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ad316c4006889f94e0626566a4462db49}{fmm\_m2p\_bessel}}(c, src\_r, p, vscales, alpha, src\_m, beta, dst\_v)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01086}01086     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01087}01087     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01088}01088     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01089}01089 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01090}01090         \& src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01091}01091     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01092}01092 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01093}01093     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01094}01094     \textcolor{keywordtype}{complex(dp)} :: work\_complex(max(2, p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01095}01095 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01096}01096     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01097}01097 \textcolor{keywordtype}{    real}(dp) :: src\_sk(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01098}01098     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01099}01099     \textcolor{keyword}{call }modified\_spherical\_bessel\_second\_kind(p, src\_r, src\_sk, work, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01100}01100         \& work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01101}01101     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p, vscales, src\_sk, alpha, src\_m, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01102}01102         \& dst\_v, work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01103}01103 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ad316c4006889f94e0626566a4462db49}{fmm\_m2p\_bessel}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01104}01104 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01131}\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{01131}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p, vscales, SK\_ri, alpha, src\_m, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01132}01132         \& dst\_v, work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01133}01133     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01134}01134     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01135}01135     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01136}01136 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), vscales((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01137}01137         \& src\_m((p+1)*(p+1)), beta, SK\_ri(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01138}01138     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01139}01139 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01140}01140     \textcolor{comment}{!! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01141}01141     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01142}01142 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01143}01143     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01144}01144 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01145}01145         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm, t}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01146}01146     \textcolor{keywordtype}{real(dp)} :: scaling\_factor}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01147}01147     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01148}01148     \textcolor{keywordtype}{integer} :: l, m, indl, ierr, NZ}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01149}01149 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: fnu=1.5d0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01150}01150     \textcolor{comment}{! Scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01151}01151     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01152}01152         dst\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01153}01153     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01154}01154         dst\_v = beta * dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01155}01155 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01156}01156     \textcolor{comment}{! In case of zero alpha nothing else is required no matter what is the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01157}01157     \textcolor{comment}{! value of the induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01158}01158     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01159}01159         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01160}01160 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01161}01161     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01162}01162     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01163}01163         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01164}01164         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01165}01165     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01166}01166         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01167}01167         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01168}01168     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01169}01169         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01170}01170         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01171}01171 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01172}01172     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01173}01173     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01174}01174         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01175}01175     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01176}01176         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01177}01177         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01178}01178     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01179}01179         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01180}01180         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01181}01181 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01182}01182     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential is infinite and is}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01183}01183     \textcolor{comment}{! not taken into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01184}01184     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01185}01185         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01186}01186 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01187}01187     \textcolor{comment}{! Compute Bessel function}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01188}01188     scaling\_factor = alpha * sqrt(two / (pi*rho))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01189}01189     \textcolor{comment}{! NOTE: Complex argument is required to call I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01190}01190     complex\_argument = rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01191}01191     \textcolor{comment}{! Compute for l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01192}01192     \textcolor{keyword}{call }cbesk(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01193}01193     \textcolor{comment}{! Compute for l = 1,...,p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01194}01194     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01195}01195         \textcolor{keyword}{call }cbesk(complex\_argument, fnu, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01196}01196 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01197}01197     work = scaling\_factor * real(work\_complex) / sk\_ri}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01198}01198     \textcolor{comment}{! Compute the actual induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01199}01199     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01200}01200     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01201}01201     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01202}01202     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01203}01203         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01204}01204         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01205}01205         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01206}01206         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01207}01207         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01208}01208         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01209}01209         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01210}01210         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01211}01211             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01212}01212                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01213}01213                 dst\_v = dst\_v + work(1)*vscales(1)*src\_m(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01214}01214                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01215}01215             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01216}01216                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01217}01217                 tmp = work(1) * src\_m(1) * vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01218}01218                 \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01219}01219                 tmp2 = ctheta * src\_m(3) * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01220}01220                 tmp3 = stheta * vscales(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01221}01221                 tmp2 = tmp2 -\/ tmp3*sphi*src\_m(2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01222}01222                 tmp2 = tmp2 -\/ tmp3*cphi*src\_m(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01223}01223                 dst\_v = dst\_v + tmp + work(2)*tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01224}01224                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01225}01225 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01226}01226         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01227}01227         \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01228}01228         \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01229}01229         pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01230}01230         dst\_v = dst\_v + work(1)*src\_m(1)*vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01231}01231         \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01232}01232         pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01233}01233         \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01234}01234         pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01235}01235         ylm = pl1m * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01236}01236         dst\_v = dst\_v + work(2)*src\_m(3)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01237}01237         \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01238}01238         \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01239}01239             plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01240}01240             plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01241}01241             ylm = plm * vscales(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01242}01242             dst\_v = dst\_v + work(l+1)*src\_m(l*l+l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01243}01243             \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01244}01244             pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01245}01245             pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01246}01246 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01247}01247         \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01248}01248         cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01249}01249         smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01250}01250         \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01251}01251         \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01252}01252             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01253}01253             pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01254}01254             ylm = pmm * vscales((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01255}01255             tmp1 = cmphi*src\_m((m+1)**2) + smphi*src\_m(m*m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01256}01256             dst\_v = dst\_v + work(m+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01257}01257             \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01258}01258             tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01259}01259             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01260}01260             pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01261}01261             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01262}01262             pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01263}01263             ylm = pl1m * vscales((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01264}01264             tmp1 = cmphi*src\_m((m+1)*(m+3)) + smphi*src\_m((m+1)*(m+2)+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01265}01265             dst\_v = dst\_v + work(m+2)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01266}01266             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01267}01267             \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01268}01268                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01269}01269                 plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01270}01270                 ylm = plm * vscales(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01271}01271                 tmp1 = cmphi*src\_m(l*l+l+1+m) + smphi*src\_m(l*l+l+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01272}01272                 dst\_v = dst\_v + work(l+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01273}01273                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01274}01274                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01275}01275                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01276}01276 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01277}01277             \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01278}01278             tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01279}01279             cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01280}01280             smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01281}01281 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01282}01282         \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01283}01283         ylm = pmm * vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01284}01284         tmp1 = cmphi*src\_m((p+1)**2) + smphi*src\_m(p*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01285}01285         dst\_v = dst\_v + work(p+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01286}01286     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01287}01287     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01288}01288         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01289}01289         \textcolor{comment}{! account. Y\_l\string^0 = ctheta\string^l in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01290}01290         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef. But before that we}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01291}01291         \textcolor{comment}{! initialize alpha/r factor for l=0 case without taking possible sign}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01292}01292         \textcolor{comment}{! into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01293}01293         t = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01294}01294         \textcolor{keywordflow}{if} (c(3) .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01295}01295             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01296}01296             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01297}01297             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01298}01298                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01299}01299                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01300}01300                 \textcolor{comment}{! Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01301}01301                 dst\_v = dst\_v + t*work(l+1)*src\_m(indl)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01302}01302                 t = -\/t}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01303}01303 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01304}01304         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01305}01305             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01306}01306             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01307}01307             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01308}01308                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01309}01309                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01310}01310                 \textcolor{comment}{! Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01311}01311                 dst\_v = dst\_v + work(l+1)*src\_m(indl)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01312}01312 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01313}01313 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01314}01314 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01315}01315 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01316}01316 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01317}01317 \textcolor{keyword}{subroutine }fmm\_m2p\_bessel\_grad(c, src\_r, p, vscales, alpha, src\_m, beta, dst\_g)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01318}01318     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01319}01319     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01320}01320     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01321}01321 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales((p+2)*(p+2)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01322}01322         \& src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01323}01323     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01324}01324 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_g(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01325}01325     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01326}01326     \textcolor{keywordtype}{complex(dp)} :: work\_complex(p+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01327}01327 \textcolor{keywordtype}{    real}(dp) :: work(p+2), src\_sk(p+2), vcnk(1), src\_m\_grad((p+2)**2, 3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01328}01328     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01329}01329     \textcolor{keyword}{call }modified\_spherical\_bessel\_second\_kind(p+1, src\_r, src\_sk, work, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01330}01330         \& work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01331}01331     \textcolor{keyword}{call }fmm\_m2m\_bessel\_grad(p, src\_sk, vscales, vcnk, src\_m, src\_m\_grad)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01332}01332     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p+1, vscales, src\_sk, -\/alpha, src\_m\_grad(:, 1), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01333}01333         \& beta, dst\_g(1), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01334}01334     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p+1, vscales, src\_sk, -\/alpha, src\_m\_grad(:, 2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01335}01335         \& beta, dst\_g(2), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01336}01336     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p+1, vscales, src\_sk, -\/alpha, src\_m\_grad(:, 3), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01337}01337         \& beta, dst\_g(3), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01338}01338 \textcolor{keyword}{end subroutine }fmm\_m2p\_bessel\_grad}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01339}01339 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01365}\mbox{\hyperlink{namespaceddx__harmonics_a01fc177160fca45173657a5e7e7d5c67}{01365}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a01fc177160fca45173657a5e7e7d5c67}{fmm\_m2p\_adj}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01366}01366     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01367}01367     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01368}01368 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales\_rel((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01369}01369     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01370}01370 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01371}01371     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01372}01372 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01373}01373     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01374}01374     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6b5af8fca5bf86b5c643501a079798f2}{fmm\_m2p\_adj\_work}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01375}01375 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a01fc177160fca45173657a5e7e7d5c67}{fmm\_m2p\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01376}01376 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01403}\mbox{\hyperlink{namespaceddx__harmonics_a6b5af8fca5bf86b5c643501a079798f2}{01403}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6b5af8fca5bf86b5c643501a079798f2}{fmm\_m2p\_adj\_work}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01404}01404     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01405}01405     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01406}01406 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales\_rel((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01407}01407     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01408}01408 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01409}01409     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01410}01410 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01411}01411     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01412}01412 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01413}01413         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01414}01414     \textcolor{keywordtype}{integer} :: l, m, indl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01415}01415     \textcolor{comment}{! In case src\_q is zero just scale output properly}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01416}01416     \textcolor{keywordflow}{if} (src\_q .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01417}01417         \textcolor{comment}{! Zero init output if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01418}01418         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01419}01419             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01420}01420         \textcolor{comment}{! Scale output by beta otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01421}01421         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01422}01422             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01423}01423 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01424}01424         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01425}01425         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01426}01426 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01427}01427     \textcolor{comment}{! Now src\_q is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01428}01428     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01429}01429     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01430}01430         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01431}01431         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01432}01432     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01433}01433         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01434}01434         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01435}01435     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01436}01436         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01437}01437         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01438}01438 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01439}01439     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01440}01440     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01441}01441         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01442}01442     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01443}01443         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01444}01444         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01445}01445     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01446}01446         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01447}01447         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01448}01448 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01449}01449     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential is infinite and is}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01450}01450     \textcolor{comment}{! not taken into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01451}01451     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01452}01452         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01453}01453 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01454}01454     \textcolor{comment}{! Compute actual induced potentials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01455}01455     rcoef = dst\_r / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01456}01456     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01457}01457     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01458}01458     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01459}01459     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01460}01460         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01461}01461         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01462}01462         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01463}01463         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01464}01464         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01465}01465         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01466}01466         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01467}01467         t = src\_q * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01468}01468         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01469}01469             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01470}01470                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01471}01471                     dst\_m(1) = t * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01472}01472                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01473}01473                     dst\_m(1) = beta*dst\_m(1) + t*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01474}01474 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01475}01475                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01476}01476             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01477}01477                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01478}01478                     \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01479}01479                     dst\_m(1) = t * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01480}01480                     \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01481}01481                     t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01482}01482                     tmp = -\/vscales\_rel(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01483}01483                     tmp2 = t * tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01484}01484                     dst\_m(2) = tmp2 * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01485}01485                     dst\_m(3) = t * vscales\_rel(3) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01486}01486                     dst\_m(4) = tmp2 * cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01487}01487                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01488}01488                     \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01489}01489                     dst\_m(1) = beta*dst\_m(1) + t*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01490}01490                     \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01491}01491                     t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01492}01492                     tmp = -\/vscales\_rel(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01493}01493                     tmp2 = t * tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01494}01494                     dst\_m(2) = beta*dst\_m(2) + tmp2*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01495}01495                     dst\_m(3) = beta*dst\_m(3) + t*vscales\_rel(3)*ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01496}01496                     dst\_m(4) = beta*dst\_m(4) + tmp2*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01497}01497 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01498}01498                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01499}01499 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01500}01500         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01501}01501         \textcolor{comment}{! Precompute src\_q*rcoef\string^\{l+1\}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01502}01502         work(1) = src\_q * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01503}01503         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01504}01504             work(l+1) = rcoef * work(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01505}01505 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01506}01506         \textcolor{comment}{! Overwrite output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01507}01507         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01508}01508             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01509}01509             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01510}01510             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01511}01511             dst\_m(1) = work(1) * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01512}01512             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01513}01513             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01514}01514             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01515}01515             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01516}01516             ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01517}01517             dst\_m(3) = work(2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01518}01518             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01519}01519             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01520}01520                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01521}01521                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01522}01522                 ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01523}01523                 dst\_m(l*l+l+1) = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01524}01524                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01525}01525                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01526}01526                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01527}01527 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01528}01528             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01529}01529             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01530}01530             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01531}01531             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01532}01532             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01533}01533                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01534}01534                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01535}01535                 ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01536}01536                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01537}01537                 dst\_m((m+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01538}01538                 dst\_m(m*m+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01539}01539                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01540}01540                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01541}01541                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01542}01542                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01543}01543                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01544}01544                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01545}01545                 ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01546}01546                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01547}01547                 dst\_m((m+1)*(m+3)) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01548}01548                 dst\_m((m+1)*(m+2)+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01549}01549                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01550}01550                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01551}01551                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01552}01552                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01553}01553                     ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01554}01554                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01555}01555                     dst\_m(l*l+l+1+m) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01556}01556                     dst\_m(l*l+l+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01557}01557                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01558}01558                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01559}01559                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01560}01560 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01561}01561                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01562}01562                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01563}01563                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01564}01564                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01565}01565 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01566}01566             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01567}01567             ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01568}01568             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01569}01569             dst\_m((p+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01570}01570             dst\_m(p*p+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01571}01571         \textcolor{comment}{! Update output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01572}01572         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01573}01573             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01574}01574             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01575}01575             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01576}01576             dst\_m(1) = beta*dst\_m(1) + work(1)*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01577}01577             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01578}01578             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01579}01579             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01580}01580             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01581}01581             ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01582}01582             dst\_m(3) = beta*dst\_m(3) + work(2)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01583}01583             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01584}01584             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01585}01585                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01586}01586                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01587}01587                 ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01588}01588                 dst\_m(l*l+l+1) = beta*dst\_m(l*l+l+1) + work(l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01589}01589                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01590}01590                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01591}01591                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01592}01592 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01593}01593             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01594}01594             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01595}01595             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01596}01596             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01597}01597             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01598}01598                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01599}01599                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01600}01600                 ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01601}01601                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01602}01602                 dst\_m((m+1)**2) = beta*dst\_m((m+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01603}01603                 dst\_m(m*m+1) = beta*dst\_m(m*m+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01604}01604                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01605}01605                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01606}01606                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01607}01607                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01608}01608                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01609}01609                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01610}01610                 ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01611}01611                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01612}01612                 dst\_m((m+1)*(m+3)) = beta*dst\_m((m+1)*(m+3)) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01613}01613                 dst\_m((m+1)*(m+2)+1-\/m) = beta*dst\_m((m+1)*(m+2)+1-\/m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01614}01614                     \& smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01615}01615                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01616}01616                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01617}01617                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01618}01618                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01619}01619                     ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01620}01620                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01621}01621                     dst\_m(l*l+l+1+m) = beta*dst\_m(l*l+l+1+m) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01622}01622                     dst\_m(l*l+l+1-\/m) = beta*dst\_m(l*l+l+1-\/m) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01623}01623                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01624}01624                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01625}01625                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01626}01626 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01627}01627                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01628}01628                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01629}01629                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01630}01630                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01631}01631 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01632}01632             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01633}01633             ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01634}01634             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01635}01635             dst\_m((p+1)**2) = beta*dst\_m((p+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01636}01636             dst\_m(p*p+1) = beta*dst\_m(p*p+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01637}01637 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01638}01638     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01639}01639     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01640}01640         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01641}01641         \textcolor{comment}{! account. Y\_l\string^0 = ctheta\string^l in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01642}01642         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef. But before that we}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01643}01643         \textcolor{comment}{! initialize alpha/r factor for l=0 case without taking possible sign}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01644}01644         \textcolor{comment}{! into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01645}01645         t = src\_q * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01646}01646         \textcolor{keywordflow}{if} (c(3) .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01647}01647             rcoef = -\/rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01648}01648 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01649}01649         \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01650}01650         indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01651}01651         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01652}01652             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01653}01653                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01654}01654                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01655}01655                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01656}01656                 dst\_m(indl) = t * vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01657}01657                 dst\_m(indl-\/l:indl-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01658}01658                 dst\_m(indl+1:indl+l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01659}01659                 \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01660}01660                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01661}01661 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01662}01662         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01663}01663             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01664}01664                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01665}01665                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01666}01666                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01667}01667                 dst\_m(indl) = beta*dst\_m(indl) + t*vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01668}01668                 dst\_m(indl-\/l:indl-\/1) = beta * dst\_m(indl-\/l:indl-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01669}01669                 dst\_m(indl+1:indl+l) = beta * dst\_m(indl+1:indl+l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01670}01670                 \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01671}01671                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01672}01672 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01673}01673 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01674}01674 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01675}01675 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6b5af8fca5bf86b5c643501a079798f2}{fmm\_m2p\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01676}01676 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01702}\mbox{\hyperlink{namespaceddx__harmonics_a364a597df78940a0e747a853df495682}{01702}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a364a597df78940a0e747a853df495682}{fmm\_m2p\_bessel\_adj}}(c, src\_q, dst\_r, kappa, p, vscales, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01703}01703     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01704}01704     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01705}01705 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales((p+1)*(p+1)), beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01706}01706         \& kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01707}01707     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01708}01708 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01709}01709     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01710}01710     \textcolor{keywordtype}{complex(dp)} :: work\_complex(max(2, p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01711}01711 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01712}01712     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01713}01713 \textcolor{keywordtype}{    real}(dp) :: dst\_sk(p+1), ck(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01714}01714     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01715}01715     \textcolor{keyword}{call }modified\_spherical\_bessel\_second\_kind(p, kappa*dst\_r, dst\_sk, work, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01716}01716         \& work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01717}01717     ck = kappa*c}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01718}01718     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6f93125bb26d1b6b77d351eb7057c216}{fmm\_m2p\_bessel\_adj\_work}}(ck, src\_q, dst\_sk, p, vscales, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01719}01719         \& dst\_m, work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01720}01720 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a364a597df78940a0e747a853df495682}{fmm\_m2p\_bessel\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01721}01721 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01748}\mbox{\hyperlink{namespaceddx__harmonics_a6f93125bb26d1b6b77d351eb7057c216}{01748}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6f93125bb26d1b6b77d351eb7057c216}{fmm\_m2p\_bessel\_adj\_work}}(c, src\_q, dst\_sk, p, vscales, beta, dst\_m, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01749}01749         \& work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01750}01750     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01751}01751     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01752}01752     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01753}01753 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_sk(p+1), vscales((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01754}01754     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01755}01755 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01756}01756     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01757}01757     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01758}01758 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01759}01759     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01760}01760 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01761}01761         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01762}01762         \& scaling\_factor}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01763}01763     \textcolor{keywordtype}{integer} :: l, m, indl, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01764}01764     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01765}01765     \textcolor{comment}{! In case src\_q is zero just scale output properly}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01766}01766     \textcolor{keywordflow}{if} (src\_q .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01767}01767         \textcolor{comment}{! Zero init output if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01768}01768         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01769}01769             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01770}01770         \textcolor{comment}{! Scale output by beta otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01771}01771         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01772}01772             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01773}01773 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01774}01774         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01775}01775         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01776}01776 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01777}01777     \textcolor{comment}{! Now src\_q is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01778}01778     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01779}01779     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01780}01780         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01781}01781         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01782}01782     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01783}01783         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01784}01784         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01785}01785     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01786}01786         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01787}01787         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01788}01788 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01789}01789     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01790}01790     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01791}01791         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01792}01792     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01793}01793         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01794}01794         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01795}01795     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01796}01796         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01797}01797         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01798}01798 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01799}01799     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential is infinite and is}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01800}01800     \textcolor{comment}{! not taken into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01801}01801     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01802}01802         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01803}01803 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01804}01804     \textcolor{comment}{! Compute Bessel function}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01805}01805     scaling\_factor = src\_q * sqrt(two / (pi*rho))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01806}01806     \textcolor{comment}{! NOTE: Complex argument is required to call I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01807}01807     complex\_argument = rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01808}01808     \textcolor{comment}{! Compute for l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01809}01809     \textcolor{keyword}{call }cbesk(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01810}01810     \textcolor{comment}{! Compute for l = 1,...,p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01811}01811     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01812}01812         \textcolor{keyword}{call }cbesk(complex\_argument, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01813}01813 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01814}01814     work = scaling\_factor * real(work\_complex) / dst\_sk}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01815}01815     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01816}01816     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01817}01817     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01818}01818     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01819}01819         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01820}01820         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01821}01821         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01822}01822         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01823}01823         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01824}01824         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01825}01825         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01826}01826         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01827}01827             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01828}01828                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01829}01829                     dst\_m(1) = work(1) * vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01830}01830                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01831}01831                     dst\_m(1) = beta*dst\_m(1) + work(1)*vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01832}01832 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01833}01833                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01834}01834             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01835}01835                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01836}01836                     \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01837}01837                     dst\_m(1) = work(1) * vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01838}01838                     \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01839}01839                     tmp = -\/vscales(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01840}01840                     tmp2 = work(2) * tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01841}01841                     dst\_m(2) = tmp2 * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01842}01842                     dst\_m(3) = work(2) * vscales(3) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01843}01843                     dst\_m(4) = tmp2 * cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01844}01844                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01845}01845                     \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01846}01846                     dst\_m(1) = beta*dst\_m(1) + work(1)*vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01847}01847                     \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01848}01848                     tmp = -\/vscales(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01849}01849                     tmp2 = work(2) * tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01850}01850                     dst\_m(2) = beta*dst\_m(2) + tmp2*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01851}01851                     dst\_m(3) = beta*dst\_m(3) + work(2)*vscales(3)*ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01852}01852                     dst\_m(4) = beta*dst\_m(4) + tmp2*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01853}01853 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01854}01854                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01855}01855 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01856}01856         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01857}01857         \textcolor{comment}{! Overwrite output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01858}01858         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01859}01859             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01860}01860             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01861}01861             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01862}01862             dst\_m(1) = work(1) * vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01863}01863             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01864}01864             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01865}01865             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01866}01866             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01867}01867             ylm = pl1m * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01868}01868             dst\_m(3) = work(2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01869}01869             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01870}01870             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01871}01871                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01872}01872                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01873}01873                 ylm = plm * vscales(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01874}01874                 dst\_m(l*l+l+1) = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01875}01875                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01876}01876                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01877}01877                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01878}01878 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01879}01879             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01880}01880             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01881}01881             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01882}01882             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01883}01883             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01884}01884                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01885}01885                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01886}01886                 ylm = pmm * vscales((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01887}01887                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01888}01888                 dst\_m((m+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01889}01889                 dst\_m(m*m+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01890}01890                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01891}01891                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01892}01892                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01893}01893                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01894}01894                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01895}01895                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01896}01896                 ylm = pl1m * vscales((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01897}01897                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01898}01898                 dst\_m((m+1)*(m+3)) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01899}01899                 dst\_m((m+1)*(m+2)+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01900}01900                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01901}01901                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01902}01902                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01903}01903                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01904}01904                     ylm = plm * vscales(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01905}01905                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01906}01906                     dst\_m(l*l+l+1+m) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01907}01907                     dst\_m(l*l+l+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01908}01908                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01909}01909                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01910}01910                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01911}01911 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01912}01912                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01913}01913                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01914}01914                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01915}01915                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01916}01916 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01917}01917             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01918}01918             ylm = pmm * vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01919}01919             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01920}01920             dst\_m((p+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01921}01921             dst\_m(p*p+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01922}01922         \textcolor{comment}{! Update output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01923}01923         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01924}01924             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01925}01925             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01926}01926             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01927}01927             dst\_m(1) = beta*dst\_m(1) + work(1)*vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01928}01928             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01929}01929             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01930}01930             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01931}01931             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01932}01932             ylm = pl1m * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01933}01933             dst\_m(3) = beta*dst\_m(3) + work(2)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01934}01934             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01935}01935             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01936}01936                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01937}01937                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01938}01938                 ylm = plm * vscales(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01939}01939                 dst\_m(l*l+l+1) = beta*dst\_m(l*l+l+1) + work(l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01940}01940                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01941}01941                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01942}01942                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01943}01943 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01944}01944             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01945}01945             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01946}01946             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01947}01947             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01948}01948             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01949}01949                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01950}01950                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01951}01951                 ylm = pmm * vscales((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01952}01952                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01953}01953                 dst\_m((m+1)**2) = beta*dst\_m((m+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01954}01954                 dst\_m(m*m+1) = beta*dst\_m(m*m+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01955}01955                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01956}01956                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01957}01957                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01958}01958                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01959}01959                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01960}01960                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01961}01961                 ylm = pl1m * vscales((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01962}01962                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01963}01963                 dst\_m((m+1)*(m+3)) = beta*dst\_m((m+1)*(m+3)) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01964}01964                 dst\_m((m+1)*(m+2)+1-\/m) = beta*dst\_m((m+1)*(m+2)+1-\/m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01965}01965                     \& smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01966}01966                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01967}01967                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01968}01968                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01969}01969                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01970}01970                     ylm = plm * vscales(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01971}01971                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01972}01972                     dst\_m(l*l+l+1+m) = beta*dst\_m(l*l+l+1+m) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01973}01973                     dst\_m(l*l+l+1-\/m) = beta*dst\_m(l*l+l+1-\/m) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01974}01974                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01975}01975                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01976}01976                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01977}01977 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01978}01978                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01979}01979                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01980}01980                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01981}01981                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01982}01982 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01983}01983             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01984}01984             ylm = pmm * vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01985}01985             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01986}01986             dst\_m((p+1)**2) = beta*dst\_m((p+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01987}01987             dst\_m(p*p+1) = beta*dst\_m(p*p+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01988}01988 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01989}01989     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01990}01990     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01991}01991         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01992}01992         \textcolor{comment}{! account. Y\_l\string^0 = ctheta\string^l in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01993}01993         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef. But before that we}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01994}01994         \textcolor{comment}{! initialize alpha/r factor for l=0 case without taking possible sign}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01995}01995         \textcolor{comment}{! into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01996}01996         t = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01997}01997         \textcolor{keywordflow}{if} (c(3) .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01998}01998             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l01999}01999             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02000}02000             \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02001}02001                 \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02002}02002                     \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02003}02003                     indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02004}02004                     \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02005}02005                     dst\_m(indl) = t * work(l+1) * vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02006}02006                     dst\_m(indl-\/l:indl-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02007}02007                     dst\_m(indl+1:indl+l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02008}02008                     \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02009}02009                     t = -\/t}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02010}02010 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02011}02011             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02012}02012                 \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02013}02013                     \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02014}02014                     indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02015}02015                     \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02016}02016                     dst\_m(indl) = beta*dst\_m(indl) + t*work(l+1)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02017}02017                     dst\_m(indl-\/l:indl-\/1) = beta * dst\_m(indl-\/l:indl-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02018}02018                     dst\_m(indl+1:indl+l) = beta * dst\_m(indl+1:indl+l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02019}02019                     \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02020}02020                     t = -\/t}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02021}02021 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02022}02022 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02023}02023         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02024}02024             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02025}02025             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02026}02026             \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02027}02027                 \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02028}02028                     \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02029}02029                     indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02030}02030                     \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02031}02031                     dst\_m(indl) = work(l+1) * vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02032}02032                     dst\_m(indl-\/l:indl-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02033}02033                     dst\_m(indl+1:indl+l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02034}02034 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02035}02035             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02036}02036                 \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02037}02037                     \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02038}02038                     indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02039}02039                     \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02040}02040                     dst\_m(indl) = beta*dst\_m(indl) + work(l+1)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02041}02041                     dst\_m(indl-\/l:indl-\/1) = beta * dst\_m(indl-\/l:indl-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02042}02042                     dst\_m(indl+1:indl+l) = beta * dst\_m(indl+1:indl+l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02043}02043 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02044}02044 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02045}02045 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02046}02046 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02047}02047 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6f93125bb26d1b6b77d351eb7057c216}{fmm\_m2p\_bessel\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02048}02048 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02072}\mbox{\hyperlink{namespaceddx__harmonics_a95f20c5bbb717d6615f9d9b46c40c567}{02072}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a95f20c5bbb717d6615f9d9b46c40c567}{fmm\_m2p\_mat}}(c, r, p, vscales, mat)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02073}02073     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02074}02074     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02075}02075 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), r, vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02076}02076     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02077}02077 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: mat((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02078}02078     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02079}02079 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, vcos(p+1), vsin(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02080}02080 \textcolor{keywordtype}{    real}(dp) :: vylm((p+1)**2), vplm((p+1)**2), rcoef, t, tmp}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02081}02081     \textcolor{keywordtype}{integer} :: n, ind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02082}02082     \textcolor{comment}{! Get radius and values of spherical harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02083}02083     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a74a0d8fb15d594b39e7f4872d79846e0}{ylmbas}}(c, rho, ctheta, stheta, cphi, sphi, p, vscales, vylm, vplm, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02084}02084         \& vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02085}02085     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential is infinite and is}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02086}02086     \textcolor{comment}{! not taken into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02087}02087     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02088}02088         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02089}02089 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02090}02090     \textcolor{comment}{! Compute actual induced potentials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02091}02091     rcoef = r / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02092}02092     t = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02093}02093     \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02094}02094         t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02095}02095         ind = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02096}02096         mat(ind-\/n:ind+n) = t / vscales(ind)**2 * vylm(ind-\/n:ind+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02097}02097 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02098}02098 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a95f20c5bbb717d6615f9d9b46c40c567}{fmm\_m2p\_mat}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02099}02099 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02125}\mbox{\hyperlink{namespaceddx__harmonics_a3e3bd6455b55865ee1829cd8addaad3c}{02125}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3e3bd6455b55865ee1829cd8addaad3c}{fmm\_l2p}}(c, src\_r, p, vscales, alpha, src\_l, beta, dst\_v)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02126}02126     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02127}02127     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02128}02128 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02129}02129         \& src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02130}02130     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02131}02131 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02132}02132     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02133}02133 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02134}02134     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02135}02135     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_afcb1b1e24d6d54835de05360bedad809}{fmm\_l2p\_work}}(c, src\_r, p, vscales, alpha, src\_l, beta, dst\_v, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02136}02136 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3e3bd6455b55865ee1829cd8addaad3c}{fmm\_l2p}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02137}02137 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02164}\mbox{\hyperlink{namespaceddx__harmonics_afcb1b1e24d6d54835de05360bedad809}{02164}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afcb1b1e24d6d54835de05360bedad809}{fmm\_l2p\_work}}(c, src\_r, p, vscales\_rel, alpha, src\_l, beta, dst\_v, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02165}02165         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02166}02166     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02167}02167     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02168}02168 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales\_rel((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02169}02169         \& src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02170}02170     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02171}02171 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02172}02172     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02173}02173 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02174}02174     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02175}02175 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02176}02176         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02177}02177     \textcolor{keywordtype}{integer} :: l, m, indl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02178}02178     \textcolor{comment}{! Scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02179}02179     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02180}02180         dst\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02181}02181     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02182}02182         dst\_v = beta * dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02183}02183 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02184}02184     \textcolor{comment}{! In case of zero alpha nothing else is required no matter what is the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02185}02185     \textcolor{comment}{! value of the induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02186}02186     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02187}02187         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02188}02188 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02189}02189     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02190}02190     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02191}02191         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02192}02192         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02193}02193     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02194}02194         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02195}02195         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02196}02196     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02197}02197         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02198}02198         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02199}02199 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02200}02200     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02201}02201     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02202}02202         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02203}02203     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02204}02204         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02205}02205         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02206}02206     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02207}02207         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02208}02208         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02209}02209 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02210}02210     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential depends only on the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02211}02211     \textcolor{comment}{! leading 1-\/st spherical harmonic}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02212}02212     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02213}02213         dst\_v = dst\_v + alpha*src\_l(1)*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02214}02214         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02215}02215 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02216}02216     \textcolor{comment}{! Compute the actual induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02217}02217     rcoef = rho / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02218}02218     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02219}02219     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02220}02220     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02221}02221     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02222}02222         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02223}02223         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02224}02224         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02225}02225         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02226}02226         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02227}02227         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02228}02228         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02229}02229         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02230}02230             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02231}02231                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02232}02232                 dst\_v = dst\_v + alpha*vscales\_rel(1)*src\_l(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02233}02233                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02234}02234             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02235}02235                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02236}02236                 tmp = src\_l(1) * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02237}02237                 \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02238}02238                 tmp2 = ctheta * src\_l(3) * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02239}02239                 tmp3 = vscales\_rel(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02240}02240                 tmp2 = tmp2 -\/ tmp3*sphi*src\_l(2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02241}02241                 tmp2 = tmp2 -\/ tmp3*cphi*src\_l(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02242}02242                 dst\_v = dst\_v + alpha*(tmp+rcoef*tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02243}02243                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02244}02244 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02245}02245         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02246}02246         \textcolor{comment}{! Precompute alpha*rcoef\string^l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02247}02247         work(1) = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02248}02248         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02249}02249             work(l+1) = rcoef * work(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02250}02250 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02251}02251         \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02252}02252         \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02253}02253         pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02254}02254         dst\_v = dst\_v + work(1)*src\_l(1)*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02255}02255         \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02256}02256         pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02257}02257         \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02258}02258         pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02259}02259         ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02260}02260         dst\_v = dst\_v + work(2)*src\_l(3)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02261}02261         \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02262}02262         \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02263}02263             plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02264}02264             plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02265}02265             ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02266}02266             dst\_v = dst\_v + work(l+1)*src\_l(l*l+l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02267}02267             \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02268}02268             pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02269}02269             pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02270}02270 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02271}02271         \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02272}02272         cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02273}02273         smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02274}02274         \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02275}02275         \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02276}02276             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02277}02277             pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02278}02278             ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02279}02279             tmp1 = cmphi*src\_l((m+1)**2) + smphi*src\_l(m*m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02280}02280             dst\_v = dst\_v + work(m+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02281}02281             \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02282}02282             tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02283}02283             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02284}02284             pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02285}02285             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02286}02286             pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02287}02287             ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02288}02288             tmp1 = cmphi*src\_l((m+1)*(m+3)) + smphi*src\_l((m+1)*(m+2)+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02289}02289             dst\_v = dst\_v + work(m+2)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02290}02290             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02291}02291             \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02292}02292                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02293}02293                 plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02294}02294                 ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02295}02295                 tmp1 = cmphi*src\_l(l*l+l+1+m) + smphi*src\_l(l*l+l+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02296}02296                 dst\_v = dst\_v + work(l+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02297}02297                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02298}02298                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02299}02299                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02300}02300 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02301}02301             \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02302}02302             tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02303}02303             cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02304}02304             smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02305}02305 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02306}02306         \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02307}02307         ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02308}02308         tmp1 = cmphi*src\_l((p+1)**2) + smphi*src\_l(p*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02309}02309         dst\_v = dst\_v + work(p+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02310}02310     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02311}02311     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02312}02312         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02313}02313         \textcolor{comment}{! account. Y\_l\string^m = ctheta\string^m in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02314}02314         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02315}02315         rcoef = sign(rcoef, c(3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02316}02316         \textcolor{comment}{! Init t and proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02317}02317         t = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02318}02318         indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02319}02319         \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02320}02320             \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02321}02321             indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02322}02322             \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02323}02323             dst\_v = dst\_v + t*src\_l(indl)*vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02324}02324             \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02325}02325             t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02326}02326 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02327}02327 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02328}02328 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afcb1b1e24d6d54835de05360bedad809}{fmm\_l2p\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02329}02329 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02355}\mbox{\hyperlink{namespaceddx__harmonics_a91f16516ededaf0fc38fe7efc9013e44}{02355}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a91f16516ededaf0fc38fe7efc9013e44}{fmm\_l2p\_bessel}}(c, src\_r, p, vscales, alpha, src\_l, beta, dst\_v)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02356}02356     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02357}02357     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02358}02358 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02359}02359         \& src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02360}02360     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02361}02361 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02362}02362     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02363}02363     \textcolor{keywordtype}{complex(dp)} :: work\_complex(max(2, p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02364}02364 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02365}02365     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02366}02366 \textcolor{keywordtype}{    real}(dp) :: src\_si(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02367}02367     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02368}02368     \textcolor{keyword}{call }modified\_spherical\_bessel\_first\_kind(p, src\_r, src\_si, work, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02369}02369         \& work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02370}02370     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}(c, p, vscales, src\_si, alpha, src\_l, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02371}02371         \& dst\_v, work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02372}02372 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a91f16516ededaf0fc38fe7efc9013e44}{fmm\_l2p\_bessel}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02373}02373 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02400}\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{02400}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}(c, p, vscales, SI\_ri, alpha, src\_l, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02401}02401         \& dst\_v, work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02402}02402     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02403}02403     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02404}02404     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02405}02405 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), vscales((p+1)*(p+1)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02406}02406         \& src\_l((p+1)*(p+1)), beta, SI\_ri(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02407}02407     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02408}02408 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02409}02409     \textcolor{comment}{!! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02410}02410     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02411}02411 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02412}02412     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02413}02413 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02414}02414         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02415}02415     \textcolor{keywordtype}{real(dp)} :: scaling\_factor}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02416}02416     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02417}02417     \textcolor{keywordtype}{integer} :: l, m, indl, ierr, NZ}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02418}02418 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: fnu=1.5d0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02419}02419     \textcolor{comment}{! Scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02420}02420     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02421}02421         dst\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02422}02422     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02423}02423         dst\_v = beta * dst\_v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02424}02424 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02425}02425     \textcolor{comment}{! In case of zero alpha nothing else is required no matter what is the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02426}02426     \textcolor{comment}{! value of the induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02427}02427     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02428}02428         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02429}02429 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02430}02430     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02431}02431     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02432}02432         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02433}02433         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02434}02434     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02435}02435         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02436}02436         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02437}02437     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02438}02438         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02439}02439         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02440}02440 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02441}02441     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02442}02442     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02443}02443         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02444}02444     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02445}02445         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02446}02446         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02447}02447     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02448}02448         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02449}02449         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02450}02450 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02451}02451     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential depends only on the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02452}02452     \textcolor{comment}{! leading 1-\/st spherical harmonic and the value I\_0(0)=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02453}02453     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02454}02454         dst\_v = dst\_v + alpha*src\_l(1)*vscales(1)/si\_ri(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02455}02455         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02456}02456 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02457}02457     \textcolor{comment}{! Compute Bessel function}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02458}02458     scaling\_factor = alpha * sqrt(pi / (2*rho))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02459}02459     \textcolor{comment}{! NOTE: Complex argument is required to call I\_J(x)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02460}02460     complex\_argument = rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02461}02461     \textcolor{comment}{! Compute for l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02462}02462     \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02463}02463     \textcolor{comment}{! Compute for l = 1,...,p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02464}02464     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02465}02465         \textcolor{keyword}{call }cbesi(complex\_argument, fnu, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02466}02466 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02467}02467     work = scaling\_factor * real(work\_complex) / si\_ri}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02468}02468     \textcolor{comment}{! Compute the actual induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02469}02469     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02470}02470     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02471}02471     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02472}02472     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02473}02473         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02474}02474         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02475}02475         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02476}02476         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02477}02477         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02478}02478         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02479}02479         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02480}02480         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02481}02481             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02482}02482                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02483}02483                 dst\_v = dst\_v + work(1)*vscales(1)*src\_l(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02484}02484                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02485}02485             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02486}02486                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02487}02487                 tmp = work(1) * src\_l(1) * vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02488}02488                 \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02489}02489                 tmp2 = ctheta * src\_l(3) * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02490}02490                 tmp3 = stheta * vscales(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02491}02491                 tmp2 = tmp2 -\/ tmp3*sphi*src\_l(2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02492}02492                 tmp2 = tmp2 -\/ tmp3*cphi*src\_l(4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02493}02493                 dst\_v = dst\_v + tmp + work(2)*tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02494}02494                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02495}02495 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02496}02496         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02497}02497         \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02498}02498         \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02499}02499         pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02500}02500         dst\_v = dst\_v + work(1)*src\_l(1)*vscales(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02501}02501         \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02502}02502         pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02503}02503         \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02504}02504         pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02505}02505         ylm = pl1m * vscales(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02506}02506         dst\_v = dst\_v + work(2)*src\_l(3)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02507}02507         \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02508}02508         \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02509}02509             plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02510}02510             plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02511}02511             ylm = plm * vscales(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02512}02512             dst\_v = dst\_v + work(l+1)*src\_l(l*l+l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02513}02513             \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02514}02514             pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02515}02515             pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02516}02516 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02517}02517         \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02518}02518         cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02519}02519         smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02520}02520         \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02521}02521         \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02522}02522             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02523}02523             pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02524}02524             ylm = pmm * vscales((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02525}02525             tmp1 = cmphi*src\_l((m+1)**2) + smphi*src\_l(m*m+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02526}02526             dst\_v = dst\_v + work(m+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02527}02527             \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02528}02528             tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02529}02529             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02530}02530             pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02531}02531             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02532}02532             pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02533}02533             ylm = pl1m * vscales((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02534}02534             tmp1 = cmphi*src\_l((m+1)*(m+3)) + smphi*src\_l((m+1)*(m+2)+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02535}02535             dst\_v = dst\_v + work(m+2)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02536}02536             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02537}02537             \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02538}02538                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02539}02539                 plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02540}02540                 ylm = plm * vscales(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02541}02541                 tmp1 = cmphi*src\_l(l*l+l+1+m) + smphi*src\_l(l*l+l+1-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02542}02542                 dst\_v = dst\_v + work(l+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02543}02543                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02544}02544                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02545}02545                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02546}02546 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02547}02547             \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02548}02548             tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02549}02549             cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02550}02550             smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02551}02551 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02552}02552         \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02553}02553         ylm = pmm * vscales((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02554}02554         tmp1 = cmphi*src\_l((p+1)**2) + smphi*src\_l(p*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02555}02555         dst\_v = dst\_v + work(p+1)*ylm*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02556}02556     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02557}02557     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02558}02558         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02559}02559         \textcolor{comment}{! account. Y\_l\string^0 = ctheta\string^l in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02560}02560         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef. But before that we}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02561}02561         \textcolor{comment}{! initialize alpha/r factor for l=0 case without taking possible sign}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02562}02562         \textcolor{comment}{! into account.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02563}02563         t = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02564}02564         \textcolor{keywordflow}{if} (c(3) .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02565}02565             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02566}02566             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02567}02567             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02568}02568                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02569}02569                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02570}02570                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02571}02571                 dst\_v = dst\_v + t*work(l+1)*src\_l(indl)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02572}02572                 t = -\/t}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02573}02573 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02574}02574         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02575}02575             \textcolor{comment}{! Proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02576}02576             indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02577}02577             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02578}02578                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02579}02579                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02580}02580                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02581}02581                 dst\_v = dst\_v + work(l+1)*src\_l(indl)*vscales(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02582}02582 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02583}02583 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02584}02584 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02585}02585 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02586}02586 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02587}02587 \textcolor{keyword}{subroutine }fmm\_l2p\_bessel\_grad(c, src\_r, p, vscales, alpha, src\_l, beta, dst\_g)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02588}02588     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02589}02589     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02590}02590     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02591}02591 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, vscales((p+2)*(p+2)), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02592}02592         \& src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02593}02593     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02594}02594 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_g(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02595}02595     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02596}02596     \textcolor{keywordtype}{complex(dp)} :: work\_complex(p+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02597}02597 \textcolor{keywordtype}{    real}(dp) :: work(p+2), src\_si(p+2), vcnk(1), src\_l\_grad((p+2)**2, 3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02598}02598     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02599}02599     \textcolor{keyword}{call }modified\_spherical\_bessel\_first\_kind(p+1, src\_r, src\_si, work, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02600}02600         \& work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02601}02601     \textcolor{keyword}{call }fmm\_l2l\_bessel\_grad(p, src\_si, vscales, vcnk, src\_l, src\_l\_grad)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02602}02602     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}(c, p+1, vscales, src\_si, -\/alpha, src\_l\_grad(:, 1), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02603}02603         \& beta, dst\_g(1), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02604}02604     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}(c, p+1, vscales, src\_si, -\/alpha, src\_l\_grad(:, 2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02605}02605         \& beta, dst\_g(2), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02606}02606     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae9cf6b001f184f2f72b53e1c44adc631}{fmm\_l2p\_bessel\_work}}(c, p+1, vscales, src\_si, -\/alpha, src\_l\_grad(:, 3), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02607}02607         \& beta, dst\_g(3), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02608}02608 \textcolor{keyword}{end subroutine }fmm\_l2p\_bessel\_grad}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02609}02609 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02634}\mbox{\hyperlink{namespaceddx__harmonics_a467ab49d671143bb6a90e2db8734408c}{02634}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a467ab49d671143bb6a90e2db8734408c}{fmm\_l2p\_adj}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02635}02635     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02636}02636     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02637}02637 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales\_rel((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02638}02638     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02639}02639 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02640}02640     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02641}02641 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02642}02642     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02643}02643     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a02d5736e15ad31da5e0a6b349fdacac1}{fmm\_l2p\_adj\_work}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02644}02644 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a467ab49d671143bb6a90e2db8734408c}{fmm\_l2p\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02645}02645 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02671}\mbox{\hyperlink{namespaceddx__harmonics_a02d5736e15ad31da5e0a6b349fdacac1}{02671}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a02d5736e15ad31da5e0a6b349fdacac1}{fmm\_l2p\_adj\_work}}(c, src\_q, dst\_r, p, vscales\_rel, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02672}02672     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02673}02673     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02674}02674 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_q, dst\_r, vscales\_rel((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02675}02675     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02676}02676 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02677}02677     \textcolor{comment}{! Workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02678}02678 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02679}02679     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02680}02680 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi, rcoef, t, tmp, tmp1, tmp2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02681}02681         \& tmp3, fl, max12, ssq12, pl2m, pl1m, plm, pmm, cmphi, smphi, ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02682}02682     \textcolor{keywordtype}{integer} :: l, m, indl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02683}02683     \textcolor{comment}{! In case src\_q is zero just scale output properly}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02684}02684     \textcolor{keywordflow}{if} (src\_q .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02685}02685         \textcolor{comment}{! Zero init output if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02686}02686         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02687}02687             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02688}02688         \textcolor{comment}{! Scale output by beta otherwise}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02689}02689         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02690}02690             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02691}02691 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02692}02692         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02693}02693         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02694}02694 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02695}02695     \textcolor{comment}{! Now src\_q is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02696}02696     \textcolor{comment}{! Get spherical coordinates}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02697}02697     \textcolor{keywordflow}{if} (c(1) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02698}02698         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02699}02699         ssq12 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02700}02700     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(2)) .gt. abs(c(1))) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02701}02701         max12 = abs(c(2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02702}02702         ssq12 = one + (c(1)/c(2))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02703}02703     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02704}02704         max12 = abs(c(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02705}02705         ssq12 = one + (c(2)/c(1))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02706}02706 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02707}02707     \textcolor{comment}{! Then we compute rho}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02708}02708     \textcolor{keywordflow}{if} (c(3) .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02709}02709         rho = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02710}02710     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (abs(c(3)) .gt. max12) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02711}02711         rho = one + ssq12 *(max12/c(3))**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02712}02712         rho = abs(c(3)) * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02713}02713     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02714}02714         rho = ssq12 + (c(3)/max12)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02715}02715         rho = max12 * sqrt(rho)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02716}02716 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02717}02717     \textcolor{comment}{! In case of a singularity (rho=zero) induced potential depends only on the}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02718}02718     \textcolor{comment}{! leading 1-\/st spherical harmonic, so in adjoint way we update only the leading}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02719}02719     \textcolor{keywordflow}{if} (rho .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02720}02720         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02721}02721             dst\_l(1) = src\_q * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02722}02722             dst\_l(2:) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02723}02723         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02724}02724             dst\_l(1) = beta*dst\_l(1) + src\_q*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02725}02725             dst\_l(2:) = beta * dst\_l(2:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02726}02726 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02727}02727         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02728}02728 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02729}02729     \textcolor{comment}{! Compute the actual induced potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02730}02730     rcoef = rho / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02731}02731     \textcolor{comment}{! Length of a vector x(1:2)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02732}02732     stheta = max12 * sqrt(ssq12)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02733}02733     \textcolor{comment}{! Case x(1:2) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02734}02734     \textcolor{keywordflow}{if} (stheta .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02735}02735         \textcolor{comment}{! Normalize cphi and sphi}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02736}02736         cphi = c(1) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02737}02737         sphi = c(2) / stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02738}02738         \textcolor{comment}{! Normalize ctheta and stheta}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02739}02739         ctheta = c(3) / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02740}02740         stheta = stheta / rho}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02741}02741         \textcolor{comment}{! Treat easy cases}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02742}02742         \textcolor{keywordflow}{select case}(p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02743}02743             \textcolor{keywordflow}{case} (0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02744}02744                 \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02745}02745                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02746}02746                     dst\_l(1) = src\_q * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02747}02747                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02748}02748                     dst\_l(1) = beta*dst\_l(1) + src\_q*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02749}02749 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02750}02750                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02751}02751             \textcolor{keywordflow}{case} (1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02752}02752                 \textcolor{comment}{! l = 0 and l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02753}02753                 tmp = src\_q * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02754}02754                 tmp2 = -\/tmp * vscales\_rel(4) * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02755}02755                 \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02756}02756                     dst\_l(1) = src\_q * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02757}02757                     dst\_l(2) = tmp2 * sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02758}02758                     dst\_l(3) = tmp * vscales\_rel(3) * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02759}02759                     dst\_l(4) = tmp2 * cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02760}02760                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02761}02761                     dst\_l(1) = beta*dst\_l(1) + src\_q*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02762}02762                     dst\_l(2) = beta*dst\_l(2) + tmp2*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02763}02763                     dst\_l(3) = beta*dst\_l(3) + tmp*vscales\_rel(3)*ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02764}02764                     dst\_l(4) = beta*dst\_l(4) + tmp2*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02765}02765 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02766}02766                 \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02767}02767 \textcolor{keywordflow}{        end select}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02768}02768         \textcolor{comment}{! Now p>1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02769}02769         \textcolor{comment}{! Precompute src\_q*rcoef\string^l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02770}02770         work(1) = src\_q}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02771}02771         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02772}02772             work(l+1) = rcoef * work(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02773}02773 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02774}02774         \textcolor{comment}{! Overwrite output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02775}02775         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02776}02776             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02777}02777             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02778}02778             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02779}02779             dst\_l(1) = work(1) * vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02780}02780             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02781}02781             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02782}02782             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02783}02783             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02784}02784             ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02785}02785             dst\_l(3) = work(2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02786}02786             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02787}02787             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02788}02788                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02789}02789                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02790}02790                 ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02791}02791                 dst\_l(l*l+l+1) = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02792}02792                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02793}02793                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02794}02794                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02795}02795 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02796}02796             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02797}02797             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02798}02798             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02799}02799             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02800}02800             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02801}02801                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02802}02802                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02803}02803                 ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02804}02804                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02805}02805                 dst\_l((m+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02806}02806                 dst\_l(m*m+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02807}02807                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02808}02808                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02809}02809                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02810}02810                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02811}02811                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02812}02812                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02813}02813                 ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02814}02814                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02815}02815                 dst\_l((m+1)*(m+3)) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02816}02816                 dst\_l((m+1)*(m+2)+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02817}02817                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02818}02818                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02819}02819                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02820}02820                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02821}02821                     ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02822}02822                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02823}02823                     dst\_l(l*l+l+1+m) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02824}02824                     dst\_l(l*l+l+1-\/m) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02825}02825                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02826}02826                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02827}02827                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02828}02828 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02829}02829                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02830}02830                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02831}02831                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02832}02832                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02833}02833 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02834}02834             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02835}02835             ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02836}02836             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02837}02837             dst\_l((p+1)**2) = cmphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02838}02838             dst\_l(p*p+1) = smphi * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02839}02839         \textcolor{comment}{! Update output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02840}02840         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02841}02841             \textcolor{comment}{! Case m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02842}02842             \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_0\string^0 now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02843}02843             pl2m = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02844}02844             dst\_l(1) = beta*dst\_l(1) + work(1)*vscales\_rel(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02845}02845             \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02846}02846             pmm = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02847}02847             \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02848}02848             pl1m = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02849}02849             ylm = pl1m * vscales\_rel(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02850}02850             dst\_l(3) = beta*dst\_l(3) + work(2)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02851}02851             \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02852}02852             \textcolor{keywordflow}{do} l = 2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02853}02853                 plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02854}02854                 plm = plm / dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02855}02855                 ylm = plm * vscales\_rel(l*l+l+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02856}02856                 dst\_l(l*l+l+1) = beta*dst\_l(l*l+l+1) + work(l+1)*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02857}02857                 \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02858}02858                 pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02859}02859                 pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02860}02860 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02861}02861             \textcolor{comment}{! Prepare cos(m*phi) and sin(m*phi) for m=1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02862}02862             cmphi = cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02863}02863             smphi = sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02864}02864             \textcolor{comment}{! Case 0<m<p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02865}02865             \textcolor{keywordflow}{do} m = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02866}02866                 \textcolor{comment}{! P\_\{l-\/2\}\string^m which is P\_m\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02867}02867                 pl2m = pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02868}02868                 ylm = pmm * vscales\_rel((m+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02869}02869                 ylm = work(m+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02870}02870                 dst\_l((m+1)**2) = beta*dst\_l((m+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02871}02871                 dst\_l(m*m+1) = beta*dst\_l(m*m+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02872}02872                 \textcolor{comment}{! Temporary to reduce number of operations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02873}02873                 tmp1 = dble(2*m+1) * pmm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02874}02874                 \textcolor{comment}{! Update P\_m\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02875}02875                 pmm = -\/stheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02876}02876                 \textcolor{comment}{! P\_\{l-\/1\}\string^m which is P\_\{m+1\}\string^m now}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02877}02877                 pl1m = ctheta * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02878}02878                 ylm = pl1m * vscales\_rel((m+1)*(m+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02879}02879                 ylm = work(m+2) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02880}02880                 dst\_l((m+1)*(m+3)) = beta*dst\_l((m+1)*(m+3)) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02881}02881                 dst\_l((m+1)*(m+2)+1-\/m) = beta*dst\_l((m+1)*(m+2)+1-\/m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02882}02882                     \& smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02883}02883                 \textcolor{comment}{! P\_l\string^m for l>m+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02884}02884                 \textcolor{keywordflow}{do} l = m+2, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02885}02885                     plm = dble(2*l-\/1)*ctheta*pl1m -\/ dble(l+m-\/1)*pl2m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02886}02886                     plm = plm / dble(l-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02887}02887                     ylm = plm * vscales\_rel(l*l+l+1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02888}02888                     ylm = work(l+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02889}02889                     dst\_l(l*l+l+1+m) = beta*dst\_l(l*l+l+1+m) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02890}02890                     dst\_l(l*l+l+1-\/m) = beta*dst\_l(l*l+l+1-\/m) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02891}02891                     \textcolor{comment}{! Update P\_\{l-\/2\}\string^m and P\_\{l-\/1\}\string^m for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02892}02892                     pl2m = pl1m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02893}02893                     pl1m = plm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02894}02894 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02895}02895                 \textcolor{comment}{! Update cos(m*phi) and sin(m*phi) for the next iteration}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02896}02896                 tmp1 = cmphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02897}02897                 cmphi = cmphi*cphi -\/ smphi*sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02898}02898                 smphi = tmp1*sphi + smphi*cphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02899}02899 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02900}02900             \textcolor{comment}{! Case m=p requires only to use P\_m\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02901}02901             ylm = pmm * vscales\_rel((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02902}02902             ylm = work(p+1) * ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02903}02903             dst\_l((p+1)**2) = beta*dst\_l((p+1)**2) + cmphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02904}02904             dst\_l(p*p+1) = beta*dst\_l(p*p+1) + smphi*ylm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02905}02905 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02906}02906     \textcolor{comment}{! Case of x(1:2) = 0 and x(3) != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02907}02907     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02908}02908         \textcolor{comment}{! In this case Y\_l\string^m = 0 for m != 0, so only case m = 0 is taken into}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02909}02909         \textcolor{comment}{! account. Y\_l\string^m = ctheta\string^m in this case where ctheta is either +1 or}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02910}02910         \textcolor{comment}{! -\/1. So, we copy sign(ctheta) into rcoef.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02911}02911         rcoef = sign(rcoef, c(3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02912}02912         \textcolor{comment}{! Init t and proceed with accumulation of a potential}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02913}02913         t = src\_q}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02914}02914         indl = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02915}02915         \textcolor{comment}{! Overwrite output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02916}02916         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02917}02917             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02918}02918                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02919}02919                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02920}02920                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02921}02921                 dst\_l(indl) = t * vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02922}02922                 dst\_l(indl-\/l:indl-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02923}02923                 dst\_l(indl+1:indl+l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02924}02924                 \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02925}02925                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02926}02926 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02927}02927         \textcolor{comment}{! Update output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02928}02928         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02929}02929             \textcolor{keywordflow}{do} l = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02930}02930                 \textcolor{comment}{! Index of Y\_l\string^0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02931}02931                 indl = indl + 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02932}02932                 \textcolor{comment}{! Add 4*pi/(2*l+1)*rcoef\string^\{l+1\}*Y\_l\string^0 contribution}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02933}02933                 dst\_l(indl) = beta*dst\_l(indl) + t*vscales\_rel(indl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02934}02934                 dst\_l(indl-\/l:indl-\/1) = beta * dst\_l(indl-\/l:indl-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02935}02935                 dst\_l(indl+1:indl+l) = beta * dst\_l(indl+1:indl+l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02936}02936                 \textcolor{comment}{! Update t}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02937}02937                 t = t * rcoef}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02938}02938 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02939}02939 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02940}02940 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02941}02941 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a02d5736e15ad31da5e0a6b349fdacac1}{fmm\_l2p\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02942}02942 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02997}\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{02997}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p, r1, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02998}02998     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l02999}02999     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03000}03000 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: r1(-\/1:1, -\/1:1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03001}03001     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03002}03002 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03003}03003     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03004}03004 \textcolor{keywordtype}{    real}(dp) :: work(2*(2*p+1)*(2*p+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03005}03005     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03006}03006     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab643a611d5cbc4b1a035546a01eb9bf5}{fmm\_sph\_transform\_work}}(p, r1, alpha, src, beta, dst, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03007}03007 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03008}03008 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03022}\mbox{\hyperlink{namespaceddx__harmonics_ab643a611d5cbc4b1a035546a01eb9bf5}{03022}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab643a611d5cbc4b1a035546a01eb9bf5}{fmm\_sph\_transform\_work}}(p, r1, alpha, src, beta, dst, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03023}03023     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03024}03024     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03025}03025 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: r1(-\/1:1, -\/1:1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03026}03026     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03027}03027 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03028}03028     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03029}03029 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(2*p+1)*(2*p+3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03030}03030     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03031}03031 \textcolor{keywordtype}{    real}(dp) :: u, v, w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03032}03032     \textcolor{keywordtype}{integer} :: l, m, n, ind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03033}03033     \textcolor{comment}{! Pointers for a workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03034}03034 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: r\_prev(:, :), r(:, :), scal\_uvw\_m(:), scal\_u\_n(:), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03035}03035         \& scal\_v\_n(:), scal\_w\_n(:), r\_swap(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03036}03036     \textcolor{comment}{! In case alpha is zero just scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03037}03037     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03038}03038         \textcolor{comment}{! Set output to zero if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03039}03039         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03040}03040             dst = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03041}03041         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03042}03042             dst = beta * dst}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03043}03043 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03044}03044         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03045}03045         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03046}03046 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03047}03047     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03048}03048     \textcolor{comment}{! In case beta is zero output is just overwritten without being read}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03049}03049     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03050}03050         \textcolor{comment}{! Compute rotations/reflections}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03051}03051         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03052}03052         dst(1) = alpha * src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03053}03053         \textcolor{keywordflow}{if} (p .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03054}03054             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03055}03055 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03056}03056         \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03057}03057         dst(2) = alpha * dot\_product(r1(-\/1:1,-\/1), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03058}03058         dst(3) = alpha * dot\_product(r1(-\/1:1,0), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03059}03059         dst(4) = alpha * dot\_product(r1(-\/1:1,1), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03060}03060         \textcolor{keywordflow}{if} (p .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03061}03061             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03062}03062 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03063}03063         \textcolor{comment}{! Set pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03064}03064         n = 2*p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03065}03065         l = n ** 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03066}03066         r\_prev(-\/p:p, -\/p:p) => work(1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03067}03067         m = 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03068}03068         r(-\/p:p, -\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03069}03069         l = m + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03070}03070         scal\_uvw\_m(-\/p:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03071}03071         m = l + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03072}03072         scal\_u\_n(-\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03073}03073         l = m + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03074}03074         scal\_v\_n(-\/p:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03075}03075         m = l + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03076}03076         scal\_w\_n(-\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03077}03077         \textcolor{comment}{! l = 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03078}03078         r(2, 2) = (r1(1, 1)*r1(1, 1) -\/ r1(1, -\/1)*r1(1, -\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03079}03079             \& r1(-\/1, 1)*r1(-\/1, 1) + r1(-\/1, -\/1)*r1(-\/1, -\/1)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03080}03080         r(2, 1) = r1(1, 1)*r1(1, 0) -\/ r1(-\/1, 1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03081}03081         r(2, 0) = sqrt3 / two * (r1(1, 0)*r1(1, 0) -\/ r1(-\/1, 0)*r1(-\/1, 0))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03082}03082         r(2, -\/1) = r1(1, -\/1)*r1(1, 0) -\/ r1(-\/1, -\/1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03083}03083         r(2, -\/2) = r1(1, 1)*r1(1, -\/1) -\/ r1(-\/1, 1)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03084}03084         r(1, 2) = r1(1, 1)*r1(0, 1) -\/ r1(1, -\/1)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03085}03085         r(1, 1) = r1(1, 1)*r1(0, 0) + r1(1, 0)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03086}03086         r(1, 0) = sqrt3 * r1(1, 0) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03087}03087         r(1, -\/1) = r1(1, -\/1)*r1(0, 0) + r1(1, 0)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03088}03088         r(1, -\/2) = r1(1, 1)*r1(0, -\/1) + r1(1, -\/1)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03089}03089         r(0, 2) = sqrt3 / two * (r1(0, 1)*r1(0, 1) -\/ r1(0, -\/1)*r1(0, -\/1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03090}03090         r(0, 1) = sqrt3 * r1(0, 1) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03091}03091         r(0, 0) = (three*r1(0, 0)*r1(0, 0)-\/one) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03092}03092         r(0, -\/1) = sqrt3 * r1(0, -\/1) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03093}03093         r(0, -\/2) = sqrt3 * r1(0, 1) * r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03094}03094         r(-\/1, 2) = r1(-\/1, 1)*r1(0, 1) -\/ r1(-\/1, -\/1)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03095}03095         r(-\/1, 1) = r1(-\/1, 1)*r1(0, 0) + r1(-\/1, 0)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03096}03096         r(-\/1, 0) = sqrt3 * r1(-\/1, 0) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03097}03097         r(-\/1, -\/1) = r1(-\/1, -\/1)*r1(0, 0) + r1(0, -\/1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03098}03098         r(-\/1, -\/2) = r1(-\/1, 1)*r1(0, -\/1) + r1(-\/1, -\/1)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03099}03099         r(-\/2, 2) = r1(1, 1)*r1(-\/1, 1) -\/ r1(1, -\/1)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03100}03100         r(-\/2, 1) = r1(1, 1)*r1(-\/1, 0) + r1(1, 0)*r1(-\/1, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03101}03101         r(-\/2, 0) = sqrt3 * r1(1, 0) * r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03102}03102         r(-\/2, -\/1) = r1(1, -\/1)*r1(-\/1, 0) + r1(1, 0)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03103}03103         r(-\/2, -\/2) = r1(1, 1)*r1(-\/1, -\/1) + r1(1, -\/1)*r1(-\/1, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03104}03104         \textcolor{keywordflow}{do} m = -\/2, 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03105}03105             dst(7+m) = alpha * dot\_product(r(-\/2:2, m), src(5:9))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03106}03106 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03107}03107         \textcolor{comment}{! l > 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03108}03108         \textcolor{keywordflow}{do} l = 3, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03109}03109             \textcolor{comment}{! Swap previous and current rotation matrices}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03110}03110             r\_swap => r\_prev}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03111}03111             r\_prev => r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03112}03112             r => r\_swap}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03113}03113             \textcolor{comment}{! Prepare scalar factors}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03114}03114             scal\_uvw\_m(0) = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03115}03115             \textcolor{keywordflow}{do} m = 1, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03116}03116                 u = sqrt(dble(l*l-\/m*m))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03117}03117                 scal\_uvw\_m(m) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03118}03118                 scal\_uvw\_m(-\/m) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03119}03119 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03120}03120             u = two * dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03121}03121             u = sqrt(dble(u*(u-\/one)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03122}03122             scal\_uvw\_m(l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03123}03123             scal\_uvw\_m(-\/l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03124}03124             scal\_u\_n(0) = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03125}03125             scal\_v\_n(0) = -\/sqrt(dble(l*(l-\/1))) / sqrt2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03126}03126             scal\_w\_n(0) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03127}03127             \textcolor{keywordflow}{do} n = 1, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03128}03128                 u = sqrt(dble(l*l-\/n*n))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03129}03129                 scal\_u\_n(n) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03130}03130                 scal\_u\_n(-\/n) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03131}03131                 v = dble(l+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03132}03132                 v = sqrt(v*(v-\/one)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03133}03133                 scal\_v\_n(n) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03134}03134                 scal\_v\_n(-\/n) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03135}03135                 w = dble(l-\/n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03136}03136                 w = -\/sqrt(w*(w-\/one)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03137}03137                 scal\_w\_n(n) = w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03138}03138                 scal\_w\_n(-\/n) = w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03139}03139 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03140}03140             u = sqrt(dble(2*l-\/1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03141}03141             scal\_u\_n(l-\/1) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03142}03142             scal\_u\_n(1-\/l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03143}03143             scal\_u\_n(l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03144}03144             scal\_u\_n(-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03145}03145             v = sqrt(dble((2*l-\/1)*(2*l-\/2))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03146}03146             scal\_v\_n(l-\/1) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03147}03147             scal\_v\_n(1-\/l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03148}03148             v = sqrt(dble(2*l*(2*l-\/1))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03149}03149             scal\_v\_n(l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03150}03150             scal\_v\_n(-\/l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03151}03151             scal\_w\_n(l-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03152}03152             scal\_w\_n(l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03153}03153             scal\_w\_n(-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03154}03154             scal\_w\_n(1-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03155}03155             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03156}03156             \textcolor{comment}{! m = l, n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03157}03157             v = r1(1, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(l-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03158}03158                 \& r1(-\/1, 1)*r\_prev(1-\/l, l-\/1) + r1(-\/1, -\/1)*r\_prev(1-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03159}03159             r(l, l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03160}03160             \textcolor{comment}{!dst(ind+l) = src(ind+l) * r(l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03161}03161             \textcolor{comment}{! m = l, n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03162}03162             v = r1(1, 1)*r\_prev(1-\/l, l-\/1) -\/ r1(1, -\/1)*r\_prev(1-\/l, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03163}03163                 \& r1(-\/1, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(l-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03164}03164             r(-\/l, l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03165}03165             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/l)*r(-\/l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03166}03166             \textcolor{comment}{! m = l, n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03167}03167             u = r1(0, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(0, -\/1)*r\_prev(l-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03168}03168             v = r1(1, 1)*r\_prev(l-\/2, l-\/1) -\/ r1(1, -\/1)*r\_prev(l-\/2, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03169}03169                 \& r1(-\/1, 1)*r\_prev(2-\/l, l-\/1) + r1(-\/1, -\/1)*r\_prev(2-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03170}03170             r(l-\/1, l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03171}03171             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+l-\/1)*r(l-\/1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03172}03172             \textcolor{comment}{! m = l, n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03173}03173             u = r1(0, 1)*r\_prev(1-\/l, l-\/1) -\/ r1(0, -\/1)*r\_prev(1-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03174}03174             v = r1(1, 1)*r\_prev(2-\/l, l-\/1) -\/ r1(1, -\/1)*r\_prev(2-\/l, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03175}03175                 \& r1(-\/1, 1)*r\_prev(l-\/2, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(l-\/2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03176}03176             r(1-\/l, l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03177}03177             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+1-\/l)*r(1-\/l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03178}03178             \textcolor{comment}{! m = l, n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03179}03179             u = r1(0, 1)*r\_prev(1, l-\/1) -\/ r1(0, -\/1)*r\_prev(1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03180}03180             v = r1(1, 1)*r\_prev(0, l-\/1) -\/ r1(1, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03181}03181             w = r1(1, 1)*r\_prev(2, l-\/1) -\/ r1(1, -\/1)*r\_prev(2, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03182}03182                 \& r1(-\/1, 1)*r\_prev(-\/2, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03183}03183             r(1, l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03184}03184             r(1, l) = r(1, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03185}03185             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+1)*r(1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03186}03186             \textcolor{comment}{! m = l, n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03187}03187             u = r1(0, 1)*r\_prev(-\/1, l-\/1) -\/ r1(0, -\/1)*r\_prev(-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03188}03188             v = r1(-\/1, 1)*r\_prev(0, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03189}03189             w = r1(1, 1)*r\_prev(-\/2, l-\/1) -\/ r1(1, -\/1)*r\_prev(-\/2, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03190}03190                 \& r1(-\/1, 1)*r\_prev(2, l-\/1) + r1(-\/1, -\/1)*r\_prev(2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03191}03191             r(-\/1, l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03192}03192             r(-\/1, l) = r(-\/1, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03193}03193             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/1)*r(-\/1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03194}03194             \textcolor{comment}{! m = l, n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03195}03195             u = r1(0, 1)*r\_prev(0, l-\/1) -\/ r1(0, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03196}03196             v = r1(1, 1)*r\_prev(1, l-\/1) -\/ r1(1, -\/1)*r\_prev(1, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03197}03197                 \& r1(-\/1, 1)*r\_prev(-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03198}03198             r(0, l) = (u*scal\_u\_n(0) + v*scal\_v\_n(0)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03199}03199             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind)*r(0, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03200}03200             \textcolor{comment}{! m = l, n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03201}03201             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03202}03202                 u = r1(0, 1)*r\_prev(n, l-\/1) -\/ r1(0, -\/1)*r\_prev(n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03203}03203                 v = r1(1, 1)*r\_prev(n-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(n-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03204}03204                     \& r1(-\/1, 1)*r\_prev(1-\/n, l-\/1) + r1(-\/1, -\/1)*r\_prev(1-\/n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03205}03205                 w = r1(1, 1)*r\_prev(n+1, l-\/1) -\/ r1(1, -\/1)*r\_prev(n+1, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03206}03206                     \& r1(-\/1, 1)*r\_prev(-\/n-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/n-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03207}03207                 r(n, l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03208}03208                 r(n, l) = r(n, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03209}03209                 \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+n)*r(n, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03210}03210                 u = r1(0, 1)*r\_prev(-\/n, l-\/1) -\/ r1(0, -\/1)*r\_prev(-\/n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03211}03211                 v = r1(1, 1)*r\_prev(1-\/n, l-\/1) -\/ r1(1, -\/1)*r\_prev(1-\/n, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03212}03212                     \& r1(-\/1, 1)*r\_prev(n-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(n-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03213}03213                 w = r1(1, 1)*r\_prev(-\/n-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(-\/n-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03214}03214                     \& r1(-\/1, 1)*r\_prev(n+1, l-\/1) + r1(-\/1, -\/1)*r\_prev(n+1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03215}03215                 r(-\/n, l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03216}03216                 r(-\/n, l) = r(-\/n, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03217}03217                 \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/n)*r(-\/n, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03218}03218 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03219}03219             dst(ind+l) = alpha * dot\_product(src(ind-\/l:ind+l), r(-\/l:l, l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03220}03220             \textcolor{comment}{! m = -\/l, n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03221}03221             v = r1(1, 1)*r\_prev(l-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(l-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03222}03222                 \& r1(-\/1, 1)*r\_prev(1-\/l, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(1-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03223}03223             r(l, -\/l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03224}03224             \textcolor{comment}{!dst(ind-\/l) = src(ind+l)*r(l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03225}03225             \textcolor{comment}{! m = -\/l, n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03226}03226             v = r1(1, 1)*r\_prev(1-\/l, 1-\/l) + r1(1, -\/1)*r\_prev(1-\/l, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03227}03227                 \& r1(-\/1, 1)*r\_prev(l-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03228}03228             r(-\/l, -\/l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03229}03229             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/l)*r(-\/l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03230}03230             \textcolor{comment}{! m = -\/l, n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03231}03231             u = r1(0, 1)*r\_prev(l-\/1, 1-\/l) + r1(0, -\/1)*r\_prev(l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03232}03232             v = r1(1, 1)*r\_prev(l-\/2, 1-\/l) + r1(1, -\/1)*r\_prev(l-\/2, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03233}03233                 \& r1(-\/1, 1)*r\_prev(2-\/l, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(2-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03234}03234             r(l-\/1, -\/l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03235}03235             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+l-\/1)*r(l-\/1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03236}03236             \textcolor{comment}{! m = -\/l, n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03237}03237             u = r1(0, 1)*r\_prev(1-\/l, 1-\/l) + r1(0, -\/1)*r\_prev(1-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03238}03238             v = r1(1, 1)*r\_prev(2-\/l, 1-\/l) + r1(1, -\/1)*r\_prev(2-\/l, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03239}03239                 \& r1(-\/1, 1)*r\_prev(l-\/2, 1-\/l) + r1(-\/1, -\/1)*r\_prev(l-\/2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03240}03240             r(1-\/l, -\/l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03241}03241             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+1-\/l)*r(1-\/l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03242}03242             \textcolor{comment}{! m = -\/l, n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03243}03243             u = r1(0, 1)*r\_prev(1, 1-\/l) + r1(0, -\/1)*r\_prev(1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03244}03244             v = r1(1, 1)*r\_prev(0, 1-\/l) + r1(1, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03245}03245             w = r1(1, 1)*r\_prev(2, 1-\/l) + r1(1, -\/1)*r\_prev(2, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03246}03246                 \& r1(-\/1, 1)*r\_prev(-\/2, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03247}03247             r(1, -\/l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03248}03248             r(1, -\/l) = r(1, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03249}03249             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+1)*r(1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03250}03250             \textcolor{comment}{! m = -\/l, n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03251}03251             u = r1(0, 1)*r\_prev(-\/1, 1-\/l) + r1(0, -\/1)*r\_prev(-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03252}03252             v = r1(-\/1, 1)*r\_prev(0, 1-\/l) + r1(-\/1, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03253}03253             w = r1(1, 1)*r\_prev(-\/2, 1-\/l) + r1(1, -\/1)*r\_prev(-\/2, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03254}03254                 \& r1(-\/1, 1)*r\_prev(2, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03255}03255             r(-\/1, -\/l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03256}03256             r(-\/1, -\/l) = r(-\/1, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03257}03257             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/1)*r(-\/1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03258}03258             \textcolor{comment}{! m = -\/l, n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03259}03259             u = r1(0, 1)*r\_prev(0, 1-\/l) + r1(0, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03260}03260             v = r1(1, 1)*r\_prev(1, 1-\/l) + r1(1, -\/1)*r\_prev(1, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03261}03261                 \& r1(-\/1, 1)*r\_prev(-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03262}03262             r(0, -\/l) = (u*scal\_u\_n(0) + v*scal\_v\_n(0)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03263}03263             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind)*r(0, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03264}03264             \textcolor{comment}{! m = -\/l, n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03265}03265             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03266}03266                 u = r1(0, 1)*r\_prev(n, 1-\/l) + r1(0, -\/1)*r\_prev(n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03267}03267                 v = r1(1, 1)*r\_prev(n-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(n-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03268}03268                     \& r1(-\/1, 1)*r\_prev(1-\/n, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(1-\/n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03269}03269                 w = r1(1, 1)*r\_prev(n+1, 1-\/l) + r1(1, -\/1)*r\_prev(n+1, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03270}03270                     \& r1(-\/1, 1)*r\_prev(-\/n-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/n-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03271}03271                 r(n, -\/l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03272}03272                 r(n, -\/l) = r(n, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03273}03273                 \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+n)*r(n, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03274}03274                 u = r1(0, 1)*r\_prev(-\/n, 1-\/l) + r1(0, -\/1)*r\_prev(-\/n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03275}03275                 v = r1(1, 1)*r\_prev(1-\/n, 1-\/l) + r1(1, -\/1)*r\_prev(1-\/n, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03276}03276                     \& r1(-\/1, 1)*r\_prev(n-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(n-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03277}03277                 w = r1(1, 1)*r\_prev(-\/n-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(-\/n-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03278}03278                     \& r1(-\/1, 1)*r\_prev(n+1, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(n+1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03279}03279                 r(-\/n, -\/l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03280}03280                 r(-\/n, -\/l) = r(-\/n, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03281}03281                 \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/n)*r(-\/n, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03282}03282 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03283}03283             dst(ind-\/l) = alpha * dot\_product(src(ind-\/l:ind+l), r(-\/l:l, -\/l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03284}03284             \textcolor{comment}{! Now deal with m=1-\/l..l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03285}03285             \textcolor{keywordflow}{do} m = 1-\/l, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03286}03286                 \textcolor{comment}{! n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03287}03287                 v = r1(1, 0)*r\_prev(l-\/1, m) -\/ r1(-\/1, 0)*r\_prev(1-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03288}03288                 r(l, m) = v * scal\_v\_n(l) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03289}03289                 \textcolor{comment}{!dst(ind+m) = src(ind+l) * r(l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03290}03290                 \textcolor{comment}{! n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03291}03291                 v = r1(1, 0)*r\_prev(1-\/l, m) + r1(-\/1, 0)*r\_prev(l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03292}03292                 r(-\/l, m) = v * scal\_v\_n(l) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03293}03293                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/l)*r(-\/l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03294}03294                 \textcolor{comment}{! n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03295}03295                 u = r1(0, 0) * r\_prev(l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03296}03296                 v = r1(1, 0)*r\_prev(l-\/2, m) -\/ r1(-\/1, 0)*r\_prev(2-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03297}03297                 r(l-\/1, m) = u*scal\_u\_n(l-\/1) + v*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03298}03298                 r(l-\/1, m) = r(l-\/1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03299}03299                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+l-\/1)*r(l-\/1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03300}03300                 \textcolor{comment}{! n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03301}03301                 u = r1(0, 0) * r\_prev(1-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03302}03302                 v = r1(1, 0)*r\_prev(2-\/l, m) + r1(-\/1, 0)*r\_prev(l-\/2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03303}03303                 r(1-\/l, m) = u*scal\_u\_n(l-\/1) + v*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03304}03304                 r(1-\/l, m) = r(1-\/l, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03305}03305                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+1-\/l)*r(1-\/l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03306}03306                 \textcolor{comment}{! n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03307}03307                 u = r1(0, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03308}03308                 v = r1(1, 0)*r\_prev(1, m) + r1(-\/1, 0)*r\_prev(-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03309}03309                 r(0, m) = u*scal\_u\_n(0) + v*scal\_v\_n(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03310}03310                 r(0, m) = r(0, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03311}03311                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind)*r(0, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03312}03312                 \textcolor{comment}{! n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03313}03313                 u = r1(0, 0) * r\_prev(1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03314}03314                 v = r1(1, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03315}03315                 w = r1(1, 0)*r\_prev(2, m) + r1(-\/1, 0)*r\_prev(-\/2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03316}03316                 r(1, m) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03317}03317                 r(1, m) = r(1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03318}03318                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+1)*r(1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03319}03319                 \textcolor{comment}{! n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03320}03320                 u = r1(0, 0) * r\_prev(-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03321}03321                 v = r1(-\/1, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03322}03322                 w = r1(1, 0)*r\_prev(-\/2, m) -\/ r1(-\/1, 0)*r\_prev(2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03323}03323                 r(-\/1, m) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03324}03324                 r(-\/1, m) = r(-\/1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03325}03325                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/1)*r(-\/1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03326}03326                 \textcolor{comment}{! n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03327}03327                 \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03328}03328                     u = r1(0, 0) * r\_prev(n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03329}03329                     v = r1(1, 0)*r\_prev(n-\/1, m) -\/ r1(-\/1, 0)*r\_prev(1-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03330}03330                     w = r1(1, 0)*r\_prev(n+1, m) + r1(-\/1, 0)*r\_prev(-\/1-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03331}03331                     r(n, m) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03332}03332                     r(n, m) = r(n, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03333}03333                     \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+n)*r(n, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03334}03334                     u = r1(0, 0) * r\_prev(-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03335}03335                     v = r1(1, 0)*r\_prev(1-\/n, m) + r1(-\/1, 0)*r\_prev(n-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03336}03336                     w = r1(1, 0)*r\_prev(-\/n-\/1, m) -\/ r1(-\/1, 0)*r\_prev(n+1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03337}03337                     r(-\/n, m) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03338}03338                     r(-\/n, m) = r(-\/n, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03339}03339                     \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/n)*r(-\/n, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03340}03340 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03341}03341                 dst(ind+m) = alpha * dot\_product(src(ind-\/l:ind+l), r(-\/l:l, m))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03342}03342 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03343}03343 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03344}03344     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03345}03345         \textcolor{comment}{! Compute rotations/reflections}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03346}03346         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03347}03347         dst(1) = beta*dst(1) + alpha*src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03348}03348         \textcolor{keywordflow}{if} (p .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03349}03349             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03350}03350 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03351}03351         \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03352}03352         dst(2) = beta*dst(2) + alpha*dot\_product(r1(-\/1:1,-\/1), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03353}03353         dst(3) = beta*dst(3) + alpha*dot\_product(r1(-\/1:1,0), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03354}03354         dst(4) = beta*dst(4) + alpha*dot\_product(r1(-\/1:1,1), src(2:4))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03355}03355         \textcolor{keywordflow}{if} (p .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03356}03356             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03357}03357 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03358}03358         \textcolor{comment}{! Set pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03359}03359         n = 2*p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03360}03360         l = n ** 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03361}03361         r\_prev(-\/p:p, -\/p:p) => work(1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03362}03362         m = 2*l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03363}03363         r(-\/p:p, -\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03364}03364         l = m + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03365}03365         scal\_uvw\_m(-\/p:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03366}03366         m = l + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03367}03367         scal\_u\_n(-\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03368}03368         l = m + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03369}03369         scal\_v\_n(-\/p:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03370}03370         m = l + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03371}03371         scal\_w\_n(-\/p:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03372}03372         \textcolor{comment}{! l = 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03373}03373         r(2, 2) = (r1(1, 1)*r1(1, 1) -\/ r1(1, -\/1)*r1(1, -\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03374}03374             \& r1(-\/1, 1)*r1(-\/1, 1) + r1(-\/1, -\/1)*r1(-\/1, -\/1)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03375}03375         r(2, 1) = r1(1, 1)*r1(1, 0) -\/ r1(-\/1, 1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03376}03376         r(2, 0) = sqrt3 / two * (r1(1, 0)*r1(1, 0) -\/ r1(-\/1, 0)*r1(-\/1, 0))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03377}03377         r(2, -\/1) = r1(1, -\/1)*r1(1, 0) -\/ r1(-\/1, -\/1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03378}03378         r(2, -\/2) = r1(1, 1)*r1(1, -\/1) -\/ r1(-\/1, 1)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03379}03379         r(1, 2) = r1(1, 1)*r1(0, 1) -\/ r1(1, -\/1)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03380}03380         r(1, 1) = r1(1, 1)*r1(0, 0) + r1(1, 0)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03381}03381         r(1, 0) = sqrt3 * r1(1, 0) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03382}03382         r(1, -\/1) = r1(1, -\/1)*r1(0, 0) + r1(1, 0)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03383}03383         r(1, -\/2) = r1(1, 1)*r1(0, -\/1) + r1(1, -\/1)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03384}03384         r(0, 2) = sqrt3 / two * (r1(0, 1)*r1(0, 1) -\/ r1(0, -\/1)*r1(0, -\/1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03385}03385         r(0, 1) = sqrt3 * r1(0, 1) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03386}03386         r(0, 0) = (three*r1(0, 0)*r1(0, 0)-\/one) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03387}03387         r(0, -\/1) = sqrt3 * r1(0, -\/1) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03388}03388         r(0, -\/2) = sqrt3 * r1(0, 1) * r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03389}03389         r(-\/1, 2) = r1(-\/1, 1)*r1(0, 1) -\/ r1(-\/1, -\/1)*r1(0, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03390}03390         r(-\/1, 1) = r1(-\/1, 1)*r1(0, 0) + r1(-\/1, 0)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03391}03391         r(-\/1, 0) = sqrt3 * r1(-\/1, 0) * r1(0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03392}03392         r(-\/1, -\/1) = r1(-\/1, -\/1)*r1(0, 0) + r1(0, -\/1)*r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03393}03393         r(-\/1, -\/2) = r1(-\/1, 1)*r1(0, -\/1) + r1(-\/1, -\/1)*r1(0, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03394}03394         r(-\/2, 2) = r1(1, 1)*r1(-\/1, 1) -\/ r1(1, -\/1)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03395}03395         r(-\/2, 1) = r1(1, 1)*r1(-\/1, 0) + r1(1, 0)*r1(-\/1, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03396}03396         r(-\/2, 0) = sqrt3 * r1(1, 0) * r1(-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03397}03397         r(-\/2, -\/1) = r1(1, -\/1)*r1(-\/1, 0) + r1(1, 0)*r1(-\/1, -\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03398}03398         r(-\/2, -\/2) = r1(1, 1)*r1(-\/1, -\/1) + r1(1, -\/1)*r1(-\/1, 1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03399}03399         \textcolor{keywordflow}{do} m = -\/2, 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03400}03400             dst(7+m) = beta*dst(7+m) + alpha*dot\_product(r(-\/2:2, m), src(5:9))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03401}03401 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03402}03402         \textcolor{comment}{! l > 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03403}03403         \textcolor{keywordflow}{do} l = 3, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03404}03404             \textcolor{comment}{! Swap previous and current rotation matrices}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03405}03405             r\_swap => r\_prev}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03406}03406             r\_prev => r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03407}03407             r => r\_swap}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03408}03408             \textcolor{comment}{! Prepare scalar factors}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03409}03409             scal\_uvw\_m(0) = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03410}03410             \textcolor{keywordflow}{do} m = 1, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03411}03411                 u = sqrt(dble(l*l-\/m*m))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03412}03412                 scal\_uvw\_m(m) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03413}03413                 scal\_uvw\_m(-\/m) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03414}03414 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03415}03415             u = two * dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03416}03416             u = sqrt(dble(u*(u-\/one)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03417}03417             scal\_uvw\_m(l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03418}03418             scal\_uvw\_m(-\/l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03419}03419             scal\_u\_n(0) = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03420}03420             scal\_v\_n(0) = -\/sqrt(dble(l*(l-\/1))) / sqrt2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03421}03421             scal\_w\_n(0) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03422}03422             \textcolor{keywordflow}{do} n = 1, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03423}03423                 u = sqrt(dble(l*l-\/n*n))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03424}03424                 scal\_u\_n(n) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03425}03425                 scal\_u\_n(-\/n) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03426}03426                 v = dble(l+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03427}03427                 v = sqrt(v*(v-\/one)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03428}03428                 scal\_v\_n(n) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03429}03429                 scal\_v\_n(-\/n) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03430}03430                 w = dble(l-\/n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03431}03431                 w = -\/sqrt(w*(w-\/one)) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03432}03432                 scal\_w\_n(n) = w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03433}03433                 scal\_w\_n(-\/n) = w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03434}03434 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03435}03435             u = sqrt(dble(2*l-\/1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03436}03436             scal\_u\_n(l-\/1) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03437}03437             scal\_u\_n(1-\/l) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03438}03438             scal\_u\_n(l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03439}03439             scal\_u\_n(-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03440}03440             v = sqrt(dble((2*l-\/1)*(2*l-\/2))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03441}03441             scal\_v\_n(l-\/1) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03442}03442             scal\_v\_n(1-\/l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03443}03443             v = sqrt(dble(2*l*(2*l-\/1))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03444}03444             scal\_v\_n(l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03445}03445             scal\_v\_n(-\/l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03446}03446             scal\_w\_n(l-\/1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03447}03447             scal\_w\_n(l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03448}03448             scal\_w\_n(-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03449}03449             scal\_w\_n(1-\/l) = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03450}03450             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03451}03451             \textcolor{comment}{! m = l, n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03452}03452             v = r1(1, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(l-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03453}03453                 \& r1(-\/1, 1)*r\_prev(1-\/l, l-\/1) + r1(-\/1, -\/1)*r\_prev(1-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03454}03454             r(l, l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03455}03455             \textcolor{comment}{!dst(ind+l) = src(ind+l) * r(l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03456}03456             \textcolor{comment}{! m = l, n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03457}03457             v = r1(1, 1)*r\_prev(1-\/l, l-\/1) -\/ r1(1, -\/1)*r\_prev(1-\/l, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03458}03458                 \& r1(-\/1, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(l-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03459}03459             r(-\/l, l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03460}03460             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/l)*r(-\/l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03461}03461             \textcolor{comment}{! m = l, n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03462}03462             u = r1(0, 1)*r\_prev(l-\/1, l-\/1) -\/ r1(0, -\/1)*r\_prev(l-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03463}03463             v = r1(1, 1)*r\_prev(l-\/2, l-\/1) -\/ r1(1, -\/1)*r\_prev(l-\/2, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03464}03464                 \& r1(-\/1, 1)*r\_prev(2-\/l, l-\/1) + r1(-\/1, -\/1)*r\_prev(2-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03465}03465             r(l-\/1, l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03466}03466             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+l-\/1)*r(l-\/1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03467}03467             \textcolor{comment}{! m = l, n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03468}03468             u = r1(0, 1)*r\_prev(1-\/l, l-\/1) -\/ r1(0, -\/1)*r\_prev(1-\/l, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03469}03469             v = r1(1, 1)*r\_prev(2-\/l, l-\/1) -\/ r1(1, -\/1)*r\_prev(2-\/l, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03470}03470                 \& r1(-\/1, 1)*r\_prev(l-\/2, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(l-\/2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03471}03471             r(1-\/l, l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03472}03472             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+1-\/l)*r(1-\/l, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03473}03473             \textcolor{comment}{! m = l, n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03474}03474             u = r1(0, 1)*r\_prev(1, l-\/1) -\/ r1(0, -\/1)*r\_prev(1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03475}03475             v = r1(1, 1)*r\_prev(0, l-\/1) -\/ r1(1, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03476}03476             w = r1(1, 1)*r\_prev(2, l-\/1) -\/ r1(1, -\/1)*r\_prev(2, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03477}03477                 \& r1(-\/1, 1)*r\_prev(-\/2, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03478}03478             r(1, l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03479}03479             r(1, l) = r(1, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03480}03480             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+1)*r(1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03481}03481             \textcolor{comment}{! m = l, n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03482}03482             u = r1(0, 1)*r\_prev(-\/1, l-\/1) -\/ r1(0, -\/1)*r\_prev(-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03483}03483             v = r1(-\/1, 1)*r\_prev(0, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03484}03484             w = r1(1, 1)*r\_prev(-\/2, l-\/1) -\/ r1(1, -\/1)*r\_prev(-\/2, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03485}03485                 \& r1(-\/1, 1)*r\_prev(2, l-\/1) + r1(-\/1, -\/1)*r\_prev(2, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03486}03486             r(-\/1, l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03487}03487             r(-\/1, l) = r(-\/1, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03488}03488             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/1)*r(-\/1, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03489}03489             \textcolor{comment}{! m = l, n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03490}03490             u = r1(0, 1)*r\_prev(0, l-\/1) -\/ r1(0, -\/1)*r\_prev(0, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03491}03491             v = r1(1, 1)*r\_prev(1, l-\/1) -\/ r1(1, -\/1)*r\_prev(1, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03492}03492                 \& r1(-\/1, 1)*r\_prev(-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03493}03493             r(0, l) = (u*scal\_u\_n(0) + v*scal\_v\_n(0)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03494}03494             \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind)*r(0, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03495}03495             \textcolor{comment}{! m = l, n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03496}03496             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03497}03497                 u = r1(0, 1)*r\_prev(n, l-\/1) -\/ r1(0, -\/1)*r\_prev(n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03498}03498                 v = r1(1, 1)*r\_prev(n-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(n-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03499}03499                     \& r1(-\/1, 1)*r\_prev(1-\/n, l-\/1) + r1(-\/1, -\/1)*r\_prev(1-\/n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03500}03500                 w = r1(1, 1)*r\_prev(n+1, l-\/1) -\/ r1(1, -\/1)*r\_prev(n+1, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03501}03501                     \& r1(-\/1, 1)*r\_prev(-\/n-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(-\/n-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03502}03502                 r(n, l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03503}03503                 r(n, l) = r(n, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03504}03504                 \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind+n)*r(n, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03505}03505                 u = r1(0, 1)*r\_prev(-\/n, l-\/1) -\/ r1(0, -\/1)*r\_prev(-\/n, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03506}03506                 v = r1(1, 1)*r\_prev(1-\/n, l-\/1) -\/ r1(1, -\/1)*r\_prev(1-\/n, 1-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03507}03507                     \& r1(-\/1, 1)*r\_prev(n-\/1, l-\/1) -\/ r1(-\/1, -\/1)*r\_prev(n-\/1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03508}03508                 w = r1(1, 1)*r\_prev(-\/n-\/1, l-\/1) -\/ r1(1, -\/1)*r\_prev(-\/n-\/1, 1-\/l) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03509}03509                     \& r1(-\/1, 1)*r\_prev(n+1, l-\/1) + r1(-\/1, -\/1)*r\_prev(n+1, 1-\/l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03510}03510                 r(-\/n, l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03511}03511                 r(-\/n, l) = r(-\/n, l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03512}03512                 \textcolor{comment}{!dst(ind+l) = dst(ind+l) + src(ind-\/n)*r(-\/n, l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03513}03513 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03514}03514             dst(ind+l) = beta*dst(ind+l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03515}03515                 \& alpha*dot\_product(src(ind-\/l:ind+l), r(-\/l:l, l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03516}03516             \textcolor{comment}{! m = -\/l, n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03517}03517             v = r1(1, 1)*r\_prev(l-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(l-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03518}03518                 \& r1(-\/1, 1)*r\_prev(1-\/l, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(1-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03519}03519             r(l, -\/l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03520}03520             \textcolor{comment}{!dst(ind-\/l) = src(ind+l)*r(l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03521}03521             \textcolor{comment}{! m = -\/l, n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03522}03522             v = r1(1, 1)*r\_prev(1-\/l, 1-\/l) + r1(1, -\/1)*r\_prev(1-\/l, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03523}03523                 \& r1(-\/1, 1)*r\_prev(l-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03524}03524             r(-\/l, -\/l) = v * scal\_v\_n(l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03525}03525             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/l)*r(-\/l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03526}03526             \textcolor{comment}{! m = -\/l, n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03527}03527             u = r1(0, 1)*r\_prev(l-\/1, 1-\/l) + r1(0, -\/1)*r\_prev(l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03528}03528             v = r1(1, 1)*r\_prev(l-\/2, 1-\/l) + r1(1, -\/1)*r\_prev(l-\/2, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03529}03529                 \& r1(-\/1, 1)*r\_prev(2-\/l, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(2-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03530}03530             r(l-\/1, -\/l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03531}03531             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+l-\/1)*r(l-\/1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03532}03532             \textcolor{comment}{! m = -\/l, n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03533}03533             u = r1(0, 1)*r\_prev(1-\/l, 1-\/l) + r1(0, -\/1)*r\_prev(1-\/l, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03534}03534             v = r1(1, 1)*r\_prev(2-\/l, 1-\/l) + r1(1, -\/1)*r\_prev(2-\/l, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03535}03535                 \& r1(-\/1, 1)*r\_prev(l-\/2, 1-\/l) + r1(-\/1, -\/1)*r\_prev(l-\/2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03536}03536             r(1-\/l, -\/l) = (u*scal\_u\_n(l-\/1)+v*scal\_v\_n(l-\/1)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03537}03537             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+1-\/l)*r(1-\/l, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03538}03538             \textcolor{comment}{! m = -\/l, n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03539}03539             u = r1(0, 1)*r\_prev(1, 1-\/l) + r1(0, -\/1)*r\_prev(1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03540}03540             v = r1(1, 1)*r\_prev(0, 1-\/l) + r1(1, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03541}03541             w = r1(1, 1)*r\_prev(2, 1-\/l) + r1(1, -\/1)*r\_prev(2, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03542}03542                 \& r1(-\/1, 1)*r\_prev(-\/2, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03543}03543             r(1, -\/l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03544}03544             r(1, -\/l) = r(1, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03545}03545             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+1)*r(1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03546}03546             \textcolor{comment}{! m = -\/l, n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03547}03547             u = r1(0, 1)*r\_prev(-\/1, 1-\/l) + r1(0, -\/1)*r\_prev(-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03548}03548             v = r1(-\/1, 1)*r\_prev(0, 1-\/l) + r1(-\/1, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03549}03549             w = r1(1, 1)*r\_prev(-\/2, 1-\/l) + r1(1, -\/1)*r\_prev(-\/2, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03550}03550                 \& r1(-\/1, 1)*r\_prev(2, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03551}03551             r(-\/1, -\/l) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03552}03552             r(-\/1, -\/l) = r(-\/1, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03553}03553             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/1)*r(-\/1, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03554}03554             \textcolor{comment}{! m = -\/l, n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03555}03555             u = r1(0, 1)*r\_prev(0, 1-\/l) + r1(0, -\/1)*r\_prev(0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03556}03556             v = r1(1, 1)*r\_prev(1, 1-\/l) + r1(1, -\/1)*r\_prev(1, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03557}03557                 \& r1(-\/1, 1)*r\_prev(-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03558}03558             r(0, -\/l) = (u*scal\_u\_n(0) + v*scal\_v\_n(0)) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03559}03559             \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind)*r(0, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03560}03560             \textcolor{comment}{! m = -\/l, n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03561}03561             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03562}03562                 u = r1(0, 1)*r\_prev(n, 1-\/l) + r1(0, -\/1)*r\_prev(n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03563}03563                 v = r1(1, 1)*r\_prev(n-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(n-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03564}03564                     \& r1(-\/1, 1)*r\_prev(1-\/n, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(1-\/n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03565}03565                 w = r1(1, 1)*r\_prev(n+1, 1-\/l) + r1(1, -\/1)*r\_prev(n+1, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03566}03566                     \& r1(-\/1, 1)*r\_prev(-\/n-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(-\/n-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03567}03567                 r(n, -\/l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03568}03568                 r(n, -\/l) = r(n, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03569}03569                 \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind+n)*r(n, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03570}03570                 u = r1(0, 1)*r\_prev(-\/n, 1-\/l) + r1(0, -\/1)*r\_prev(-\/n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03571}03571                 v = r1(1, 1)*r\_prev(1-\/n, 1-\/l) + r1(1, -\/1)*r\_prev(1-\/n, l-\/1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03572}03572                     \& r1(-\/1, 1)*r\_prev(n-\/1, 1-\/l) + r1(-\/1, -\/1)*r\_prev(n-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03573}03573                 w = r1(1, 1)*r\_prev(-\/n-\/1, 1-\/l) + r1(1, -\/1)*r\_prev(-\/n-\/1, l-\/1) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03574}03574                     \& r1(-\/1, 1)*r\_prev(n+1, 1-\/l) -\/ r1(-\/1, -\/1)*r\_prev(n+1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03575}03575                 r(-\/n, -\/l) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03576}03576                 r(-\/n, -\/l) = r(-\/n, -\/l) / scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03577}03577                 \textcolor{comment}{!dst(ind-\/l) = dst(ind-\/l) + src(ind-\/n)*r(-\/n, -\/l)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03578}03578 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03579}03579             dst(ind-\/l) = beta*dst(ind-\/l) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03580}03580                 \& alpha*dot\_product(src(ind-\/l:ind+l), r(-\/l:l, -\/l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03581}03581             \textcolor{comment}{! Now deal with m=1-\/l..l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03582}03582             \textcolor{keywordflow}{do} m = 1-\/l, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03583}03583                 \textcolor{comment}{! n = l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03584}03584                 v = r1(1, 0)*r\_prev(l-\/1, m) -\/ r1(-\/1, 0)*r\_prev(1-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03585}03585                 r(l, m) = v * scal\_v\_n(l) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03586}03586                 \textcolor{comment}{!dst(ind+m) = src(ind+l) * r(l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03587}03587                 \textcolor{comment}{! n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03588}03588                 v = r1(1, 0)*r\_prev(1-\/l, m) + r1(-\/1, 0)*r\_prev(l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03589}03589                 r(-\/l, m) = v * scal\_v\_n(l) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03590}03590                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/l)*r(-\/l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03591}03591                 \textcolor{comment}{! n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03592}03592                 u = r1(0, 0) * r\_prev(l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03593}03593                 v = r1(1, 0)*r\_prev(l-\/2, m) -\/ r1(-\/1, 0)*r\_prev(2-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03594}03594                 r(l-\/1, m) = u*scal\_u\_n(l-\/1) + v*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03595}03595                 r(l-\/1, m) = r(l-\/1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03596}03596                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+l-\/1)*r(l-\/1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03597}03597                 \textcolor{comment}{! n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03598}03598                 u = r1(0, 0) * r\_prev(1-\/l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03599}03599                 v = r1(1, 0)*r\_prev(2-\/l, m) + r1(-\/1, 0)*r\_prev(l-\/2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03600}03600                 r(1-\/l, m) = u*scal\_u\_n(l-\/1) + v*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03601}03601                 r(1-\/l, m) = r(1-\/l, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03602}03602                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+1-\/l)*r(1-\/l, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03603}03603                 \textcolor{comment}{! n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03604}03604                 u = r1(0, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03605}03605                 v = r1(1, 0)*r\_prev(1, m) + r1(-\/1, 0)*r\_prev(-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03606}03606                 r(0, m) = u*scal\_u\_n(0) + v*scal\_v\_n(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03607}03607                 r(0, m) = r(0, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03608}03608                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind)*r(0, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03609}03609                 \textcolor{comment}{! n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03610}03610                 u = r1(0, 0) * r\_prev(1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03611}03611                 v = r1(1, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03612}03612                 w = r1(1, 0)*r\_prev(2, m) + r1(-\/1, 0)*r\_prev(-\/2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03613}03613                 r(1, m) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03614}03614                 r(1, m) = r(1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03615}03615                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+1)*r(1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03616}03616                 \textcolor{comment}{! n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03617}03617                 u = r1(0, 0) * r\_prev(-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03618}03618                 v = r1(-\/1, 0) * r\_prev(0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03619}03619                 w = r1(1, 0)*r\_prev(-\/2, m) -\/ r1(-\/1, 0)*r\_prev(2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03620}03620                 r(-\/1, m) = u*scal\_u\_n(1) + sqrt2*v*scal\_v\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03621}03621                 r(-\/1, m) = r(-\/1, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03622}03622                 \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/1)*r(-\/1, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03623}03623                 \textcolor{comment}{! n = 2-\/l..l-\/2, n != -\/1,0,1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03624}03624                 \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03625}03625                     u = r1(0, 0) * r\_prev(n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03626}03626                     v = r1(1, 0)*r\_prev(n-\/1, m) -\/ r1(-\/1, 0)*r\_prev(1-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03627}03627                     w = r1(1, 0)*r\_prev(n+1, m) + r1(-\/1, 0)*r\_prev(-\/1-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03628}03628                     r(n, m) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03629}03629                     r(n, m) = r(n, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03630}03630                     \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind+n)*r(n, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03631}03631                     u = r1(0, 0) * r\_prev(-\/n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03632}03632                     v = r1(1, 0)*r\_prev(1-\/n, m) + r1(-\/1, 0)*r\_prev(n-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03633}03633                     w = r1(1, 0)*r\_prev(-\/n-\/1, m) -\/ r1(-\/1, 0)*r\_prev(n+1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03634}03634                     r(-\/n, m) = u*scal\_u\_n(n) + v*scal\_v\_n(n) + w*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03635}03635                     r(-\/n, m) = r(-\/n, m) / scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03636}03636                     \textcolor{comment}{!dst(ind+m) = dst(ind+m) + src(ind-\/n)*r(-\/n, m)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03637}03637 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03638}03638                 dst(ind+m) = beta*dst(ind+m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03639}03639                     \& alpha*dot\_product(src(ind-\/l:ind+l), r(-\/l:l, m))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03640}03640 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03641}03641 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03642}03642 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03643}03643 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab643a611d5cbc4b1a035546a01eb9bf5}{fmm\_sph\_transform\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03644}03644 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03666}\mbox{\hyperlink{namespaceddx__harmonics_a8e16c11fcefb704bfa036827b574989c}{03666}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8e16c11fcefb704bfa036827b574989c}{fmm\_sph\_rotate\_oz}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03667}03667     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03668}03668     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03669}03669 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vcos(p+1), vsin(p+1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03670}03670     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03671}03671 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03672}03672     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03673}03673     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03674}03674 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8e16c11fcefb704bfa036827b574989c}{fmm\_sph\_rotate\_oz}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03675}03675 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03697}\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{03697}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03698}03698     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03699}03699     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03700}03700 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vcos(p+1), vsin(p+1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03701}03701     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03702}03702 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03703}03703     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03704}03704     \textcolor{keywordtype}{integer} :: l, m, ind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03705}03705 \textcolor{keywordtype}{    real}(dp) :: v1, v2, v3, v4}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03706}03706     \textcolor{comment}{! In case alpha is zero just scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03707}03707     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03708}03708         \textcolor{comment}{! Set output to zero if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03709}03709         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03710}03710             dst = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03711}03711         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03712}03712             dst = beta * dst}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03713}03713 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03714}03714         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03715}03715         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03716}03716 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03717}03717     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03718}03718     \textcolor{comment}{! In case beta is zero output is just overwritten without being read}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03719}03719     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03720}03720         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03721}03721         dst(1) = alpha*src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03722}03722         \textcolor{comment}{! l > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03723}03723         \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03724}03724         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03725}03725             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03726}03726             \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03727}03727             dst(ind) = alpha*src(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03728}03728             \textcolor{comment}{! m != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03729}03729             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03730}03730             \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03731}03731                 v1 = src(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03732}03732                 v2 = src(ind-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03733}03733                 v3 = vcos(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03734}03734                 v4 = vsin(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03735}03735                 \textcolor{comment}{! m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03736}03736                 dst(ind+m) = alpha * (v1*v3-\/v2*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03737}03737                 \textcolor{comment}{! m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03738}03738                 dst(ind-\/m) = alpha * (v1*v4+v2*v3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03739}03739 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03740}03740 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03741}03741     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03742}03742         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03743}03743         dst(1) = beta*dst(1) + alpha*src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03744}03744         \textcolor{comment}{! l > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03745}03745         \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03746}03746         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03747}03747             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03748}03748             \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03749}03749             dst(ind) = beta*dst(ind) + alpha*src(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03750}03750             \textcolor{comment}{! m != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03751}03751             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03752}03752             \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03753}03753                 v1 = src(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03754}03754                 v2 = src(ind-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03755}03755                 v3 = vcos(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03756}03756                 v4 = vsin(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03757}03757                 \textcolor{comment}{! m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03758}03758                 dst(ind+m) = beta*dst(ind+m) + alpha*(v1*v3-\/v2*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03759}03759                 \textcolor{comment}{! m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03760}03760                 dst(ind-\/m) = beta*dst(ind-\/m) + alpha*(v1*v4+v2*v3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03761}03761 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03762}03762 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03763}03763 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03764}03764 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03765}03765 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03787}\mbox{\hyperlink{namespaceddx__harmonics_a588c445e8bd85ccb3d81190be6b2901c}{03787}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a588c445e8bd85ccb3d81190be6b2901c}{fmm\_sph\_rotate\_oz\_adj}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03788}03788     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03789}03789     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03790}03790 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vcos(p+1), vsin(p+1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03791}03791     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03792}03792 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03793}03793     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03794}03794     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03795}03795 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a588c445e8bd85ccb3d81190be6b2901c}{fmm\_sph\_rotate\_oz\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03796}03796 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03818}\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{03818}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03819}03819     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03820}03820     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03821}03821 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vcos(p+1), vsin(p+1), alpha, src((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03822}03822     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03823}03823 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03824}03824     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03825}03825     \textcolor{keywordtype}{integer} :: l, m, ind}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03826}03826 \textcolor{keywordtype}{    real}(dp) :: v1, v2, v3, v4}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03827}03827     \textcolor{comment}{! In case alpha is zero just scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03828}03828     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03829}03829         \textcolor{comment}{! Set output to zero if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03830}03830         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03831}03831             dst = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03832}03832         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03833}03833             dst = beta * dst}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03834}03834 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03835}03835         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03836}03836         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03837}03837 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03838}03838     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03839}03839     \textcolor{comment}{! In case beta is zero output is just overwritten without being read}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03840}03840     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03841}03841         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03842}03842         dst(1) = alpha*src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03843}03843         \textcolor{comment}{! l > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03844}03844         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03845}03845             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03846}03846             \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03847}03847             dst(ind) = alpha*src(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03848}03848             \textcolor{comment}{! m != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03849}03849             \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03850}03850                 v1 = src(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03851}03851                 v2 = src(ind-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03852}03852                 v3 = vcos(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03853}03853                 v4 = vsin(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03854}03854                 \textcolor{comment}{! m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03855}03855                 dst(ind+m) = alpha * (v1*v3+v2*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03856}03856                 \textcolor{comment}{! m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03857}03857                 dst(ind-\/m) = alpha * (v2*v3-\/v1*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03858}03858 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03859}03859 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03860}03860     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03861}03861         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03862}03862         dst(1) = beta*dst(1) + alpha*src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03863}03863         \textcolor{comment}{! l > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03864}03864         \textcolor{keywordflow}{do} l = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03865}03865             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03866}03866             \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03867}03867             dst(ind) = beta*dst(ind) + alpha*src(ind)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03868}03868             \textcolor{comment}{! m != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03869}03869             \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03870}03870                 v1 = src(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03871}03871                 v2 = src(ind-\/m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03872}03872                 v3 = vcos(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03873}03873                 v4 = vsin(1+m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03874}03874                 \textcolor{comment}{! m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03875}03875                 dst(ind+m) = beta*dst(ind+m) + alpha*(v1*v3+v2*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03876}03876                 \textcolor{comment}{! m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03877}03877                 dst(ind-\/m) = beta*dst(ind-\/m) + alpha*(v2*v3-\/v1*v4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03878}03878 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03879}03879 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03880}03880 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03881}03881 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03882}03882 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03915}\mbox{\hyperlink{namespaceddx__harmonics_a3a330c054807d19fa99aa1bcfec71f9e}{03915}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3a330c054807d19fa99aa1bcfec71f9e}{fmm\_sph\_rotate\_oxz}}(p, ctheta, stheta, alpha, src, beta, dst)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03916}03916     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03917}03917     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03918}03918 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: ctheta, stheta, alpha, src((p+1)**2), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03919}03919     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03920}03920 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03921}03921     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03922}03922 \textcolor{keywordtype}{    real}(dp) :: work(2*(2*p+1)*(2*p+3)+p)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03923}03923     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03924}03924     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, alpha, src, beta, dst, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03925}03925         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03926}03926 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3a330c054807d19fa99aa1bcfec71f9e}{fmm\_sph\_rotate\_oxz}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03927}03927 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03940}\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{03940}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, alpha, src, beta, dst, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03941}03941         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03942}03942     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03943}03943     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03944}03944 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: ctheta, stheta, alpha, src((p+1)**2), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03945}03945     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03946}03946 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: dst((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03947}03947     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03948}03948 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(4*p*p+13*p+4)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03949}03949     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03950}03950 \textcolor{keywordtype}{    real}(dp) :: u, v, w, fl, fl2, tmp1, tmp2, vu(2), vv(2), vw(2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03951}03951         ctheta2, stheta2, cstheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03952}03952     \textcolor{keywordtype}{integer} :: l, m, n, ind, k}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03953}03953     \textcolor{comment}{! Pointers for a workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03954}03954 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: r(:, :, :), r\_prev(:, :, :), scal\_uvw\_m(:), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03955}03955         \& scal\_u\_n(:), scal\_v\_n(:), scal\_w\_n(:), r\_swap(:, :, :), vsqr(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03956}03956     \textcolor{comment}{!! Spherical harmonics Y\_l\string^m with negative m transform into harmonics Y\_l\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03957}03957     \textcolor{comment}{!! with the same l and negative m, while harmonics Y\_l\string^m with non-\/negative}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03958}03958     \textcolor{comment}{!! m transform into harmonics Y\_l\string^m with the same l and non-\/negative m.}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03959}03959     \textcolor{comment}{!! Transformations for non-\/negative m will be stored in r(1, :, :) and for}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03960}03960     \textcolor{comment}{!! negative m will be in r(2, :, :)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03961}03961     \textcolor{comment}{! In case alpha is zero just scale output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03962}03962     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03963}03963         \textcolor{comment}{! Set output to zero if beta is also zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03964}03964         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03965}03965             dst = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03966}03966         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03967}03967             dst = beta * dst}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03968}03968 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03969}03969         \textcolor{comment}{! Exit subroutine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03970}03970         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03971}03971 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03972}03972     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03973}03973     \textcolor{comment}{! In case beta is zero output is just overwritten without being read}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03974}03974     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03975}03975         \textcolor{comment}{! Compute rotations/reflections}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03976}03976         \textcolor{comment}{! l = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03977}03977         dst(1) = alpha * src(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03978}03978         \textcolor{keywordflow}{if} (p .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03979}03979             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03980}03980 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03981}03981         \textcolor{comment}{! l = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03982}03982         dst(2) = alpha * src(2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03983}03983         dst(3) = alpha * (src(3)*ctheta -\/ src(4)*stheta)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03984}03984         dst(4) = alpha * (src(3)*stheta + src(4)*ctheta)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03985}03985         \textcolor{keywordflow}{if} (p .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03986}03986             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03987}03987 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03988}03988         \textcolor{comment}{! Set pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03989}03989         l = 2 * (p+1) * (p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03990}03990         r(1:2, 0:p, 0:p) => work(1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03991}03991         m = 2 * l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03992}03992         r\_prev(1:2, 0:p, 0:p) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03993}03993         l = m + p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03994}03994         scal\_uvw\_m(0:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03995}03995         m = l + p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03996}03996         scal\_u\_n(0:p-\/1) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03997}03997         l = m + p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03998}03998         scal\_v\_n(0:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l03999}03999         m = l + p -\/ 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04000}04000         scal\_w\_n(1:p-\/2) => work(l+1:m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04001}04001         l = m + p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04002}04002         vsqr(1:p) => work(m+1:l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04003}04003         \textcolor{comment}{! l = 2, m >= 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04004}04004         ctheta2 = ctheta * ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04005}04005         cstheta = ctheta * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04006}04006         stheta2 = stheta * stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04007}04007         r(1, 2, 2) = (ctheta2 + one) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04008}04008         r(1, 1, 2) = cstheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04009}04009         r(1, 0, 2) = sqrt3 / two * stheta2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04010}04010         dst(9) = alpha * (src(9)*r(1, 2, 2) + src(8)*r(1, 1, 2) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04011}04011             \& src(7)*r(1, 0, 2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04012}04012         r(1, 2, 1) = -\/cstheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04013}04013         r(1, 1, 1) = ctheta2 -\/ stheta2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04014}04014         r(1, 0, 1) = sqrt3 * cstheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04015}04015         dst(8) = alpha * (src(9)*r(1, 2, 1) + src(8)*r(1, 1, 1) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04016}04016             \& src(7)*r(1, 0, 1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04017}04017         r(1, 2, 0) = sqrt3 / two * stheta2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04018}04018         r(1, 1, 0) = -\/sqrt3 * cstheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04019}04019         r(1, 0, 0) = (three*ctheta2-\/one) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04020}04020         dst(7) = alpha * (src(9)*r(1, 2, 0) + src(8)*r(1, 1, 0) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04021}04021             \& src(7)*r(1, 0, 0))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04022}04022         \textcolor{comment}{! l = 2,  m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04023}04023         r(2, 1, 1) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04024}04024         r(2, 2, 1) = -\/stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04025}04025         dst(6) = alpha * (src(6)*r(2, 1, 1) + src(5)*r(2, 2, 1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04026}04026         r(2, 1, 2) = stheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04027}04027         r(2, 2, 2) = ctheta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04028}04028         dst(5) = alpha * (src(6)*r(2, 1, 2) + src(5)*r(2, 2, 2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04029}04029         \textcolor{comment}{! l > 2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04030}04030         vsqr(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04031}04031         vsqr(2) = four}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04032}04032         \textcolor{keywordflow}{do} l = 3, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04033}04033             \textcolor{comment}{! Swap previous and current rotation matrices}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04034}04034             r\_swap => r\_prev}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04035}04035             r\_prev => r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04036}04036             r => r\_swap}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04037}04037             \textcolor{comment}{! Prepare scalar factors}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04038}04038             fl = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04039}04039             fl2 = fl * fl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04040}04040             vsqr(l) = fl2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04041}04041             scal\_uvw\_m(0) = one / fl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04042}04042             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04043}04043             \textcolor{keywordflow}{do} m = 1, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04044}04044                 u = sqrt(fl2 -\/ vsqr(m))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04045}04045                 scal\_uvw\_m(m) = one / u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04046}04046 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04047}04047             u = two * dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04048}04048             u = sqrt(dble(u*(u-\/one)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04049}04049             scal\_uvw\_m(l) = one / u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04050}04050             scal\_u\_n(0) = dble(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04051}04051             scal\_v\_n(0) = -\/sqrt(dble(l*(l-\/1))) / sqrt2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04052}04052             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04053}04053             \textcolor{keywordflow}{do} n = 1, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04054}04054                 u = sqrt(fl2-\/vsqr(n))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04055}04055                 scal\_u\_n(n) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04056}04056 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04057}04057             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04058}04058             \textcolor{keywordflow}{do} n = 1, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04059}04059                 v = dble(l+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04060}04060                 v = sqrt(v*v-\/v) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04061}04061                 scal\_v\_n(n) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04062}04062                 w = dble(l-\/n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04063}04063                 w = -\/sqrt(w*w-\/w) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04064}04064                 scal\_w\_n(n) = w}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04065}04065 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04066}04066             u = sqrt(dble(2*l-\/1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04067}04067             scal\_u\_n(l-\/1) = u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04068}04068             v = sqrt(dble((2*l-\/1)*(2*l-\/2))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04069}04069             scal\_v\_n(l-\/1) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04070}04070             v = sqrt(dble(2*l*(2*l-\/1))) / two}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04071}04071             scal\_v\_n(l) = v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04072}04072             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04073}04073             \textcolor{comment}{! m = l, n = l and m = -\/l, n = -\/ l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04074}04074             vv = ctheta*r\_prev(:, l-\/1, l-\/1) + r\_prev(2:1:-\/1, l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04075}04075             r(:, l, l) = vv * scal\_v\_n(l) * scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04076}04076             tmp1 = src(ind+l) * r(1, l, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04077}04077             tmp2 = src(ind-\/l) * r(2, l, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04078}04078             \textcolor{comment}{! m = l, n = l-\/1 and m = -\/l, n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04079}04079             vu = stheta * r\_prev(:, l-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04080}04080             vv = ctheta*r\_prev(:, l-\/2, l-\/1) + r\_prev(2:1:-\/1, l-\/2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04081}04081             r(:, l-\/1, l) = (vu*scal\_u\_n(l-\/1)+vv*scal\_v\_n(l-\/1)) * scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04082}04082             tmp1 = tmp1 + src(ind+l-\/1)*r(1, l-\/1, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04083}04083             tmp2 = tmp2 + src(ind-\/l+1)*r(2, l-\/1, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04084}04084             \textcolor{comment}{! m = l, n = 1 and m = -\/l, n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04085}04085             vu = stheta * r\_prev(:, 1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04086}04086             vv(1) = ctheta * r\_prev(1, 0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04087}04087             vv(2) = r\_prev(1, 0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04088}04088             vw = ctheta*r\_prev(:, 2, l-\/1) -\/ r\_prev(2:1:-\/1, 2, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04089}04089             r(:, 1, l) = vu*scal\_u\_n(1) + vw*scal\_w\_n(1) + sqrt2*scal\_v\_n(1)*vv}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04090}04090             r(:, 1, l) = r(:, 1, l) * scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04091}04091             tmp1 = tmp1 + src(ind+1)*r(1, 1, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04092}04092             tmp2 = tmp2 + src(ind-\/1)*r(2, 1, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04093}04093             \textcolor{comment}{! m = l, n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04094}04094             u = stheta * r\_prev(1, 0, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04095}04095             v = ctheta*r\_prev(1, 1, l-\/1) -\/ r\_prev(2, 1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04096}04096             r(1, 0, l) = (u*scal\_u\_n(0) + v*scal\_v\_n(0)) * scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04097}04097             tmp1 = tmp1 + src(ind)*r(1, 0, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04098}04098             \textcolor{comment}{! m = l, n = 2..l-\/2 and m = -\/l, n = 2-\/l..-\/2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04099}04099             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04100}04100             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04101}04101                 vu = stheta * r\_prev(:, n, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04102}04102                 vv = ctheta*r\_prev(:, n-\/1, l-\/1) + r\_prev(2:1:-\/1, n-\/1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04103}04103                 vw = ctheta*r\_prev(:, n+1, l-\/1) -\/ r\_prev(2:1:-\/1, n+1, l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04104}04104                 vu = vu*scal\_u\_n(n) + vv*scal\_v\_n(n) + vw*scal\_w\_n(n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04105}04105                 r(:, n, l) = vu * scal\_uvw\_m(l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04106}04106                 tmp1 = tmp1 + src(ind+n)*r(1, n, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04107}04107                 tmp2 = tmp2 + src(ind-\/n)*r(2, n, l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04108}04108 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04109}04109             dst(ind+l) = alpha * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04110}04110             dst(ind-\/l) = alpha * tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04111}04111             \textcolor{comment}{! Now deal with m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04112}04112             \textcolor{comment}{! n = l and n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04113}04113             v = -\/stheta * r\_prev(1, l-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04114}04114             u = scal\_v\_n(l) * scal\_uvw\_m(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04115}04115             r(1, l, 0) = v * u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04116}04116             tmp1 = src(ind+l) * r(1, l, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04117}04117             \textcolor{comment}{! n = l-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04118}04118             u = ctheta * r\_prev(1, l-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04119}04119             v = -\/stheta * r\_prev(1, l-\/2, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04120}04120             w = u*scal\_u\_n(l-\/1) + v*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04121}04121             r(1, l-\/1, 0) = w * scal\_uvw\_m(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04122}04122             tmp1 = tmp1 + src(ind+l-\/1)*r(1, l-\/1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04123}04123             \textcolor{comment}{! n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04124}04124             u = ctheta * r\_prev(1, 0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04125}04125             v = -\/stheta * r\_prev(1, 1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04126}04126             w = u*scal\_u\_n(0) + v*scal\_v\_n(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04127}04127             r(1, 0, 0) = w * scal\_uvw\_m(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04128}04128             tmp1 = tmp1 + src(ind)*r(1, 0, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04129}04129             \textcolor{comment}{! n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04130}04130             v = sqrt2*scal\_v\_n(1)*r\_prev(1, 0, 0) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04131}04131                 \& scal\_w\_n(1)*r\_prev(1, 2, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04132}04132             u = ctheta * r\_prev(1, 1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04133}04133             w = scal\_u\_n(1)*u -\/ stheta*v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04134}04134             r(1, 1, 0) = w * scal\_uvw\_m(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04135}04135             tmp1 = tmp1 + src(ind+1)*r(1, 1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04136}04136             \textcolor{comment}{! n = 2..l-\/2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04137}04137             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04138}04138             \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04139}04139                 v = scal\_v\_n(n)*r\_prev(1, n-\/1, 0) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04140}04140                     \& scal\_w\_n(n)*r\_prev(1, n+1, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04141}04141                 u = ctheta * r\_prev(1, n, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04142}04142                 w = scal\_u\_n(n)*u -\/ stheta*v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04143}04143                 r(1, n, 0) = w * scal\_uvw\_m(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04144}04144                 tmp1 = tmp1 + src(ind+n)*r(1, n, 0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04145}04145 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04146}04146             dst(ind) = alpha * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04147}04147             \textcolor{comment}{! Now deal with m=1..l-\/1 and m=1-\/l..-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04148}04148             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04149}04149             \textcolor{keywordflow}{do} m = 1, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04150}04150                 \textcolor{comment}{! n = l and n = -\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04151}04151                 vv = -\/stheta * r\_prev(:, l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04152}04152                 u = scal\_v\_n(l) * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04153}04153                 r(:, l, m) = vv * u}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04154}04154                 tmp1 = src(ind+l) * r(1, l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04155}04155                 tmp2 = src(ind-\/l) * r(2, l, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04156}04156                 \textcolor{comment}{! n = l-\/1 and n = 1-\/l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04157}04157                 vu = ctheta * r\_prev(:, l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04158}04158                 vv = -\/stheta * r\_prev(:, l-\/2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04159}04159                 vw = vu*scal\_u\_n(l-\/1) + vv*scal\_v\_n(l-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04160}04160                 r(:, l-\/1, m) = vw * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04161}04161                 tmp1 = tmp1 + src(ind+l-\/1)*r(1, l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04162}04162                 tmp2 = tmp2 + src(ind-\/l+1)*r(2, l-\/1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04163}04163                 \textcolor{comment}{! n = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04164}04164                 u = ctheta * r\_prev(1, 0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04165}04165                 v = -\/stheta * r\_prev(1, 1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04166}04166                 w = u*scal\_u\_n(0) + v*scal\_v\_n(0)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04167}04167                 r(1, 0, m) = w * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04168}04168                 tmp1 = tmp1 + src(ind)*r(1, 0, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04169}04169                 \textcolor{comment}{! n = 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04170}04170                 v = sqrt2*scal\_v\_n(1)*r\_prev(1, 0, m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04171}04171                     \& scal\_w\_n(1)*r\_prev(1, 2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04172}04172                 u = ctheta * r\_prev(1, 1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04173}04173                 w = scal\_u\_n(1)*u -\/ stheta*v}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04174}04174                 r(1, 1, m) = w * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04175}04175                 tmp1 = tmp1 + src(ind+1)*r(1, 1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04176}04176                 \textcolor{comment}{! n = -\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04177}04177                 u = ctheta * r\_prev(2, 1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04178}04178                 w = -\/stheta * r\_prev(2, 2, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04179}04179                 v = u*scal\_u\_n(1) + w*scal\_w\_n(1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04180}04180                 r(2, 1, m) = v * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04181}04181                 tmp2 = tmp2 + src(ind-\/1)*r(2, 1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04182}04182                 \textcolor{comment}{! n = 2..l-\/2 and n = 2-\/l..-\/2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04183}04183                 \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04184}04184                 \textcolor{keywordflow}{do} n = 2, l-\/2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04185}04185                     vv = scal\_v\_n(n)*r\_prev(:, n-\/1, m) + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04186}04186                         \& scal\_w\_n(n)*r\_prev(:, n+1, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04187}04187                     vu = ctheta * r\_prev(:, n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04188}04188                     vw = scal\_u\_n(n)*vu -\/ stheta*vv}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04189}04189                     r(:, n, m) = vw * scal\_uvw\_m(m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04190}04190                     tmp1 = tmp1 + src(ind+n)*r(1, n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04191}04191                     tmp2 = tmp2 + src(ind-\/n)*r(2, n, m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04192}04192 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04193}04193                 dst(ind+m) = alpha * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04194}04194                 dst(ind-\/m) = alpha * tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04195}04195 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04196}04196 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04197}04197     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04198}04198         stop \textcolor{stringliteral}{"{}Not Implemented"{}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04199}04199 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04200}04200 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04201}04201 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04224}\mbox{\hyperlink{namespaceddx__harmonics_a04507f68eafd1a3757afb3958107c895}{04224}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a04507f68eafd1a3757afb3958107c895}{fmm\_m2m\_ztranslate}}(z, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04225}04225         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04226}04226     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04227}04227     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04228}04228 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04229}04229         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04230}04230     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04231}04231 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04232}04232     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04233}04233 \textcolor{keywordtype}{    real}(dp) :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04234}04234     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04235}04235     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{fmm\_m2m\_ztranslate\_work}}(z, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04236}04236         \& src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04237}04237 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a04507f68eafd1a3757afb3958107c895}{fmm\_m2m\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04238}04238 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04262}\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{04262}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{fmm\_m2m\_ztranslate\_work}}(z, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04263}04263         \& src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04264}04264     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04265}04265     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04266}04266 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04267}04267         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04268}04268     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04269}04269 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04270}04270     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04271}04271 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04272}04272     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04273}04273 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04274}04274     \textcolor{keywordtype}{integer} :: j, k, n, indj, indjn, indjk1, indjk2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04275}04275     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04276}04276 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: pow\_r2(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04277}04277     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04278}04278     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04279}04279         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04280}04280             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04281}04281         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04282}04282             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04283}04283 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04284}04284         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04285}04285 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04286}04286     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04287}04287     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04288}04288     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04289}04289         \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04290}04290         pow\_r2(1:p+1) => work(1:p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04291}04291         \textcolor{comment}{! Get ratios r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04292}04292         r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04293}04293         r2 = z / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04294}04294         \textcolor{comment}{! Get powers of ratio r2/r1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04295}04295         r2 = r2 / r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04296}04296         pow\_r1 = r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04297}04297         pow\_r2(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04298}04298         \textcolor{keywordflow}{do} j = 2, p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04299}04299             pow\_r2(j) = pow\_r2(j-\/1) * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04300}04300 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04301}04301         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04302}04302         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04303}04303         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04304}04304             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04305}04305                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04306}04306                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04307}04307                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04308}04308                 tmp1 = alpha * pow\_r1 * vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04309}04309                 pow\_r1 = pow\_r1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04310}04310                 tmp2 = tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04311}04311                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04312}04312                 \textcolor{comment}{! Offset for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04313}04313                 indjk1 = j*(j+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04314}04314                 \textcolor{keywordflow}{do} n = 0, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04315}04315                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04316}04316                     indjn = (j-\/n)**2 + (j-\/n) + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04317}04317                     tmp3 = pow\_r2(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04318}04318                         \& vscales(indjn) * vcnk(indjk1+n)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04319}04319                     res1 = res1 + tmp3*src\_m(indjn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04320}04320 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04321}04321                 dst\_m(indj) = tmp2 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04322}04322                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04323}04323                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04324}04324                     tmp2 = tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04325}04325                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04326}04326                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04327}04327                     \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04328}04328                     indjk1 = (j-\/k)*(j-\/k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04329}04329                     indjk2 = (j+k)*(j+k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04330}04330                     \textcolor{keywordflow}{do} n = 0, j-\/k}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04331}04331                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04332}04332                         indjn = (j-\/n)**2 + (j-\/n) + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04333}04333                         tmp3 = pow\_r2(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04334}04334                             \& vscales(indjn) * vcnk(indjk1+n) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04335}04335                             \& vcnk(indjk2+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04336}04336                         res1 = res1 + tmp3*src\_m(indjn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04337}04337                         res2 = res2 + tmp3*src\_m(indjn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04338}04338 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04339}04339                     dst\_m(indj+k) = tmp2 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04340}04340                     dst\_m(indj-\/k) = tmp2 * res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04341}04341 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04342}04342 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04343}04343         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04344}04344         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04345}04345             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04346}04346                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04347}04347                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04348}04348                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04349}04349                 tmp1 = alpha * pow\_r1 * vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04350}04350                 pow\_r1 = pow\_r1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04351}04351                 tmp2 = tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04352}04352                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04353}04353                 \textcolor{comment}{! Offset for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04354}04354                 indjk1 = j * (j+1) /2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04355}04355                 \textcolor{keywordflow}{do} n = 0, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04356}04356                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04357}04357                     indjn = (j-\/n)**2 + (j-\/n) + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04358}04358                     tmp3 = pow\_r2(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04359}04359                         \& vscales(indjn) * vcnk(indjk1+n)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04360}04360                     res1 = res1 + tmp3*src\_m(indjn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04361}04361 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04362}04362                 dst\_m(indj) = beta*dst\_m(indj) + tmp2*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04363}04363                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04364}04364                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04365}04365                     tmp2 = tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04366}04366                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04367}04367                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04368}04368                     \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04369}04369                     indjk1 = (j-\/k)*(j-\/k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04370}04370                     indjk2 = (j+k)*(j+k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04371}04371                     \textcolor{keywordflow}{do} n = 0, j-\/k}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04372}04372                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04373}04373                         indjn = (j-\/n)**2 + (j-\/n) + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04374}04374                         tmp3 = pow\_r2(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04375}04375                             \& vscales(indjn) * vcnk(indjk1+n) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04376}04376                             \& vcnk(indjk2+n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04377}04377                         res1 = res1 + tmp3*src\_m(indjn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04378}04378                         res2 = res2 + tmp3*src\_m(indjn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04379}04379 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04380}04380                     dst\_m(indj+k) = beta*dst\_m(indj+k) + tmp2*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04381}04381                     dst\_m(indj-\/k) = beta*dst\_m(indj-\/k) + tmp2*res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04382}04382 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04383}04383 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04384}04384 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04385}04385     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04386}04386     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04387}04387         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04388}04388         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04389}04389             r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04390}04390             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04391}04391             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04392}04392                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04393}04393                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04394}04394                     dst\_m(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04395}04395 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04396}04396                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04397}04397 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04398}04398         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04399}04399         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04400}04400             r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04401}04401             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04402}04402             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04403}04403                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04404}04404                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04405}04405                     dst\_m(k) = beta*dst\_m(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04406}04406 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04407}04407                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04408}04408 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04409}04409 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04410}04410 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04411}04411 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{fmm\_m2m\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04412}04412 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04435}\mbox{\hyperlink{namespaceddx__harmonics_a9d80015d1ca2f96afaa655616d754a92}{04435}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9d80015d1ca2f96afaa655616d754a92}{fmm\_m2m\_bessel\_ztranslate}}(z, src\_sk, dst\_sk, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04436}04436         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04437}04437     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04438}04438     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04439}04439 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04440}04440         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04441}04441     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04442}04442 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04443}04443     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04444}04444 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04445}04445     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04446}04446     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04447}04447     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa92f3d719b3f99cf0cdd523e865c12ca}{fmm\_m2m\_bessel\_ztranslate\_work}}(z, src\_sk, dst\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04448}04448         \& alpha, src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04449}04449 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9d80015d1ca2f96afaa655616d754a92}{fmm\_m2m\_bessel\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04450}04450 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04475}\mbox{\hyperlink{namespaceddx__harmonics_aa92f3d719b3f99cf0cdd523e865c12ca}{04475}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa92f3d719b3f99cf0cdd523e865c12ca}{fmm\_m2m\_bessel\_ztranslate\_work}}(z, src\_sk, dst\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04476}04476         \& alpha, src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04477}04477     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04478}04478     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04479}04479     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04480}04480 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04481}04481         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04482}04482     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04483}04483 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04484}04484     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04485}04485 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04486}04486     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04487}04487     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04488}04488 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04489}04489     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04490}04490     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04491}04491 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04492}04492     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04493}04493     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04494}04494     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04495}04495         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04496}04496             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04497}04497         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04498}04498             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04499}04499 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04500}04500         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04501}04501 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04502}04502     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04503}04503     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04504}04504     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04505}04505         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04506}04506 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04507}04507     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04508}04508     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04509}04509     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04510}04510         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04511}04511         \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04512}04512         work(1) = sqrt(pi/(2*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04513}04513         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04514}04514             \textcolor{keyword}{call }cbesi(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04515}04515                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04516}04516             work(2:2*p+1) = sqrt(pi/(2*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04517}04517 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04518}04518         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04519}04519         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04520}04520         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04521}04521             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04522}04522             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04523}04523                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04524}04524                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04525}04525                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04526}04526                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04527}04527                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04528}04528                 \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04529}04529                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04530}04530                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04531}04531                     tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04532}04532                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04533}04533                         \& src\_sk(n+1) / vscales(indj) * dst\_sk(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04534}04534                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04535}04535                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04536}04536                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04537}04537                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04538}04538                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04539}04539                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04540}04540                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04541}04541 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04542}04542                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04543}04543                     res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04544}04544 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04545}04545                 dst\_m(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04546}04546                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04547}04547                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04548}04548                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04549}04549                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04550}04550                     \textcolor{keywordflow}{do} n = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04551}04551                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04552}04552                         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04553}04553                         tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04554}04554                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04555}04555                             \& src\_sk(n+1) / vscales(indj+k) * dst\_sk(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04556}04556                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04557}04557                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04558}04558                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04559}04559                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04560}04560                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04561}04561                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04562}04562                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04563}04563 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04564}04564                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04565}04565                         res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04566}04566                         res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04567}04567 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04568}04568                     dst\_m(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04569}04569                     dst\_m(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04570}04570 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04571}04571 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04572}04572         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04573}04573         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04574}04574             stop 111}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04575}04575 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04576}04576     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04577}04577     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04578}04578         stop 222}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04579}04579         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04580}04580         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04581}04581             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04582}04582             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04583}04583             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04584}04584                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04585}04585                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04586}04586                     dst\_m(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04587}04587 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04588}04588                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04589}04589 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04590}04590         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04591}04591         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04592}04592             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04593}04593             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04594}04594             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04595}04595                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04596}04596                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04597}04597                     dst\_m(k) = beta*dst\_m(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04598}04598 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04599}04599                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04600}04600 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04601}04601 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04602}04602 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04603}04603 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa92f3d719b3f99cf0cdd523e865c12ca}{fmm\_m2m\_bessel\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04604}04604 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04627}\mbox{\hyperlink{namespaceddx__harmonics_aed42c229d4ba1f6e8e08ab7c7d8f51bc}{04627}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aed42c229d4ba1f6e8e08ab7c7d8f51bc}{fmm\_m2m\_bessel\_ztranslate\_adj}}(z, src\_sk, dst\_sk, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04628}04628         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04629}04629     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04630}04630     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04631}04631 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04632}04632         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04633}04633     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04634}04634 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04635}04635     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04636}04636 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04637}04637     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04638}04638     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04639}04639     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a25d206db906fd240782e0f328a320a6e}{fmm\_m2m\_bessel\_ztranslate\_adj\_work}}(z, src\_sk, dst\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04640}04640         \& alpha, src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04641}04641 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aed42c229d4ba1f6e8e08ab7c7d8f51bc}{fmm\_m2m\_bessel\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04642}04642 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04667}\mbox{\hyperlink{namespaceddx__harmonics_a25d206db906fd240782e0f328a320a6e}{04667}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a25d206db906fd240782e0f328a320a6e}{fmm\_m2m\_bessel\_ztranslate\_adj\_work}}(z, src\_sk, dst\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04668}04668         \& alpha, src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04669}04669     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04670}04670     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04671}04671     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04672}04672 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04673}04673         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04674}04674     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04675}04675 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04676}04676     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04677}04677 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04678}04678     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04679}04679     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04680}04680 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04681}04681     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04682}04682     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04683}04683 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04684}04684     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04685}04685     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04686}04686     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04687}04687         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04688}04688             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04689}04689         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04690}04690             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04691}04691 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04692}04692         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04693}04693 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04694}04694     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04695}04695     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04696}04696     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04697}04697         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04698}04698 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04699}04699     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04700}04700     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04701}04701     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04702}04702         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04703}04703         \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04704}04704         work(1) = sqrt(pi/(2*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04705}04705         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04706}04706             \textcolor{keyword}{call }cbesi(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04707}04707                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04708}04708             work(2:2*p+1) = sqrt(pi/(2*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04709}04709 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04710}04710         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04711}04711         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04712}04712         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04713}04713             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04714}04714             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04715}04715                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04716}04716                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04717}04717                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04718}04718                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04719}04719                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04720}04720                 \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04721}04721                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04722}04722                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04723}04723                     tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04724}04724                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04725}04725                         \& src\_sk(n+1) / vscales(indj) * dst\_sk(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04726}04726                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04727}04727                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04728}04728                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04729}04729                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04730}04730                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04731}04731                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04732}04732                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04733}04733 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04734}04734                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04735}04735                     res1 = res1 + tmp3*src\_m(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04736}04736 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04737}04737                 dst\_m(indn) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04738}04738                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04739}04739                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04740}04740                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04741}04741                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04742}04742                     \textcolor{keywordflow}{do} j = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04743}04743                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04744}04744                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04745}04745                         tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04746}04746                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04747}04747                             \& src\_sk(n+1) / vscales(indj+k) * dst\_sk(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04748}04748                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04749}04749                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04750}04750                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04751}04751                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04752}04752                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04753}04753                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04754}04754                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04755}04755 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04756}04756                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04757}04757                         res1 = res1 + tmp3*src\_m(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04758}04758                         res2 = res2 + tmp3*src\_m(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04759}04759 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04760}04760                     dst\_m(indn+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04761}04761                     dst\_m(indn-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04762}04762 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04763}04763 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04764}04764         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04765}04765         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04766}04766             stop 111}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04767}04767 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04768}04768     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04769}04769     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04770}04770         stop 222}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04771}04771         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04772}04772         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04773}04773             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04774}04774             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04775}04775             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04776}04776                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04777}04777                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04778}04778                     dst\_m(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04779}04779 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04780}04780                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04781}04781 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04782}04782         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04783}04783         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04784}04784             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04785}04785             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04786}04786             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04787}04787                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04788}04788                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04789}04789                     dst\_m(k) = beta*dst\_m(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04790}04790 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04791}04791                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04792}04792 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04793}04793 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04794}04794 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04795}04795 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a25d206db906fd240782e0f328a320a6e}{fmm\_m2m\_bessel\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04796}04796 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04821}\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{04821}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}(src\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04822}04822         \& alpha, src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04823}04823     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04824}04824     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04825}04825     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04826}04826 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_sk(p+2), vscales((p+2)*(p+2)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04827}04827         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04828}04828     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04829}04829 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+2)*(p+2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04830}04830     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04831}04831     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04832}04832 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04833}04833     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04834}04834     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04835}04835 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1), fact2(p+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04836}04836     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04837}04837     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04838}04838     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04839}04839         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04840}04840             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04841}04841         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04842}04842             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04843}04843 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04844}04844         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04845}04845 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04846}04846     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04847}04847     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04848}04848     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04849}04849         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04850}04850 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04851}04851     fact2(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04852}04852     \textcolor{keywordflow}{do} j = 1, p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04853}04853         fact2(j+1) = dble(2*j+1) * fact2(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04854}04854 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04855}04855     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04856}04856     \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04857}04857     \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04858}04858     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04859}04859         dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04860}04860         \textcolor{comment}{! j=0, k=0, n=1, l=0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04861}04861         j = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04862}04862         k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04863}04863         n = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04864}04864         l = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04865}04865         indj = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04866}04866         indn = 3}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04867}04867         dst\_m(1) = vscales(3) / src\_sk(2) / vscales(1) * src\_sk(1) / fact2(2) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04868}04868             \& src\_m(3) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04869}04869         \textcolor{comment}{! j=1..p-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04870}04870         \textcolor{keywordflow}{do} j = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04871}04871             \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04872}04872             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04873}04873             \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04874}04874             k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04875}04875             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04876}04876             \textcolor{comment}{! n=j-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04877}04877             n = j-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04878}04878             \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04879}04879             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04880}04880             tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04881}04881                 \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04882}04882                 \& src\_sk(n+1) / vscales(indj) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04883}04883             tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04884}04884             \textcolor{comment}{! l=n}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04885}04885             l = n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04886}04886             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04887}04887                 \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04888}04888                 \& fact(l+1)/fact(l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04889}04889                 \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04890}04890             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04891}04891             tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04892}04892             res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04893}04893             \textcolor{comment}{! n=j+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04894}04894             n = j+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04895}04895             \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04896}04896             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04897}04897             tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04898}04898                 \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04899}04899                 \& src\_sk(n+1) / vscales(indj) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04900}04900             tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04901}04901             \textcolor{comment}{! l=j}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04902}04902             l = j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04903}04903             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04904}04904                 \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04905}04905                 \& fact(l+1)/fact(l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04906}04906                 \& fact2(j+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04907}04907             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04908}04908             tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04909}04909             res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04910}04910             dst\_m(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04911}04911             \textcolor{comment}{! k=1..j-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04912}04912             \textcolor{keywordflow}{do} k = 1, j-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04913}04913                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04914}04914                 res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04915}04915                 \textcolor{comment}{! n=j-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04916}04916                 n = j-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04917}04917                 \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04918}04918                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04919}04919                 tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04920}04920                     \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04921}04921                     \& src\_sk(n+1) / vscales(indj+k) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04922}04922                 tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04923}04923                 l = n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04924}04924                 tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04925}04925                     \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04926}04926                     \& fact(l+1)/fact(l-\/k+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04927}04927                     \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04928}04928                 tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04929}04929                 tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04930}04930                 res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04931}04931                 res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04932}04932                 \textcolor{comment}{! n=j+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04933}04933                 n = j+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04934}04934                 \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04935}04935                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04936}04936                 tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04937}04937                     \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04938}04938                     \& src\_sk(n+1) / vscales(indj+k) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04939}04939                 tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04940}04940                 l = j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04941}04941                 tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04942}04942                     \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04943}04943                     \& fact(l+1)/fact(l-\/k+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04944}04944                     \& fact2(j+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04945}04945                 tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04946}04946                 tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04947}04947                 res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04948}04948                 res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04949}04949                 dst\_m(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04950}04950                 dst\_m(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04951}04951 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04952}04952             \textcolor{comment}{! k=j}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04953}04953             k = j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04954}04954             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04955}04955             res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04956}04956             \textcolor{comment}{! n=j+1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04957}04957             n = j+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04958}04958             \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04959}04959             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04960}04960             tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04961}04961                 \& dble(2*j+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04962}04962                 \& src\_sk(n+1) / vscales(indj+k) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04963}04963             tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04964}04964             l = j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04965}04965             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04966}04966                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04967}04967                 \& fact(l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04968}04968                 \& fact2(j+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04969}04969             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04970}04970             tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04971}04971             res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04972}04972             res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04973}04973             dst\_m(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04974}04974             dst\_m(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04975}04975 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04976}04976         \textcolor{comment}{! j=p, n=p-\/1, l=p-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04977}04977         j = p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04978}04978         n = p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04979}04979         \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04980}04980         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04981}04981         \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04982}04982         k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04983}04983         res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04984}04984         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04985}04985         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04986}04986         tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04987}04987             \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04988}04988             \& src\_sk(n+1) / vscales(indj) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04989}04989         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04990}04990         l = p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04991}04991         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04992}04992             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04993}04993             \& fact(l+1)/fact(l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04994}04994             \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04995}04995         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04996}04996         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04997}04997         res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04998}04998         dst\_m(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l04999}04999         \textcolor{comment}{! k=1..p-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05000}05000         \textcolor{keywordflow}{do} k = 1, p-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05001}05001             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05002}05002             res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05003}05003             \textcolor{comment}{! n=j-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05004}05004             n = j-\/1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05005}05005             \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05006}05006             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05007}05007             tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05008}05008                 \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05009}05009                 \& src\_sk(n+1) / vscales(indj+k) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05010}05010             tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05011}05011             l = n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05012}05012             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05013}05013                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05014}05014                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05015}05015                 \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05016}05016             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05017}05017             tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05018}05018             res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05019}05019             res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05020}05020             dst\_m(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05021}05021             dst\_m(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05022}05022 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05023}05023         \textcolor{comment}{! j=p,k=p is impossible because n=p-\/1 or n=p+1 is impossible}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05024}05024         \textcolor{comment}{! j=p+1, n=p, l=p}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05025}05025         j = p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05026}05026         n = p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05027}05027         \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05028}05028         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05029}05029         \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05030}05030         k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05031}05031         res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05032}05032         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05033}05033         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05034}05034         tmp1 = vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05035}05035             \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05036}05036             \& src\_sk(n+1) / vscales(indj) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05037}05037         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05038}05038         l = n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05039}05039         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05040}05040             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05041}05041             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05042}05042             \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05043}05043         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05044}05044         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05045}05045         res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05046}05046         dst\_m(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05047}05047         \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05048}05048         \textcolor{keywordflow}{do} k = 1, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05049}05049             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05050}05050             res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05051}05051             \textcolor{comment}{! n=j-\/1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05052}05052             n = p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05053}05053             \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05054}05054             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05055}05055             tmp1 = vscales(indn+k) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05056}05056                 \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05057}05057                 \& src\_sk(n+1) / vscales(indj+k) * src\_sk(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05058}05058             tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05059}05059             l = n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05060}05060             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05061}05061                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05062}05062                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05063}05063                 \& fact2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05064}05064             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05065}05065             tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05066}05066             res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05067}05067             res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05068}05068             dst\_m(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05069}05069             dst\_m(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05070}05070 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05071}05071     \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05072}05072     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05073}05073         stop 111}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05074}05074 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05075}05075 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05076}05076 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05099}\mbox{\hyperlink{namespaceddx__harmonics_a1f3fe034c9643740bea4da7da792ef10}{05099}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1f3fe034c9643740bea4da7da792ef10}{fmm\_m2m\_ztranslate\_adj}}(z, src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05100}05100         \& alpha, src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05101}05101     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05102}05102     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05103}05103 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05104}05104         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05105}05105     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05106}05106 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05107}05107     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05108}05108 \textcolor{keywordtype}{    real}(dp) :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05109}05109     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05110}05110     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{fmm\_m2m\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05111}05111         \& alpha, src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05112}05112 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1f3fe034c9643740bea4da7da792ef10}{fmm\_m2m\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05113}05113 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05137}\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{05137}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{fmm\_m2m\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05138}05138         \& alpha, src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05139}05139     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05140}05140     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05141}05141 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05142}05142         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05143}05143     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05144}05144 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05145}05145     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05146}05146 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05147}05147     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05148}05148 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, res1, res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05149}05149     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, indjk1, indjk2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05150}05150     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05151}05151 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: pow\_r1(:), pow\_r2(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05152}05152     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05153}05153     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05154}05154         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05155}05155             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05156}05156         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05157}05157             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05158}05158 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05159}05159         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05160}05160 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05161}05161     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05162}05162     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05163}05163         \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05164}05164         pow\_r1(1:p+1) => work(1:p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05165}05165         pow\_r2(1:p+1) => work(p+2:2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05166}05166         \textcolor{comment}{! Get powers of r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05167}05167         r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05168}05168         r2 = -\/z / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05169}05169         pow\_r1(1) = r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05170}05170         pow\_r2(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05171}05171         \textcolor{keywordflow}{do} j = 2, p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05172}05172             pow\_r1(j) = pow\_r1(j-\/1) * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05173}05173             pow\_r2(j) = pow\_r2(j-\/1) * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05174}05174 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05175}05175         \textcolor{comment}{! Do actual adjoint M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05176}05176         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05177}05177         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05178}05178             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05179}05179                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05180}05180                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05181}05181                 tmp1 = alpha * pow\_r1(n+1) / vscales(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05182}05182                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05183}05183                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05184}05184                 \textcolor{keywordflow}{do} j = n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05185}05185                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05186}05186                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05187}05187                     \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05188}05188                     indjk1 = j*(j+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05189}05189                     tmp2 = tmp1 * vscales(indj) * pow\_r2(j-\/n+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05190}05190                         \& vcnk(indjk1+j-\/n)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05191}05191                     res1 = res1 + tmp2*src\_m(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05192}05192 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05193}05193                 dst\_m(indn) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05194}05194                 \textcolor{comment}{! k != 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05195}05195                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05196}05196                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05197}05197                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05198}05198                     \textcolor{keywordflow}{do} j = n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05199}05199                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05200}05200                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05201}05201                         \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05202}05202                         indjk1 = (j-\/k)*(j-\/k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05203}05203                         indjk2 = (j+k)*(j+k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05204}05204                         tmp2 = tmp1 * vscales(indj) * pow\_r2(j-\/n+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05205}05205                             \& vcnk(indjk1+j-\/n) * vcnk(indjk2+j-\/n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05206}05206                         res1 = res1 + tmp2*src\_m(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05207}05207                         res2 = res2 + tmp2*src\_m(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05208}05208 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05209}05209                     dst\_m(indn+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05210}05210                     dst\_m(indn-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05211}05211 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05212}05212 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05213}05213         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05214}05214         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05215}05215             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05216}05216                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05217}05217                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05218}05218                 tmp1 = alpha * pow\_r1(n+1) / vscales(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05219}05219                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05220}05220                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05221}05221                 \textcolor{keywordflow}{do} j = n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05222}05222                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05223}05223                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05224}05224                     \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05225}05225                     indjk1 = j*(j+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05226}05226                     tmp2 = tmp1 * vscales(indj) * pow\_r2(j-\/n+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05227}05227                         \& vcnk(indjk1+j-\/n)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05228}05228                     res1 = res1 + tmp2*src\_m(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05229}05229 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05230}05230                 dst\_m(indn) = beta*dst\_m(indn) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05231}05231                 \textcolor{comment}{! k != 1}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05232}05232                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05233}05233                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05234}05234                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05235}05235                     \textcolor{keywordflow}{do} j = n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05236}05236                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05237}05237                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05238}05238                         \textcolor{comment}{! Offsets for vcnk}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05239}05239                         indjk1 = (j-\/k)*(j-\/k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05240}05240                         indjk2 = (j+k)*(j+k+1)/2 + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05241}05241                         tmp2 = tmp1 * vscales(indj) * pow\_r2(j-\/n+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05242}05242                             \& vcnk(indjk1+j-\/n) * vcnk(indjk2+j-\/n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05243}05243                         res1 = res1 + tmp2*src\_m(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05244}05244                         res2 = res2 + tmp2*src\_m(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05245}05245 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05246}05246                     dst\_m(indn+k) = beta*dst\_m(indn+k) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05247}05247                     dst\_m(indn-\/k) = beta*dst\_m(indn-\/k) + res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05248}05248 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05249}05249 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05250}05250 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05251}05251     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05252}05252     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05253}05253         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05254}05254         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05255}05255             r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05256}05256             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05257}05257             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05258}05258                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05259}05259                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05260}05260                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05261}05261                     dst\_m(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05262}05262 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05263}05263                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05264}05264 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05265}05265         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05266}05266         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05267}05267             r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05268}05268             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05269}05269             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05270}05270                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05271}05271                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05272}05272                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05273}05273                     dst\_m(k) = beta*dst\_m(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05274}05274 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05275}05275                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05276}05276 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05277}05277 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05278}05278 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05279}05279 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{fmm\_m2m\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05280}05280 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05300}\mbox{\hyperlink{namespaceddx__harmonics_a51c01e8ba76374eff76e3854bdcfe949}{05300}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a51c01e8ba76374eff76e3854bdcfe949}{fmm\_m2m\_scale}}(src\_r, dst\_r, p, alpha, src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05301}05301     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05302}05302     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05303}05303 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_r, dst\_r, alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05304}05304     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05305}05305 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05306}05306     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05307}05307 \textcolor{keywordtype}{    real}(dp) :: r1, tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05308}05308     \textcolor{keywordtype}{integer} :: j, k, indj}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05309}05309     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05310}05310     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05311}05311         dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05312}05312     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05313}05313         dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05314}05314 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05315}05315     r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05316}05316     tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05317}05317     \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05318}05318         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05319}05319         \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05320}05320             dst\_m(k) = dst\_m(k) + src\_m(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05321}05321 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05322}05322         tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05323}05323 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05324}05324 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a51c01e8ba76374eff76e3854bdcfe949}{fmm\_m2m\_scale}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05325}05325 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05346}\mbox{\hyperlink{namespaceddx__harmonics_ac97e4fe54c0763bb7a9bbb7bebaaefdc}{05346}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ac97e4fe54c0763bb7a9bbb7bebaaefdc}{fmm\_m2m\_scale\_adj}}(src\_r, dst\_r, p, alpha, src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05347}05347     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05348}05348     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05349}05349 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_r, dst\_r, alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05350}05350     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05351}05351 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05352}05352     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05353}05353 \textcolor{keywordtype}{    real}(dp) :: r1, tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05354}05354     \textcolor{keywordtype}{integer} :: j, k, indj}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05355}05355     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05356}05356     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05357}05357         dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05358}05358     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05359}05359         dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05360}05360 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05361}05361     r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05362}05362     tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05363}05363     \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05364}05364         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05365}05365         \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05366}05366             dst\_m(k) = dst\_m(k) + src\_m(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05367}05367 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05368}05368         tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05369}05369 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05370}05370 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ac97e4fe54c0763bb7a9bbb7bebaaefdc}{fmm\_m2m\_scale\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05371}05371 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05397}\mbox{\hyperlink{namespaceddx__harmonics_a36fcddfe6a8097317e37332f44ad6331}{05397}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a36fcddfe6a8097317e37332f44ad6331}{fmm\_m2m\_rotation}}(c, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05398}05398         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05399}05399     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05400}05400     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05401}05401 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05402}05402         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05403}05403     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05404}05404 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05405}05405     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05406}05406 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05407}05407     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05408}05408     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{fmm\_m2m\_rotation\_work}}(c, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05409}05409         \& src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05410}05410 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a36fcddfe6a8097317e37332f44ad6331}{fmm\_m2m\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05411}05411 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05438}\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{05438}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{fmm\_m2m\_rotation\_work}}(c, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05439}05439         \& src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05440}05440     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05441}05441     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05442}05442 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05443}05443         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05444}05444     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05445}05445 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05446}05446     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05447}05447 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05448}05448     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05449}05449 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05450}05450     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05451}05451     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05452}05452 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05453}05453     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05454}05454     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05455}05455     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05456}05456     \textcolor{keywordflow}{if} (stheta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05457}05457         \textcolor{comment}{! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05458}05458         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{fmm\_m2m\_ztranslate\_work}}(c(3), src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05459}05459             \& alpha, src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05460}05460         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05461}05461 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05462}05462     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05463}05463     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05464}05464     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05465}05465     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05466}05466     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05467}05467     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05468}05468     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05469}05469     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05470}05470     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05471}05471     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05472}05472     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05473}05473     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05474}05474     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05475}05475     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05476}05476     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05477}05477     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05478}05478     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05479}05479         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05480}05480     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05481}05481     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a18f3f31756270f14e4bf398be1f40a4a}{fmm\_m2m\_ztranslate\_work}}(rho, src\_r, dst\_r, p, vscales, vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05482}05482         \& tmp\_m2, zero, tmp\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05483}05483     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05484}05484     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05485}05485         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05486}05486     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05487}05487     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05488}05488 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{fmm\_m2m\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05489}05489 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05515}\mbox{\hyperlink{namespaceddx__harmonics_a0f1934ed9e1bb6f70d2b07e0000337b9}{05515}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a0f1934ed9e1bb6f70d2b07e0000337b9}{fmm\_m2m\_bessel\_rotation}}(c, src\_r, dst\_r, kappa, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05516}05516         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05517}05517     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05518}05518     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05519}05519     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05520}05520 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05521}05521         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05522}05522     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05523}05523 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05524}05524     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05525}05525 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_sk(p+1), dst\_sk(p+1), s1, s2, ck(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05526}05526     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05527}05527     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05528}05528     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05529}05529     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05530}05530     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05531}05531     s1 = sqrt(2/(pi*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05532}05532     s2 = sqrt(2/(pi*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05533}05533     \textcolor{keyword}{call }cbesk(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05534}05534     src\_sk(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05535}05535     \textcolor{keyword}{call }cbesk(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05536}05536     dst\_sk(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05537}05537     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05538}05538         \textcolor{keyword}{call }cbesk(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05539}05539         src\_sk(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05540}05540         \textcolor{keyword}{call }cbesk(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05541}05541         dst\_sk(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05542}05542 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05543}05543     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05544}05544     ck = c*kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05545}05545     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{fmm\_m2m\_bessel\_rotation\_work}}(ck, src\_sk, dst\_sk, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05546}05546         \& src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05547}05547 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a0f1934ed9e1bb6f70d2b07e0000337b9}{fmm\_m2m\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05548}05548 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05575}\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{05575}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{fmm\_m2m\_bessel\_rotation\_work}}(c, src\_sk, dst\_sk, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05576}05576         \& src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05577}05577     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05578}05578     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05579}05579 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05580}05580         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05581}05581     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05582}05582 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05583}05583     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05584}05584 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05585}05585     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05586}05586     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05587}05587 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05588}05588     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05589}05589     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05590}05590 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05591}05591     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05592}05592     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05593}05593     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05594}05594     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05595}05595     \textcolor{comment}{!    ! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05596}05596     \textcolor{comment}{!    call fmm\_m2m\_bessel\_ztranslate\_work(c(3), src\_r, dst\_r, p, vscales, vcnk, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05597}05597     \textcolor{comment}{!        \& alpha, src\_m, beta, dst\_m, work)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05598}05598     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05599}05599     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05600}05600     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05601}05601     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05602}05602     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05603}05603     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05604}05604     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05605}05605     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05606}05606     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05607}05607     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05608}05608     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05609}05609     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05610}05610     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05611}05611     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05612}05612     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05613}05613     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05614}05614     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05615}05615     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05616}05616     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05617}05617         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05618}05618     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05619}05619     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa92f3d719b3f99cf0cdd523e865c12ca}{fmm\_m2m\_bessel\_ztranslate\_work}}(rho, src\_sk, dst\_sk, p, vscales, vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05620}05620         \& tmp\_m2, zero, tmp\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05621}05621     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05622}05622     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05623}05623         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05624}05624     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05625}05625     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05626}05626 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{fmm\_m2m\_bessel\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05627}05627 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05653}\mbox{\hyperlink{namespaceddx__harmonics_aba7f517fdb4f2c6d19605d22e961bd8a}{05653}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aba7f517fdb4f2c6d19605d22e961bd8a}{fmm\_m2m\_bessel\_rotation\_adj}}(c, src\_r, dst\_r, kappa, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05654}05654     \& vcnk, alpha, src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05655}05655     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05656}05656     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05657}05657     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05658}05658 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05659}05659         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05660}05660     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05661}05661 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05662}05662     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05663}05663 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_sk(p+1), dst\_sk(p+1), s1, s2, ck(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05664}05664     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05665}05665     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05666}05666     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05667}05667     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05668}05668     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05669}05669     s1 = sqrt(2/(pi*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05670}05670     s2 = sqrt(2/(pi*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05671}05671     \textcolor{keyword}{call }cbesk(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05672}05672     src\_sk(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05673}05673     \textcolor{keyword}{call }cbesk(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05674}05674     dst\_sk(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05675}05675     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05676}05676         \textcolor{keyword}{call }cbesk(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05677}05677         src\_sk(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05678}05678         \textcolor{keyword}{call }cbesk(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05679}05679         dst\_sk(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05680}05680 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05681}05681     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05682}05682     ck = -\/c*kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05683}05683     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9ce78f5c64aa0138b672a8fc0d86a43f}{fmm\_m2m\_bessel\_rotation\_adj\_work}}(ck, dst\_sk, src\_sk, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05684}05684         \& vcnk, alpha, src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05685}05685 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aba7f517fdb4f2c6d19605d22e961bd8a}{fmm\_m2m\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05686}05686 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05713}\mbox{\hyperlink{namespaceddx__harmonics_a9ce78f5c64aa0138b672a8fc0d86a43f}{05713}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9ce78f5c64aa0138b672a8fc0d86a43f}{fmm\_m2m\_bessel\_rotation\_adj\_work}}(c, src\_sk, dst\_sk, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05714}05714         \& src\_m, beta, dst\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05715}05715     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05716}05716     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05717}05717 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_sk(p+1), dst\_sk(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05718}05718         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05719}05719     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05720}05720 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05721}05721     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05722}05722 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05723}05723     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05724}05724     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05725}05725 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05726}05726     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05727}05727     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05728}05728 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05729}05729     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05730}05730     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05731}05731     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05732}05732     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05733}05733     \textcolor{comment}{!    ! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05734}05734     \textcolor{comment}{!    call fmm\_m2m\_bessel\_ztranslate\_work(c(3), src\_r, dst\_r, p, vscales, vcnk, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05735}05735     \textcolor{comment}{!        \& alpha, src\_m, beta, dst\_m, work)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05736}05736     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05737}05737     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05738}05738     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05739}05739     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05740}05740     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05741}05741     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05742}05742     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05743}05743     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05744}05744     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05745}05745     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05746}05746     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05747}05747     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05748}05748     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05749}05749     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05750}05750     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05751}05751     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05752}05752     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05753}05753     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05754}05754     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05755}05755         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05756}05756     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05757}05757     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a25d206db906fd240782e0f328a320a6e}{fmm\_m2m\_bessel\_ztranslate\_adj\_work}}(rho, src\_sk, dst\_sk, p, vscales, vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05758}05758         \& tmp\_m2, zero, tmp\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05759}05759     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05760}05760     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05761}05761         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05762}05762     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05763}05763     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05764}05764 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9ce78f5c64aa0138b672a8fc0d86a43f}{fmm\_m2m\_bessel\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05765}05765 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05789}\mbox{\hyperlink{namespaceddx__harmonics_afd618bb64bfc86a7e3d6e30b846e8827}{05789}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afd618bb64bfc86a7e3d6e30b846e8827}{fmm\_m2m\_rotation\_adj}}(c, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05790}05790         \& src\_m, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05791}05791     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05792}05792     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05793}05793 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05794}05794         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05795}05795     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05796}05796 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05797}05797     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05798}05798 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05799}05799     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05800}05800     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeb0fff99d95226ac55100e7bea5e54c3}{fmm\_m2m\_rotation\_adj\_work}}(c, src\_r, dst\_r, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05801}05801         \& src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05802}05802 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afd618bb64bfc86a7e3d6e30b846e8827}{fmm\_m2m\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05803}05803 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05828}\mbox{\hyperlink{namespaceddx__harmonics_aeb0fff99d95226ac55100e7bea5e54c3}{05828}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeb0fff99d95226ac55100e7bea5e54c3}{fmm\_m2m\_rotation\_adj\_work}}(c, src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05829}05829         \& alpha, src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05830}05830     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05831}05831     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05832}05832 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05833}05833         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05834}05834     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05835}05835 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05836}05836     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05837}05837 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05838}05838     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05839}05839 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05840}05840     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05841}05841     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05842}05842 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05843}05843     \textcolor{comment}{! Covert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05844}05844     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05845}05845     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05846}05846     \textcolor{keywordflow}{if} (stheta .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05847}05847         \textcolor{comment}{! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05848}05848         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{fmm\_m2m\_ztranslate\_adj\_work}}(c(3), src\_r, dst\_r, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05849}05849             \& vcnk, alpha, src\_m, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05850}05850         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05851}05851 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05852}05852     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05853}05853     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05854}05854     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05855}05855     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05856}05856     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05857}05857     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05858}05858     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05859}05859     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05860}05860     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05861}05861     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05862}05862     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05863}05863     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05864}05864     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05865}05865     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05866}05866     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05867}05867     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05868}05868     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05869}05869         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05870}05870     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05871}05871     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa87d3ac883f6e9ec93a2cbb01f243be8}{fmm\_m2m\_ztranslate\_adj\_work}}(rho, src\_r, dst\_r, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05872}05872         \& one, tmp\_m2, zero, tmp\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05873}05873     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05874}05874     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05875}05875         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05876}05876     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05877}05877     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05878}05878 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeb0fff99d95226ac55100e7bea5e54c3}{fmm\_m2m\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05879}05879 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05880}05880 \textcolor{keyword}{subroutine }fmm\_m2m\_bessel\_grad(p, sph\_sk, vscales, vcnk, sph\_m, sph\_m\_grad)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05881}05881     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05882}05882     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05883}05883 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: sph\_sk(p+2), vscales((p+2)**2), vcnk((2*p+3)*(p+2)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05884}05884         \& sph\_m((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05885}05885     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05886}05886 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: sph\_m\_grad((p+2)**2, 3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05887}05887     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05888}05888 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3, 3)} :: zx\_coord\_transform, zy\_coord\_transform}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05889}05889 \textcolor{keywordtype}{    real}(dp) :: tmp((p+1)**2), tmp2((p+2)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05890}05890     \textcolor{comment}{! Set coordinate transformations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05891}05891     zx\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05892}05892     zx\_coord\_transform(3, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05893}05893     zx\_coord\_transform(2, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05894}05894     zx\_coord\_transform(1, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05895}05895     zy\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05896}05896     zy\_coord\_transform(1, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05897}05897     zy\_coord\_transform(2, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05898}05898     zy\_coord\_transform(3, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05899}05899     \textcolor{comment}{! Transform input harmonics for OX axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05900}05900     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p, zx\_coord\_transform, one, sph\_m, zero, tmp)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05901}05901     \textcolor{comment}{! Differentiate M2M along OZ}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05902}05902     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}(sph\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05903}05903         \& one, tmp, zero, tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05904}05904     \textcolor{comment}{! Transform into output harmonics for OX axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05905}05905     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p+1, zx\_coord\_transform, one, tmp2, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05906}05906         \& sph\_m\_grad(:, 1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05907}05907     \textcolor{comment}{! Transform input harmonics for OY axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05908}05908     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p, zy\_coord\_transform, one, sph\_m, zero, tmp)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05909}05909     \textcolor{comment}{! Differentiate M2M along OZ}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05910}05910     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}(sph\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05911}05911         \& one, tmp, zero, tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05912}05912     \textcolor{comment}{! Transform into output harmonics for OY axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05913}05913     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p+1, zy\_coord\_transform, one, tmp2, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05914}05914         \& sph\_m\_grad(:, 2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05915}05915     \textcolor{comment}{! Differentiate for OZ axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05916}05916     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}(sph\_sk, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05917}05917         \& one, sph\_m, zero, sph\_m\_grad(:, 3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05918}05918 \textcolor{keyword}{end subroutine }fmm\_m2m\_bessel\_grad}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05919}05919 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05942}\mbox{\hyperlink{namespaceddx__harmonics_aad9703d05e792d36a570785d86462a54}{05942}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aad9703d05e792d36a570785d86462a54}{fmm\_l2l\_ztranslate}}(z, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05943}05943         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05944}05944     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05945}05945     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05946}05946 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05947}05947         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05948}05948     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05949}05949 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05950}05950     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05951}05951 \textcolor{keywordtype}{    real}(dp) :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05952}05952     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05953}05953     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{fmm\_l2l\_ztranslate\_work}}(z, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05954}05954         \& src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05955}05955 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aad9703d05e792d36a570785d86462a54}{fmm\_l2l\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05956}05956 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05980}\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{05980}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{fmm\_l2l\_ztranslate\_work}}(z, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05981}05981         \& src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05982}05982     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05983}05983     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05984}05984 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05985}05985         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05986}05986     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05987}05987 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05988}05988     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05989}05989 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05990}05990     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05991}05991 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05992}05992     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05993}05993     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05994}05994 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: pow\_r1(:), pow\_r2(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05995}05995     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05996}05996     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05997}05997         dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05998}05998     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l05999}05999         dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06000}06000 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06001}06001     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06002}06002     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06003}06003         \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06004}06004         pow\_r1(1:p+1) => work(1:p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06005}06005         pow\_r2(1:p+1) => work(p+2:2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06006}06006         \textcolor{comment}{! Get powers of r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06007}06007         r1 = z / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06008}06008         r2 = dst\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06009}06009         pow\_r1(1) = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06010}06010         pow\_r2(1) = 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06011}06011         \textcolor{keywordflow}{do} j = 2, p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06012}06012             pow\_r1(j) = pow\_r1(j-\/1) * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06013}06013             pow\_r2(j) = pow\_r2(j-\/1) * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06014}06014 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06015}06015         \textcolor{comment}{! Do actual L2L}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06016}06016         \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06017}06017             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06018}06018             \textcolor{keywordflow}{do} k = 0, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06019}06019                 tmp1 = alpha * pow\_r2(j+1) / vfact(j-\/k+1) / vfact(j+k+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06020}06020                     \& vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06021}06021                 \textcolor{keywordflow}{do} n = j, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06022}06022                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06023}06023                     tmp2 = tmp1 * pow\_r1(n+1) / vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06024}06024                         \& vfact(n-\/k+1) * vfact(n+k+1) / vfact(n-\/j+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06025}06025                         \& vfact(n-\/j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06026}06026                     \textcolor{keywordflow}{if} (mod(n+j, 2) .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06027}06027                         tmp2 = -\/tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06028}06028 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06029}06029                     \textcolor{keywordflow}{if} (k .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06030}06030                         dst\_l(indj) = dst\_l(indj) + tmp2*src\_l(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06031}06031                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06032}06032                         dst\_l(indj+k) = dst\_l(indj+k) + tmp2*src\_l(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06033}06033                         dst\_l(indj-\/k) = dst\_l(indj-\/k) + tmp2*src\_l(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06034}06034 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06035}06035 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06036}06036 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06037}06037 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06038}06038     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06039}06039     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06040}06040         r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06041}06041         tmp1 = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06042}06042         \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06043}06043             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06044}06044             \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06045}06045                 dst\_l(k) = dst\_l(k) + src\_l(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06046}06046 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06047}06047             tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06048}06048 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06049}06049 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06050}06050 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{fmm\_l2l\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06051}06051 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06074}\mbox{\hyperlink{namespaceddx__harmonics_afc3069b525010879766feae650c66ad3}{06074}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afc3069b525010879766feae650c66ad3}{fmm\_l2l\_bessel\_ztranslate}}(z, src\_si, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06075}06075         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06076}06076     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06077}06077     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06078}06078 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06079}06079         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06080}06080     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06081}06081 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06082}06082     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06083}06083 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06084}06084     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06085}06085     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06086}06086     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_af70cd42161512b6731ecb44991fa436f}{fmm\_l2l\_bessel\_ztranslate\_work}}(z, src\_si, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06087}06087         \& alpha, src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06088}06088 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_afc3069b525010879766feae650c66ad3}{fmm\_l2l\_bessel\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06089}06089 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06114}\mbox{\hyperlink{namespaceddx__harmonics_af70cd42161512b6731ecb44991fa436f}{06114}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af70cd42161512b6731ecb44991fa436f}{fmm\_l2l\_bessel\_ztranslate\_work}}(z, src\_si, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06115}06115         \& alpha, src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06116}06116     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06117}06117     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06118}06118     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06119}06119 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06120}06120         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06121}06121     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06122}06122 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06123}06123     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06124}06124 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06125}06125     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06126}06126     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06127}06127 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06128}06128     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06129}06129     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06130}06130 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06131}06131     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06132}06132     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06133}06133     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06134}06134         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06135}06135             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06136}06136         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06137}06137             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06138}06138 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06139}06139         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06140}06140 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06141}06141     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06142}06142     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06143}06143     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06144}06144         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06145}06145 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06146}06146     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06147}06147     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06148}06148     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06149}06149         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06150}06150         \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06151}06151         work(1) = sqrt(pi/(2*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06152}06152         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06153}06153             \textcolor{keyword}{call }cbesi(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06154}06154                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06155}06155             work(2:2*p+1) = sqrt(pi/(2*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06156}06156 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06157}06157         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06158}06158         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06159}06159         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06160}06160             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06161}06161             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06162}06162                 \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06163}06163                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06164}06164                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06165}06165                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06166}06166                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06167}06167                 \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06168}06168                     \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06169}06169                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06170}06170                     tmp1 = vscales(indn) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06171}06171                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06172}06172                         \& src\_si(n+1) / vscales(indj) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06173}06173                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06174}06174                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06175}06175                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06176}06176                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06177}06177                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06178}06178                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06179}06179                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06180}06180 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06181}06181                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06182}06182                     res1 = res1 + tmp3*src\_l(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06183}06183 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06184}06184                 dst\_l(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06185}06185                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06186}06186                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06187}06187                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06188}06188                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06189}06189                     \textcolor{keywordflow}{do} n = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06190}06190                         \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06191}06191                         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06192}06192                         tmp1 = vscales(indn+k) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06193}06193                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06194}06194                             \& src\_si(n+1) / vscales(indj+k) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06195}06195                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06196}06196                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06197}06197                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06198}06198                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06199}06199                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06200}06200                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06201}06201                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06202}06202 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06203}06203                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06204}06204                         res1 = res1 + tmp3*src\_l(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06205}06205                         res2 = res2 + tmp3*src\_l(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06206}06206 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06207}06207                     dst\_l(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06208}06208                     dst\_l(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06209}06209 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06210}06210 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06211}06211         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06212}06212         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06213}06213             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06214}06214                 \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06215}06215                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06216}06216                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06217}06217                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06218}06218                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06219}06219                 \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06220}06220                     \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06221}06221                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06222}06222                     tmp1 = vscales(indn) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06223}06223                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06224}06224                         \& src\_si(n+1) / vscales(indj) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06225}06225                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06226}06226                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06227}06227                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06228}06228                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06229}06229                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06230}06230                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06231}06231                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06232}06232 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06233}06233                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06234}06234                     res1 = res1 + tmp3*src\_l(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06235}06235 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06236}06236                 dst\_l(indj) = beta*dst\_l(indj) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06237}06237                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06238}06238                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06239}06239                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06240}06240                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06241}06241                     \textcolor{keywordflow}{do} n = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06242}06242                         \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06243}06243                         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06244}06244                         tmp1 = vscales(indn+k) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06245}06245                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06246}06246                             \& src\_si(n+1) / vscales(indj+k) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06247}06247                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06248}06248                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06249}06249                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06250}06250                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06251}06251                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06252}06252                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06253}06253                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06254}06254 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06255}06255                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06256}06256                         res1 = res1 + tmp3*src\_l(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06257}06257                         res2 = res2 + tmp3*src\_l(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06258}06258 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06259}06259                     dst\_l(indj+k) = beta*dst\_l(indj+k) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06260}06260                     dst\_l(indj-\/k) = beta*dst\_l(indj-\/k) + res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06261}06261 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06262}06262 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06263}06263 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06264}06264     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06265}06265     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06266}06266         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06267}06267         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06268}06268             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06269}06269             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06270}06270             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06271}06271                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06272}06272                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06273}06273                     dst\_l(k) = tmp1 * src\_l(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06274}06274 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06275}06275                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06276}06276 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06277}06277         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06278}06278         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06279}06279             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06280}06280             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06281}06281             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06282}06282                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06283}06283                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06284}06284                     dst\_l(k) = beta*dst\_l(k) + tmp1*src\_l(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06285}06285 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06286}06286                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06287}06287 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06288}06288 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06289}06289 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06290}06290 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af70cd42161512b6731ecb44991fa436f}{fmm\_l2l\_bessel\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06291}06291 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06314}\mbox{\hyperlink{namespaceddx__harmonics_a1dac37da23b9a63fd737d7992c030196}{06314}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1dac37da23b9a63fd737d7992c030196}{fmm\_l2l\_bessel\_ztranslate\_adj}}(z, src\_si, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06315}06315         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06316}06316     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06317}06317     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06318}06318 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06319}06319         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06320}06320     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06321}06321 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06322}06322     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06323}06323 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06324}06324     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06325}06325     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06326}06326     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a3cec3838169439c25bdca5fc932eda11}{fmm\_l2l\_bessel\_ztranslate\_adj\_work}}(z, src\_si, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06327}06327         \& alpha, src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06328}06328 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1dac37da23b9a63fd737d7992c030196}{fmm\_l2l\_bessel\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06329}06329 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06354}\mbox{\hyperlink{namespaceddx__harmonics_a3cec3838169439c25bdca5fc932eda11}{06354}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3cec3838169439c25bdca5fc932eda11}{fmm\_l2l\_bessel\_ztranslate\_adj\_work}}(z, src\_si, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06355}06355         \& alpha, src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06356}06356     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06357}06357     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06358}06358     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06359}06359 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06360}06360         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06361}06361     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06362}06362 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06363}06363     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06364}06364 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06365}06365     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06366}06366     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06367}06367 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06368}06368     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06369}06369     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06370}06370 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06371}06371     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06372}06372     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06373}06373     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06374}06374         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06375}06375             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06376}06376         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06377}06377             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06378}06378 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06379}06379         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06380}06380 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06381}06381     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06382}06382     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06383}06383     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06384}06384         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06385}06385 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06386}06386     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06387}06387     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06388}06388     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06389}06389         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06390}06390         \textcolor{keyword}{call }cbesi(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06391}06391         work(1) = sqrt(pi/(2*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06392}06392         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06393}06393             \textcolor{keyword}{call }cbesi(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06394}06394                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06395}06395             work(2:2*p+1) = sqrt(pi/(2*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06396}06396 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06397}06397         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06398}06398         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06399}06399         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06400}06400             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06401}06401             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06402}06402                 \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06403}06403                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06404}06404                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06405}06405                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06406}06406                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06407}06407                 \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06408}06408                     \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06409}06409                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06410}06410                     tmp1 = vscales(indn) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06411}06411                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06412}06412                         \& src\_si(n+1) / vscales(indj) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06413}06413                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06414}06414                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06415}06415                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06416}06416                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06417}06417                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06418}06418                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06419}06419                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06420}06420 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06421}06421                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06422}06422                     res1 = res1 + tmp3*src\_l(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06423}06423 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06424}06424                 dst\_l(indn) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06425}06425                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06426}06426                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06427}06427                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06428}06428                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06429}06429                     \textcolor{keywordflow}{do} j = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06430}06430                         \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06431}06431                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06432}06432                         tmp1 = vscales(indn+k) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06433}06433                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06434}06434                             \& src\_si(n+1) / vscales(indj+k) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06435}06435                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06436}06436                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06437}06437                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06438}06438                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06439}06439                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06440}06440                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06441}06441                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06442}06442 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06443}06443                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06444}06444                         res1 = res1 + tmp3*src\_l(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06445}06445                         res2 = res2 + tmp3*src\_l(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06446}06446 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06447}06447                     dst\_l(indn+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06448}06448                     dst\_l(indn-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06449}06449 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06450}06450 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06451}06451         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06452}06452         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06453}06453             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06454}06454                 \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06455}06455                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06456}06456                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06457}06457                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06458}06458                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06459}06459                 \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06460}06460                     \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06461}06461                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06462}06462                     tmp1 = vscales(indn) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06463}06463                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06464}06464                         \textcolor{comment}{!\& src\_si(n+1) / vscales(indj) * dst\_si(j+1) * alpha}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06465}06465                         \& src\_si(n+1) / vscales(indj) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06466}06466                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06467}06467                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06468}06468                         tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06469}06469                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06470}06470                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06471}06471                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06472}06472                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06473}06473 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06474}06474                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06475}06475                     res1 = res1 + tmp3*src\_l(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06476}06476 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06477}06477                 dst\_l(indn) = beta*dst\_l(indn) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06478}06478                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06479}06479                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06480}06480                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06481}06481                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06482}06482                     \textcolor{keywordflow}{do} j = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06483}06483                         \textcolor{comment}{! Offset for src\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06484}06484                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06485}06485                         tmp1 = vscales(indn+k) * ((-\/one)**(j+n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06486}06486                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06487}06487                             \& src\_si(n+1) / vscales(indj+k) * dst\_si(j+1) * alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06488}06488                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06489}06489                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06490}06490                             tmp2 = (two**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06491}06491                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06492}06492                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06493}06493                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06494}06494                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06495}06495 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06496}06496                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06497}06497                         res1 = res1 + tmp3*src\_l(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06498}06498                         res2 = res2 + tmp3*src\_l(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06499}06499 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06500}06500                     dst\_l(indn+k) = beta*dst\_l(indn+k) + res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06501}06501                     dst\_l(indn-\/k) = beta*dst\_l(indn-\/k) + res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06502}06502 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06503}06503 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06504}06504 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06505}06505     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06506}06506     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06507}06507         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06508}06508         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06509}06509             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06510}06510             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06511}06511             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06512}06512                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06513}06513                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06514}06514                     dst\_l(k) = tmp1 * src\_l(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06515}06515 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06516}06516                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06517}06517 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06518}06518         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06519}06519         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06520}06520             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06521}06521             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06522}06522             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06523}06523                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06524}06524                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06525}06525                     dst\_l(k) = beta*dst\_l(k) + tmp1*src\_l(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06526}06526 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06527}06527                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06528}06528 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06529}06529 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06530}06530 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06531}06531 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3cec3838169439c25bdca5fc932eda11}{fmm\_l2l\_bessel\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06532}06532 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06557}\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{06557}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{fmm\_l2l\_bessel\_derivative\_ztranslate\_work}}(src\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06558}06558         \& alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06559}06559     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06560}06560     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06561}06561     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06562}06562 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_si(p+2), vscales((p+2)*(p+2)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06563}06563         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06564}06564     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06565}06565 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+2)*(p+2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06566}06566     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06567}06567     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06568}06568 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06569}06569     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06570}06570     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06571}06571 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1), fact2(p+2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06572}06572     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06573}06573     \textcolor{comment}{! Derivative of the L2L is just a negative derivative of the M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06574}06574     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab223429877e369e8bdc48d6bff4a7a32}{fmm\_m2m\_bessel\_derivative\_ztranslate\_work}}(src\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06575}06575         \& -\/alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06576}06576 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{fmm\_l2l\_bessel\_derivative\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06577}06577 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06600}\mbox{\hyperlink{namespaceddx__harmonics_a5c7d13c5cf136657b7444c1d837fab4b}{06600}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a5c7d13c5cf136657b7444c1d837fab4b}{fmm\_l2l\_ztranslate\_adj}}(z, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06601}06601         \& alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06602}06602     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06603}06603     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06604}06604 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06605}06605         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06606}06606     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06607}06607 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06608}06608     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06609}06609 \textcolor{keywordtype}{    real}(dp) :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06610}06610     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06611}06611     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{fmm\_l2l\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06612}06612         \& alpha, src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06613}06613 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a5c7d13c5cf136657b7444c1d837fab4b}{fmm\_l2l\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06614}06614 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06638}\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{06638}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{fmm\_l2l\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06639}06639         \& alpha, src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06640}06640     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06641}06641     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06642}06642 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06643}06643         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06644}06644     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06645}06645 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06646}06646     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06647}06647 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06648}06648     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06649}06649 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06650}06650     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06651}06651     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06652}06652 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: pow\_r1(:), pow\_r2(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06653}06653     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06654}06654     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06655}06655         dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06656}06656     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06657}06657         dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06658}06658 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06659}06659     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06660}06660     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06661}06661         \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06662}06662         pow\_r1(1:p+1) => work(1:p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06663}06663         pow\_r2(1:p+1) => work(p+2:2*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06664}06664         \textcolor{comment}{! Get powers of r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06665}06665         r1 = -\/z / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06666}06666         r2 = -\/src\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06667}06667         pow\_r1(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06668}06668         pow\_r2(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06669}06669         \textcolor{keywordflow}{do} j = 2, p+1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06670}06670             pow\_r1(j) = pow\_r1(j-\/1) * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06671}06671             pow\_r2(j) = pow\_r2(j-\/1) * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06672}06672 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06673}06673         \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06674}06674             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06675}06675             \textcolor{keywordflow}{do} k = 0, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06676}06676                 tmp1 = alpha * pow\_r2(j+1) / vfact(j-\/k+1) / vfact(j+k+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06677}06677                     \& vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06678}06678                 \textcolor{keywordflow}{do} n = j, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06679}06679                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06680}06680                     tmp2 = tmp1 * pow\_r1(n+1) / vscales(indn) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06681}06681                         \& vfact(n-\/k+1) * vfact(n+k+1) / vfact(n-\/j+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06682}06682                         \& vfact(n-\/j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06683}06683                     \textcolor{keywordflow}{if} (mod(n+j, 2) .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06684}06684                         tmp2 = -\/tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06685}06685 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06686}06686                     \textcolor{keywordflow}{if} (k .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06687}06687                         dst\_l(indn) = dst\_l(indn) + tmp2*src\_l(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06688}06688                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06689}06689                         dst\_l(indn+k) = dst\_l(indn+k) + tmp2*src\_l(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06690}06690                         dst\_l(indn-\/k) = dst\_l(indn-\/k) + tmp2*src\_l(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06691}06691 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06692}06692 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06693}06693 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06694}06694 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06695}06695     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06696}06696     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06697}06697         r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06698}06698         tmp1 = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06699}06699         \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06700}06700             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06701}06701             \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06702}06702                 dst\_l(k) = dst\_l(k) + src\_l(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06703}06703 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06704}06704             tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06705}06705 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06706}06706 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06707}06707 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{fmm\_l2l\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06708}06708 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06728}\mbox{\hyperlink{namespaceddx__harmonics_a37a718dad667bceccf0b7daac26a0e8c}{06728}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a37a718dad667bceccf0b7daac26a0e8c}{fmm\_l2l\_scale}}(src\_r, dst\_r, p, alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06729}06729     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06730}06730     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06731}06731 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_r, dst\_r, alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06732}06732     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06733}06733 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06734}06734     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06735}06735 \textcolor{keywordtype}{    real}(dp) :: r1, tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06736}06736     \textcolor{keywordtype}{integer} :: j, k, indj}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06737}06737     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06738}06738     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06739}06739         dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06740}06740     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06741}06741         dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06742}06742 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06743}06743     r1 = dst\_r / src\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06744}06744     tmp1 = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06745}06745     \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06746}06746         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06747}06747         \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06748}06748             dst\_l(k) = dst\_l(k) + src\_l(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06749}06749 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06750}06750         tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06751}06751 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06752}06752 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a37a718dad667bceccf0b7daac26a0e8c}{fmm\_l2l\_scale}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06753}06753 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06773}\mbox{\hyperlink{namespaceddx__harmonics_a085ce4ed5dc41ee929792e75d6c89c8a}{06773}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a085ce4ed5dc41ee929792e75d6c89c8a}{fmm\_l2l\_scale\_adj}}(src\_r, dst\_r, p, alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06774}06774     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06775}06775     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06776}06776 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: src\_r, dst\_r, alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06777}06777     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06778}06778 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06779}06779     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06780}06780 \textcolor{keywordtype}{    real}(dp) :: r1, tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06781}06781     \textcolor{keywordtype}{integer} :: j, k, indj}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06782}06782     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06783}06783     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06784}06784         dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06785}06785     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06786}06786         dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06787}06787 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06788}06788     r1 = src\_r / dst\_r}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06789}06789     tmp1 = alpha}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06790}06790     \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06791}06791         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06792}06792         \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06793}06793             dst\_l(k) = dst\_l(k) + src\_l(k)*tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06794}06794 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06795}06795         tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06796}06796 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06797}06797 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a085ce4ed5dc41ee929792e75d6c89c8a}{fmm\_l2l\_scale\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06798}06798 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06824}\mbox{\hyperlink{namespaceddx__harmonics_a8a048c26fd101b7f9bac1a0ff0a24905}{06824}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8a048c26fd101b7f9bac1a0ff0a24905}{fmm\_l2l\_rotation}}(c, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06825}06825         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06826}06826     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06827}06827     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06828}06828 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06829}06829         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06830}06830     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06831}06831 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06832}06832     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06833}06833 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p+19*p+8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06834}06834     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06835}06835     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a75cdc5b6aeb95fdfaa88ae0e0834092f}{fmm\_l2l\_rotation\_work}}(c, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06836}06836         \& src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06837}06837 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8a048c26fd101b7f9bac1a0ff0a24905}{fmm\_l2l\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06838}06838 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06865}\mbox{\hyperlink{namespaceddx__harmonics_a75cdc5b6aeb95fdfaa88ae0e0834092f}{06865}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a75cdc5b6aeb95fdfaa88ae0e0834092f}{fmm\_l2l\_rotation\_work}}(c, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06866}06866         \& src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06867}06867     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06868}06868     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06869}06869 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06870}06870         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06871}06871     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06872}06872 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06873}06873     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06874}06874 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06875}06875     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06876}06876 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06877}06877     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06878}06878     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06879}06879 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_l(:), tmp\_l2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06880}06880     \textcolor{comment}{! Covert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06881}06881     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06882}06882     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06883}06883     \textcolor{keywordflow}{if} (stheta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06884}06884         \textcolor{comment}{! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06885}06885         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{fmm\_l2l\_ztranslate\_work}}(c(3), src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06886}06886             \& alpha, src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06887}06887         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06888}06888 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06889}06889     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06890}06890     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06891}06891     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06892}06892     tmp\_l(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06893}06893     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06894}06894     tmp\_l2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06895}06895     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06896}06896     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06897}06897     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06898}06898     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06899}06899     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06900}06900     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06901}06901     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06902}06902     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06903}06903     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_l, zero, tmp\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06904}06904     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06905}06905     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_l, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06906}06906         \& tmp\_l2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06907}06907     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06908}06908     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a4570fcbdae57e94800ae108a5e7d0156}{fmm\_l2l\_ztranslate\_work}}(rho, src\_r, dst\_r, p, vscales, vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06909}06909         \& tmp\_l2, zero, tmp\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06910}06910     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06911}06911     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_l, zero, tmp\_l2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06912}06912         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06913}06913     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06914}06914     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_l2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06915}06915 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a75cdc5b6aeb95fdfaa88ae0e0834092f}{fmm\_l2l\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06916}06916 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06942}\mbox{\hyperlink{namespaceddx__harmonics_a2470673bf995bdc825636dc134ccbb8a}{06942}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2470673bf995bdc825636dc134ccbb8a}{fmm\_l2l\_bessel\_rotation}}(c, src\_r, dst\_r, kappa, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06943}06943         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06944}06944     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06945}06945     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06946}06946     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06947}06947 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06948}06948         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06949}06949     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06950}06950 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06951}06951     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06952}06952 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_si(p+1), dst\_si(p+1), s1, s2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06953}06953     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06954}06954     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06955}06955     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06956}06956     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06957}06957     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06958}06958     s1 = sqrt(pi/(2*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06959}06959     s2 = sqrt(pi/(2*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06960}06960     \textcolor{keyword}{call }cbesi(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06961}06961     src\_si(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06962}06962     \textcolor{keyword}{call }cbesi(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06963}06963     dst\_si(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06964}06964     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06965}06965         \textcolor{keyword}{call }cbesi(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06966}06966         src\_si(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06967}06967         \textcolor{keyword}{call }cbesi(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06968}06968         dst\_si(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06969}06969 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06970}06970     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06971}06971     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a2284e6d544d983d0ac935f0ec642d3b1}{fmm\_l2l\_bessel\_rotation\_work}}(c*kappa, src\_si, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06972}06972         \& src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06973}06973 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2470673bf995bdc825636dc134ccbb8a}{fmm\_l2l\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l06974}06974 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07001}\mbox{\hyperlink{namespaceddx__harmonics_a2284e6d544d983d0ac935f0ec642d3b1}{07001}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2284e6d544d983d0ac935f0ec642d3b1}{fmm\_l2l\_bessel\_rotation\_work}}(c, src\_si, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07002}07002         \& src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07003}07003     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07004}07004     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07005}07005 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07006}07006         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07007}07007     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07008}07008 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07009}07009     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07010}07010 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07011}07011     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07012}07012     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07013}07013 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07014}07014     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07015}07015     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07016}07016 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_l(:), tmp\_l2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07017}07017     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07018}07018     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07019}07019     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07020}07020     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07021}07021     \textcolor{comment}{!    call fmm\_l2l\_bessel\_ztranslate\_work(abs(c(3)), src\_si, dst\_si, p, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07022}07022     \textcolor{comment}{!        \& vscales, vcnk, one, src\_l, beta, dst\_l, work, work\_complex)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07023}07023     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07024}07024     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07025}07025     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07026}07026     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07027}07027     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07028}07028     tmp\_l(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07029}07029     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07030}07030     tmp\_l2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07031}07031     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07032}07032     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07033}07033     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07034}07034     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07035}07035     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07036}07036     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07037}07037     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07038}07038     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07039}07039     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_l, zero, tmp\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07040}07040     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07041}07041     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_l, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07042}07042         \& tmp\_l2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07043}07043     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07044}07044     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_af70cd42161512b6731ecb44991fa436f}{fmm\_l2l\_bessel\_ztranslate\_work}}(rho, src\_si, dst\_si, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07045}07045         \& vcnk, one, tmp\_l2, zero, tmp\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07046}07046     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07047}07047     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_l, zero, tmp\_l2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07048}07048         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07049}07049     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07050}07050     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_l2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07051}07051 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2284e6d544d983d0ac935f0ec642d3b1}{fmm\_l2l\_bessel\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07052}07052 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07078}\mbox{\hyperlink{namespaceddx__harmonics_a43a12c1e6baf98f39499317b71978ea1}{07078}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a43a12c1e6baf98f39499317b71978ea1}{fmm\_l2l\_bessel\_rotation\_adj}}(c, src\_r, dst\_r, kappa, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07079}07079         \& src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07080}07080     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07081}07081     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07082}07082     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07083}07083 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07084}07084         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07085}07085     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07086}07086 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07087}07087     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07088}07088 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_si(p+1), dst\_si(p+1), s1, s2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07089}07089     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07090}07090     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07091}07091     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07092}07092     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07093}07093     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07094}07094     s1 = sqrt(pi/(2*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07095}07095     s2 = sqrt(pi/(2*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07096}07096     \textcolor{keyword}{call }cbesi(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07097}07097     src\_si(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07098}07098     \textcolor{keyword}{call }cbesi(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07099}07099     dst\_si(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07100}07100     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07101}07101         \textcolor{keyword}{call }cbesi(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07102}07102         src\_si(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07103}07103         \textcolor{keyword}{call }cbesi(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07104}07104         dst\_si(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07105}07105 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07106}07106     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07107}07107     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a5c75d37d1e2bcc0897cdac02b45c7bca}{fmm\_l2l\_bessel\_rotation\_adj\_work}}(-\/c*kappa, dst\_si, src\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07108}07108         \& src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07109}07109 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a43a12c1e6baf98f39499317b71978ea1}{fmm\_l2l\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07110}07110 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07137}\mbox{\hyperlink{namespaceddx__harmonics_a5c75d37d1e2bcc0897cdac02b45c7bca}{07137}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a5c75d37d1e2bcc0897cdac02b45c7bca}{fmm\_l2l\_bessel\_rotation\_adj\_work}}(c, src\_si, dst\_si, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07138}07138         \& vcnk, alpha, src\_l, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07139}07139     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07140}07140     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07141}07141 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_si(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07142}07142         \& vcnk((2*p+1)*(p+1)), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07143}07143     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07144}07144 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07145}07145     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07146}07146 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07147}07147     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07148}07148     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07149}07149 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07150}07150     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07151}07151     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07152}07152 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_l(:), tmp\_l2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07153}07153     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07154}07154     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07155}07155     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07156}07156     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07157}07157     \textcolor{comment}{!    ! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07158}07158     \textcolor{comment}{!    call fmm\_l2l\_bessel\_ztranslate\_adj\_work(abs(c(3)), dst\_si, src\_si, p, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07159}07159     \textcolor{comment}{!        \& vscales, vcnk, one, src\_l, beta, dst\_l, work, work\_complex)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07160}07160     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07161}07161     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07162}07162     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07163}07163     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07164}07164     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07165}07165     tmp\_l(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07166}07166     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07167}07167     tmp\_l2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07168}07168     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07169}07169     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07170}07170     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07171}07171     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07172}07172     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07173}07173     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07174}07174     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07175}07175     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07176}07176     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_l, zero, tmp\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07177}07177     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07178}07178     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_l, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07179}07179         \& tmp\_l2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07180}07180     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07181}07181     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a3cec3838169439c25bdca5fc932eda11}{fmm\_l2l\_bessel\_ztranslate\_adj\_work}}(rho, dst\_si, src\_si, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07182}07182         \& vcnk, one, tmp\_l2, zero, tmp\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07183}07183     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07184}07184     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_l, zero, tmp\_l2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07185}07185         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07186}07186     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07187}07187     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_l2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07188}07188 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a5c75d37d1e2bcc0897cdac02b45c7bca}{fmm\_l2l\_bessel\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07189}07189 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07190}07190 \textcolor{keyword}{subroutine }fmm\_l2l\_bessel\_grad(p, sph\_si, vscales, vcnk, sph\_l, sph\_l\_grad)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07191}07191     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07192}07192     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07193}07193 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: sph\_si(p+2), vscales((p+2)**2), vcnk((2*p+3)*(p+2)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07194}07194         \& sph\_l((p+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07195}07195     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07196}07196 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: sph\_l\_grad((p+2)**2, 3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07197}07197     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07198}07198 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3, 3)} :: zx\_coord\_transform, zy\_coord\_transform}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07199}07199 \textcolor{keywordtype}{    real}(dp) :: tmp((p+1)**2), tmp2((p+2)**2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07200}07200     \textcolor{comment}{! Set coordinate transformations}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07201}07201     zx\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07202}07202     zx\_coord\_transform(3, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07203}07203     zx\_coord\_transform(2, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07204}07204     zx\_coord\_transform(1, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07205}07205     zy\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07206}07206     zy\_coord\_transform(1, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07207}07207     zy\_coord\_transform(2, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07208}07208     zy\_coord\_transform(3, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07209}07209     \textcolor{comment}{! Transform input harmonics for OX axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07210}07210     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p, zx\_coord\_transform, one, sph\_l, zero, tmp)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07211}07211     \textcolor{comment}{! Differentiate L2L along OZ}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07212}07212     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{fmm\_l2l\_bessel\_derivative\_ztranslate\_work}}(sph\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07213}07213         \& one, tmp, zero, tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07214}07214     \textcolor{comment}{! Transform into output harmonics for OX axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07215}07215     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p+1, zx\_coord\_transform, one, tmp2, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07216}07216         \& sph\_l\_grad(:, 1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07217}07217     \textcolor{comment}{! Transform input harmonics for OY axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07218}07218     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p, zy\_coord\_transform, one, sph\_l, zero, tmp)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07219}07219     \textcolor{comment}{! Differentiate M2M along OZ}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07220}07220     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{fmm\_l2l\_bessel\_derivative\_ztranslate\_work}}(sph\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07221}07221         \& one, tmp, zero, tmp2)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07222}07222     \textcolor{comment}{! Transform into output harmonics for OY axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07223}07223     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(p+1, zy\_coord\_transform, one, tmp2, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07224}07224         \& sph\_l\_grad(:, 2))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07225}07225     \textcolor{comment}{! Differentiate for OZ axis}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07226}07226     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ab85718cf83cde425ec2829524a4e86f0}{fmm\_l2l\_bessel\_derivative\_ztranslate\_work}}(sph\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07227}07227         \& one, sph\_l, zero, sph\_l\_grad(:, 3))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07228}07228 \textcolor{keyword}{end subroutine }fmm\_l2l\_bessel\_grad}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07229}07229 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07255}\mbox{\hyperlink{namespaceddx__harmonics_a2e78bfce1b61689ffc4bbae65033273c}{07255}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2e78bfce1b61689ffc4bbae65033273c}{fmm\_l2l\_rotation\_adj}}(c, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07256}07256         \& alpha, src\_l, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07257}07257     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07258}07258     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07259}07259 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07260}07260         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07261}07261     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07262}07262 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07263}07263     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07264}07264 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07265}07265     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07266}07266     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{fmm\_l2l\_rotation\_adj\_work}}(c, src\_r, dst\_r, p, vscales, vfact, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07267}07267         \& src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07268}07268 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a2e78bfce1b61689ffc4bbae65033273c}{fmm\_l2l\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07269}07269 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07296}\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{07296}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{fmm\_l2l\_rotation\_adj\_work}}(c, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07297}07297         \& alpha, src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07298}07298     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07299}07299     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07300}07300 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07301}07301         \& vfact(2*p+1), alpha, src\_l((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07302}07302     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07303}07303 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07304}07304     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07305}07305 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07306}07306     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07307}07307 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07308}07308     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07309}07309     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07310}07310 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_l(:), tmp\_l2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07311}07311     \textcolor{comment}{! Covert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07312}07312     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07313}07313     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07314}07314     \textcolor{keywordflow}{if} (stheta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07315}07315         \textcolor{comment}{! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07316}07316         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{fmm\_l2l\_ztranslate\_adj\_work}}(c(3), src\_r, dst\_r, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07317}07317             \& vfact, alpha, src\_l, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07318}07318         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07319}07319 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07320}07320     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07321}07321     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07322}07322     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07323}07323     tmp\_l(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07324}07324     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07325}07325     tmp\_l2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07326}07326     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07327}07327     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07328}07328     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07329}07329     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07330}07330     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07331}07331     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07332}07332     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07333}07333     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07334}07334     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_l, zero, tmp\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07335}07335     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07336}07336     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_l, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07337}07337         \& tmp\_l2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07338}07338     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07339}07339     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9c62cbb1ed23a853d4e7b41d6ddcdf02}{fmm\_l2l\_ztranslate\_adj\_work}}(rho, src\_r, dst\_r, p, vscales, vfact, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07340}07340         \& one, tmp\_l2, zero, tmp\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07341}07341     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07342}07342     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_l, zero, tmp\_l2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07343}07343         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07344}07344     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07345}07345     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_l2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07346}07346 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{fmm\_l2l\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07347}07347 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07371}\mbox{\hyperlink{namespaceddx__harmonics_a302db88f5061b12f7486d0b97cc3e097}{07371}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a302db88f5061b12f7486d0b97cc3e097}{fmm\_m2l\_ztranslate}}(z, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07372}07372         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07373}07373     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07374}07374     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pm, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07375}07375 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((pm+pl+1)*(pm+pl+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07376}07376         \& m2l\_ztranslate\_coef(pm+1, pl+1, pl+1), alpha, src\_m((pm+1)*(pm+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07377}07377         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07378}07378     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07379}07379 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((pl+1)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07380}07380     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07381}07381 \textcolor{keywordtype}{    real}(dp) :: work((pm+2)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07382}07382     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07383}07383     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{fmm\_m2l\_ztranslate\_work}}(z, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07384}07384         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07385}07385 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a302db88f5061b12f7486d0b97cc3e097}{fmm\_m2l\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07386}07386 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07411}\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{07411}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{fmm\_m2l\_ztranslate\_work}}(z, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07412}07412         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07413}07413     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07414}07414     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pm, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07415}07415 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((pm+pl+1)*(pm+pl+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07416}07416         \& m2l\_ztranslate\_coef(pm+1, pl+1, pl+1), alpha, src\_m((pm+1)*(pm+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07417}07417         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07418}07418     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07419}07419 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((pl+1)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07420}07420     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07421}07421 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work((pm+2)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07422}07422     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07423}07423 \textcolor{keywordtype}{    real}(dp) :: tmp1, tmp2, r1, r2, res1, res2, pow\_r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07424}07424     \textcolor{keywordtype}{integer} :: j, k, n, indj, indjn, indk1, indk2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07425}07425     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07426}07426 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: src\_m2(:), pow\_r1(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07427}07427     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07428}07428     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07429}07429         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07430}07430             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07431}07431         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07432}07432             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07433}07433 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07434}07434         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07435}07435 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07436}07436     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07437}07437     \textcolor{comment}{! z cannot be zero, as input sphere (multipole) must not intersect with}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07438}07438     \textcolor{comment}{! output sphere (local)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07439}07439     \textcolor{keywordflow}{if} (z .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07440}07440         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07441}07441 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07442}07442     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07443}07443     n = (pm+1) ** 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07444}07444     src\_m2(1:n) => work(1:n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07445}07445     pow\_r1(1:pm+1) => work(n+1:n+pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07446}07446     \textcolor{comment}{! Get powers of r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07447}07447     r1 = src\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07448}07448     r2 = dst\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07449}07449     \textcolor{comment}{! This abs(r1) makes it possible to work with negative z to avoid}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07450}07450     \textcolor{comment}{! unnecessary rotation to positive z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07451}07451     tmp1 = abs(r1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07452}07452     \textcolor{keywordflow}{do} j = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07453}07453         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07454}07454         pow\_r1(j+1) = tmp1 / vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07455}07455         tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07456}07456 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07457}07457     pow\_r2 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07458}07458     \textcolor{comment}{! Reorder source harmonics from (degree, order) to (order, degree)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07459}07459     \textcolor{comment}{! Zero order k=0 at first}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07460}07460     \textcolor{keywordflow}{do} j = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07461}07461         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07462}07462         src\_m2(j+1) = pow\_r1(j+1) * src\_m(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07463}07463 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07464}07464     \textcolor{comment}{! Non-\/zero orders next, a positive k followed by a negative -\/k}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07465}07465     indk1 = pm + 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07466}07466     \textcolor{keywordflow}{do} k = 1, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07467}07467         n = pm -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07468}07468         indk2 = indk1 + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07469}07469         \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07470}07470         \textcolor{keywordflow}{do} j = k, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07471}07471             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07472}07472             src\_m2(indk1+j-\/k) = pow\_r1(j+1) * src\_m(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07473}07473             src\_m2(indk2+j-\/k) = pow\_r1(j+1) * src\_m(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07474}07474 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07475}07475         indk1 = indk2 + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07476}07476 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07477}07477     \textcolor{comment}{! Do actual M2L}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07478}07478     \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07479}07479     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07480}07480         \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07481}07481             \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07482}07482             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07483}07483             \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07484}07484             tmp1 = alpha * vscales(indj) * pow\_r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07485}07485             pow\_r2 = pow\_r2 * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07486}07486             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07487}07487             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07488}07488             \textcolor{keywordflow}{do} n = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07489}07489                 res1 = res1 + m2l\_ztranslate\_coef(n+1, 1, j+1)*src\_m2(n+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07490}07490 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07491}07491             dst\_l(indj) = tmp1 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07492}07492             \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07493}07493             \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07494}07494             \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07495}07495                 \textcolor{comment}{! Offsets for src\_m2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07496}07496                 indk1 = pm + 2 + (2*pm-\/k+2)*(k-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07497}07497                 indk2 = indk1 + pm -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07498}07498                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07499}07499                 res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07500}07500                 \textcolor{comment}{!!GCC\$ unroll 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07501}07501                 \textcolor{keywordflow}{do} n = k, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07502}07502                     res1 = res1 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07503}07503                         \& m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07504}07504                         \& src\_m2(indk1+n-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07505}07505                     res2 = res2 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07506}07506                         \& m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07507}07507                         \& src\_m2(indk2+n-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07508}07508 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07509}07509                 dst\_l(indj+k) = tmp1 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07510}07510                 dst\_l(indj-\/k) = tmp1 * res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07511}07511 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07512}07512 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07513}07513     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07514}07514         \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07515}07515             \textcolor{comment}{! Offset for dst\_l}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07516}07516             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07517}07517             \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07518}07518             tmp1 = alpha * vscales(indj) * pow\_r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07519}07519             pow\_r2 = pow\_r2 * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07520}07520             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07521}07521             \textcolor{keywordflow}{do} n = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07522}07522                 res1 = res1 + m2l\_ztranslate\_coef(n+1, 1, j+1)*src\_m2(n+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07523}07523 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07524}07524             dst\_l(indj) = beta*dst\_l(indj) + tmp1*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07525}07525             \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07526}07526             \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07527}07527                 \textcolor{comment}{! Offsets for src\_m2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07528}07528                 indk1 = pm + 2 + (2*pm-\/k+2)*(k-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07529}07529                 indk2 = indk1 + pm -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07530}07530                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07531}07531                 res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07532}07532                 \textcolor{keywordflow}{do} n = k, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07533}07533                     res1 = res1 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07534}07534                         \& m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07535}07535                         \& src\_m2(indk1+n-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07536}07536                     res2 = res2 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07537}07537                         \& m2l\_ztranslate\_coef(n-\/k+1, k+1, j-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07538}07538                         \& src\_m2(indk2+n-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07539}07539 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07540}07540                 dst\_l(indj+k) = beta*dst\_l(indj+k) + tmp1*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07541}07541                 dst\_l(indj-\/k) = beta*dst\_l(indj-\/k) + tmp1*res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07542}07542 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07543}07543 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07544}07544 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07545}07545 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{fmm\_m2l\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07546}07546 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07570}\mbox{\hyperlink{namespaceddx__harmonics_aeae1744438b52f07e7a42f549c610d32}{07570}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeae1744438b52f07e7a42f549c610d32}{fmm\_m2l\_ztranslate\_adj}}(z, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07571}07571         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07572}07572     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07573}07573     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pl, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07574}07574 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((pm+pl+1)*(pm+pl+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07575}07575         \& m2l\_ztranslate\_adj\_coef(pl+1, pl+1, pm+1), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07576}07576         \& src\_l((pl+1)*(pl+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07577}07577     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07578}07578 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((pm+1)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07579}07579     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07580}07580 \textcolor{keywordtype}{    real}(dp) :: work((pl+2)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07581}07581     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07582}07582     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{fmm\_m2l\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07583}07583         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07584}07584 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aeae1744438b52f07e7a42f549c610d32}{fmm\_m2l\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07585}07585 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07609}\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{07609}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{fmm\_m2l\_ztranslate\_adj\_work}}(z, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07610}07610         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07611}07611     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07612}07612     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pl, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07613}07613 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_r, dst\_r, vscales((pm+pl+1)*(pm+pl+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07614}07614         \& m2l\_ztranslate\_adj\_coef(pl+1, pl+1, pm+1), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07615}07615         \& src\_l((pl+1)*(pl+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07616}07616     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07617}07617 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((pm+1)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07618}07618     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07619}07619 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work((pl+2)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07620}07620     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07621}07621 \textcolor{keywordtype}{    real}(dp) :: tmp1, tmp2, tmp3, r1, r2, pow\_r1, res1, res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07622}07622     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, indk1, indk2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07623}07623     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07624}07624 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: pow\_r2(:), src\_l2(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07625}07625     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07626}07626     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07627}07627         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07628}07628             dst\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07629}07629         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07630}07630             dst\_m = beta * dst\_m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07631}07631 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07632}07632         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07633}07633 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07634}07634     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07635}07635     \textcolor{comment}{! z cannot be zero, as input sphere (multipole) must not intersect with}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07636}07636     \textcolor{comment}{! output sphere (local)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07637}07637     \textcolor{keywordflow}{if} (z .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07638}07638         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07639}07639 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07640}07640     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07641}07641     n = (pl+1) ** 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07642}07642     src\_l2(1:n) => work(1:n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07643}07643     pow\_r2(1:pl+1) => work(n+1:n+pl+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07644}07644     \textcolor{comment}{! Get powers of r1 and r2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07645}07645     r1 = -\/dst\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07646}07646     r2 = -\/src\_r / z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07647}07647     \textcolor{comment}{! This abs(r1) makes it possible to work with negative z to avoid}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07648}07648     \textcolor{comment}{! unnecessary rotation to positive z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07649}07649     tmp1 = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07650}07650     \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07651}07651         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07652}07652         pow\_r2(j+1) = tmp1 * vscales(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07653}07653         tmp1 = tmp1 * r2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07654}07654 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07655}07655     pow\_r1 = abs(r1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07656}07656     \textcolor{comment}{! Reorder source harmonics from (degree, order) to (order, degree)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07657}07657     \textcolor{comment}{! Zero order k=0 at first}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07658}07658     \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07659}07659         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07660}07660         src\_l2(j+1) = pow\_r2(j+1) * src\_l(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07661}07661 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07662}07662     \textcolor{comment}{! Non-\/zero orders next, a positive k followed by a negative -\/k}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07663}07663     indk1 = pl + 2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07664}07664     \textcolor{keywordflow}{do} k = 1, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07665}07665         n = pl -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07666}07666         indk2 = indk1 + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07667}07667         \textcolor{keywordflow}{do} j = k, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07668}07668             indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07669}07669             src\_l2(indk1+j-\/k) = pow\_r2(j+1) * src\_l(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07670}07670             src\_l2(indk2+j-\/k) = pow\_r2(j+1) * src\_l(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07671}07671 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07672}07672         indk1 = indk2 + n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07673}07673 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07674}07674     \textcolor{comment}{! Do actual adjoint M2L}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07675}07675     \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07676}07676     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07677}07677         \textcolor{keywordflow}{do} n = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07678}07678             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07679}07679             \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07680}07680             tmp1 = alpha * pow\_r1 / vscales(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07681}07681             pow\_r1 = pow\_r1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07682}07682             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07683}07683             \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07684}07684                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07685}07685                 res1 = res1 + m2l\_ztranslate\_adj\_coef(j+1, 1, n+1)*src\_l2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07686}07686 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07687}07687             dst\_m(indn) = tmp1 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07688}07688             \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07689}07689             \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07690}07690                 \textcolor{comment}{! Offsets for src\_l2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07691}07691                 indk1 = pl + 2 + (2*pl-\/k+2)*(k-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07692}07692                 indk2 = indk1 + pl -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07693}07693                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07694}07694                 res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07695}07695                 \textcolor{keywordflow}{do} j = k, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07696}07696                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07697}07697                     res1 = res1 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07698}07698                         \& m2l\_ztranslate\_adj\_coef(j-\/k+1, k+1, n-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07699}07699                         \& src\_l2(indk1+j-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07700}07700                     res2 = res2 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07701}07701                         \& m2l\_ztranslate\_adj\_coef(j-\/k+1, k+1, n-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07702}07702                         \& src\_l2(indk2+j-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07703}07703 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07704}07704                 dst\_m(indn+k) = tmp1 * res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07705}07705                 dst\_m(indn-\/k) = tmp1 * res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07706}07706 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07707}07707 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07708}07708     \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07709}07709     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07710}07710         \textcolor{keywordflow}{do} n = 0, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07711}07711             indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07712}07712             \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07713}07713             tmp1 = alpha * pow\_r1 / vscales(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07714}07714             pow\_r1 = pow\_r1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07715}07715             res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07716}07716             \textcolor{keywordflow}{do} j = 0, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07717}07717                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07718}07718                 res1 = res1 + m2l\_ztranslate\_adj\_coef(j+1, 1, n+1)*src\_l2(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07719}07719 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07720}07720             dst\_m(indn) = beta*dst\_m(indn) + tmp1*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07721}07721             \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07722}07722             \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07723}07723                 \textcolor{comment}{! Offsets for src\_l2}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07724}07724                 indk1 = pl + 2 + (2*pl-\/k+2)*(k-\/1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07725}07725                 indk2 = indk1 + pl -\/ k + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07726}07726                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07727}07727                 res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07728}07728                 \textcolor{keywordflow}{do} j = k, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07729}07729                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07730}07730                     res1 = res1 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07731}07731                         \& m2l\_ztranslate\_adj\_coef(j-\/k+1, k+1, n-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07732}07732                         \& src\_l2(indk1+j-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07733}07733                     res2 = res2 + \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07734}07734                         \& m2l\_ztranslate\_adj\_coef(j-\/k+1, k+1, n-\/k+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07735}07735                         \& src\_l2(indk2+j-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07736}07736 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07737}07737                 dst\_m(indn+k) = beta*dst\_m(indn+k) + tmp1*res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07738}07738                 dst\_m(indn-\/k) = beta*dst\_m(indn-\/k) + tmp1*res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07739}07739 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07740}07740 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07741}07741 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07742}07742 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{fmm\_m2l\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07743}07743 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07770}\mbox{\hyperlink{namespaceddx__harmonics_a0d2be15addfeb062073b61d5fd239912}{07770}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a0d2be15addfeb062073b61d5fd239912}{fmm\_m2l\_rotation}}(c, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07771}07771         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07772}07772     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07773}07773     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pm, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07774}07774 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((pm+pl+1)**2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07775}07775         \& m2l\_ztranslate\_coef(pm+1, pl+1, pl+1), alpha, src\_m((pm+1)*(pm+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07776}07776         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07777}07777     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07778}07778 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((pl+1)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07779}07779     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07780}07780 \textcolor{keywordtype}{    real}(dp) :: work(6*max(pm, pl)**2 + 19*max(pm, pl) + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07781}07781     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07782}07782     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{fmm\_m2l\_rotation\_work}}(c, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07783}07783         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07784}07784 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a0d2be15addfeb062073b61d5fd239912}{fmm\_m2l\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07785}07785 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07814}\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{07814}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{fmm\_m2l\_rotation\_work}}(c, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07815}07815         \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07816}07816     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07817}07817     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pm, pl}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07818}07818 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((pm+pl+1)**2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07819}07819         \& m2l\_ztranslate\_coef(pm+1, pl+1, pl+1), alpha, src\_m((pm+1)*(pm+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07820}07820         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07821}07821     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07822}07822 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((pl+1)*(pl+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07823}07823     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07824}07824 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07825}07825         \& work(6*max(pm, pl)**2 + 19*max(pm, pl) + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07826}07826     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07827}07827 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07828}07828     \textcolor{keywordtype}{integer} :: m, n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07829}07829     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07830}07830 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_ml(:), tmp\_ml2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07831}07831     \textcolor{comment}{! Covert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07832}07832     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07833}07833     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07834}07834     \textcolor{keywordflow}{if} (stheta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07835}07835         \textcolor{comment}{! Workspace here is (pm+2)*(pm+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07836}07836         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{fmm\_m2l\_ztranslate\_work}}(c(3), src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07837}07837             \& m2l\_ztranslate\_coef, alpha, src\_m, beta, dst\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07838}07838         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07839}07839 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07840}07840     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07841}07841     p = max(pm, pl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07842}07842     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07843}07843     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07844}07844     tmp\_ml(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07845}07845     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07846}07846     tmp\_ml2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07847}07847     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07848}07848     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07849}07849     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07850}07850     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07851}07851     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07852}07852     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07853}07853     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07854}07854     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07855}07855     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(pm, vcos, vsin, alpha, src\_m, zero, tmp\_ml)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07856}07856     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*pm*pm+13*pm+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07857}07857     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(pm, ctheta, -\/stheta, one, tmp\_ml, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07858}07858         \& tmp\_ml2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07859}07859     \textcolor{comment}{! OZ translation, workspace here is (pm+2)*(pm+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07860}07860     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77d42c058d06892d3b7fca4be94fe7aa}{fmm\_m2l\_ztranslate\_work}}(rho, src\_r, dst\_r, pm, pl, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07861}07861         \& m2l\_ztranslate\_coef, one, tmp\_ml2, zero, tmp\_ml, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07862}07862     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*pl*pl+13*pl+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07863}07863     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(pl, ctheta, stheta, one, tmp\_ml, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07864}07864         \& tmp\_ml2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07865}07865     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07866}07866     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(pl, vcos, vsin, one, tmp\_ml2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07867}07867 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{fmm\_m2l\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07868}07868 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07894}\mbox{\hyperlink{namespaceddx__harmonics_af04110484cace6e9cefcad3acd7ece66}{07894}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af04110484cace6e9cefcad3acd7ece66}{fmm\_m2l\_bessel\_rotation}}(c, src\_r, dst\_r, kappa, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07895}07895         \& src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07896}07896     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07897}07897     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07898}07898     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07899}07899 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07900}07900         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07901}07901     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07902}07902 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07903}07903     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07904}07904 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_sk(p+1), dst\_si(p+1), s1, s2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07905}07905     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07906}07906     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07907}07907     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07908}07908     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07909}07909     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07910}07910     s1 = sqrt(2/(pi*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07911}07911     s2 = sqrt(pi/(2*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07912}07912     \textcolor{keyword}{call }cbesk(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07913}07913     src\_sk(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07914}07914     \textcolor{keyword}{call }cbesi(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07915}07915     dst\_si(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07916}07916     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07917}07917         \textcolor{keyword}{call }cbesk(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07918}07918         src\_sk(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07919}07919         \textcolor{keyword}{call }cbesi(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07920}07920         dst\_si(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07921}07921 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07922}07922     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07923}07923     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{fmm\_m2l\_bessel\_rotation\_work}}(c*kappa, src\_sk, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07924}07924         \& src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07925}07925 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af04110484cace6e9cefcad3acd7ece66}{fmm\_m2l\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07926}07926 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07953}\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{07953}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{fmm\_m2l\_bessel\_rotation\_work}}(c, src\_sk, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07954}07954         \& src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07955}07955     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07956}07956     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07957}07957 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07958}07958         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07959}07959     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07960}07960 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07961}07961     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07962}07962 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07963}07963     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07964}07964     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07965}07965 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07966}07966     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07967}07967     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07968}07968 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07969}07969     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07970}07970     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07971}07971     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07972}07972     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07973}07973     \textcolor{comment}{!    ! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07974}07974     \textcolor{comment}{!    call fmm\_m2m\_bessel\_ztranslate\_work(c(3), src\_r, dst\_r, p, vscales, vcnk, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07975}07975     \textcolor{comment}{!        \& alpha, src\_m, beta, dst\_m, work)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07976}07976     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07977}07977     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07978}07978     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07979}07979     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07980}07980     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07981}07981     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07982}07982     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07983}07983     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07984}07984     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07985}07985     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07986}07986     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07987}07987     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07988}07988     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07989}07989     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07990}07990     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07991}07991     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07992}07992     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07993}07993     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07994}07994     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07995}07995         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07996}07996     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07997}07997     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aca682ec8e6ddee561d69d864ad8bc14e}{fmm\_m2l\_bessel\_ztranslate\_work}}(rho, src\_sk, dst\_si, p, vscales, vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07998}07998         \& tmp\_m2, zero, tmp\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l07999}07999     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08000}08000     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08001}08001         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08002}08002     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08003}08003     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08004}08004 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{fmm\_m2l\_bessel\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08005}08005 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08031}\mbox{\hyperlink{namespaceddx__harmonics_a44beda4f2d48ac451449357076a3ff89}{08031}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a44beda4f2d48ac451449357076a3ff89}{fmm\_m2l\_bessel\_rotation\_adj}}(c, src\_r, dst\_r, kappa, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08032}08032         \& src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08033}08033     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08034}08034     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08035}08035     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08036}08036 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08037}08037         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08038}08038     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08039}08039 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08040}08040     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08041}08041 \textcolor{keywordtype}{    real}(dp) :: work(6*p*p + 19*p + 8), src\_sk(p+1), dst\_si(p+1), s1, s2, ck(3)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08042}08042     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1), z1, z2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08043}08043     \textcolor{keywordtype}{integer} :: NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08044}08044     \textcolor{comment}{! Compute Bessel functions}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08045}08045     z1 = src\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08046}08046     z2 = dst\_r * kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08047}08047     s1 = sqrt(2/(pi*real(z1)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08048}08048     s2 = sqrt(pi/(2*real(z2)))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08049}08049     \textcolor{keyword}{call }cbesk(z1, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08050}08050     src\_sk(1) = s1 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08051}08051     \textcolor{keyword}{call }cbesi(z2, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08052}08052     dst\_si(1) = s2 * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08053}08053     \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08054}08054         \textcolor{keyword}{call }cbesk(z1, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08055}08055         src\_sk(2:p+1) = s1 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08056}08056         \textcolor{keyword}{call }cbesi(z2, 1.5d0, 1, p, work\_complex(2:p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08057}08057         dst\_si(2:p+1) = s2 * real(work\_complex(2:p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08058}08058 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08059}08059     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08060}08060     ck = -\/ c*kappa}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08061}08061     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{fmm\_m2l\_bessel\_rotation\_adj\_work}}(ck, dst\_si, src\_sk, p, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08062}08062         \& vcnk, alpha, src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08063}08063 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a44beda4f2d48ac451449357076a3ff89}{fmm\_m2l\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08064}08064 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08091}\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{08091}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{fmm\_m2l\_bessel\_rotation\_adj\_work}}(c, src\_sk, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08092}08092         \& src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08093}08093     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08094}08094     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08095}08095 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08096}08096         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08097}08097     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08098}08098 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08099}08099     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08100}08100 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(6*p*p + 19*p + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08101}08101     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08102}08102     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08103}08103 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08104}08104     \textcolor{keywordtype}{integer} :: m, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08105}08105     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08106}08106 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_m(:), tmp\_m2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08107}08107     \textcolor{comment}{! Convert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08108}08108     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08109}08109     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08110}08110     \textcolor{comment}{!if (stheta .eq. zero) then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08111}08111     \textcolor{comment}{!    ! Workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08112}08112     \textcolor{comment}{!    call fmm\_m2m\_bessel\_ztranslate\_work(c(3), src\_r, dst\_r, p, vscales, vcnk, \&}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08113}08113     \textcolor{comment}{!        \& alpha, src\_m, beta, dst\_m, work)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08114}08114     \textcolor{comment}{!    return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08115}08115     \textcolor{comment}{!end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08116}08116     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08117}08117     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08118}08118     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08119}08119     tmp\_m(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08120}08120     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08121}08121     tmp\_m2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08122}08122     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08123}08123     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08124}08124     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08125}08125     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08126}08126     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08127}08127     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08128}08128     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08129}08129     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08130}08130     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(p, vcos, vsin, alpha, src\_m, zero, tmp\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08131}08131     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08132}08132     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, -\/stheta, one, tmp\_m, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08133}08133         \& tmp\_m2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08134}08134     \textcolor{comment}{! OZ translation, workspace here is 2*(p+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08135}08135     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a933d14fb3c323d01a2706c25eed8869e}{fmm\_m2l\_bessel\_ztranslate\_adj\_work}}(rho, src\_sk, dst\_si, p, vscales, vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08136}08136         \& tmp\_m2, zero, tmp\_m, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08137}08137     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*p*p+13*p+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08138}08138     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(p, ctheta, stheta, one, tmp\_m, zero, tmp\_m2, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08139}08139         \& work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08140}08140     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08141}08141     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(p, vcos, vsin, one, tmp\_m2, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08142}08142 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{fmm\_m2l\_bessel\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08143}08143 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08166}\mbox{\hyperlink{namespaceddx__harmonics_a1bae2fb9a4287cfa93178ec5ba4db9f5}{08166}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1bae2fb9a4287cfa93178ec5ba4db9f5}{fmm\_m2l\_bessel\_ztranslate}}(z, src\_sk, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08167}08167         \& src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08168}08168     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08169}08169     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08170}08170 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08171}08171         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08172}08172     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08173}08173 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08174}08174     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08175}08175 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08176}08176     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08177}08177     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08178}08178     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aca682ec8e6ddee561d69d864ad8bc14e}{fmm\_m2l\_bessel\_ztranslate\_work}}(z, src\_sk, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08179}08179         \& alpha, src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08180}08180 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a1bae2fb9a4287cfa93178ec5ba4db9f5}{fmm\_m2l\_bessel\_ztranslate}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08181}08181 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08206}\mbox{\hyperlink{namespaceddx__harmonics_aca682ec8e6ddee561d69d864ad8bc14e}{08206}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aca682ec8e6ddee561d69d864ad8bc14e}{fmm\_m2l\_bessel\_ztranslate\_work}}(z, src\_sk, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08207}08207         \& alpha, src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08208}08208     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08209}08209     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08210}08210     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08211}08211 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08212}08212         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08213}08213     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08214}08214 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08215}08215     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08216}08216 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08217}08217     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08218}08218     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08219}08219 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08220}08220     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08221}08221     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08222}08222 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08223}08223     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08224}08224     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08225}08225     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08226}08226         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08227}08227             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08228}08228         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08229}08229             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08230}08230 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08231}08231         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08232}08232 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08233}08233     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08234}08234     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08235}08235     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08236}08236         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08237}08237 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08238}08238     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08239}08239     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08240}08240     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08241}08241         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08242}08242         \textcolor{keyword}{call }cbesk(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08243}08243         work(1) = sqrt(2/(pi*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08244}08244         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08245}08245             \textcolor{keyword}{call }cbesk(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08246}08246                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08247}08247             work(2:2*p+1) = sqrt(2/(pi*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08248}08248 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08249}08249         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08250}08250         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08251}08251         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08252}08252             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08253}08253             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08254}08254                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08255}08255                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08256}08256                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08257}08257                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08258}08258                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08259}08259                 \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08260}08260                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08261}08261                     indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08262}08262                     tmp1 = vscales(indn) * ((-\/one)**(n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08263}08263                         \& dble(2*j+1) * fact(j+1) * fact(n+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08264}08264                         \& src\_sk(n+1) / vscales(indj) * dst\_si(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08265}08265                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08266}08266                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08267}08267                         tmp2 = ((-\/two)**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08268}08268                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08269}08269                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08270}08270                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08271}08271                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08272}08272 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08273}08273                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08274}08274                     res1 = res1 + tmp3*src\_m(indn)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08275}08275 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08276}08276                 dst\_l(indj) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08277}08277                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08278}08278                 \textcolor{keywordflow}{do} k = 1, j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08279}08279                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08280}08280                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08281}08281                     \textcolor{keywordflow}{do} n = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08282}08282                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08283}08283                         indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08284}08284                         tmp1 = vscales(indn+k) * ((-\/one)**(n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08285}08285                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08286}08286                             \& src\_sk(n+1) / vscales(indj+k) * dst\_si(j+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08287}08287                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08288}08288                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08289}08289                             tmp2 = ((-\/two)**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08290}08290                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08291}08291                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08292}08292                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08293}08293                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08294}08294 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08295}08295                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08296}08296                         res1 = res1 + tmp3*src\_m(indn+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08297}08297                         res2 = res2 + tmp3*src\_m(indn-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08298}08298 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08299}08299                     dst\_l(indj+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08300}08300                     dst\_l(indj-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08301}08301 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08302}08302 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08303}08303         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08304}08304         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08305}08305             stop 111}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08306}08306 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08307}08307     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08308}08308     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08309}08309         stop 222}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08310}08310         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08311}08311         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08312}08312             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08313}08313             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08314}08314             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08315}08315                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08316}08316                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08317}08317                     dst\_l(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08318}08318 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08319}08319                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08320}08320 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08321}08321         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08322}08322         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08323}08323             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08324}08324             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08325}08325             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08326}08326                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08327}08327                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08328}08328                     dst\_l(k) = beta*dst\_l(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08329}08329 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08330}08330                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08331}08331 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08332}08332 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08333}08333 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08334}08334 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_aca682ec8e6ddee561d69d864ad8bc14e}{fmm\_m2l\_bessel\_ztranslate\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08335}08335 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08358}\mbox{\hyperlink{namespaceddx__harmonics_af59ef6901ffb4383d0959de10fd8926f}{08358}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af59ef6901ffb4383d0959de10fd8926f}{fmm\_m2l\_bessel\_ztranslate\_adj}}(z, src\_sk, dst\_si, p, vscales, vcnk, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08359}08359         \& src\_m, beta, dst\_l)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08360}08360     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08361}08361     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08362}08362 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08363}08363         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08364}08364     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08365}08365 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08366}08366     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08367}08367 \textcolor{keywordtype}{    real}(dp) :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08368}08368     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08369}08369     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08370}08370     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a933d14fb3c323d01a2706c25eed8869e}{fmm\_m2l\_bessel\_ztranslate\_adj\_work}}(z, src\_sk, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08371}08371         \& alpha, src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08372}08372 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_af59ef6901ffb4383d0959de10fd8926f}{fmm\_m2l\_bessel\_ztranslate\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08373}08373 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08398}\mbox{\hyperlink{namespaceddx__harmonics_a933d14fb3c323d01a2706c25eed8869e}{08398}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a933d14fb3c323d01a2706c25eed8869e}{fmm\_m2l\_bessel\_ztranslate\_adj\_work}}(z, src\_sk, dst\_si, p, vscales, vcnk, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08399}08399         \& alpha, src\_m, beta, dst\_l, work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08400}08400     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08401}08401     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08402}08402     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08403}08403 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: z, src\_sk(p+1), dst\_si(p+1), vscales((p+1)*(p+1)), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08404}08404         \& vcnk((2*p+1)*(p+1)), alpha, src\_m((p+1)*(p+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08405}08405     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08406}08406 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_l((p+1)*(p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08407}08407     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08408}08408 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: work(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08409}08409     \textcolor{keywordtype}{complex(dp)}, \textcolor{keywordtype}{intent(out)} :: work\_complex(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08410}08410     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08411}08411 \textcolor{keywordtype}{    real}(dp) :: r1, r2, tmp1, tmp2, tmp3, res1, res2, pow\_r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08412}08412     \textcolor{keywordtype}{integer} :: j, k, n, indj, indn, l, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08413}08413     \textcolor{comment}{! Pointers for temporary values of powers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08414}08414 \textcolor{keywordtype}{    real}(dp) :: fact(2*p+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08415}08415     \textcolor{keywordtype}{complex(dp)} :: complex\_argument}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08416}08416     \textcolor{comment}{! In case alpha is zero just do a proper scaling of output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08417}08417     \textcolor{keywordflow}{if} (alpha .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08418}08418         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08419}08419             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08420}08420         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08421}08421             dst\_l = beta * dst\_l}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08422}08422 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08423}08423         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08424}08424 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08425}08425     \textcolor{comment}{! Get factorials}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08426}08426     fact(1) = one}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08427}08427     \textcolor{keywordflow}{do} j = 1, 2*p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08428}08428         fact(j+1) = dble(j) * fact(j)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08429}08429 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08430}08430     \textcolor{comment}{! Now alpha is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08431}08431     \textcolor{comment}{! If harmonics have different centers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08432}08432     \textcolor{keywordflow}{if} (z .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08433}08433         complex\_argument = z}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08434}08434         \textcolor{keyword}{call }cbesk(complex\_argument, pt5, 1, 1, work\_complex(1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08435}08435         work(1) = sqrt(2/(pi*z)) * real(work\_complex(1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08436}08436         \textcolor{keywordflow}{if} (p .gt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08437}08437             \textcolor{keyword}{call }cbesk(complex\_argument, 1.5d0, 1, 2*p, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08438}08438                 \& work\_complex(2:2*p+1), nz, ierr)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08439}08439             work(2:2*p+1) = sqrt(2/(pi*z)) * real(work\_complex(2:2*p+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08440}08440 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08441}08441         \textcolor{comment}{! Do actual M2M}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08442}08442         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08443}08443         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08444}08444             dst\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08445}08445             \textcolor{keywordflow}{do} n = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08446}08446                 \textcolor{comment}{! Offset for dst\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08447}08447                 indn = n*n + n + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08448}08448                 \textcolor{comment}{! k = 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08449}08449                 k = 0}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08450}08450                 res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08451}08451                 \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08452}08452                     \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08453}08453                     indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08454}08454                     tmp1 = vscales(indn) * ((-\/one)**(n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08455}08455                         \& dble(2*j+1) * fact(j+1) * fact(n+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08456}08456                         \& src\_sk(j+1) / vscales(indj) / dst\_si(n+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08457}08457                     tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08458}08458                     \textcolor{keywordflow}{do} l = 0, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08459}08459                         tmp2 = ((-\/two)**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08460}08460                             \& fact(l+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08461}08461                             \& fact(l+1)/fact(l+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08462}08462                             \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08463}08463                         tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08464}08464 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08465}08465                     tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08466}08466                     res1 = res1 + tmp3*src\_m(indj)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08467}08467 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08468}08468                 dst\_l(indn) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08469}08469                 \textcolor{comment}{! k != 0}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08470}08470                 \textcolor{keywordflow}{do} k = 1, n}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08471}08471                     res1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08472}08472                     res2 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08473}08473                     \textcolor{keywordflow}{do} j = k, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08474}08474                         \textcolor{comment}{! Offset for src\_m}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08475}08475                         indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08476}08476                         tmp1 = vscales(indn+k) * ((-\/one)**(n)) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08477}08477                             \& dble(2*j+1) * fact(j-\/k+1) * fact(n+k+1) * \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08478}08478                             \& src\_sk(j+1) / vscales(indj+k) / dst\_si(n+1)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08479}08479                         tmp3 = zero}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08480}08480                         \textcolor{keywordflow}{do} l = k, min(j, n)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08481}08481                             tmp2 = ((-\/two)**(-\/l)) / \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08482}08482                                 \& fact(l+k+1)*fact(2*l+1)/ \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08483}08483                                 \& fact(l+1)/fact(l-\/k+1)/fact(j-\/l+1)/fact(n-\/l+1)* \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08484}08484                                 \& (work(j+n-\/l+1) / (z**l))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08485}08485                             tmp3 = tmp3 + tmp2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08486}08486 \textcolor{keywordflow}{                        end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08487}08487                         tmp3 = tmp3 * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08488}08488                         res1 = res1 + tmp3*src\_m(indj+k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08489}08489                         res2 = res2 + tmp3*src\_m(indj-\/k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08490}08490 \textcolor{keywordflow}{                    end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08491}08491                     dst\_l(indn+k) = res1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08492}08492                     dst\_l(indn-\/k) = res2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08493}08493 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08494}08494 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08495}08495         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08496}08496         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08497}08497             stop 111}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08498}08498 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08499}08499     \textcolor{comment}{! If harmonics are located at the same point}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08500}08500     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08501}08501         stop 222}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08502}08502         \textcolor{comment}{! Overwrite output if beta is zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08503}08503         \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08504}08504             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08505}08505             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08506}08506             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08507}08507                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08508}08508                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08509}08509                     dst\_l(k) = tmp1 * src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08510}08510 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08511}08511                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08512}08512 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08513}08513         \textcolor{comment}{! Update output if beta is non-\/zero}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08514}08514         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08515}08515             \textcolor{comment}{!r1 = src\_r / dst\_r}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08516}08516             tmp1 = alpha * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08517}08517             \textcolor{keywordflow}{do} j = 0, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08518}08518                 indj = j*j + j + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08519}08519                 \textcolor{keywordflow}{do} k = indj-\/j, indj+j}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08520}08520                     dst\_l(k) = beta*dst\_l(k) + tmp1*src\_m(k)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08521}08521 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08522}08522                 tmp1 = tmp1 * r1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08523}08523 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08524}08524 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08525}08525 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08526}08526 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a933d14fb3c323d01a2706c25eed8869e}{fmm\_m2l\_bessel\_ztranslate\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08527}08527 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08554}\mbox{\hyperlink{namespaceddx__harmonics_a8cfe4104aac6bb08df2fa15d2df2ba1a}{08554}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8cfe4104aac6bb08df2fa15d2df2ba1a}{fmm\_m2l\_rotation\_adj}}(c, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08555}08555         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08556}08556     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08557}08557     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pl, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08558}08558 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((pm+pl+1)**2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08559}08559         \& m2l\_ztranslate\_adj\_coef(pl+1, pl+1, pm+1), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08560}08560         \& src\_l((pl+1)*(pl+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08561}08561     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08562}08562 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((pm+1)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08563}08563     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08564}08564 \textcolor{keywordtype}{    real}(dp) :: work(6*max(pm, pl)**2 + 19*max(pm, pl) + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08565}08565     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08566}08566     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_abbb798594959e90b6d60588e88a7a12e}{fmm\_m2l\_rotation\_adj\_work}}(c, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08567}08567         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08568}08568 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_a8cfe4104aac6bb08df2fa15d2df2ba1a}{fmm\_m2l\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08569}08569 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08598}\mbox{\hyperlink{namespaceddx__harmonics_abbb798594959e90b6d60588e88a7a12e}{08598}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__harmonics_abbb798594959e90b6d60588e88a7a12e}{fmm\_m2l\_rotation\_adj\_work}}(c, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08599}08599         \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08600}08600     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08601}08601     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: pl, pm}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08602}08602 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: c(3), src\_r, dst\_r, vscales((pm+pl+1)**2), \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08603}08603         \& m2l\_ztranslate\_adj\_coef(pl+1, pl+1, pm+1), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08604}08604         \& src\_l((pl+1)*(pl+1)), beta}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08605}08605     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08606}08606 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: dst\_m((pm+1)*(pm+1))}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08607}08607     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08608}08608 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{target} :: \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08609}08609         \& work(6*max(pm, pl)**2 + 19*max(pm, pl) + 8)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08610}08610     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08611}08611 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08612}08612     \textcolor{keywordtype}{integer} :: m, n, p}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08613}08613     \textcolor{comment}{! Pointers for temporary values of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08614}08614 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{pointer} :: tmp\_ml(:), tmp\_ml2(:), vcos(:), vsin(:)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08615}08615     \textcolor{comment}{! Covert Cartesian coordinates into spherical}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08616}08616     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6c3357a53655c62372199bab90444412}{carttosph}}(c, rho, ctheta, stheta, cphi, sphi)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08617}08617     \textcolor{comment}{! If no need for rotations, just do translation along z}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08618}08618     \textcolor{keywordflow}{if} (stheta .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08619}08619         \textcolor{comment}{! Workspace here is (pl+2)*(pl+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08620}08620         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{fmm\_m2l\_ztranslate\_adj\_work}}(c(3), src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08621}08621             \& m2l\_ztranslate\_adj\_coef, alpha, src\_l, beta, dst\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08622}08622         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08623}08623 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08624}08624     \textcolor{comment}{! Prepare pointers}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08625}08625     p = max(pm, pl)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08626}08626     m = (p+1)**2}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08627}08627     n = 4*m + 5*p \textcolor{comment}{! 4*p*p + 13*p + 4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08628}08628     tmp\_ml(1:m) => work(n+1:n+m) \textcolor{comment}{! 5*p*p + 15*p + 5}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08629}08629     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08630}08630     tmp\_ml2(1:m) => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 17*p + 6}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08631}08631     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08632}08632     m = p + 1}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08633}08633     vcos => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 18*p + 7}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08634}08634     n = n + m}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08635}08635     vsin => work(n+1:n+m) \textcolor{comment}{! 6*p*p + 19*p + 8}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08636}08636     \textcolor{comment}{! Compute arrays of cos and sin that are needed for rotations of harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08637}08637     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}(cphi, sphi, p, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08638}08638     \textcolor{comment}{! Rotate around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08639}08639     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6376d4d78d6bcbf83b5747c03f13065c}{fmm\_sph\_rotate\_oz\_adj\_work}}(pl, vcos, vsin, alpha, src\_l, zero, tmp\_ml)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08640}08640     \textcolor{comment}{! Perform rotation in the OXZ plane, work size is 4*pl*pl+13*pl+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08641}08641     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(pl, ctheta, -\/stheta, one, tmp\_ml, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08642}08642         \& tmp\_ml2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08643}08643     \textcolor{comment}{! OZ translation, workspace here is (pl+2)*(pl+1)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08644}08644     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a3cd0d97cf18e84aa23c13847a3977fb3}{fmm\_m2l\_ztranslate\_adj\_work}}(rho, src\_r, dst\_r, pl, pm, vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08645}08645         \& m2l\_ztranslate\_adj\_coef, one, tmp\_ml2, zero, tmp\_ml, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08646}08646     \textcolor{comment}{! Backward rotation in the OXZ plane, work size is 4*pm*pm+13*pm+4}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08647}08647     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a1acd3dc4a1f64b2d6639817b160f223d}{fmm\_sph\_rotate\_oxz\_work}}(pm, ctheta, stheta, one, tmp\_ml, zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08648}08648         \& tmp\_ml2, work)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08649}08649     \textcolor{comment}{! Backward rotation around OZ axis (work array might appear in the future)}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08650}08650     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_ae7164759454da6c012e9afdf7f0aa156}{fmm\_sph\_rotate\_oz\_work}}(pm, vcos, vsin, one, tmp\_ml2, beta, dst\_m)}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08651}08651 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__harmonics_abbb798594959e90b6d60588e88a7a12e}{fmm\_m2l\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08652}08652 }
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08653}08653 \textcolor{keyword}{end module }\mbox{\hyperlink{namespaceddx__harmonics}{ddx\_harmonics}}}
\DoxyCodeLine{\Hypertarget{ddx__harmonics_8f90_source_l08654}08654 }

\end{DoxyCode}
