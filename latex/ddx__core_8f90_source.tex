\hypertarget{ddx__core_8f90_source}{}\doxysection{ddx\+\_\+core.\+f90}
\label{ddx__core_8f90_source}\index{src/ddx\_core.f90@{src/ddx\_core.f90}}
\mbox{\hyperlink{ddx__core_8f90}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00013}\mbox{\hyperlink{namespaceddx__core}{00013}} \textcolor{keyword}{module} \mbox{\hyperlink{namespaceddx__core}{ddx\_core}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00014}00014 \textcolor{comment}{! Get ddx\_params\_type and all compile-\/time definitions}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00015}00015 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceddx__parameters}{ddx\_parameters}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00016}00016 \textcolor{comment}{! Get ddx\_constants\_type and all run-\/time constants}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00017}00017 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceddx__constants}{ddx\_constants}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00018}00018 \textcolor{comment}{! Get ddx\_workspace\_type for temporary buffers}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00019}00019 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceddx__workspace}{ddx\_workspace}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00020}00020 \textcolor{comment}{! Get harmonics-\/related functions}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00021}00021 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceddx__harmonics}{ddx\_harmonics}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00022}00022 \textcolor{comment}{! Enable OpenMP}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00023}00023 \textcolor{keywordtype}{use }omp\_lib}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00024}00024 \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00026}\mbox{\hyperlink{structddx__core_1_1ddx__state__type}{00026}} \textcolor{keyword}{type} \mbox{\hyperlink{structddx__core_1_1ddx__state__type}{ddx\_state\_type}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00027}00027     \textcolor{comment}{!! High-\/level entities to be stored and accessed by users}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00029}00029     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00030}00030     \textcolor{comment}{!! ddCOSMO quantities (used also by ddPCM)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00031}00031     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00034}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_aee7846568db8bab39129c9cb946ddd2e}{00034}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: phi(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00037}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a08d23dc0eceb14dcb6f623871c208529}{00037}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: xs(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00040}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a8180c3d20b4cb8effeb4f8b65f170445}{00040}}     \textcolor{keywordtype}{integer} :: xs\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00043}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_adb77809d89986f4c02824d297fd966d7}{00043}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: xs\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00045}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_afea532fb7fd4160a2984ce1aca68934b}{00045}} \textcolor{keywordtype}{    real}(dp) :: xs\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00048}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a3f54780b6bbb34070a8f38c83b742254}{00048}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: sgrid(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00050}00050     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00051}00051     \textcolor{comment}{!! ddPCM specific quantities}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00052}00052     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00055}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a83850fd12c4c5b915a9226afa3d90e17}{00055}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: phiinf(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00058}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a85a9a635519db969914d9b977f2bf3b1}{00058}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: phieps(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00061}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a85b122812d525480a3f97c1891087441}{00061}}     \textcolor{keywordtype}{integer} :: phieps\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00064}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a4dfbeb29f87cf4040d8633b0b1c54e33}{00064}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: phieps\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00066}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a987b38d818104cabc9f7f3ba301b5235}{00066}} \textcolor{keywordtype}{    real}(dp) :: phieps\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00068}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a80d564db3f80ca02474529f94a7fb858}{00068}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: g(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00073}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ab5570afac25a88ebd483149e1ac2dc66}{00073}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: s(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00075}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ae8b26ac0e03b0dd5fb4c5013723d982c}{00075}}     \textcolor{keywordtype}{integer} :: s\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00078}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a3ff8561962833ab28dcf5fdac281d9f7}{00078}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: s\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00080}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_abe53093bb83bd41277e53848474610a8}{00080}} \textcolor{keywordtype}{    real}(dp) :: s\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00083}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a289b95040949952de1e86111f440a838}{00083}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: y(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00085}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a0905754357c8025076591272cd88812f}{00085}}     \textcolor{keywordtype}{integer} :: y\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00088}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ac5a1f3314992f8aef6fcfe45abbb2f24}{00088}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: y\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00090}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ae7761162d404940bf9695d8d57124d58}{00090}} \textcolor{keywordtype}{    real}(dp) :: y\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00093}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ac7c4e2212dc6d7d677d3612cad389c8f}{00093}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: ygrid(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00095}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ad1757dc3ef7f36af7e1767c2ae827bfd}{00095}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: q(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00097}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a66ba3c75158728fff99a9ea26b0e0d7b}{00097}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: qgrid(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00099}00099     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00100}00100     \textcolor{comment}{!! ddLPB quantities}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00101}00101     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00104}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_aa87796b2be1f31aa84b0c4a9e914c7c5}{00104}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: x\_lpb(:,:,:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00107}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a20bca950fa436fd0eecc5064250572ea}{00107}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: x\_adj\_lpb(:,:,:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00110}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_aae8bae38bfaba096f11adebb60e4ee14}{00110}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: g\_lpb(:,:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00114}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_ae88a2a0537d509eec93de2f47f0ae49e}{00114}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: f\_lpb(:,:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00115}00115     \textcolor{keywordtype}{integer} :: x\_lpb\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00116}00116     \textcolor{keywordtype}{integer} :: x\_adj\_lpb\_niter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00117}00117 \textcolor{keywordtype}{    real}(dp) :: x\_lpb\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00118}00118 \textcolor{keywordtype}{    real}(dp) :: x\_adj\_lpb\_time}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00119}00119 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: x\_lpb\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00120}00120 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: x\_adj\_lpb\_rel\_diff(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00121}00121 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00122}00122     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00123}00123     \textcolor{comment}{!! Misc}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00124}00124     \textcolor{comment}{!!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00126}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a6d25ed184b0365b44a597556edec3b49}{00126}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: zeta(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00129}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a903ec491e30ffa2a5a4012bac9641900}{00129}} \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: phi\_grid(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00131}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a0b1492447f2bef9ff3b132f68f8d67cc}{00131}}     \textcolor{keywordtype}{integer} :: error\_flag}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00133}\mbox{\hyperlink{structddx__core_1_1ddx__state__type_a56c8add2d008d542df338eb2e7c5c890}{00133}}     \textcolor{keywordtype}{character(len=255)} :: error\_message}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00134}00134 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00135}00135 \textcolor{keyword}{end type }\mbox{\hyperlink{structddx__core_1_1ddx__state__type}{ddx\_state\_type}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00138}\mbox{\hyperlink{structddx__core_1_1ddx__type}{00138}} \textcolor{keyword}{type} \mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00139}00139     \textcolor{comment}{!! New types inside the old one for an easier shift to the new design}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00140}00140     \textcolor{keywordtype}{type}(ddx\_params\_type) :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00141}00141     \textcolor{keywordtype}{type}(ddx\_constants\_type) :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00142}00142     \textcolor{keywordtype}{type}(ddx\_workspace\_type) :: workspace}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00144}\mbox{\hyperlink{structddx__core_1_1ddx__type_a3e3f24814f68ec3f80f2f67f1eb00551}{00144}}     \textcolor{keywordtype}{integer} :: error\_flag}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00146}\mbox{\hyperlink{structddx__core_1_1ddx__type_aad61ddf589790a931a0c544adc4db37c}{00146}}     \textcolor{keywordtype}{character(len=255)} :: error\_message}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00147}00147 \textcolor{keyword}{end type }\mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00149}00149 \textcolor{keyword}{contains}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00151}00151 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00196}00196 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00197}\mbox{\hyperlink{namespaceddx__core_ad98e6ca9db2543caa5273d4d33bb0e10}{00197}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ad98e6ca9db2543caa5273d4d33bb0e10}{ddinit}}(nsph, charge, x, y, z, rvdw, model, lmax, ngrid, force, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00198}00198         \& fmm, pm, pl, se, eta, eps, kappa, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00199}00199         \& matvecmem, itersolver, maxiter, jacobi\_ndiis, gmresr\_j, gmresr\_dim, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00200}00200         \& nproc, ddx\_data, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00201}00201     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00202}00202     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: nsph, model, lmax, force, fmm, pm, pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00203}00203         \& matvecmem, itersolver, maxiter, jacobi\_ndiis, gmresr\_j, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00204}00204         \& gmresr\_dim, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00205}00205     \textcolor{keywordtype}{real(dp)}, \textcolor{keywordtype}{intent(in)}:: charge(nsph), x(nsph), y(nsph), z(nsph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00206}00206         \& rvdw(nsph), se, eta, eps, kappa}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00207}00207     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00208}00208     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}), \textcolor{keywordtype}{target}, \textcolor{keywordtype}{intent(out)} :: ddx\_data}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00209}00209     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: info}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00210}00210     \textcolor{comment}{! Inouts}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00211}00211     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(inout)} :: nproc}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00212}00212     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00213}00213     \textcolor{keywordtype}{integer} :: istatus, i, indi, j, ii, inear, jnear, igrid, jgrid, isph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00214}00214         \& jsph, lnl, l, indl, ithread, k, n, indjn}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00215}00215     \textcolor{keywordtype}{real(dp)} :: v(3), maxv, ssqv, vv, t, swthr, fac, r, start\_time, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00216}00216         \& finish\_time, tmp1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00217}00217     \textcolor{keywordtype}{real(dp)} :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00218}00218 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: sphcoo(:, :), csph(:, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00219}00219     \textcolor{keywordtype}{double precision}, \textcolor{keywordtype}{external} :: dnrm2}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00220}00220     \textcolor{keywordtype}{integer} :: iwork, jwork, lwork, old\_lwork, nngmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00221}00221     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{allocatable} :: work(:, :), tmp\_work(:, :), tmp\_nl(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00222}00222     \textcolor{keywordtype}{logical} :: use\_omp}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00223}00223     \textcolor{comment}{! Init underlying objects}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00224}00224     \textcolor{keyword}{allocate}(csph(3, nsph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00225}00225     csph(1, :) = x}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00226}00226     csph(2, :) = y}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00227}00227     csph(3, :) = z}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00228}00228     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__parameters_a37d40289550bb6eb8e049fb4ca227c2c}{params\_init}}(model, force, eps, kappa, eta, se, lmax, ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00229}00229         \& matvecmem, itersolver, maxiter, jacobi\_ndiis, gmresr\_j, gmresr\_dim, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00230}00230         \& fmm, pm, pl, nproc, nsph, charge, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00231}00231         \& csph, rvdw, \mbox{\hyperlink{namespaceddx__parameters_a63f973043b80c39c6f905fba9bd2aa09}{print\_func\_default}}, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00232}00232         \& ddx\_data \% params, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00233}00233     \textcolor{keywordflow}{if} (info .ne. 0) \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00234}00234     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__constants_aa10b4ebb5a70e2cac960a9f0a955b29a}{constants\_init}}(ddx\_data \% params, ddx\_data \% constants, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00235}00235     \textcolor{keywordflow}{if} (info .ne. 0) \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00236}00236     \textcolor{keyword}{call }workspace\_init(ddx\_data \% params, ddx\_data \% constants, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00237}00237         \& ddx\_data \% workspace, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00238}00238     \textcolor{keywordflow}{if} (info .ne. 0) \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00239}00239 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ad98e6ca9db2543caa5273d4d33bb0e10}{ddinit}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00241}00241 \textcolor{keyword}{subroutine }ddx\_init\_state(params, constants, state)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00242}00242     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00243}00243     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00244}00244     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__state__type}{ddx\_state\_type}}), \textcolor{keywordtype}{intent(out)} :: state}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00245}00245     \textcolor{keywordtype}{integer} :: istatus}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00246}00246 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00247}00247     \textcolor{comment}{! COSMO model}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00248}00248     \textcolor{keywordflow}{if} (params \% model .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00249}00249         \textcolor{keyword}{allocate}(state \% phi\_grid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00250}00250             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00251}00251         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00252}00252             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00253}00253             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phi\_grid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00254}00254                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00255}00255             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00256}00256 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00257}00257         \textcolor{keyword}{allocate}(state \% phi(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00258}00258             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00259}00259         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00260}00260             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00261}00261             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phi` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00262}00262                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00263}00263             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00264}00264 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00265}00265         \textcolor{keyword}{allocate}(state \% xs(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00266}00266             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00267}00267         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00268}00268             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00269}00269             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00270}00270                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00271}00271             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00272}00272 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00273}00273         \textcolor{keyword}{allocate}(state \% xs\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00274}00274             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00275}00275         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00276}00276             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00277}00277             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00278}00278                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00279}00279             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00280}00280 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00281}00281         \textcolor{keyword}{allocate}(state \% s(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00282}00282             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00283}00283         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00284}00284             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00285}00285             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `s` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00286}00286                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00287}00287             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00288}00288 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00289}00289         \textcolor{keyword}{allocate}(state \% s\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00290}00290             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00291}00291         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00292}00292             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00293}00293             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `s\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00294}00294                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00295}00295             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00296}00296 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00297}00297         \textcolor{keyword}{allocate}(state \% sgrid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00298}00298             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00299}00299         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00300}00300             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00301}00301             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `sgrid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00302}00302                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00303}00303             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00304}00304 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00305}00305         \textcolor{keyword}{allocate}(state \% zeta(constants \% ncav), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00306}00306         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00307}00307             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00308}00308             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `zeta` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00309}00309                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00310}00310             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00311}00311 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00312}00312     \textcolor{comment}{! PCM model}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00313}00313     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% model .eq. 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00314}00314         \textcolor{keyword}{allocate}(state \% phi\_grid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00315}00315             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00316}00316         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00317}00317             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00318}00318             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phi\_grid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00319}00319                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00320}00320             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00321}00321 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00322}00322         \textcolor{keyword}{allocate}(state \% phi(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00323}00323             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00324}00324         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00325}00325             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00326}00326             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phi` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00327}00327                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00328}00328             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00329}00329 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00330}00330         \textcolor{keyword}{allocate}(state \% phiinf(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00331}00331             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00332}00332         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00333}00333             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00334}00334             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phiinf` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00335}00335                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00336}00336             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00337}00337 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00338}00338         \textcolor{keyword}{allocate}(state \% phieps(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00339}00339             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00340}00340         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00341}00341             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00342}00342             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `phieps` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00343}00343                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00344}00344             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00345}00345 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00346}00346         \textcolor{keyword}{allocate}(state \% phieps\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00347}00347             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00348}00348         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00349}00349             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00350}00350             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00351}00351                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00352}00352             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00353}00353 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00354}00354         \textcolor{keyword}{allocate}(state \% xs(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00355}00355             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00356}00356         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00357}00357             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00358}00358             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00359}00359                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00360}00360             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00361}00361 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00362}00362         \textcolor{keyword}{allocate}(state \% xs\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00363}00363             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00364}00364         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00365}00365             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00366}00366             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00367}00367                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00368}00368             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00369}00369 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00370}00370         \textcolor{keyword}{allocate}(state \% s(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00371}00371             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00372}00372         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00373}00373             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00374}00374             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `s` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00375}00375                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00376}00376             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00377}00377 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00378}00378         \textcolor{keyword}{allocate}(state \% s\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00379}00379             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00380}00380         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00381}00381             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00382}00382             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `xs\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00383}00383                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00384}00384             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00385}00385 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00386}00386         \textcolor{keyword}{allocate}(state \% sgrid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00387}00387             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00388}00388         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00389}00389             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00390}00390             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `sgrid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00391}00391                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00392}00392             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00393}00393 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00394}00394         \textcolor{keyword}{allocate}(state \% y(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00395}00395             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00396}00396         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00397}00397             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00398}00398             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `y` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00399}00399                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00400}00400             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00401}00401 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00402}00402         \textcolor{keyword}{allocate}(state \% y\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00403}00403             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00404}00404         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00405}00405             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00406}00406             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `y\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00407}00407                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00408}00408             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00409}00409 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00410}00410         \textcolor{keyword}{allocate}(state \% ygrid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00411}00411             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00412}00412         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00413}00413             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00414}00414             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `ygrid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00415}00415                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00416}00416             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00417}00417 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00418}00418         \textcolor{keyword}{allocate}(state \% g(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00419}00419             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00420}00420         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00421}00421             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00422}00422             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `g` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00423}00423                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00424}00424             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00425}00425 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00426}00426         \textcolor{keyword}{allocate}(state \% q(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00427}00427             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00428}00428         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00429}00429             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00430}00430             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `q` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00431}00431                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00432}00432             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00433}00433 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00434}00434         \textcolor{keyword}{allocate}(state \% qgrid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00435}00435             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00436}00436         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00437}00437             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00438}00438             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `qgrid` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00439}00439                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00440}00440             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00441}00441 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00442}00442         \textcolor{keyword}{allocate}(state \% zeta(constants \% ncav), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00443}00443         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00444}00444             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00445}00445             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `zeta` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00446}00446                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00447}00447             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00448}00448 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00449}00449     \textcolor{comment}{! LPB model}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00450}00450     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% model .eq. 3) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00451}00451         \textcolor{keyword}{allocate}(state \% phi\_grid(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00452}00452             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00453}00453         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00454}00454           \textcolor{comment}{!write(*, *) "{}Error in allocation of M2P matrices"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00455}00455             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00456}00456 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00457}00457         \textcolor{keyword}{allocate}(state \% phi(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00458}00458             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00459}00459         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00460}00460             \textcolor{comment}{!write(*, *) "{}Error in allocation of M2P matrices"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00461}00461             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00462}00462 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00463}00463         \textcolor{keyword}{allocate}(state \% zeta(constants \% ncav), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00464}00464         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00465}00465             \textcolor{comment}{!write(*, *) "{}Error in allocation of M2P matrices"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00466}00466             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00467}00467 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00468}00468         \textcolor{keyword}{allocate}(state \% x\_lpb\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00469}00469             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00470}00470         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00471}00471             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00472}00472             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `x\_lpb\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00473}00473                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00474}00474             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00475}00475 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00476}00476         \textcolor{keyword}{allocate}(state \% x\_lpb(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00477}00477             \& params \% nsph, 2), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00478}00478             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00479}00479         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00480}00480             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00481}00481             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `x\_lpb` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00482}00482                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00483}00483             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00484}00484 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00485}00485         \textcolor{keyword}{allocate}(state \% x\_adj\_lpb(constants \% nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00486}00486             \& params \% nsph, 2), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00487}00487         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00488}00488             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00489}00489             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `x\_adj\_lpb` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00490}00490                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00491}00491             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00492}00492 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00493}00493         \textcolor{keyword}{allocate}(state \% x\_adj\_lpb\_rel\_diff(params \% maxiter), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00494}00494             \& stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00495}00495         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00496}00496             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00497}00497             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `x\_adj\_lpb\_rel\_diff` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00498}00498                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00499}00499             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00500}00500 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00501}00501         \textcolor{keyword}{allocate}(state \% g\_lpb(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00502}00502             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00503}00503         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00504}00504             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00505}00505             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `g\_lpb` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00506}00506                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00507}00507             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00508}00508 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00509}00509         \textcolor{keyword}{allocate}(state \% f\_lpb(params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00510}00510             \& params \% nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00511}00511         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00512}00512             state \% error\_flag = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00513}00513             state \% error\_message = \textcolor{stringliteral}{"{}ddinit: `f\_lpb` "{}} // \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00514}00514                 \& \textcolor{stringliteral}{"{}allocation failed"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00515}00515             \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00516}00516 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00517}00517 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00518}00518 \textcolor{keyword}{end subroutine }ddx\_init\_state}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00519}00519 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00520}00520 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00529}00529 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00530}\mbox{\hyperlink{namespaceddx__core_a7a2ec4809155b56be2c61ccb72b974ea}{00530}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7a2ec4809155b56be2c61ccb72b974ea}{ddfromfile}}(fname, ddx\_data, tol, iprint, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00531}00531     \textcolor{comment}{! Input}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00532}00532     \textcolor{keywordtype}{character(len=*)}, \textcolor{keywordtype}{intent(in)} :: fname}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00533}00533     \textcolor{comment}{! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00534}00534     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}), \textcolor{keywordtype}{intent(out)} :: ddx\_data}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00535}00535 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: tol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00536}00536     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: iprint, info}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00537}00537     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00538}00538     \textcolor{keywordtype}{integer} :: nproc, model, lmax, ngrid, force, fmm, pm, pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00539}00539         \& nsph, i, matvecmem, itersolver, maxiter, jacobi\_ndiis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00540}00540         \& gmresr\_j, gmresr\_dim, istatus}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00541}00541     \textcolor{keywordtype}{real(dp)} :: eps, se, eta, kappa}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00542}00542 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable} :: charge(:), x(:), y(:), z(:), rvdw(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00543}00543     \textcolor{comment}{!! Read all the parameters from the file}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00544}00544     \textcolor{comment}{! Open a configuration file}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00545}00545     \textcolor{keyword}{open}(unit=100, file=fname, form=\textcolor{stringliteral}{'formatted'}, access=\textcolor{stringliteral}{'sequential'})}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00546}00546     \textcolor{comment}{! Printing flag}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00547}00547     \textcolor{keyword}{read}(100, *) iprint}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00548}00548     \textcolor{keywordflow}{if}(iprint .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00549}00549         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 1st line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00550}00550             \& \textcolor{stringliteral}{"{}: `iprint` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00551}00551         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00552}00552 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00553}00553     \textcolor{comment}{! Number of OpenMP threads to be used}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00554}00554     \textcolor{keyword}{read}(100, *) nproc}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00555}00555     \textcolor{keywordflow}{if}(nproc .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00556}00556         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 2nd line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00557}00557             \& \textcolor{stringliteral}{"{}: `nproc` must be a positive integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00558}00558         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00559}00559 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00560}00560     \textcolor{comment}{! Model to be used: 1 for COSMO, 2 for PCM and 3 for LPB}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00561}00561     \textcolor{keyword}{read}(100, *) model}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00562}00562     \textcolor{keywordflow}{if}((model .lt. 1) .or. (model .gt. 3)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00563}00563         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 3rd line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00564}00564             \& \textcolor{stringliteral}{"{}: `model` must be an integer of a value 1, 2 or 3."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00565}00565         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00566}00566 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00567}00567     \textcolor{comment}{! Max degree of modeling spherical harmonics}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00568}00568     \textcolor{keyword}{read}(100, *) lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00569}00569     \textcolor{keywordflow}{if}(lmax .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00570}00570         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 4th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00571}00571             \& \textcolor{stringliteral}{"{}: `lmax` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00572}00572         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00573}00573 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00574}00574     \textcolor{comment}{! Approximate number of Lebedev points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00575}00575     \textcolor{keyword}{read}(100, *) ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00576}00576     \textcolor{keywordflow}{if}(ngrid .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00577}00577         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 5th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00578}00578             \& \textcolor{stringliteral}{"{}: `ngrid` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00579}00579         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00580}00580 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00581}00581     \textcolor{comment}{! Dielectric permittivity constant of the solvent}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00582}00582     \textcolor{keyword}{read}(100, *) eps}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00583}00583     \textcolor{keywordflow}{if}(eps .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00584}00584         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 6th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00585}00585             \& \textcolor{stringliteral}{"{}: `eps` must be a non-\/negative floating point value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00586}00586         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00587}00587 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00588}00588     \textcolor{comment}{! Shift of the regularized characteristic function}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00589}00589     \textcolor{keyword}{read}(100, *) se}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00590}00590     \textcolor{keywordflow}{if}((se .lt. -\/one) .or. (se .gt. one)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00591}00591         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 7th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00592}00592             \& \textcolor{stringliteral}{"{}: `se` must be a floating point value in a range [-\/1, 1]."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00593}00593         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00594}00594 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00595}00595     \textcolor{comment}{! Regularization parameter}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00596}00596     \textcolor{keyword}{read}(100, *) eta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00597}00597     \textcolor{keywordflow}{if}((eta .lt. zero) .or. (eta .gt. one)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00598}00598         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 8th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00599}00599             \& \textcolor{stringliteral}{"{}: `eta` must be a floating point value in a range [0, 1]."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00600}00600         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00601}00601 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00602}00602     \textcolor{comment}{! Debye H\(\backslash\)"{}\{u\}ckel parameter}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00603}00603     \textcolor{keyword}{read}(100, *) kappa}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00604}00604     \textcolor{keywordflow}{if}(kappa .lt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00605}00605         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 9th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00606}00606             \& \textcolor{stringliteral}{"{}: `kappa` must be a non-\/negative floating point value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00607}00607         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00608}00608 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00609}00609     \textcolor{comment}{! whether the (sparse) matrices are precomputed and kept in memory (1) or not (0).}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00610}00610     \textcolor{keyword}{read}(100, *) matvecmem }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00611}00611     \textcolor{keywordflow}{if}((matvecmem.lt. 0) .or. (matvecmem .gt. 1)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00612}00612         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 10th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00613}00613             \& \textcolor{stringliteral}{"{}: `matvecmem` must be an integer value of a value 0 or 1."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00614}00614         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00615}00615 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00616}00616     \textcolor{comment}{! Iterative solver of choice. Only one is supported as of now.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00617}00617     \textcolor{keyword}{read}(100, *) itersolver}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00618}00618     \textcolor{keywordflow}{if}((itersolver .lt. 1) .or. (itersolver .gt. 2)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00619}00619         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 11th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00620}00620             \& \textcolor{stringliteral}{"{}: `itersolver` must be an integer value of a value 1 or 2."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00621}00621         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00622}00622 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00623}00623     \textcolor{comment}{! Relative convergence threshold for the iterative solver}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00624}00624     \textcolor{keyword}{read}(100, *) tol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00625}00625     \textcolor{keywordflow}{if}((tol .lt. 1d-\/14) .or. (tol .gt. one)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00626}00626         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 12th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00627}00627             \& \textcolor{stringliteral}{"{}: `tol` must be a floating point value in a range [1d-\/14, 1]."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00628}00628         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00629}00629 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00630}00630     \textcolor{comment}{! Maximum number of iterations for the iterative solver}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00631}00631     \textcolor{keyword}{read}(100, *) maxiter}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00632}00632     \textcolor{keywordflow}{if}((maxiter .le. 0)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00633}00633         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 13th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00634}00634             \& \textcolor{stringliteral}{"{}: `maxiter` must be a positive integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00635}00635         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00636}00636 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00637}00637     \textcolor{comment}{! Number of extrapolation points for Jacobi/DIIS solver}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00638}00638     \textcolor{keyword}{read}(100, *) jacobi\_ndiis}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00639}00639     \textcolor{keywordflow}{if}((jacobi\_ndiis .lt. 0)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00640}00640         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 14th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00641}00641             \& \textcolor{stringliteral}{"{}: `jacobi\_ndiis` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00642}00642         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00643}00643 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00644}00644     \textcolor{comment}{! Number of last vectors that GMRESR works with. Referenced only if GMRESR}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00645}00645     \textcolor{comment}{!      solver is used.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00646}00646     \textcolor{keyword}{read}(100, *) gmresr\_j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00647}00647     \textcolor{keywordflow}{if}((gmresr\_j .lt. 1)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00648}00648         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 15th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00649}00649             \& \textcolor{stringliteral}{"{}: `gmresr\_j` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00650}00650         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00651}00651 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00652}00652     \textcolor{comment}{! Dimension of the envoked GMRESR. In case of 0 GMRESR becomes the GCR}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00653}00653     \textcolor{comment}{!      solver, one of the simplest versions of GMRESR. Referenced only if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00654}00654     \textcolor{comment}{!      GMRESR solver is used.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00655}00655     \textcolor{keyword}{read}(100, *) gmresr\_dim}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00656}00656     \textcolor{keywordflow}{if}((gmresr\_dim .lt. 0)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00657}00657         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 16th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00658}00658             \& \textcolor{stringliteral}{"{}: `gmresr\_dim` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00659}00659         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00660}00660 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00661}00661     \textcolor{comment}{! Dimension of the envoked GMRESR. In case of 0 GMRESR becomes the GCR}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00662}00662     \textcolor{comment}{!      solver, one of the simplest versions of GMRESR. Referenced only if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00663}00663     \textcolor{comment}{!      GMRESR solver is used.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00664}00664     \textcolor{comment}{! Whether to compute (1) or not (0) forces as analytical gradients}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00665}00665     \textcolor{keyword}{read}(100, *) force}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00666}00666     \textcolor{keywordflow}{if}((force .lt. 0) .or. (force .gt. 1)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00667}00667         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 17th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00668}00668             \& \textcolor{stringliteral}{"{}: `force` must be an integer value of a value 0 or 1."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00669}00669         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00670}00670 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00671}00671     \textcolor{comment}{! Whether to use (1) or not (0) the FMM to accelerate computations}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00672}00672     \textcolor{keyword}{read}(100, *) fmm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00673}00673     \textcolor{keywordflow}{if}((fmm .lt. 0) .or. (fmm .gt. 1)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00674}00674         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 18th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00675}00675             \& \textcolor{stringliteral}{"{}: `fmm` must be an integer value of a value 0 or 1."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00676}00676         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00677}00677 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00678}00678     \textcolor{comment}{! Max degree of multipole spherical harmonics for the FMM}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00679}00679     \textcolor{keyword}{read}(100, *) pm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00680}00680     \textcolor{keywordflow}{if}(pm .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00681}00681         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 19th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00682}00682             \& \textcolor{stringliteral}{"{}: `pm` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00683}00683         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00684}00684 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00685}00685     \textcolor{comment}{! Max degree of local spherical harmonics for the FMM}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00686}00686     \textcolor{keyword}{read}(100, *) pl}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00687}00687     \textcolor{keywordflow}{if}(pl .lt. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00688}00688         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 20th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00689}00689             \& \textcolor{stringliteral}{"{}: `pl` must be a non-\/negative integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00690}00690         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00691}00691 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00692}00692     \textcolor{comment}{! Number of input spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00693}00693     \textcolor{keyword}{read}(100, *) nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00694}00694     \textcolor{keywordflow}{if}(nsph .le. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00695}00695         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(3A)"{}}) \textcolor{stringliteral}{"{}Error on the 21th line of a config file "{}}, fname, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00696}00696             \& \textcolor{stringliteral}{"{}: `nsph` must be a positive integer value."{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00697}00697         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00698}00698 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00699}00699     \textcolor{comment}{! Coordinates, radii and charges}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00700}00700     \textcolor{keyword}{allocate}(charge(nsph), x(nsph), y(nsph), z(nsph), rvdw(nsph), stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00701}00701     \textcolor{keywordflow}{if}(istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00702}00702         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{"{}Could not allocate space for coordinates, radii "{}}, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00703}00703             \& \textcolor{stringliteral}{"{}and charges of atoms"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00704}00704         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00705}00705 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00706}00706     \textcolor{keywordflow}{do} i = 1, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00707}00707         \textcolor{keyword}{read}(100, *) charge(i), x(i), y(i), z(i), rvdw(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00708}00708 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00709}00709     \textcolor{comment}{! Finish reading}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00710}00710     \textcolor{keyword}{close}(100)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00711}00711     \textcolor{comment}{!! Convert Angstrom input into Bohr units}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00712}00712     x = x * tobohr}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00713}00713     y = y * tobohr}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00714}00714     z = z * tobohr}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00715}00715     rvdw = rvdw * tobohr}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00716}00716 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00717}00717     \textcolor{comment}{! adjust ngrid}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00718}00718     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__parameters_a1b84e0732491759d44bb63d14f7c77a5}{closest\_supported\_lebedev\_grid}}(ngrid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00719}00719 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00720}00720     \textcolor{comment}{!! Initialize ddx\_data object}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00721}00721     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_ad98e6ca9db2543caa5273d4d33bb0e10}{ddinit}}(nsph, charge, x, y, z, rvdw, model, lmax, ngrid, force, fmm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00722}00722         \& pm, pl, se, eta, eps, kappa, matvecmem, itersolver, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00723}00723         \& maxiter, jacobi\_ndiis, gmresr\_j, gmresr\_dim, nproc, ddx\_data, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00724}00724     \textcolor{comment}{!! Clean local temporary data}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00725}00725     \textcolor{keyword}{deallocate}(charge, x, y, z, rvdw, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00726}00726     \textcolor{keywordflow}{if}(istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00727}00727         \textcolor{keyword}{write}(*, \textcolor{stringliteral}{"{}(2A)"{}}) \textcolor{stringliteral}{"{}Could not deallocate space for coordinates, "{}}, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00728}00728             \& \textcolor{stringliteral}{"{}radii and charges of atoms"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00729}00729         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00730}00730 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00731}00731 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7a2ec4809155b56be2c61ccb72b974ea}{ddfromfile}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00732}00732 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00733}00733 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00737}00737 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00738}\mbox{\hyperlink{namespaceddx__core_a3258ae6ef23a4f07ea8a14ccf612acaa}{00738}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a3258ae6ef23a4f07ea8a14ccf612acaa}{ddfree}}(ddx\_data)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00739}00739     \textcolor{comment}{! Input/output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00740}00740     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}), \textcolor{keywordtype}{intent(inout)} :: ddx\_data}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00741}00741     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00742}00742     \textcolor{keywordtype}{integer} :: istatus}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00743}00743     \textcolor{keyword}{call }workspace\_free(ddx\_data \% workspace, istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00744}00744     \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00745}00745         \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}workspace\_free failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00746}00746         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00747}00747 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00748}00748     \textcolor{keyword}{call }constants\_free(ddx\_data \% constants, istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00749}00749     \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00750}00750         \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}constants\_free failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00751}00751         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00752}00752 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00753}00753     \textcolor{keyword}{call }params\_free(ddx\_data \% params, istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00754}00754     \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00755}00755         \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}params\_free failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00756}00756         stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00757}00757 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00758}00758 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a3258ae6ef23a4f07ea8a14ccf612acaa}{ddfree}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00759}00759 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00760}00760 \textcolor{keyword}{subroutine }ddx\_free\_state(state)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00761}00761     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00762}00762     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__state__type}{ddx\_state\_type}}), \textcolor{keywordtype}{intent(inout)} :: state}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00763}00763     \textcolor{keywordtype}{integer} :: istatus}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00764}00764 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00765}00765     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% phi\_grid)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00766}00766         \textcolor{keyword}{deallocate}(state \% phi\_grid, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00767}00767         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00768}00768             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`phi\_grid` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00769}00769             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00770}00770 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00771}00771 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00772}00772     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% phi)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00773}00773         \textcolor{keyword}{deallocate}(state \% phi, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00774}00774         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00775}00775             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`phi` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00776}00776             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00777}00777 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00778}00778 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00779}00779     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% phiinf)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00780}00780         \textcolor{keyword}{deallocate}(state \% phiinf, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00781}00781         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00782}00782             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`phiinf` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00783}00783             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00784}00784 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00785}00785 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00786}00786     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% phieps)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00787}00787         \textcolor{keyword}{deallocate}(state \% phieps, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00788}00788         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00789}00789             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`phieps` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00790}00790             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00791}00791 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00792}00792 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00793}00793     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% phieps\_rel\_diff)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00794}00794         \textcolor{keyword}{deallocate}(state \% phieps\_rel\_diff, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00795}00795         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00796}00796             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`phieps\_rel\_diff` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00797}00797             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00798}00798 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00799}00799 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00800}00800     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% xs)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00801}00801         \textcolor{keyword}{deallocate}(state \% xs, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00802}00802         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00803}00803             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`xs` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00804}00804             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00805}00805 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00806}00806 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00807}00807     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% xs\_rel\_diff)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00808}00808         \textcolor{keyword}{deallocate}(state \% xs\_rel\_diff, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00809}00809         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00810}00810             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`xs\_rel\_diff` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00811}00811             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00812}00812 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00813}00813 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00814}00814     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% s)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00815}00815         \textcolor{keyword}{deallocate}(state \% s, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00816}00816         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00817}00817             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`s` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00818}00818             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00819}00819 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00820}00820 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00821}00821     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% s\_rel\_diff)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00822}00822         \textcolor{keyword}{deallocate}(state \% s\_rel\_diff, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00823}00823         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00824}00824             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`s\_rel\_diff` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00825}00825             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00826}00826 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00827}00827 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00828}00828     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% sgrid)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00829}00829         \textcolor{keyword}{deallocate}(state \% sgrid, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00830}00830         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00831}00831             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`sgrid` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00832}00832             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00833}00833 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00834}00834 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00835}00835     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% y)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00836}00836         \textcolor{keyword}{deallocate}(state \% y, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00837}00837         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00838}00838             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`y` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00839}00839             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00840}00840 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00841}00841 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00842}00842     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% y\_rel\_diff)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00843}00843         \textcolor{keyword}{deallocate}(state \% y\_rel\_diff, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00844}00844         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00845}00845             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`y\_rel\_diff` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00846}00846             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00847}00847 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00848}00848 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00849}00849     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% ygrid)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00850}00850         \textcolor{keyword}{deallocate}(state \% ygrid, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00851}00851         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00852}00852             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`ygrid` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00853}00853             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00854}00854 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00855}00855 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00856}00856     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% g)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00857}00857         \textcolor{keyword}{deallocate}(state \% g, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00858}00858         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00859}00859             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`g` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00860}00860             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00861}00861 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00862}00862 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00863}00863     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% q)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00864}00864         \textcolor{keyword}{deallocate}(state \% q, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00865}00865         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00866}00866             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`q` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00867}00867             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00868}00868 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00869}00869 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00870}00870     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% qgrid)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00871}00871         \textcolor{keyword}{deallocate}(state \% qgrid, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00872}00872         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00873}00873             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`qgrid` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00874}00874             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00875}00875 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00876}00876 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00877}00877     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% zeta)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00878}00878         \textcolor{keyword}{deallocate}(state \% zeta, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00879}00879         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00880}00880             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}`zeta` deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00881}00881             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00882}00882 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00883}00883 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00884}00884     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% x\_lpb)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00885}00885         \textcolor{keyword}{deallocate}(state \% x\_lpb, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00886}00886         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00887}00887             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}ddfree: [36] deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00888}00888             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00889}00889 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00890}00890 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00891}00891     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% x\_adj\_lpb)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00892}00892         \textcolor{keyword}{deallocate}(state \% x\_adj\_lpb, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00893}00893         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00894}00894             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}ddfree: [36] deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00895}00895             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00896}00896 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00897}00897 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00898}00898     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% g\_lpb)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00899}00899         \textcolor{keyword}{deallocate}(state \% g\_lpb, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00900}00900         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00901}00901             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}ddfree: [36] deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00902}00902             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00903}00903 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00904}00904 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00905}00905     \textcolor{keywordflow}{if} (\textcolor{keyword}{allocated}(state \% f\_lpb)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00906}00906         \textcolor{keyword}{deallocate}(state \% f\_lpb, stat=istatus)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00907}00907         \textcolor{keywordflow}{if} (istatus .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00908}00908             \textcolor{keyword}{write}(*, *) \textcolor{stringliteral}{"{}ddfree: [36] deallocation failed!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00909}00909             stop 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00910}00910 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00911}00911 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00912}00912 \textcolor{keyword}{end subroutine }ddx\_free\_state}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00913}00913 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00914}00914 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00926}\mbox{\hyperlink{namespaceddx__core_aa76b7e526f53c93bf1492f51b3e1a8cc}{00926}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_aa76b7e526f53c93bf1492f51b3e1a8cc}{print\_spherical}}(label, nbasis, lmax, ncol, icol, x)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00927}00927     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00928}00928     \textcolor{keywordtype}{character (len=*)}, \textcolor{keywordtype}{intent(in)} :: label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00929}00929     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: nbasis, lmax, ncol, icol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00930}00930 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x(nbasis, ncol)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00931}00931     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00932}00932     \textcolor{keywordtype}{integer} :: l, m, ind, noff, nprt, ic, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00933}00933     \textcolor{comment}{! Print header:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00934}00934     \textcolor{keywordflow}{if} (ncol .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00935}00935         \textcolor{keyword}{write} (6,\textcolor{stringliteral}{'(3x,a,1x,"{}(column "{},i4"{})"{})'}) label, icol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00936}00936     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00937}00937         \textcolor{keyword}{write} (6,\textcolor{stringliteral}{'(3x,a)'}) label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00938}00938 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00939}00939     \textcolor{comment}{! Print entries:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00940}00940     \textcolor{keywordflow}{if} (ncol .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00941}00941         \textcolor{keywordflow}{do} l = 0, lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00942}00942             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00943}00943             \textcolor{keywordflow}{do} m = -\/l, l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00944}00944                 \textcolor{keyword}{write}(6,1000) l, m, x(ind+m, 1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00945}00945 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00946}00946 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00947}00947     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00948}00948         noff = mod(ncol, 5)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00949}00949         nprt = max(ncol-\/noff, 0)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00950}00950         \textcolor{keywordflow}{do} ic = 1, nprt, 5}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00951}00951             \textcolor{keyword}{write}(6,1010) (j, j = ic, ic+4)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00952}00952             \textcolor{keywordflow}{do} l = 0, lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00953}00953                 ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00954}00954                 \textcolor{keywordflow}{do} m = -\/l, l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00955}00955                     \textcolor{keyword}{write}(6,1020) l, m, x(ind+m, ic:ic+4)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00956}00956 \textcolor{keywordflow}{                end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00957}00957 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00958}00958 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00959}00959         \textcolor{keyword}{write} (6,1010) (j, j = nprt+1, nprt+noff)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00960}00960         \textcolor{keywordflow}{do} l = 0, lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00961}00961             ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00962}00962             \textcolor{keywordflow}{do} m = -\/l, l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00963}00963                 \textcolor{keyword}{write}(6,1020) l, m, x(ind+m, nprt+1:nprt+noff)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00964}00964 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00965}00965 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00966}00966 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00967}00967     1000 \textcolor{keyword}{format}(1x,i3,i4,f14.8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00968}00968     1010 \textcolor{keyword}{format}(8x,5i14)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00969}00969     1020 \textcolor{keyword}{format}(1x,i3,i4,5f14.8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00970}00970 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_aa76b7e526f53c93bf1492f51b3e1a8cc}{print\_spherical}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00971}00971 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00972}00972 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00982}\mbox{\hyperlink{namespaceddx__core_a7116b451c0d1427361e7d1437a1c5ae8}{00982}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7116b451c0d1427361e7d1437a1c5ae8}{print\_nodes}}(label, ngrid, ncol, icol, x)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00983}00983     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00984}00984     \textcolor{keywordtype}{character (len=*)}, \textcolor{keywordtype}{intent(in)} :: label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00985}00985     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: ngrid, ncol, icol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00986}00986 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x(ngrid, ncol)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00987}00987     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00988}00988     \textcolor{keywordtype}{integer} :: ig, noff, nprt, ic, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00989}00989     \textcolor{comment}{! Print header :}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00990}00990     \textcolor{keywordflow}{if} (ncol .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00991}00991         \textcolor{keyword}{write} (6,\textcolor{stringliteral}{'(3x,a,1x,"{}(column "{},i4"{})"{})'}) label, icol}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00992}00992     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00993}00993         \textcolor{keyword}{write} (6,\textcolor{stringliteral}{'(3x,a)'}) label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00994}00994 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00995}00995     \textcolor{comment}{! Print entries :}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00996}00996     \textcolor{keywordflow}{if} (ncol .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00997}00997         \textcolor{keywordflow}{do} ig = 1, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00998}00998             \textcolor{keyword}{write}(6,1000) ig, x(ig, 1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l00999}00999 \textcolor{keywordflow}{        enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01000}01000     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01001}01001         noff = mod(ncol, 5)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01002}01002         nprt = max(ncol-\/noff, 0)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01003}01003         \textcolor{keywordflow}{do} ic = 1, nprt, 5}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01004}01004             \textcolor{keyword}{write}(6,1010) (j, j = ic, ic+4)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01005}01005             \textcolor{keywordflow}{do} ig = 1, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01006}01006                 \textcolor{keyword}{write}(6,1020) ig, x(ig, ic:ic+4)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01007}01007 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01008}01008 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01009}01009         \textcolor{keyword}{write} (6,1010) (j, j = nprt+1, nprt+noff)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01010}01010         \textcolor{keywordflow}{do} ig = 1, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01011}01011             \textcolor{keyword}{write}(6,1020) ig, x(ig, nprt+1:nprt+noff)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01012}01012 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01013}01013 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01014}01014     \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01015}01015     1000 \textcolor{keyword}{format}(1x,i5,f14.8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01016}01016     1010 \textcolor{keyword}{format}(6x,5i14)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01017}01017     1020 \textcolor{keyword}{format}(1x,i5,5f14.8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01018}01018     \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01019}01019 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7116b451c0d1427361e7d1437a1c5ae8}{print\_nodes}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01020}01020 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01021}01021 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01026}01026 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01027}\mbox{\hyperlink{namespaceddx__core_a7ee983451a2d6b52ce89801a59fb33e6}{01027}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7ee983451a2d6b52ce89801a59fb33e6}{print\_ddvector}}(ddx\_data, label, vector)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01028}01028     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01029}01029     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__core_1_1ddx__type}{ddx\_type}}), \textcolor{keywordtype}{intent(in)}  :: ddx\_data}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01030}01030     \textcolor{keywordtype}{character(len=*)} :: label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01031}01031 \textcolor{keywordtype}{    real}(dp) :: vector(ddx\_data \% constants \% nbasis, ddx\_data \% params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01032}01032     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01033}01033     \textcolor{keywordtype}{integer} :: isph, lm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01034}01034     \textcolor{keyword}{write}(6,*) label}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01035}01035     \textcolor{keywordflow}{do} isph = 1, ddx\_data \% params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01036}01036       \textcolor{keywordflow}{do} lm = 1, ddx\_data \% constants \% nbasis}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01037}01037         \textcolor{keyword}{write}(6,\textcolor{stringliteral}{'(F15.8)'}) vector(lm,isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01038}01038 \textcolor{keywordflow}{      end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01039}01039 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01040}01040     \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01041}01041 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7ee983451a2d6b52ce89801a59fb33e6}{print\_ddvector}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01042}01042 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01043}01043 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01044}01044 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01059}\mbox{\hyperlink{namespaceddx__core_a7c6ed3167dcc5edcd4efa59719858b72}{01059}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7c6ed3167dcc5edcd4efa59719858b72}{ddintegrate}}(nsph, nbasis, ngrid, vwgrid, ldvwgrid, x\_grid, x\_lm)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01060}01060     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01061}01061     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: nsph, nbasis, ngrid, ldvwgrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01062}01062 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vwgrid(ldvwgrid, ngrid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01063}01063 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x\_grid(ngrid, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01064}01064     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01065}01065 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: x\_lm(nbasis, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01066}01066     \textcolor{comment}{!! Just call a single dgemm to do the job}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01067}01067     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'N'}, \textcolor{stringliteral}{'N'}, nbasis, nsph, ngrid, one, vwgrid, ldvwgrid, x\_grid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01068}01068         \& ngrid, zero, x\_lm, nbasis)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01069}01069 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7c6ed3167dcc5edcd4efa59719858b72}{ddintegrate}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01070}01070 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01071}01071 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01085}01085 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01086}\mbox{\hyperlink{namespaceddx__core_af4a63e9274aa8031ba29947ec4840da1}{01086}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_af4a63e9274aa8031ba29947ec4840da1}{dbasis}}(params, constants, x, basloc, dbsloc, vplm, vcos, vsin)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01087}01087     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01088}01088     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01089}01089 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3)},        \textcolor{keywordtype}{intent(in)}    :: x}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01090}01090 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(constants \% nbasis)},   \textcolor{keywordtype}{intent(inout)} :: basloc, vplm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01091}01091 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3, constants \% nbasis)}, \textcolor{keywordtype}{intent(inout)} :: dbsloc}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01092}01092 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(params \% lmax+1)},   \textcolor{keywordtype}{intent(inout)} :: vcos, vsin}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01093}01093     \textcolor{keywordtype}{integer} :: l, m, ind}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01094}01094 \textcolor{keywordtype}{    real}(dp)  :: cthe, sthe, cphi, sphi, plm, fln, pp1, pm1, pp, VC, VS}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01095}01095 \textcolor{keywordtype}{    real}(dp)  :: et(3), ep(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01096}01096     \textcolor{comment}{!     get cos(\(\backslash\)theta), sin(\(\backslash\)theta), cos(\(\backslash\)phi) and sin(\(\backslash\)phi) from the cartesian}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01097}01097     \textcolor{comment}{!     coordinates of x.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01098}01098     cthe = x(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01099}01099     sthe = sqrt(one -\/ cthe*cthe)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01100}01100     \textcolor{comment}{!     not ( NORTH or SOUTH pole )}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01101}01101     \textcolor{keywordflow}{if} ( sthe.ne.zero ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01102}01102         cphi = x(1)/sthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01103}01103         sphi = x(2)/sthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01104}01104         \textcolor{comment}{!     NORTH or SOUTH pole}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01105}01105     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01106}01106         cphi = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01107}01107         sphi = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01108}01108 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01109}01109     \textcolor{comment}{!     evaluate the derivatives of theta and phi:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01110}01110     et(1) = cthe*cphi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01111}01111     et(2) = cthe*sphi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01112}01112     et(3) = -\/sthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01113}01113     \textcolor{comment}{!     not ( NORTH or SOUTH pole )}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01114}01114     \textcolor{keywordflow}{if}( sthe.ne.zero ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01115}01115         ep(1) = -\/sphi/sthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01116}01116         ep(2) = cphi/sthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01117}01117         ep(3) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01118}01118         \textcolor{comment}{!     NORTH or SOUTH pole}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01119}01119     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01120}01120         ep(1) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01121}01121         ep(2) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01122}01122         ep(3) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01123}01123 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01124}01124     vc=zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01125}01125     vs=cthe}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01126}01126     \textcolor{comment}{!     evaluate the generalized legendre polynomials. Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01127}01127     \textcolor{comment}{!       is of size (p+1) here, so we use vcos for that purpose}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01128}01128     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a43b882cf0333a0ee0bf062501a03ff01}{polleg\_work}}( cthe, sthe, params \% lmax, vplm, vcos )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01129}01129     \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01130}01130     \textcolor{comment}{!     evaluate cos(m*phi) and sin(m*phi) arrays. notice that this is }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01131}01131     \textcolor{comment}{!     pointless if z = 1, as the only non vanishing terms will be the }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01132}01132     \textcolor{comment}{!     ones with m=0.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01133}01133     \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01134}01134     \textcolor{comment}{!     not ( NORTH or SOUTH pole )}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01135}01135     \textcolor{keywordflow}{if} ( sthe.ne.zero ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01136}01136         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a66b4e8bee63238c5c1c3f7a4210c8dd4}{trgev}}( cphi, sphi, params \% lmax, vcos, vsin )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01137}01137         \textcolor{comment}{!     NORTH or SOUTH pole}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01138}01138     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01139}01139         vcos = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01140}01140         vsin = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01141}01141 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01142}01142     \textcolor{comment}{!     now build the spherical harmonics. we will distinguish m=0,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01143}01143     \textcolor{comment}{!     m>0 and m<0:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01144}01144     \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01145}01145     basloc = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01146}01146     dbsloc = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01147}01147     \textcolor{keywordflow}{do} l = 0, params \% lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01148}01148         ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01149}01149         \textcolor{comment}{! m = 0}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01150}01150         fln = constants \% vscales(ind)   }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01151}01151         basloc(ind) = fln*vplm(ind)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01152}01152         \textcolor{keywordflow}{if} (l.gt.0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01153}01153             dbsloc(:,ind) = fln*vplm(ind+1)*et(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01154}01154         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01155}01155             dbsloc(:,ind) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01156}01156 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01157}01157         \textcolor{comment}{!dir\$ simd}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01158}01158         \textcolor{keywordflow}{do} m = 1, l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01159}01159             fln = constants \% vscales(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01160}01160             plm = fln*vplm(ind+m)   }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01161}01161             pp1 = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01162}01162             \textcolor{keywordflow}{if} (m.lt.l) pp1 = -\/pt5*vplm(ind+m+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01163}01163             pm1 = pt5*(dble(l+m)*dble(l-\/m+1)*vplm(ind+m-\/1))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01164}01164             pp  = pp1 + pm1   }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01165}01165             \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01166}01166             \textcolor{comment}{!         m > 0}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01167}01167             \textcolor{comment}{!         -\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01168}01168             \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01169}01169             basloc(ind+m) = plm*vcos(m+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01170}01170             \textcolor{comment}{!          }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01171}01171             \textcolor{comment}{!         not ( NORTH or SOUTH pole )}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01172}01172             \textcolor{keywordflow}{if} ( sthe.ne.zero ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01173}01173                 \textcolor{comment}{! }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01174}01174                 dbsloc(:,ind+m) = -\/fln*pp*vcos(m+1)*et(:) -\/ dble(m)*plm*vsin(m+1)*ep(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01175}01175                 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01176}01176                 \textcolor{comment}{!            }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01177}01177                 \textcolor{comment}{!         NORTH or SOUTH pole}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01178}01178             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01179}01179                 \textcolor{comment}{!                  }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01180}01180                 dbsloc(:,ind+m) = -\/fln*pp*vcos(m+1)*et(:) -\/ fln*pp*ep(:)*vc}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01181}01181                 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01182}01182                 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01183}01183 \textcolor{keywordflow}{            endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01184}01184             \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01185}01185             \textcolor{comment}{!         m < 0}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01186}01186             \textcolor{comment}{!         -\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01187}01187             \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01188}01188             basloc(ind-\/m) = plm*vsin(m+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01189}01189             \textcolor{comment}{!          }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01190}01190             \textcolor{comment}{!         not ( NORTH or SOUTH pole )}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01191}01191             \textcolor{keywordflow}{if} ( sthe.ne.zero ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01192}01192                 \textcolor{comment}{! }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01193}01193                 dbsloc(:,ind-\/m) = -\/fln*pp*vsin(m+1)*et(:) + dble(m)*plm*vcos(m+1)*ep(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01194}01194                 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01195}01195                 \textcolor{comment}{!         NORTH or SOUTH pole}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01196}01196             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01197}01197                 \textcolor{comment}{!                  }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01198}01198                 dbsloc(:,ind-\/m) = -\/fln*pp*vsin(m+1)*et(:) -\/ fln*pp*ep(:)*vs}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01199}01199                 \textcolor{comment}{!            }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01200}01200 \textcolor{keywordflow}{            endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01201}01201             \textcolor{comment}{!  }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01202}01202 \textcolor{keywordflow}{        enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01203}01203 \textcolor{keywordflow}{    enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01204}01204 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_af4a63e9274aa8031ba29947ec4840da1}{dbasis}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01205}01205 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01206}01206 \textcolor{comment}{! Purpose : compute}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01207}01207 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01208}01208 \textcolor{comment}{!                               l}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01209}01209 \textcolor{comment}{!             sum   4pi/(2l+1) t  * Y\_l\string^m( s ) * sigma\_l\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01210}01210 \textcolor{comment}{!             l,m                                           }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01211}01211 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01212}01212 \textcolor{comment}{!           which is need to compute action of COSMO matrix L.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01213}01213 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01215}01215 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01216}\mbox{\hyperlink{namespaceddx__core_af57c0e1c6dd13f71fee44d975a1080cd}{01216}} \textcolor{keyword}{real(dp) }\textcolor{keyword}{function }\mbox{\hyperlink{namespaceddx__core_af57c0e1c6dd13f71fee44d975a1080cd}{intmlp}}(params, constants, t, sigma, basloc )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01217}01217 \textcolor{comment}{!  }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01218}01218       \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01219}01219       \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01220}01220 \textcolor{keywordtype}{      real}(dp), \textcolor{keywordtype}{intent(in)} :: t}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01221}01221 \textcolor{keywordtype}{      real}(dp), \textcolor{keywordtype}{dimension(constants \% nbasis)}, \textcolor{keywordtype}{intent(in)} :: sigma, basloc}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01222}01222 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01223}01223       \textcolor{keywordtype}{integer} :: l, ind}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01224}01224 \textcolor{keywordtype}{      real}(dp)  :: tt, ss, fac}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01225}01225 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01226}01226 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01227}01227 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01228}01228 \textcolor{comment}{!     initialize t\string^l}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01229}01229       tt = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01230}01230 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01231}01231 \textcolor{comment}{!     initialize}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01232}01232       ss = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01233}01233 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01234}01234 \textcolor{comment}{!     loop over l}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01235}01235       \textcolor{keywordflow}{do} l = 0, params \% lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01236}01236 \textcolor{comment}{!      }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01237}01237         ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01238}01238 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01239}01239 \textcolor{comment}{!       update factor 4pi / (2l+1) * t\string^l}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01240}01240         fac = tt / constants \% vscales(ind)**2}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01241}01241 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01242}01242 \textcolor{comment}{!       contract over l,m and accumulate}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01243}01243         ss = ss + fac * dot\_product( basloc(ind-\/l:ind+l), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01244}01244                                      sigma( ind-\/l:ind+l)   )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01245}01245 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01246}01246 \textcolor{comment}{!       update t\string^l}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01247}01247         tt = tt*t}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01248}01248 \textcolor{comment}{!        }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01249}01249 \textcolor{keywordflow}{      enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01250}01250 \textcolor{comment}{!      }}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01251}01251 \textcolor{comment}{!     redirect}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01252}01252       \mbox{\hyperlink{namespaceddx__core_af57c0e1c6dd13f71fee44d975a1080cd}{intmlp}} = ss}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01253}01253 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01254}01254 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01255}01255 \textcolor{keyword}{end function }\mbox{\hyperlink{namespaceddx__core_af57c0e1c6dd13f71fee44d975a1080cd}{intmlp}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01256}01256 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01257}01257 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01260}01260 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01261}\mbox{\hyperlink{namespaceddx__core_a202929912f5b0db1b6fd9f6c8809074c}{01261}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a202929912f5b0db1b6fd9f6c8809074c}{wghpot}}(ncav, phi\_cav, nsph, ngrid, ui, phi\_grid, g)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01262}01262     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01263}01263     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: ncav, nsph, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01264}01264 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: phi\_cav(ncav), ui(ngrid, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01265}01265     \textcolor{comment}{!! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01266}01266 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: g(ngrid, nsph), phi\_grid(ngrid, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01267}01267     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01268}01268     \textcolor{keywordtype}{integer} isph, igrid, icav}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01269}01269     \textcolor{comment}{!! Code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01270}01270     \textcolor{comment}{! Initialize}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01271}01271     icav = 0 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01272}01272     g = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01273}01273     phi\_grid = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01274}01274     \textcolor{comment}{! Loop over spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01275}01275     \textcolor{keywordflow}{do} isph = 1, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01276}01276         \textcolor{comment}{! Loop over points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01277}01277         \textcolor{keywordflow}{do} igrid = 1, ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01278}01278             \textcolor{comment}{! Non-\/zero contribution from point}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01279}01279             \textcolor{keywordflow}{if} (ui(igrid, isph) .ne. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01280}01280                 \textcolor{comment}{! Advance cavity point counter}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01281}01281                 icav = icav + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01282}01282                 phi\_grid(igrid, isph) = phi\_cav(icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01283}01283                 \textcolor{comment}{! Weigh by (negative) characteristic function}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01284}01284                 g(igrid, isph) = -\/ui(igrid, isph) * phi\_cav(icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01285}01285 \textcolor{keywordflow}{            endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01286}01286 \textcolor{keywordflow}{        enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01287}01287 \textcolor{keywordflow}{    enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01288}01288 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a202929912f5b0db1b6fd9f6c8809074c}{wghpot}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01289}01289 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01290}01290 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01292}01292 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01293}\mbox{\hyperlink{namespaceddx__core_aa459fca8ccf1b5380372e23d03d72fcf}{01293}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_aa459fca8ccf1b5380372e23d03d72fcf}{hsnorm}}(lmax, nbasis, u, unorm)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01294}01294     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: lmax, nbasis}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01295}01295 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(nbasis)}, \textcolor{keywordtype}{intent(in)} :: u}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01296}01296 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: unorm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01297}01297     \textcolor{keywordtype}{integer} :: l, m, ind}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01298}01298 \textcolor{keywordtype}{    real}(dp)  :: fac}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01299}01299     \textcolor{comment}{! initialize}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01300}01300     unorm = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01301}01301     \textcolor{keywordflow}{do} l = 0, lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01302}01302         ind = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01303}01303         fac = one/(one + dble(l))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01304}01304         \textcolor{keywordflow}{do} m = -\/l, l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01305}01305             unorm = unorm + fac*u(ind+m)*u(ind+m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01306}01306 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01307}01307 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01308}01308 \textcolor{comment}{!   the much neglected square root}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01309}01309     unorm = sqrt(unorm)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01310}01310 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_aa459fca8ccf1b5380372e23d03d72fcf}{hsnorm}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01311}01311 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01312}01312 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01314}01314 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01315}\mbox{\hyperlink{namespaceddx__core_a2b3e39f4eaa589b097d4e9f37673e8f1}{01315}} \textcolor{keyword}{real(dp) }\textcolor{keyword}{function }\mbox{\hyperlink{namespaceddx__core_a2b3e39f4eaa589b097d4e9f37673e8f1}{hnorm}}(lmax, nbasis, nsph, x)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01316}01316     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: lmax, nbasis, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01317}01317 \textcolor{keywordtype}{    real}(dp),  \textcolor{keywordtype}{dimension(nbasis, nsph)}, \textcolor{keywordtype}{intent(in)} :: x}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01318}01318     \textcolor{keywordtype}{integer}                                     :: isph, istatus}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01319}01319 \textcolor{keywordtype}{    real}(dp)                                      :: vrms, vmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01320}01320 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{allocatable}                         :: u(:)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01321}01321     \textcolor{keyword}{allocate}( u(nsph) , stat=istatus )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01322}01322     \textcolor{keywordflow}{if} ( istatus.ne.0 ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01323}01323         \textcolor{keyword}{write}(*,*) \textcolor{stringliteral}{'hnorm: allocation failed !'}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01324}01324         stop}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01325}01325 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01326}01326     \textcolor{comment}{!\$omp parallel do default(none) shared(nsph,lmax,nbasis,x,u) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01327}01327     \textcolor{comment}{!\$omp private(isph) schedule(dynamic)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01328}01328     \textcolor{keywordflow}{do} isph = 1, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01329}01329         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_aa459fca8ccf1b5380372e23d03d72fcf}{hsnorm}}(lmax, nbasis, x(:,isph), u(isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01330}01330 \textcolor{keywordflow}{    enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01331}01331     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a4dcabcd0c6fe4d601c5a739d8d1bf86c}{rmsvec}}(nsph, u, vrms, vmax)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01332}01332     \mbox{\hyperlink{namespaceddx__core_a2b3e39f4eaa589b097d4e9f37673e8f1}{hnorm}} = vrms}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01333}01333     \textcolor{keyword}{deallocate}( u , stat=istatus )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01334}01334     \textcolor{keywordflow}{if} ( istatus.ne.0 ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01335}01335         \textcolor{keyword}{write}(*,*) \textcolor{stringliteral}{'hnorm: deallocation failed !'}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01336}01336         stop}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01337}01337 \textcolor{keywordflow}{    endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01338}01338 \textcolor{keyword}{end function }\mbox{\hyperlink{namespaceddx__core_a2b3e39f4eaa589b097d4e9f37673e8f1}{hnorm}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01339}01339 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01340}01340 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01342}01342 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01343}\mbox{\hyperlink{namespaceddx__core_af6525c3026ed48bc2e9711d7f5f993a1}{01343}} \textcolor{keyword}{real(dp) }\textcolor{keyword}{function }\mbox{\hyperlink{namespaceddx__core_af6525c3026ed48bc2e9711d7f5f993a1}{rmsnorm}}(lmax, nbasis, nsph, x)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01344}01344     \textcolor{keywordtype}{integer},                            \textcolor{keywordtype}{intent(in)} :: lmax, nbasis, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01345}01345 \textcolor{keywordtype}{    real}(dp),  \textcolor{keywordtype}{dimension(nbasis, nsph)}, \textcolor{keywordtype}{intent(in)} :: x}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01346}01346 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01347}01347     \textcolor{keywordtype}{integer}  :: n}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01348}01348 \textcolor{keywordtype}{    real}(dp) :: vrms, vmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01349}01349 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01350}01350     n = nbasis*nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01351}01351     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a4dcabcd0c6fe4d601c5a739d8d1bf86c}{rmsvec}}(n,x,vrms,vmax)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01352}01352 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01353}01353     \mbox{\hyperlink{namespaceddx__core_af6525c3026ed48bc2e9711d7f5f993a1}{rmsnorm}} = vrms}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01354}01354   }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01355}01355 \textcolor{keyword}{end function }\mbox{\hyperlink{namespaceddx__core_af6525c3026ed48bc2e9711d7f5f993a1}{rmsnorm}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01356}01356 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01357}01357 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01359}01359 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01360}\mbox{\hyperlink{namespaceddx__core_a4dcabcd0c6fe4d601c5a739d8d1bf86c}{01360}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a4dcabcd0c6fe4d601c5a739d8d1bf86c}{rmsvec}}( n, v, vrms, vmax )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01361}01361     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01362}01362     \textcolor{keywordtype}{integer},               \textcolor{keywordtype}{intent(in)}    :: n}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01363}01363 \textcolor{keywordtype}{    real}(dp),  \textcolor{keywordtype}{dimension(n)}, \textcolor{keywordtype}{intent(in)}    :: v}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01364}01364 \textcolor{keywordtype}{    real}(dp),                \textcolor{keywordtype}{intent(inout)} :: vrms, vmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01365}01365     \textcolor{keywordtype}{integer} :: i}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01366}01366 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: zero=0.0d0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01367}01367 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01368}01368     vrms = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01369}01369     vmax = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01370}01370     \textcolor{keywordflow}{do} i = 1,n}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01371}01371       vmax = max(vmax,abs(v(i)))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01372}01372       vrms = vrms + v(i)*v(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01373}01373 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01374}01374     \textcolor{comment}{! the much neglected square root}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01375}01375     vrms = sqrt(vrms/dble(n))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01376}01376 \textcolor{keyword}{endsubroutine }\mbox{\hyperlink{namespaceddx__core_a4dcabcd0c6fe4d601c5a739d8d1bf86c}{rmsvec}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01377}01377 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01378}01378 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01380}01380 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01381}\mbox{\hyperlink{namespaceddx__core_a506cc06b7ccdef7dae3c83c324ca2923}{01381}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a506cc06b7ccdef7dae3c83c324ca2923}{adjrhs}}(params, constants, isph, xi, vlm, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01382}01382     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01383}01383     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01384}01384     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: isph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01385}01385 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(params \% ngrid, params \% nsph)}, \textcolor{keywordtype}{intent(in)} :: xi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01386}01386 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(constants \% nbasis)}, \textcolor{keywordtype}{intent(inout)} :: vlm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01387}01387 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(params \% lmax+1)}, \textcolor{keywordtype}{intent(inout)} :: work}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01388}01388 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01389}01389     \textcolor{keywordtype}{integer} :: ij, jsph, ig, l, ind, m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01390}01390 \textcolor{keywordtype}{    real}(dp)  :: vji(3), vvji, tji, sji(3), xji, oji, fac, ffac, t}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01391}01391 \textcolor{keywordtype}{    real}(dp) :: rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01392}01392 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01393}01393     \textcolor{keywordflow}{do} ij = constants \% inl(isph), constants \% inl(isph+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01394}01394       jsph = constants \% nl(ij)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01395}01395       \textcolor{keywordflow}{do} ig = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01396}01396         vji  = params \% csph(:,jsph) + params \% rsph(jsph)* \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01397}01397             \& constants \% cgrid(:,ig) -\/ params \% csph(:,isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01398}01398         vvji = sqrt(dot\_product(vji,vji))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01399}01399         tji  = vvji/params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01400}01400         \textcolor{keywordflow}{if} ( tji.lt.( one + (params \% se+one)/two*params \% eta ) ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01401}01401           xji = \mbox{\hyperlink{namespaceddx__constants_abb0c060445e3b2d40b770eda26d20fdb}{fsw}}( tji, params \% se, params \% eta )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01402}01402           \textcolor{keywordflow}{if} ( constants \% fi(ig,jsph).gt.one ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01403}01403             oji = xji/ constants \% fi(ig,jsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01404}01404           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01405}01405             oji = xji}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01406}01406 \textcolor{keywordflow}{          endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01407}01407           fac = constants \% wgrid(ig) * xi(ig,jsph) * oji}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01408}01408           \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a02d5736e15ad31da5e0a6b349fdacac1}{fmm\_l2p\_adj\_work}}(vji, fac, params \% rsph(isph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01409}01409               \& params \% lmax, constants \% vscales\_rel, one, vlm, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01410}01410 \textcolor{keywordflow}{        endif}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01411}01411 \textcolor{keywordflow}{      enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01412}01412 \textcolor{keywordflow}{    enddo}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01413}01413 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a506cc06b7ccdef7dae3c83c324ca2923}{adjrhs}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01414}01414 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01415}01415 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01417}01417 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01418}\mbox{\hyperlink{namespaceddx__core_a96984a0f96c1a17e25c781d34ed73f80}{01418}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a96984a0f96c1a17e25c781d34ed73f80}{calcv}}(params, constants, isph, pot, sigma, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01419}01419     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01420}01420     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01421}01421     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: isph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01422}01422 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(constants \% nbasis, params \% nsph)}, \textcolor{keywordtype}{intent(in)} :: sigma}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01423}01423 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(params \% ngrid)}, \textcolor{keywordtype}{intent(inout)} :: pot}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01424}01424 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(params \% lmax+1)}, \textcolor{keywordtype}{intent(inout)} :: work}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01425}01425 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01426}01426     \textcolor{keywordtype}{integer} :: its, ij, jsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01427}01427 \textcolor{keywordtype}{    real}(dp) :: vij(3), sij(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01428}01428 \textcolor{keywordtype}{    real}(dp) :: vvij, tij, xij, oij, stslm, stslm2, stslm3, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01429}01429         \& thigh, rho, ctheta, stheta, cphi, sphi}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01430}01430 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01431}01431     thigh = one + pt5*(params \% se + one)*params \% eta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01432}01432     pot(:) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01433}01433     \textcolor{comment}{! loop over grid points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01434}01434     \textcolor{keywordflow}{do} its = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01435}01435         \textcolor{comment}{! contribution from integration point present}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01436}01436         \textcolor{keywordflow}{if} (constants \% ui(its,isph).lt.one) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01437}01437             \textcolor{comment}{! loop over neighbors of i-\/sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01438}01438             \textcolor{keywordflow}{do} ij = constants \% inl(isph), constants \% inl(isph+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01439}01439                 jsph = constants \% nl(ij)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01440}01440                 \textcolor{comment}{! compute t\_n\string^ij = | r\_i + \(\backslash\)rho\_i s\_n -\/ r\_j | / \(\backslash\)rho\_j}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01441}01441                 vij  = params \% csph(:,isph) + params \% rsph(isph)* \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01442}01442                     \& constants \% cgrid(:,its) -\/ params \% csph(:,jsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01443}01443                 vvij = sqrt( dot\_product( vij, vij ) )}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01444}01444                 tij  = vvij / params \% rsph(jsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01445}01445                 \textcolor{comment}{! point is INSIDE j-\/sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01446}01446                 \textcolor{keywordflow}{if} (tij.lt.thigh .and. tij.gt.zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01447}01447                     xij = \mbox{\hyperlink{namespaceddx__constants_abb0c060445e3b2d40b770eda26d20fdb}{fsw}}(tij, params \% se, params \% eta)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01448}01448                     \textcolor{keywordflow}{if} (constants \% fi(its,isph).gt.one) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01449}01449                         oij = xij / constants \% fi(its,isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01450}01450                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01451}01451                         oij = xij}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01452}01452 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01453}01453                     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_afcb1b1e24d6d54835de05360bedad809}{fmm\_l2p\_work}}(vij, params \% rsph(jsph), params \% lmax, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01454}01454                         \& constants \% vscales\_rel, oij, sigma(:, jsph), one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01455}01455                         \& pot(its), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01456}01456 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01457}01457 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01458}01458 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01459}01459 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01460}01460 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a96984a0f96c1a17e25c781d34ed73f80}{calcv}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01461}01461 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01462}01462 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01464}01464 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01465}\mbox{\hyperlink{namespaceddx__core_ad5b07f0450b5b0fae876973a3ce661d7}{01465}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ad5b07f0450b5b0fae876973a3ce661d7}{ddeval\_grid}}(params, constants, alpha, x\_sph, beta, x\_grid, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01466}01466     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01467}01467     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01468}01468     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01469}01469 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: alpha, x\_sph(constants \% nbasis, params \% nsph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01470}01470         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01471}01471     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01472}01472 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: x\_grid(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01473}01473     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: info}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01474}01474     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01475}01475     \textcolor{keywordtype}{character(len=255)} :: string}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01476}01476     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01477}01477     \textcolor{comment}{! Check that parameters and constants are correctly initialized}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01478}01478     \textcolor{keywordflow}{if} (params \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01479}01479         string = \textcolor{stringliteral}{"{}ddeval\_grid: `params` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01480}01480         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01481}01481         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01482}01482         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01483}01483 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01484}01484     \textcolor{keywordflow}{if} (constants \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01485}01485         string = \textcolor{stringliteral}{"{}ddeval\_grid: `constants` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01486}01486         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01487}01487         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01488}01488         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01489}01489 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01490}01490     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01491}01491     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a52eaee7c9a67f2a9f317c2d6dd50426e}{ddeval\_grid\_work}}(constants \% nbasis, params \% ngrid, params \% nsph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01492}01492         \& constants \% vgrid, constants \% vgrid\_nbasis, alpha, x\_sph, beta, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01493}01493         \& x\_grid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01494}01494     info = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01495}01495 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ad5b07f0450b5b0fae876973a3ce661d7}{ddeval\_grid}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01496}01496 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01497}01497 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01499}01499 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01500}\mbox{\hyperlink{namespaceddx__core_a52eaee7c9a67f2a9f317c2d6dd50426e}{01500}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a52eaee7c9a67f2a9f317c2d6dd50426e}{ddeval\_grid\_work}}(nbasis, ngrid, nsph, vgrid, ldvgrid, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01501}01501         \& x\_sph, beta, x\_grid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01502}01502     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01503}01503     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: nbasis, ngrid, nsph, ldvgrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01504}01504 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vgrid(ldvgrid, ngrid), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01505}01505         \& x\_sph(nbasis, nsph), beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01506}01506     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01507}01507 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: x\_grid(ngrid, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01508}01508     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01509}01509     \textcolor{keywordtype}{external} :: dgemm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01510}01510     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01511}01511     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'T'}, \textcolor{stringliteral}{'N'}, ngrid, nsph, nbasis, alpha, vgrid, ldvgrid, x\_sph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01512}01512         \& nbasis, beta, x\_grid, ngrid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01513}01513 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a52eaee7c9a67f2a9f317c2d6dd50426e}{ddeval\_grid\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01514}01514 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01516}\mbox{\hyperlink{namespaceddx__core_ae804f0dbf4b9800bc75adaa57c842149}{01516}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ae804f0dbf4b9800bc75adaa57c842149}{ddintegrate\_sph}}(params, constants, alpha, x\_grid, beta, x\_sph, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01517}01517     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01518}01518     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01519}01519     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01520}01520 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: alpha, x\_grid(params \% ngrid, params \% nsph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01521}01521         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01522}01522     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01523}01523 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: x\_sph(constants \% nbasis, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01524}01524     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: info}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01525}01525     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01526}01526     \textcolor{keywordtype}{character(len=255)} :: string}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01527}01527     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01528}01528     \textcolor{comment}{! Check that parameters and constants are correctly initialized}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01529}01529     \textcolor{keywordflow}{if} (params \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01530}01530         string = \textcolor{stringliteral}{"{}ddintegrate\_sph: `params` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01531}01531         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01532}01532         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01533}01533         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01534}01534 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01535}01535     \textcolor{keywordflow}{if} (constants \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01536}01536         string = \textcolor{stringliteral}{"{}ddintegrate\_sph: `constants` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01537}01537         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01538}01538         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01539}01539         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01540}01540 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01541}01541     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01542}01542     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a61156a8a0aec479ea2071dd6d6922fb1}{ddintegrate\_sph\_work}}(constants \% nbasis, params \% ngrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01543}01543         \& params \% nsph, constants \% vwgrid, constants \% vgrid\_nbasis, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01544}01544         \& x\_grid, beta, x\_sph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01545}01545     info = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01546}01546 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ae804f0dbf4b9800bc75adaa57c842149}{ddintegrate\_sph}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01547}01547 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01549}\mbox{\hyperlink{namespaceddx__core_a61156a8a0aec479ea2071dd6d6922fb1}{01549}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a61156a8a0aec479ea2071dd6d6922fb1}{ddintegrate\_sph\_work}}(nbasis, ngrid, nsph, vwgrid, ldvwgrid, alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01550}01550         \& x\_grid, beta, x\_sph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01551}01551     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01552}01552     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: nbasis, ngrid, nsph, ldvwgrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01553}01553 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: vwgrid(ldvwgrid, ngrid), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01554}01554         \& x\_grid(ngrid, nsph), beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01555}01555     \textcolor{comment}{!! Outputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01556}01556 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: x\_sph(nbasis, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01557}01557     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01558}01558     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01559}01559     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'N'}, \textcolor{stringliteral}{'N'}, nbasis, nsph, ngrid, alpha, vwgrid, ldvwgrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01560}01560         \& x\_grid, ngrid, beta, x\_sph, nbasis)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01561}01561 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a61156a8a0aec479ea2071dd6d6922fb1}{ddintegrate\_sph\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01562}01562 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01563}01563 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01565}01565 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01566}\mbox{\hyperlink{namespaceddx__core_a8abb13e98d5d1eb3512e5ad55b701ef3}{01566}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a8abb13e98d5d1eb3512e5ad55b701ef3}{ddcav\_to\_grid}}(params, constants, x\_cav, x\_grid, info)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01567}01567     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01568}01568     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01569}01569     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01570}01570 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x\_cav(constants \% ncav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01571}01571     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01572}01572 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: x\_grid(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01573}01573     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: info}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01574}01574     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01575}01575     \textcolor{keywordtype}{character(len=255)} :: string}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01576}01576     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01577}01577     \textcolor{comment}{! Check that parameters and constants are correctly initialized}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01578}01578     \textcolor{keywordflow}{if} (params \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01579}01579         string = \textcolor{stringliteral}{"{}ddcav\_to\_grid: `params` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01580}01580         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01581}01581         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01582}01582         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01583}01583 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01584}01584     \textcolor{keywordflow}{if} (constants \% error\_flag .ne. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01585}01585         string = \textcolor{stringliteral}{"{}ddcav\_to\_grid: `constants` is in error state"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01586}01586         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01587}01587         info = 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01588}01588         \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01589}01589 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01590}01590     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01591}01591     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_accaee74767f44a369c6d2d1e106c0453}{ddcav\_to\_grid\_work}}(params \% ngrid, params \% nsph, constants \% ncav, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01592}01592         \& constants \% icav\_ia, constants \% icav\_ja, x\_cav, x\_grid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01593}01593     info = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01594}01594 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a8abb13e98d5d1eb3512e5ad55b701ef3}{ddcav\_to\_grid}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01595}01595 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01596}01596 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01598}01598 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01599}\mbox{\hyperlink{namespaceddx__core_accaee74767f44a369c6d2d1e106c0453}{01599}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_accaee74767f44a369c6d2d1e106c0453}{ddcav\_to\_grid\_work}}(ngrid, nsph, ncav, icav\_ia, icav\_ja, x\_cav, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01600}01600         \& x\_grid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01601}01601     \textcolor{comment}{!! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01602}01602     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: ngrid, nsph, ncav}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01603}01603     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: icav\_ia(nsph+1), icav\_ja(ncav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01604}01604 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: x\_cav(ncav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01605}01605     \textcolor{comment}{!! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01606}01606 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: x\_grid(ngrid, nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01607}01607     \textcolor{comment}{!! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01608}01608     \textcolor{keywordtype}{integer} :: isph, icav, igrid, igrid\_old}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01609}01609     \textcolor{comment}{!! The code}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01610}01610     \textcolor{keywordflow}{do} isph = 1, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01611}01611         igrid\_old = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01612}01612         igrid = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01613}01613         \textcolor{keywordflow}{do} icav = icav\_ia(isph), icav\_ia(isph+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01614}01614             igrid = icav\_ja(icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01615}01615             x\_grid(igrid\_old+1:igrid-\/1, isph) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01616}01616             x\_grid(igrid, isph) = x\_cav(icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01617}01617             igrid\_old = igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01618}01618 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01619}01619         x\_grid(igrid+1:ngrid, isph) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01620}01620 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01621}01621 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_accaee74767f44a369c6d2d1e106c0453}{ddcav\_to\_grid\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01622}01622 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01623}01623 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01624}01624 \textcolor{comment}{! Integrate by a characteristic function at Lebedev grid points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01625}01625 \textcolor{comment}{! \(\backslash\)xi(n,i) = sum w\_n U\_n\string^i Y\_l\string^m(s\_n) [S\_i]\_l\string^m}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01626}01626 \textcolor{comment}{!            l,m}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01627}01627 \textcolor{keyword}{subroutine }ddproject\_cav(params, constants, s, xi)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01628}01628     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01629}01629     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01630}01630 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)}  :: s(constants\%nbasis, params\%nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01631}01631 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: xi(constants\%ncav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01632}01632     \textcolor{keywordtype}{integer} :: its, isph, ii}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01633}01633 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01634}01634     ii = 0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01635}01635     \textcolor{keywordflow}{do} isph = 1, params\%nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01636}01636       \textcolor{keywordflow}{do} its = 1, params\%ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01637}01637         \textcolor{keywordflow}{if} (constants\%ui(its, isph) .gt. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01638}01638           ii     = ii + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01639}01639           xi(ii) = constants\%ui(its, isph) * dot\_product(constants\%vwgrid(:, its), s(:, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01640}01640 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01641}01641 \textcolor{keywordflow}{      end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01642}01642 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01643}01643 \textcolor{keyword}{end subroutine }ddproject\_cav}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01644}01644 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01645}01645 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01647}01647 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01648}\mbox{\hyperlink{namespaceddx__core_a1caf6da4500220161384b51938ada1f8}{01648}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a1caf6da4500220161384b51938ada1f8}{tree\_m2m\_rotation}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01649}01649     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01650}01650     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01651}01651     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01652}01652     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01653}01653 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01654}01654     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01655}01655 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01656}01656     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01657}01657     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a824b2d46bc4f19b41d1e59efc101fe97}{tree\_m2m\_rotation\_work}}(params, constants, node\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01658}01658 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a1caf6da4500220161384b51938ada1f8}{tree\_m2m\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01659}01659 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01660}01660 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01662}01662 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01663}\mbox{\hyperlink{namespaceddx__core_a824b2d46bc4f19b41d1e59efc101fe97}{01663}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a824b2d46bc4f19b41d1e59efc101fe97}{tree\_m2m\_rotation\_work}}(params, constants, node\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01664}01664     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01665}01665     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01666}01666     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01667}01667     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01668}01668 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01669}01669     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01670}01670 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01671}01671     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01672}01672     \textcolor{keywordtype}{integer} :: i, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01673}01673 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01674}01674     \textcolor{comment}{! Bottom-\/to-\/top pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01675}01675     \textcolor{comment}{!!\$omp parallel do default(none) shared(constants,params,node\_m) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01676}01676     \textcolor{comment}{!!\$omp private(i,j,c1,c,r1,r,work)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01677}01677     \textcolor{keywordflow}{do} i = constants \% nclusters, 1, -\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01678}01678         \textcolor{comment}{! Leaf node does not need any update}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01679}01679         \textcolor{keywordflow}{if} (constants \% children(1, i) == 0) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01680}01680         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01681}01681         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01682}01682         \textcolor{comment}{! First child initializes output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01683}01683         j = constants \% children(1, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01684}01684         c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01685}01685         r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01686}01686         c1 = c1 -\/ c}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01687}01687         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{fmm\_m2m\_rotation\_work}}(c1, r1, r, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01688}01688             \& params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01689}01689             \& constants \% vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01690}01690             \& constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01691}01691             \& node\_m(:, j), zero, node\_m(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01692}01692         \textcolor{comment}{! All other children update the same output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01693}01693         \textcolor{keywordflow}{do} j = constants \% children(1, i)+1, constants \% children(2, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01694}01694             c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01695}01695             r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01696}01696             c1 = c1 -\/ c}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01697}01697             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8e2dbf3bd69874619c4490930b91b4cc}{fmm\_m2m\_rotation\_work}}(c1, r1, r, params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01698}01698                 \& constants \% vscales, constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01699}01699                 \& node\_m(:, j), one, node\_m(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01700}01700 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01701}01701 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01702}01702 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a824b2d46bc4f19b41d1e59efc101fe97}{tree\_m2m\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01703}01703 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01704}01704 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01706}01706 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01707}\mbox{\hyperlink{namespaceddx__core_ad0d3d3c1ab770177d8e62b74b7b70a7f}{01707}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ad0d3d3c1ab770177d8e62b74b7b70a7f}{tree\_m2m\_bessel\_rotation}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01708}01708     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01709}01709     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01710}01710     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01711}01711     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01712}01712 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01713}01713     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01714}01714     \textcolor{comment}{!real(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01715}01715     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01716}01716     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a50051b223e25bba2f92fc30c8e4e9c14}{tree\_m2m\_bessel\_rotation\_work}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01717}01717 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ad0d3d3c1ab770177d8e62b74b7b70a7f}{tree\_m2m\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01718}01718 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01719}01719 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01721}01721 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01722}\mbox{\hyperlink{namespaceddx__core_a50051b223e25bba2f92fc30c8e4e9c14}{01722}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a50051b223e25bba2f92fc30c8e4e9c14}{tree\_m2m\_bessel\_rotation\_work}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01723}01723     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01724}01724     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01725}01725     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01726}01726     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01727}01727     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01728}01728 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01729}01729     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01730}01730 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01731}01731     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01732}01732     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01733}01733     \textcolor{keywordtype}{integer} :: i, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01734}01734 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01735}01735     \textcolor{comment}{! Bottom-\/to-\/top pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01736}01736     \textcolor{keywordflow}{do} i = constants \% nclusters, 1, -\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01737}01737         \textcolor{comment}{! Leaf node does not need any update}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01738}01738         \textcolor{keywordflow}{if} (constants \% children(1, i) == 0) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01739}01739         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01740}01740         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01741}01741         \textcolor{comment}{! First child initializes output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01742}01742         j = constants \% children(1, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01743}01743         c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01744}01744         r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01745}01745 \textcolor{comment}{!        call fmm\_m2m\_bessel\_rotation(c1-\/c, r1, r, params \% kappa, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01746}01746 \textcolor{comment}{!            \& params \% pm, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01747}01747 \textcolor{comment}{!            \& constants \% vscales, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01748}01748 \textcolor{comment}{!            \& constants \% vcnk, one, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01749}01749 \textcolor{comment}{!            \& node\_m(:, j), zero, node\_m(:, i))}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01750}01750         c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01751}01751         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{fmm\_m2m\_bessel\_rotation\_work}}(c1, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01752}01752             \& constants \% SK\_rnode(:, j), constants \% SK\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01753}01753             \& params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01754}01754             \& constants \% vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01755}01755             \& constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01756}01756             \& node\_m(:, j), zero, node\_m(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01757}01757         \textcolor{comment}{! All other children update the same output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01758}01758         \textcolor{keywordflow}{do} j = constants \% children(1, i)+1, constants \% children(2, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01759}01759             c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01760}01760             r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01761}01761 \textcolor{comment}{!            call fmm\_m2m\_bessel\_rotation(c1-\/c, r1, r, params \% kappa, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01762}01762 \textcolor{comment}{!                \& params \% pm, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01763}01763 \textcolor{comment}{!                \& constants \% vscales, constants \% vcnk, one, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01764}01764 \textcolor{comment}{!                \& node\_m(:, j), one, node\_m(:, i))}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01765}01765             c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01766}01766             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9f062fa6ce8602b23ee7ad4dba325fc5}{fmm\_m2m\_bessel\_rotation\_work}}(c1, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01767}01767                 \& constants \% SK\_rnode(:, j), constants \% SK\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01768}01768                 \& params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01769}01769                 \& constants \% vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01770}01770                 \& constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01771}01771                 \& node\_m(:, j), one, node\_m(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01772}01772 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01773}01773 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01774}01774 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a50051b223e25bba2f92fc30c8e4e9c14}{tree\_m2m\_bessel\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01775}01775 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01776}01776 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01778}01778 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01779}\mbox{\hyperlink{namespaceddx__core_ab680c1da4d087c3064e9fcbe4c439698}{01779}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ab680c1da4d087c3064e9fcbe4c439698}{tree\_m2m\_rotation\_adj}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01780}01780     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01781}01781     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01782}01782     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01783}01783     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01784}01784 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01785}01785     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01786}01786 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01787}01787     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01788}01788     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_af0f8bc57cc0a607a5f7b9d123b91e85a}{tree\_m2m\_rotation\_adj\_work}}(params, constants, node\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01789}01789 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ab680c1da4d087c3064e9fcbe4c439698}{tree\_m2m\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01790}01790 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01791}01791 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01793}01793 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01794}\mbox{\hyperlink{namespaceddx__core_af0f8bc57cc0a607a5f7b9d123b91e85a}{01794}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_af0f8bc57cc0a607a5f7b9d123b91e85a}{tree\_m2m\_rotation\_adj\_work}}(params, constants, node\_m, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01795}01795     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01796}01796     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01797}01797     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01798}01798     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01799}01799 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01800}01800     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01801}01801 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01802}01802     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01803}01803     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01804}01804 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01805}01805     \textcolor{comment}{! Top-\/to-\/bottom pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01806}01806     \textcolor{keywordflow}{do} i = 2, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01807}01807         j = constants \% parent(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01808}01808         c = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01809}01809         r = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01810}01810         c1 = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01811}01811         r1 = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01812}01812         c1 = c -\/ c1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01813}01813         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeb0fff99d95226ac55100e7bea5e54c3}{fmm\_m2m\_rotation\_adj\_work}}(c1, r, r1, params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01814}01814             \& constants \% vscales, constants \% vcnk, one, node\_m(:, j), one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01815}01815             \& node\_m(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01816}01816 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01817}01817 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_af0f8bc57cc0a607a5f7b9d123b91e85a}{tree\_m2m\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01818}01818 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01820}01820 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01821}\mbox{\hyperlink{namespaceddx__core_a4b801c0c80a755fcdedd743c93e63d13}{01821}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a4b801c0c80a755fcdedd743c93e63d13}{tree\_m2m\_bessel\_rotation\_adj}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01822}01822     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01823}01823     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01824}01824     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01825}01825     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01826}01826 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01827}01827     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01828}01828     \textcolor{comment}{!real(dp), intent(out) :: work(6*params \% pm**2 + 19*params \% pm + 8)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01829}01829     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_ad57a2d9013d87acb421f0747b95f4e75}{tree\_m2m\_bessel\_rotation\_adj\_work}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01830}01830 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a4b801c0c80a755fcdedd743c93e63d13}{tree\_m2m\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01831}01831 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01832}01832 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01834}01834 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01835}\mbox{\hyperlink{namespaceddx__core_ad57a2d9013d87acb421f0747b95f4e75}{01835}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ad57a2d9013d87acb421f0747b95f4e75}{tree\_m2m\_bessel\_rotation\_adj\_work}}(params, constants, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01836}01836     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01837}01837     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01838}01838     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01839}01839     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01840}01840 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01841}01841     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01842}01842 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01843}01843     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01844}01844     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01845}01845     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01846}01846 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01847}01847     \textcolor{comment}{! Top-\/to-\/bottom pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01848}01848     \textcolor{keywordflow}{do} i = 2, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01849}01849         j = constants \% parent(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01850}01850         c = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01851}01851         c1 = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01852}01852         c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01853}01853         \textcolor{comment}{! Little bit confusion about the i and j indices}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01854}01854         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9ce78f5c64aa0138b672a8fc0d86a43f}{fmm\_m2m\_bessel\_rotation\_adj\_work}}(c1, constants \% SK\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01855}01855             \& constants \% SK\_rnode(:, j),\&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01856}01856             \& params \% pm, constants \% vscales, constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01857}01857             \& node\_m(:, j), one, node\_m(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01858}01858 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01859}01859 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ad57a2d9013d87acb421f0747b95f4e75}{tree\_m2m\_bessel\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01860}01860 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01861}01861 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01863}01863 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01864}\mbox{\hyperlink{namespaceddx__core_a144b53f7df72de5a2717b78c6b903160}{01864}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a144b53f7df72de5a2717b78c6b903160}{tree\_l2l\_rotation}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01865}01865     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01866}01866     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01867}01867     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01868}01868     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01869}01869 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01870}01870     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01871}01871 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pl**2 + 19*params \% pl + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01872}01872     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01873}01873     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a343cdc81dac01fcc275b329aaff6584d}{tree\_l2l\_rotation\_work}}(params, constants, node\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01874}01874 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a144b53f7df72de5a2717b78c6b903160}{tree\_l2l\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01875}01875 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01876}01876 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01878}01878 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01879}\mbox{\hyperlink{namespaceddx__core_a343cdc81dac01fcc275b329aaff6584d}{01879}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a343cdc81dac01fcc275b329aaff6584d}{tree\_l2l\_rotation\_work}}(params, constants, node\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01880}01880     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01881}01881     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01882}01882     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01883}01883     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01884}01884 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01885}01885     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01886}01886 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(6*params \% pl**2 + 19*params \% pl + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01887}01887     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01888}01888     \textcolor{keywordtype}{integer} :: i, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01889}01889 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01890}01890     \textcolor{comment}{! Top-\/to-\/bottom pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01891}01891     \textcolor{comment}{!!\$omp parallel do default(none) shared(constants,params,node\_l) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01892}01892     \textcolor{comment}{!!\$omp private(i,j,c1,c,r1,r,work)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01893}01893     \textcolor{keywordflow}{do} i = 2, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01894}01894         j = constants \% parent(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01895}01895         c = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01896}01896         r = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01897}01897         c1 = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01898}01898         r1 = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01899}01899         c1 = c -\/ c1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01900}01900         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a75cdc5b6aeb95fdfaa88ae0e0834092f}{fmm\_l2l\_rotation\_work}}(c1, r, r1, params \% pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01901}01901             \& constants \% vscales, constants \% vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01902}01902             \& node\_l(:, j), one, node\_l(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01903}01903 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01904}01904 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a343cdc81dac01fcc275b329aaff6584d}{tree\_l2l\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01905}01905 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01906}01906 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01908}01908 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01909}\mbox{\hyperlink{namespaceddx__core_a7d65f9c7b0f00ffce03baa68fbe3cb99}{01909}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7d65f9c7b0f00ffce03baa68fbe3cb99}{tree\_l2l\_bessel\_rotation}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01910}01910     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01911}01911     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01912}01912     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01913}01913     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01914}01914 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01915}01915     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01916}01916     \textcolor{comment}{!real(dp) :: work(6*params \% pl**2 + 19*params \% pl + 8)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01917}01917     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01918}01918     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a7f57681126ffa1ad063103f39db026c3}{tree\_l2l\_bessel\_rotation\_work}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01919}01919 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7d65f9c7b0f00ffce03baa68fbe3cb99}{tree\_l2l\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01920}01920 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01921}01921 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01923}01923 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01924}\mbox{\hyperlink{namespaceddx__core_a7f57681126ffa1ad063103f39db026c3}{01924}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7f57681126ffa1ad063103f39db026c3}{tree\_l2l\_bessel\_rotation\_work}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01925}01925     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01926}01926     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01927}01927     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01928}01928     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01929}01929     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01930}01930 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01931}01931     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01932}01932 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01933}01933     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01934}01934     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01935}01935     \textcolor{keywordtype}{integer} :: i, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01936}01936 \textcolor{keywordtype}{    real}(dp) :: c\_child(3), c\_parent(3), c\_diff(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01937}01937     \textcolor{comment}{! Top-\/to-\/bottom pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01938}01938     \textcolor{keywordflow}{do} i = 2, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01939}01939         j = constants \% parent(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01940}01940         c\_child = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01941}01941         c\_parent = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01942}01942         c\_diff = params \% kappa*(c\_child -\/ c\_parent)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01943}01943         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a2284e6d544d983d0ac935f0ec642d3b1}{fmm\_l2l\_bessel\_rotation\_work}}(c\_diff, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01944}01944             \& constants \% si\_rnode(:, j), constants \% si\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01945}01945             \& params \% pl, constants \% vscales, constants \% vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01946}01946             \& node\_l(:, j), one, node\_l(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01947}01947 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01948}01948 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7f57681126ffa1ad063103f39db026c3}{tree\_l2l\_bessel\_rotation\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01949}01949 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01950}01950 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01952}01952 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01953}\mbox{\hyperlink{namespaceddx__core_ab1e1fe0e572c015d8f51b716e6ec8fc4}{01953}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_ab1e1fe0e572c015d8f51b716e6ec8fc4}{tree\_l2l\_rotation\_adj}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01954}01954     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01955}01955     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01956}01956     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01957}01957     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01958}01958 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01959}01959     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01960}01960 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pl**2 + 19*params \% pl + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01961}01961     \textcolor{comment}{! Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01962}01962     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_a02e2c9f1fe4c143bba50d01f1b4d338f}{tree\_l2l\_rotation\_adj\_work}}(params, constants, node\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01963}01963 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_ab1e1fe0e572c015d8f51b716e6ec8fc4}{tree\_l2l\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01964}01964 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01965}01965 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01967}01967 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01968}\mbox{\hyperlink{namespaceddx__core_a02e2c9f1fe4c143bba50d01f1b4d338f}{01968}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a02e2c9f1fe4c143bba50d01f1b4d338f}{tree\_l2l\_rotation\_adj\_work}}(params, constants, node\_l, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01969}01969     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01970}01970     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01971}01971     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01972}01972     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01973}01973 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01974}01974     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01975}01975 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work(6*params \% pl**2 + 19*params \% pl + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01976}01976     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01977}01977     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01978}01978 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01979}01979     \textcolor{comment}{! Bottom-\/to-\/top pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01980}01980     \textcolor{keywordflow}{do} i = constants \% nclusters, 1, -\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01981}01981         \textcolor{comment}{! Leaf node does not need any update}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01982}01982         \textcolor{keywordflow}{if} (constants \% children(1, i) == 0) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01983}01983         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01984}01984         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01985}01985         \textcolor{comment}{! First child initializes output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01986}01986         j = constants \% children(1, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01987}01987         c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01988}01988         r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01989}01989         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{fmm\_l2l\_rotation\_adj\_work}}(c1-\/c, r1, r, params \% pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01990}01990             \& constants \% vscales, constants \% vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01991}01991             \& node\_l(:, j), zero, node\_l(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01992}01992         \textcolor{comment}{! All other children update the same output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01993}01993         \textcolor{keywordflow}{do} j = constants \% children(1, i)+1, constants \% children(2, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01994}01994             c1 = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01995}01995             r1 = constants \% rnode(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01996}01996             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9dc2a4fa345b7c780c54cecccb88d5a7}{fmm\_l2l\_rotation\_adj\_work}}(c1-\/c, r1, r, params \% pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01997}01997                 \& constants \% vscales, constants \% vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01998}01998                 \& node\_l(:, j), one, node\_l(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l01999}01999 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02000}02000 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02001}02001 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a02e2c9f1fe4c143bba50d01f1b4d338f}{tree\_l2l\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02002}02002 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02003}02003 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02005}02005 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02006}\mbox{\hyperlink{namespaceddx__core_a6b92d30960fb1be121d7ab92d14365e9}{02006}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a6b92d30960fb1be121d7ab92d14365e9}{tree\_l2l\_bessel\_rotation\_adj}}(params, constants, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02007}02007     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02008}02008     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02009}02009     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02010}02010     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02011}02011 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02012}02012     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02013}02013 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pl**2 + 19*params \% pl + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02014}02014     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pl+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02015}02015     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02016}02016     \textcolor{keywordtype}{integer} :: i, j}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02017}02017 \textcolor{keywordtype}{    real}(dp) :: c\_parent(3), c\_child(3), c\_diff(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02018}02018     \textcolor{comment}{! Bottom-\/to-\/top pass}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02019}02019     \textcolor{keywordflow}{do} i = constants \% nclusters, 1, -\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02020}02020         c\_child = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02021}02021         j = constants \% parent(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02022}02022         \textcolor{keywordflow}{if} (j == 0) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02023}02023         c\_parent = constants \% cnode(:, j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02024}02024         c\_diff = params \% kappa*(c\_parent -\/ c\_child)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02025}02025         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a5c75d37d1e2bcc0897cdac02b45c7bca}{fmm\_l2l\_bessel\_rotation\_adj\_work}}(c\_diff, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02026}02026             \& constants \% si\_rnode(:, i), constants \% si\_rnode(:, j), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02027}02027             \& params \% pl, constants \% vscales, constants \% vfact, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02028}02028             \& node\_l(:, i), one, node\_l(:, j), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02029}02029 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02030}02030 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a6b92d30960fb1be121d7ab92d14365e9}{tree\_l2l\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02031}02031 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02032}02032 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02034}02034 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02035}\mbox{\hyperlink{namespaceddx__core_a559f8f129ce2d481446c4325526aa277}{02035}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a559f8f129ce2d481446c4325526aa277}{tree\_m2l\_rotation}}(params, constants, node\_m, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02036}02036     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02037}02037     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02038}02038     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02039}02039 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02040}02040     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02041}02041 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02042}02042     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02043}02043 \textcolor{keywordtype}{    real}(dp) :: work(6*max(params \% pm, params \% pl)**2 + \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02044}02044         \& 19*max(params \% pm, params \% pl) + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02045}02045     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02046}02046     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02047}02047 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02048}02048     \textcolor{comment}{! Any order of this cycle is OK}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02049}02049     \textcolor{comment}{!\$omp parallel do default(none) shared(constants,params,node\_m,node\_l) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02050}02050     \textcolor{comment}{!\$omp private(i,c,r,k,c1,r1,work) schedule(dynamic)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02051}02051     \textcolor{keywordflow}{do} i = 1, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02052}02052         \textcolor{comment}{! If no far admissible pairs just set output to zero}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02053}02053         \textcolor{keywordflow}{if} (constants \% nfar(i) .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02054}02054             node\_l(:, i) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02055}02055             cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02056}02056 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02057}02057         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02058}02058         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02059}02059         \textcolor{comment}{! Use the first far admissible pair to initialize output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02060}02060         k = constants \% far(constants \% sfar(i))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02061}02061         c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02062}02062         r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02063}02063         c1 = c1 -\/ c}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02064}02064         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{fmm\_m2l\_rotation\_work}}(c1, r1, r, params \% pm, params \% pl, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02065}02065             \& constants \% vscales, constants \% m2l\_ztranslate\_coef, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02066}02066             \& node\_m(:, k), zero, node\_l(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02067}02067         \textcolor{keywordflow}{do} j = constants \% sfar(i)+1, constants \% sfar(i+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02068}02068             k = constants \% far(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02069}02069             c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02070}02070             r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02071}02071             c1 = c1 -\/ c}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02072}02072             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a9626682b922d5e507f037548eb3d2355}{fmm\_m2l\_rotation\_work}}(c1, r1, r, params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02073}02073                 \& params \% pl, constants \% vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02074}02074                 \& constants \% m2l\_ztranslate\_coef, one, node\_m(:, k), one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02075}02075                 \& node\_l(:, i), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02076}02076 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02077}02077 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02078}02078 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a559f8f129ce2d481446c4325526aa277}{tree\_m2l\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02079}02079 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02080}02080 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02082}02082 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02083}\mbox{\hyperlink{namespaceddx__core_a3d18e8fd9f3dbc808deefd71af3c6892}{02083}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a3d18e8fd9f3dbc808deefd71af3c6892}{tree\_m2l\_bessel\_rotation}}(params, constants, node\_m, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02084}02084     \textcolor{keywordtype}{use }complex\_bessel}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02085}02085     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02086}02086     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02087}02087     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02088}02088 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02089}02089     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02090}02090 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02091}02091     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02092}02092 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02093}02093     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02094}02094     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02095}02095     \textcolor{keywordtype}{integer} :: i, j, k, NZ, ierr}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02096}02096 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02097}02097     \textcolor{comment}{! Any order of this cycle is OK}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02098}02098     \textcolor{keywordflow}{do} i = 1, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02099}02099         \textcolor{comment}{! If no far admissible pairs just set output to zero}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02100}02100         \textcolor{keywordflow}{if} (constants \% nfar(i) .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02101}02101             node\_l(:, i) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02102}02102             cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02103}02103 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02104}02104         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02105}02105         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02106}02106         \textcolor{comment}{! Use the first far admissible pair to initialize output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02107}02107         k = constants \% far(constants \% sfar(i))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02108}02108         c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02109}02109         r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02110}02110 \textcolor{comment}{!        call fmm\_m2l\_bessel\_rotation(c1-\/c, r1, r, params \% kappa, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02111}02111 \textcolor{comment}{!            \& params \% pm, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02112}02112 \textcolor{comment}{!            \& constants \% vscales, constants \% vcnk, one, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02113}02113 \textcolor{comment}{!            \& node\_m(:, k), zero, node\_l(:, i))}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02114}02114         c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02115}02115         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{fmm\_m2l\_bessel\_rotation\_work}}(c1, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02116}02116             \& constants \% SK\_rnode(:, k), constants \% SI\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02117}02117             \& params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02118}02118             \& constants \% vscales, constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02119}02119             \& node\_m(:, k), zero, node\_l(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02120}02120         \textcolor{keywordflow}{do} j = constants \% sfar(i)+1, constants \% sfar(i+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02121}02121             k = constants \% far(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02122}02122             c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02123}02123             r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02124}02124 \textcolor{comment}{!            call fmm\_m2l\_bessel\_rotation(c1-\/c, r1, r, params \% kappa, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02125}02125 \textcolor{comment}{!                \& params \% pm, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02126}02126 \textcolor{comment}{!                \& constants \% vscales, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02127}02127 \textcolor{comment}{!                \& constants \% vcnk, one, node\_m(:, k), one, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02128}02128 \textcolor{comment}{!                \& node\_l(:, i))}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02129}02129             c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02130}02130             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aa3c333c44623a5c713b14239f77c21be}{fmm\_m2l\_bessel\_rotation\_work}}(c1, constants \% SK\_rnode(:, k), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02131}02131                 \& constants \% SI\_rnode(:, i), params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02132}02132                 \& constants \% vscales, constants \% vcnk, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02133}02133                 \& node\_m(:, k), one, node\_l(:, i), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02134}02134 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02135}02135 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02136}02136 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a3d18e8fd9f3dbc808deefd71af3c6892}{tree\_m2l\_bessel\_rotation}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02137}02137 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02139}02139 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02140}\mbox{\hyperlink{namespaceddx__core_a8190329d0b54f19cfd0323e20740cd1a}{02140}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a8190329d0b54f19cfd0323e20740cd1a}{tree\_m2l\_bessel\_rotation\_adj}}(params, constants, node\_l, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02141}02141     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02142}02142     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02143}02143     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02144}02144 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02145}02145     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02146}02146 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02147}02147     \textcolor{comment}{!Call corresponding work routine}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02148}02148     \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__core_aa709ef144e4384d61d0ae50bfe7354dd}{tree\_m2l\_bessel\_rotation\_adj\_work}}(params, constants, node\_l, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02149}02149 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a8190329d0b54f19cfd0323e20740cd1a}{tree\_m2l\_bessel\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02150}02150 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02151}02151 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02152}02152 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02154}02154 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02155}\mbox{\hyperlink{namespaceddx__core_aa709ef144e4384d61d0ae50bfe7354dd}{02155}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_aa709ef144e4384d61d0ae50bfe7354dd}{tree\_m2l\_bessel\_rotation\_adj\_work}}(params, constants, node\_l, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02156}02156     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02157}02157     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02158}02158     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02159}02159 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02160}02160     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02161}02161 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02162}02162     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02163}02163 \textcolor{keywordtype}{    real}(dp) :: work(6*params \% pm**2 + 19*params \% pm + 8)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02164}02164     \textcolor{keywordtype}{complex(dp)} :: work\_complex(2*params \% pm+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02165}02165     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02166}02166     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02167}02167 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02168}02168     \textcolor{comment}{! Any order of this cycle is OK}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02169}02169     node\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02170}02170     \textcolor{keywordflow}{do} i = 1, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02171}02171         \textcolor{comment}{! If no far admissible pairs just set output to zero}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02172}02172         \textcolor{keywordflow}{if} (constants \% nfar(i) .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02173}02173             cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02174}02174 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02175}02175         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02176}02176         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02177}02177         \textcolor{comment}{! Use the first far admissible pair to initialize output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02178}02178         k = constants \% far(constants \% sfar(i))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02179}02179         c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02180}02180         c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02181}02181         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{fmm\_m2l\_bessel\_rotation\_adj\_work}}(c1, constants \% SI\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02182}02182             \& constants \% SK\_rnode(:, k), params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02183}02183             \& constants \% vscales, constants \% m2l\_ztranslate\_adj\_coef, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02184}02184             \& node\_l(:, i), one, node\_m(:, k), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02185}02185         \textcolor{keywordflow}{do} j = constants \% sfar(i)+1, constants \% sfar(i+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02186}02186             k = constants \% far(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02187}02187             c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02188}02188             c1 = params \% kappa*(c1 -\/ c)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02189}02189             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a77326a39f2e6eec60040792e7ab41466}{fmm\_m2l\_bessel\_rotation\_adj\_work}}(c1, constants \% SI\_rnode(:, i), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02190}02190                 \& constants \% SK\_rnode(:, k), params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02191}02191                 \& constants \% vscales, constants \% m2l\_ztranslate\_adj\_coef, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02192}02192                 \& node\_l(:, i), one, node\_m(:, k), work, work\_complex)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02193}02193 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02194}02194 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02195}02195 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_aa709ef144e4384d61d0ae50bfe7354dd}{tree\_m2l\_bessel\_rotation\_adj\_work}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02196}02196 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02197}02197 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02199}02199 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02200}\mbox{\hyperlink{namespaceddx__core_aa9e82e22265265ab215bb831a2dbdf1a}{02200}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_aa9e82e22265265ab215bb831a2dbdf1a}{tree\_m2l\_rotation\_adj}}(params, constants, node\_l, node\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02201}02201     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02202}02202     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02203}02203     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02204}02204 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02205}02205     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02206}02206 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: node\_m((params \% pm+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02207}02207     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02208}02208     \textcolor{keywordtype}{integer} :: i, j, k}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02209}02209 \textcolor{keywordtype}{    real}(dp) :: c1(3), c(3), r1, r}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02210}02210     \textcolor{comment}{! Any order of this cycle is OK}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02211}02211     node\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02212}02212     \textcolor{keywordflow}{do} i = 1, constants \% nclusters}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02213}02213         \textcolor{comment}{! If no far admissible pairs just set output to zero}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02214}02214         \textcolor{keywordflow}{if} (constants \% nfar(i) .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02215}02215             cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02216}02216 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02217}02217         c = constants \% cnode(:, i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02218}02218         r = constants \% rnode(i)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02219}02219         \textcolor{comment}{! Use the first far admissible pair to initialize output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02220}02220         k = constants \% far(constants \% sfar(i))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02221}02221         c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02222}02222         r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02223}02223         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8cfe4104aac6bb08df2fa15d2df2ba1a}{fmm\_m2l\_rotation\_adj}}(c-\/c1, r, r1, params \% pl, params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02224}02224             \& constants \% vscales, constants \% m2l\_ztranslate\_adj\_coef, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02225}02225             \& node\_l(:, i), one, node\_m(:, k))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02226}02226         \textcolor{keywordflow}{do} j = constants \% sfar(i)+1, constants \% sfar(i+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02227}02227             k = constants \% far(j)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02228}02228             c1 = constants \% cnode(:, k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02229}02229             r1 = constants \% rnode(k)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02230}02230             \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8cfe4104aac6bb08df2fa15d2df2ba1a}{fmm\_m2l\_rotation\_adj}}(c-\/c1, r, r1, params \% pl, params \% pm, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02231}02231                 \& constants \% vscales, constants \% m2l\_ztranslate\_adj\_coef, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02232}02232                 \& node\_l(:, i), one, node\_m(:, k))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02233}02233 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02234}02234 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02235}02235 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_aa9e82e22265265ab215bb831a2dbdf1a}{tree\_m2l\_rotation\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02236}02236 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02237}02237 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02239}02239 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02240}\mbox{\hyperlink{namespaceddx__core_a1d81120958f62351b12a9036ab6cbf6e}{02240}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a1d81120958f62351b12a9036ab6cbf6e}{tree\_l2p}}(params, constants, alpha, node\_l, beta, grid\_v, sph\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02241}02241     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02242}02242     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02243}02243     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02244}02244 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02245}02245         \& alpha, beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02246}02246     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02247}02247 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: grid\_v(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02248}02248     \textcolor{comment}{! Scratch}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02249}02249 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: sph\_l((params \% pl+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02250}02250     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02251}02251 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02252}02252     \textcolor{keywordtype}{integer} :: isph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02253}02253     \textcolor{keywordtype}{external} :: dgemm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02254}02254 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02255}02255 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02256}02256     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02257}02257     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02258}02258         grid\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02259}02259     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02260}02260         grid\_v = beta * grid\_v}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02261}02261 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02262}02262     \textcolor{comment}{! Get data from all clusters to spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02263}02263     \textcolor{comment}{!\$omp parallel do default(none) shared(params,constants,node\_l,sph\_l) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02264}02264     \textcolor{comment}{!\$omp private(isph) schedule(dynamic)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02265}02265     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02266}02266         sph\_l(:, isph) = node\_l(:, constants \% snode(isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02267}02267 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02268}02268     \textcolor{comment}{! Get values at grid points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02269}02269     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'T'}, \textcolor{stringliteral}{'N'}, params \% ngrid, params \% nsph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02270}02270         \& (params \% pl+1)**2, alpha, constants \% vgrid2, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02271}02271         \& constants \% vgrid\_nbasis, sph\_l, (params \% pl+1)**2, beta, grid\_v, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02272}02272         \& params \% ngrid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02273}02273 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02274}02274 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a1d81120958f62351b12a9036ab6cbf6e}{tree\_l2p}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02275}02275 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02276}02276 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02278}02278 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02279}\mbox{\hyperlink{namespaceddx__core_a0d41a631eb1ddf7d6c96b28919385514}{02279}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a0d41a631eb1ddf7d6c96b28919385514}{tree\_l2p\_bessel}}(params, constants, alpha, node\_l, beta, grid\_v)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02280}02280     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02281}02281     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02282}02282     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02283}02283 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02284}02284         \& alpha, beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02285}02285     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02286}02286 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: grid\_v(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02287}02287     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02288}02288 \textcolor{keywordtype}{    real}(dp) :: sph\_l((params \% pl+1)**2, params \% nsph), c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02289}02289     \textcolor{keywordtype}{integer} :: isph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02290}02290     \textcolor{keywordtype}{external} :: dgemm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02291}02291     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02292}02292     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02293}02293         grid\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02294}02294     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02295}02295         grid\_v = beta * grid\_v}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02296}02296 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02297}02297     \textcolor{comment}{! Get data from all clusters to spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02298}02298     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02299}02299         sph\_l(:, isph) = node\_l(:, constants \% snode(isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02300}02300 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02301}02301     \textcolor{comment}{! Get values at grid points}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02302}02302     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'T'}, \textcolor{stringliteral}{'N'}, params \% ngrid, params \% nsph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02303}02303         \& (params \% pl+1)**2, alpha, constants \% vgrid, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02304}02304         \& constants \% vgrid\_nbasis, sph\_l, (params \% pl+1)**2, beta, grid\_v, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02305}02305         \& params \% ngrid)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02306}02306 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a0d41a631eb1ddf7d6c96b28919385514}{tree\_l2p\_bessel}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02307}02307 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02308}02308 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02310}02310 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02311}\mbox{\hyperlink{namespaceddx__core_a2ee14de3640c3649fe523dfb4d083bc9}{02311}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a2ee14de3640c3649fe523dfb4d083bc9}{tree\_l2p\_adj}}(params, constants, alpha, grid\_v, beta, node\_l, sph\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02312}02312     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02313}02313     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02314}02314     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02315}02315 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: grid\_v(params \% ngrid, params \% nsph), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02316}02316         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02317}02317     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02318}02318 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02319}02319         \& constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02320}02320     \textcolor{comment}{! Scractch}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02321}02321 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: sph\_l((params \% pl+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02322}02322     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02323}02323 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02324}02324     \textcolor{keywordtype}{integer} :: isph, inode}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02325}02325     \textcolor{keywordtype}{external} :: dgemm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02326}02326     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02327}02327     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02328}02328         node\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02329}02329     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02330}02330         node\_l = beta * node\_l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02331}02331 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02332}02332     \textcolor{comment}{! Get weights of spherical harmonics at each sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02333}02333     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'N'}, \textcolor{stringliteral}{'N'}, (params \% pl+1)**2, params \% nsph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02334}02334         \& params \% ngrid, one, constants \% vgrid2, constants \% vgrid\_nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02335}02335         \& grid\_v, params \% ngrid, zero, sph\_l, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02336}02336         \& (params \% pl+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02337}02337     \textcolor{comment}{! Get data from all clusters to spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02338}02338     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02339}02339         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02340}02340         node\_l(:, inode) = node\_l(:, inode) + alpha*sph\_l(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02341}02341 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02342}02342 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a2ee14de3640c3649fe523dfb4d083bc9}{tree\_l2p\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02343}02343 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02344}02344 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02346}02346 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02347}\mbox{\hyperlink{namespaceddx__core_a1111c683b53bd2eb55ea0d130980bcd9}{02347}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a1111c683b53bd2eb55ea0d130980bcd9}{tree\_l2p\_bessel\_adj}}(params, constants, alpha, grid\_v, beta, node\_l)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02348}02348     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02349}02349     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02350}02350     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02351}02351 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: grid\_v(params \% ngrid, params \% nsph), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02352}02352         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02353}02353     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02354}02354 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: node\_l((params \% pl+1)**2, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02355}02355         \& constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02356}02356     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02357}02357 \textcolor{keywordtype}{    real}(dp) :: sph\_l((params \% pl+1)**2, params \% nsph), c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02358}02358     \textcolor{keywordtype}{integer} :: isph, inode}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02359}02359     \textcolor{keywordtype}{external} :: dgemm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02360}02360     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02361}02361     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02362}02362         node\_l = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02363}02363     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02364}02364         node\_l = beta * node\_l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02365}02365 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02366}02366     \textcolor{comment}{! Get weights of spherical harmonics at each sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02367}02367     \textcolor{keyword}{call }dgemm(\textcolor{stringliteral}{'N'}, \textcolor{stringliteral}{'N'}, (params \% pl+1)**2, params \% nsph, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02368}02368         \& params \% ngrid, one, constants \% vgrid, constants \% vgrid\_nbasis, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02369}02369         \& grid\_v, params \% ngrid, zero, sph\_l, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02370}02370         \& (params \% pl+1)**2)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02371}02371     \textcolor{comment}{! Get data from all clusters to spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02372}02372     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02373}02373         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02374}02374         node\_l(:, inode) = node\_l(:, inode) + alpha*sph\_l(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02375}02375 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02376}02376 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a1111c683b53bd2eb55ea0d130980bcd9}{tree\_l2p\_bessel\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02377}02377 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02378}02378 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02380}02380 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02381}\mbox{\hyperlink{namespaceddx__core_a60a40706c306b954af9fccb186c305e0}{02381}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a60a40706c306b954af9fccb186c305e0}{tree\_m2p}}(params, constants, p, alpha, sph\_m, beta, grid\_v)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02382}02382     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02383}02383     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02384}02384     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02385}02385     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02386}02386 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: sph\_m((p+1)**2, params \% nsph), alpha, beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02387}02387     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02388}02388 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: grid\_v(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02389}02389     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02390}02390     \textcolor{keywordtype}{integer} :: isph, inode, jnear, jnode, jsph, igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02391}02391 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02392}02392     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02393}02393 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02394}02394     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02395}02395     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02396}02396         grid\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02397}02397     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02398}02398         grid\_v = beta * grid\_v}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02399}02399 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02400}02400     \textcolor{comment}{! Cycle over all spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02401}02401     \textcolor{comment}{!\$omp parallel do default(none) shared(params,constants,grid\_v,p, \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02402}02402     \textcolor{comment}{!\$omp alpha,sph\_m), private(isph,inode,jnear,jnode,jsph,igrid,c,work) \&}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02403}02403     \textcolor{comment}{!\$omp schedule(dynamic)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02404}02404     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02405}02405         \textcolor{comment}{! Cycle over all near-\/field admissible pairs of spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02406}02406         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02407}02407         \textcolor{keywordflow}{do} jnear = constants \% snear(inode), constants \% snear(inode+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02408}02408             \textcolor{comment}{! Near-\/field interactions are possible only between leaf nodes,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02409}02409             \textcolor{comment}{! which must contain only a single input sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02410}02410             jnode = constants \% near(jnear)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02411}02411             jsph = constants \% order(constants \% cluster(1, jnode))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02412}02412             \textcolor{comment}{! Ignore self-\/interaction}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02413}02413             \textcolor{keywordflow}{if}(isph .eq. jsph) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02414}02414             \textcolor{comment}{! Accumulate interaction for external grid points only}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02415}02415             \textcolor{keywordflow}{do} igrid = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02416}02416                 \textcolor{keywordflow}{if}(constants \% ui(igrid, isph) .eq. zero) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02417}02417                 c = constants \% cgrid(:, igrid)*params \% rsph(isph) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02418}02418                     \& params \% csph(:, jsph) + params \% csph(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02419}02419                 \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a84bf7c6ebd36d68822a3e81c9d01055f}{fmm\_m2p\_work}}(c, params \% rsph(jsph), p, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02420}02420                     \& constants \% vscales\_rel, alpha, sph\_m(:, jsph), one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02421}02421                     \& grid\_v(igrid, isph), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02422}02422 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02423}02423 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02424}02424 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02425}02425 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a60a40706c306b954af9fccb186c305e0}{tree\_m2p}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02426}02426 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02427}02427 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02429}02429 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02430}\mbox{\hyperlink{namespaceddx__core_a62112cc7d3d77609e0e992504d8be125}{02430}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a62112cc7d3d77609e0e992504d8be125}{tree\_m2p\_bessel}}(params, constants, p, alpha, sph\_p, sph\_m, beta, grid\_v)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02431}02431     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02432}02432     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02433}02433     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02434}02434     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p, sph\_p}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02435}02435 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: sph\_m((sph\_p+1)**2, params \% nsph), alpha, beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02436}02436     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02437}02437 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: grid\_v(params \% ngrid, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02438}02438     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02439}02439     \textcolor{keywordtype}{integer} :: isph, inode, jnear, jnode, jsph, igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02440}02440 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02441}02441     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02442}02442 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02443}02443     \textcolor{keywordtype}{complex(dp)} :: work\_complex(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02444}02444     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02445}02445     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02446}02446         grid\_v = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02447}02447     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02448}02448         grid\_v = beta * grid\_v}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02449}02449 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02450}02450     \textcolor{comment}{! Cycle over all spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02451}02451     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02452}02452         \textcolor{comment}{! Cycle over all near-\/field admissible pairs of spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02453}02453         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02454}02454         \textcolor{keywordflow}{do} jnear = constants \% snear(inode), constants \% snear(inode+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02455}02455             \textcolor{comment}{! Near-\/field interactions are possible only between leaf nodes,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02456}02456             \textcolor{comment}{! which must contain only a single input sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02457}02457             jnode = constants \% near(jnear)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02458}02458             jsph = constants \% order(constants \% cluster(1, jnode))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02459}02459             \textcolor{comment}{! Ignore self-\/interaction}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02460}02460             \textcolor{comment}{!if(isph .eq. jsph) cycle}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02461}02461             \textcolor{comment}{! Accumulate interaction for external grid points only}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02462}02462             \textcolor{keywordflow}{do} igrid = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02463}02463                 \textcolor{keywordflow}{if}(constants \% ui(igrid, isph) .eq. zero) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02464}02464                 c = constants \% cgrid(:, igrid)*params \% rsph(isph) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02465}02465                     \& params \% csph(:, jsph) + params \% csph(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02466}02466                 c = c * params \% kappa}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02467}02467                 \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_aeffc8a34f016545c454b733f3fd589c8}{fmm\_m2p\_bessel\_work}}(c, p, constants \% vscales, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02468}02468                     \& constants \% SK\_ri(:, jsph), alpha, sph\_m(:, jsph), one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02469}02469                     \& grid\_v(igrid, isph), work\_complex, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02470}02470 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02471}02471 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02472}02472 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02473}02473 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a62112cc7d3d77609e0e992504d8be125}{tree\_m2p\_bessel}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02474}02474 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02475}02475 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02477}02477 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02478}\mbox{\hyperlink{namespaceddx__core_a8866ff0507514c1a83f3348e2cc55401}{02478}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a8866ff0507514c1a83f3348e2cc55401}{tree\_m2p\_adj}}(params, constants, p, alpha, grid\_v, beta, sph\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02479}02479     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02480}02480     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02481}02481     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02482}02482     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02483}02483 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: grid\_v(params \% ngrid, params \% nsph), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02484}02484         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02485}02485     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02486}02486 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: sph\_m((p+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02487}02487     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02488}02488 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02489}02489     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02490}02490     \textcolor{keywordtype}{integer} :: isph, inode, jnear, jnode, jsph, igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02491}02491 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02492}02492     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02493}02493     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02494}02494         sph\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02495}02495     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02496}02496         sph\_m = beta * sph\_m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02497}02497 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02498}02498     \textcolor{comment}{! Cycle over all spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02499}02499     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02500}02500         \textcolor{comment}{! Cycle over all near-\/field admissible pairs of spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02501}02501         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02502}02502         \textcolor{keywordflow}{do} jnear = constants \% snear(inode), constants \% snear(inode+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02503}02503             \textcolor{comment}{! Near-\/field interactions are possible only between leaf nodes,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02504}02504             \textcolor{comment}{! which must contain only a single input sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02505}02505             jnode = constants \% near(jnear)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02506}02506             jsph = constants \% order(constants \% cluster(1, jnode))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02507}02507             \textcolor{comment}{! Ignore self-\/interaction}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02508}02508             \textcolor{keywordflow}{if}(isph .eq. jsph) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02509}02509             \textcolor{comment}{! Accumulate interaction for external grid points only}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02510}02510             \textcolor{keywordflow}{do} igrid = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02511}02511                 \textcolor{keywordflow}{if}(constants \% ui(igrid, isph) .eq. zero) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02512}02512                 c = constants \% cgrid(:, igrid)*params \% rsph(isph) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02513}02513                     \& params \% csph(:, jsph) + params \% csph(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02514}02514                 \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a6b5af8fca5bf86b5c643501a079798f2}{fmm\_m2p\_adj\_work}}(c, alpha*grid\_v(igrid, isph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02515}02515                     \& params \% rsph(jsph), p, constants \% vscales\_rel, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02516}02516                     \& sph\_m(:, jsph), work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02517}02517 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02518}02518 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02519}02519 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02520}02520 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a8866ff0507514c1a83f3348e2cc55401}{tree\_m2p\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02521}02521 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02522}02522 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02524}02524 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02525}\mbox{\hyperlink{namespaceddx__core_aa34ea25c06052ba20613b35da813f54e}{02525}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_aa34ea25c06052ba20613b35da813f54e}{tree\_m2p\_bessel\_adj}}(params, constants, p, alpha, grid\_v, beta, sph\_p, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02526}02526         \& sph\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02527}02527     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02528}02528     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02529}02529     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02530}02530     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p, sph\_p}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02531}02531 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: grid\_v(params \% ngrid, params \% nsph), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02532}02532         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02533}02533     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02534}02534 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: sph\_m((sph\_p+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02535}02535     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02536}02536 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02537}02537     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02538}02538     \textcolor{keywordtype}{integer} :: isph, inode, jnear, jnode, jsph, igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02539}02539 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02540}02540     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02541}02541     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02542}02542         sph\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02543}02543     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02544}02544         sph\_m = beta * sph\_m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02545}02545 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02546}02546     \textcolor{comment}{! Cycle over all spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02547}02547     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02548}02548         \textcolor{comment}{! Cycle over all near-\/field admissible pairs of spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02549}02549         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02550}02550         \textcolor{keywordflow}{do} jnear = constants \% snear(inode), constants \% snear(inode+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02551}02551             \textcolor{comment}{! Near-\/field interactions are possible only between leaf nodes,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02552}02552             \textcolor{comment}{! which must contain only a single input sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02553}02553             jnode = constants \% near(jnear)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02554}02554             jsph = constants \% order(constants \% cluster(1, jnode))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02555}02555             \textcolor{comment}{! Ignore self-\/interaction}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02556}02556             \textcolor{comment}{!if(isph .eq. jsph) cycle}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02557}02557             \textcolor{comment}{! Accumulate interaction for external grid points only}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02558}02558             \textcolor{keywordflow}{do} igrid = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02559}02559                 \textcolor{keywordflow}{if}(constants \% ui(igrid, isph) .eq. zero) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02560}02560                 c = constants \% cgrid(:, igrid)*params \% rsph(isph) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02561}02561                     \& params \% csph(:, jsph) + params \% csph(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02562}02562                 \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a364a597df78940a0e747a853df495682}{fmm\_m2p\_bessel\_adj}}(c, alpha*grid\_v(igrid, isph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02563}02563                     \& params \% rsph(jsph), params \% kappa, p, constants \% vscales, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02564}02564                     \& sph\_m(:, jsph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02565}02565 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02566}02566 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02567}02567 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02568}02568 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_aa34ea25c06052ba20613b35da813f54e}{tree\_m2p\_bessel\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02569}02569 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02570}02570 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02572}02572 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02573}\mbox{\hyperlink{namespaceddx__core_a7f61e8dc65fa676434374f7ea9a07743}{02573}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a7f61e8dc65fa676434374f7ea9a07743}{tree\_m2p\_bessel\_nodiag\_adj}}(params, constants, p, alpha, grid\_v, beta, sph\_p, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02574}02574         \& sph\_m)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02575}02575     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02576}02576     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02577}02577     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02578}02578     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: p, sph\_p}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02579}02579 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: grid\_v(params \% ngrid, params \% nsph), alpha, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02580}02580         \& beta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02581}02581     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02582}02582 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: sph\_m((sph\_p+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02583}02583     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02584}02584 \textcolor{keywordtype}{    real}(dp) :: work(p+1)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02585}02585     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02586}02586     \textcolor{keywordtype}{integer} :: isph, inode, jnear, jnode, jsph, igrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02587}02587 \textcolor{keywordtype}{    real}(dp) :: c(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02588}02588     \textcolor{comment}{! Init output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02589}02589     \textcolor{keywordflow}{if} (beta .eq. zero) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02590}02590         sph\_m = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02591}02591     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02592}02592         sph\_m = beta * sph\_m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02593}02593 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02594}02594     \textcolor{comment}{! Cycle over all spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02595}02595     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02596}02596         \textcolor{comment}{! Cycle over all near-\/field admissible pairs of spheres}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02597}02597         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02598}02598         \textcolor{keywordflow}{do} jnear = constants \% snear(inode), constants \% snear(inode+1)-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02599}02599             \textcolor{comment}{! Near-\/field interactions are possible only between leaf nodes,}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02600}02600             \textcolor{comment}{! which must contain only a single input sphere}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02601}02601             jnode = constants \% near(jnear)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02602}02602             jsph = constants \% order(constants \% cluster(1, jnode))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02603}02603             \textcolor{comment}{! Ignore self-\/interaction}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02604}02604             \textcolor{keywordflow}{if}(isph .eq. jsph) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02605}02605             \textcolor{comment}{! Accumulate interaction for external grid points only}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02606}02606             \textcolor{keywordflow}{do} igrid = 1, params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02607}02607                 \textcolor{keywordflow}{if}(constants \% ui(igrid, isph) .eq. zero) cycle}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02608}02608                 c = constants \% cgrid(:, igrid)*params \% rsph(isph) -\/ \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02609}02609                     \& params \% csph(:, jsph) + params \% csph(:, isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02610}02610                 \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a364a597df78940a0e747a853df495682}{fmm\_m2p\_bessel\_adj}}(c, alpha*grid\_v(igrid, isph), \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02611}02611                     \& params \% rsph(jsph), params \% kappa, p, constants \% vscales, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02612}02612                     \& sph\_m(:, jsph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02613}02613 \textcolor{keywordflow}{            end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02614}02614 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02615}02615 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02616}02616 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a7f61e8dc65fa676434374f7ea9a07743}{tree\_m2p\_bessel\_nodiag\_adj}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02617}02617 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02618}02618 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02620}02620 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02621}\mbox{\hyperlink{namespaceddx__core_a3c8789fc01ba244fdaa0d4fef8e9d725}{02621}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a3c8789fc01ba244fdaa0d4fef8e9d725}{efld}}(ncav,zeta,ccav,nsph,csph,force)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02622}02622 \textcolor{keywordtype}{integer},                    \textcolor{keywordtype}{intent(in)}    :: ncav, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02623}02623 real*8,  \textcolor{keywordtype}{dimension(ncav)},   \textcolor{keywordtype}{intent(in)}    :: zeta}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02624}02624 real*8,  \textcolor{keywordtype}{dimension(3,ncav)}, \textcolor{keywordtype}{intent(in)}    :: ccav}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02625}02625 real*8,  \textcolor{keywordtype}{dimension(3,nsph)}, \textcolor{keywordtype}{intent(in)}    :: csph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02626}02626 real*8,  \textcolor{keywordtype}{dimension(3,nsph)}, \textcolor{keywordtype}{intent(inout)} :: force}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02627}02627 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02628}02628 \textcolor{keywordtype}{integer} :: icav, isph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02629}02629 real*8  :: dx, dy, dz, rijn2, rijn, rijn3, f, sum\_int(3)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02630}02630 real*8, \textcolor{keywordtype}{parameter} :: zero=0.0d0}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02631}02631 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02632}02632 force = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02633}02633 \textcolor{keywordflow}{do} isph = 1, nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02634}02634   sum\_int = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02635}02635   \textcolor{keywordflow}{do} icav = 1, ncav}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02636}02636     dx   = csph(1,isph) -\/ ccav(1,icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02637}02637     dy   = csph(2,isph) -\/ ccav(2,icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02638}02638     dz   = csph(3,isph) -\/ ccav(3,icav)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02639}02639     rijn2   = dx*dx + dy*dy + dz*dz}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02640}02640     rijn   = sqrt(rijn2)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02641}02641     rijn3   = rijn2*rijn}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02642}02642     f    = zeta(icav)/rijn3}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02643}02643     sum\_int(1) = sum\_int(1) + f*dx}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02644}02644     sum\_int(2) = sum\_int(2) + f*dy}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02645}02645     sum\_int(3) = sum\_int(3) + f*dz}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02646}02646 \textcolor{keywordflow}{  end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02647}02647   force(:,isph) = sum\_int}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02648}02648 \textcolor{keywordflow}{end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02649}02649 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a3c8789fc01ba244fdaa0d4fef8e9d725}{efld}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02650}02650 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02651}02651 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02653}02653 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02654}\mbox{\hyperlink{namespaceddx__core_a86f701c3486a5b26c650d5b157b6e213}{02654}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a86f701c3486a5b26c650d5b157b6e213}{tree\_grad\_m2m}}(params, constants, sph\_m, sph\_m\_grad, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02655}02655     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02656}02656     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02657}02657     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02658}02658 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: sph\_m(constants \% nbasis, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02659}02659     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02660}02660 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: sph\_m\_grad((params \% lmax+2)**2, 3, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02661}02661         \& params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02662}02662     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02663}02663 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(inout)} :: work((params \% lmax+2)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02664}02664     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02665}02665     \textcolor{keywordtype}{integer} :: isph, l, indi, indj, m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02666}02666 \textcolor{keywordtype}{    real}(dp) :: tmp1, tmp2}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02667}02667 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3, 3)} :: zx\_coord\_transform, zy\_coord\_transform}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02668}02668     \textcolor{comment}{! Set coordinate transformations}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02669}02669     zx\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02670}02670     zx\_coord\_transform(3, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02671}02671     zx\_coord\_transform(2, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02672}02672     zx\_coord\_transform(1, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02673}02673     zy\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02674}02674     zy\_coord\_transform(1, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02675}02675     zy\_coord\_transform(2, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02676}02676     zy\_coord\_transform(3, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02677}02677     \textcolor{comment}{! At first reflect harmonics of a degree up to lmax}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02678}02678     sph\_m\_grad(1:constants \% nbasis, 3, :) = sph\_m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02679}02679     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02680}02680         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% lmax, zx\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02681}02681             \& sph\_m(:, isph), zero, sph\_m\_grad(1:constants \% nbasis, 1, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02682}02682         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% lmax, zy\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02683}02683             \& sph\_m(:, isph), zero, sph\_m\_grad(1:constants \% nbasis, 2, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02684}02684 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02685}02685     \textcolor{comment}{! Derivative of M2M translation over OZ axis at the origin consists of 2}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02686}02686     \textcolor{comment}{! steps:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02687}02687     \textcolor{comment}{!   1) increase degree l and scale by sqrt((2*l+1)*(l*l-\/m*m)) / sqrt(2*l-\/1)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02688}02688     \textcolor{comment}{!   2) scale by 1/rsph(isph)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02689}02689     \textcolor{keywordflow}{do} l = params \% lmax+1, 1, -\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02690}02690         indi = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02691}02691         indj = indi -\/ 2*l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02692}02692         tmp1 = sqrt(dble(2*l+1)) / sqrt(dble(2*l-\/1))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02693}02693         \textcolor{keywordflow}{do} m = 1-\/l, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02694}02694             tmp2 = sqrt(dble(l*l-\/m*m)) * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02695}02695             sph\_m\_grad(indi+m, :, :) = tmp2 * sph\_m\_grad(indj+m, :, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02696}02696 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02697}02697         sph\_m\_grad(indi+l, :, :) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02698}02698         sph\_m\_grad(indi-\/l, :, :) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02699}02699 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02700}02700     sph\_m\_grad(1, :, :) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02701}02701     \textcolor{comment}{! Scale by 1/rsph(isph) and rotate harmonics of degree up to lmax+1 back to}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02702}02702     \textcolor{comment}{! the initial axis. Coefficient of 0-\/th degree is zero so we ignore it.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02703}02703     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02704}02704         sph\_m\_grad(:, 3, isph) = sph\_m\_grad(:, 3, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02705}02705         work(:, isph) = sph\_m\_grad(:, 1, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02706}02706         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% lmax+1, zx\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02707}02707             \& work(:, isph), zero, sph\_m\_grad(:, 1, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02708}02708         work(:, isph) = sph\_m\_grad(:, 2, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02709}02709         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% lmax+1, zy\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02710}02710             \& work(:, isph), zero, sph\_m\_grad(:, 2, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02711}02711 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02712}02712 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a86f701c3486a5b26c650d5b157b6e213}{tree\_grad\_m2m}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02713}02713 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02714}02714 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02716}02716 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02717}\mbox{\hyperlink{namespaceddx__core_a0bbe738fff5a4d15f744dfa0b26938cf}{02717}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a0bbe738fff5a4d15f744dfa0b26938cf}{tree\_grad\_l2l}}(params, constants, node\_l, sph\_l\_grad, work)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02718}02718     \textcolor{comment}{! Inputs}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02719}02719     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02720}02720     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__constants_1_1ddx__constants__type}{ddx\_constants\_type}}), \textcolor{keywordtype}{intent(in)} :: constants}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02721}02721 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(in)} :: node\_l((params \% pl+1)**2, constants \% nclusters)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02722}02722     \textcolor{comment}{! Output}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02723}02723 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: sph\_l\_grad((params \% pl+1)**2, 3, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02724}02724     \textcolor{comment}{! Temporary workspace}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02725}02725 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{intent(out)} :: work((params \% pl+1)**2, params \% nsph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02726}02726     \textcolor{comment}{! Local variables}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02727}02727     \textcolor{keywordtype}{integer} :: isph, inode, l, indi, indj, m}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02728}02728 \textcolor{keywordtype}{    real}(dp) :: tmp1, tmp2}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02729}02729 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(3, 3)} :: zx\_coord\_transform, zy\_coord\_transform}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02730}02730     \textcolor{comment}{! Gradient of L2L reduces degree by 1, so exit if degree of harmonics is 0}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02731}02731     \textcolor{comment}{! or -\/1 (which means no FMM at all)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02732}02732     \textcolor{keywordflow}{if} (params \% pl .le. 0) \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02733}02733     \textcolor{comment}{! Set coordinate transformations}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02734}02734     zx\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02735}02735     zx\_coord\_transform(3, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02736}02736     zx\_coord\_transform(2, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02737}02737     zx\_coord\_transform(1, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02738}02738     zy\_coord\_transform = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02739}02739     zy\_coord\_transform(1, 2) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02740}02740     zy\_coord\_transform(2, 1) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02741}02741     zy\_coord\_transform(3, 3) = one}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02742}02742     \textcolor{comment}{! At first reflect harmonics of a degree up to pl}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02743}02743     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02744}02744         inode = constants \% snode(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02745}02745         sph\_l\_grad(:, 3, isph) = node\_l(:, inode)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02746}02746         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% pl, zx\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02747}02747             \& node\_l(:, inode), zero, sph\_l\_grad(:, 1, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02748}02748         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% pl, zy\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02749}02749             \& node\_l(:, inode), zero, sph\_l\_grad(:, 2, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02750}02750 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02751}02751     \textcolor{comment}{! Derivative of L2L translation over OZ axis at the origin consists of 2}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02752}02752     \textcolor{comment}{! steps:}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02753}02753     \textcolor{comment}{!   1) decrease degree l and scale by sqrt((2*l-\/1)*(l*l-\/m*m)) / sqrt(2*l+1)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02754}02754     \textcolor{comment}{!   2) scale by 1/rsph(isph)}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02755}02755     \textcolor{keywordflow}{do} l = 1, params \% pl}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02756}02756         indi = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02757}02757         indj = indi -\/ 2*l}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02758}02758         tmp1 = -\/sqrt(dble(2*l-\/1)) / sqrt(dble(2*l+1))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02759}02759         \textcolor{keywordflow}{do} m = 1-\/l, l-\/1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02760}02760             tmp2 = sqrt(dble(l*l-\/m*m)) * tmp1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02761}02761             sph\_l\_grad(indj+m, :, :) = tmp2 * sph\_l\_grad(indi+m, :, :)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02762}02762 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02763}02763 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02764}02764     \textcolor{comment}{! Scale by 1/rsph(isph) and rotate harmonics of degree up to pl-\/1 back to}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02765}02765     \textcolor{comment}{! the initial axis. Coefficient of pl-\/th degree is zero so we ignore it.}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02766}02766     \textcolor{keywordflow}{do} isph = 1, params \% nsph}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02767}02767         sph\_l\_grad(1:params \% pl**2, 3, isph) = \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02768}02768             \& sph\_l\_grad(1:params \% pl**2, 3, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02769}02769         work(1:params \% pl**2, isph) = \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02770}02770             \& sph\_l\_grad(1:params \% pl**2, 1, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02771}02771         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% pl-\/1, zx\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02772}02772             \& work(1:params \% pl**2, isph), zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02773}02773             \& sph\_l\_grad(1:params \% pl**2, 1, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02774}02774         work(1:params \% pl**2, isph) = \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02775}02775             \& sph\_l\_grad(1:params \% pl**2, 2, isph) / params \% rsph(isph)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02776}02776         \textcolor{keyword}{call }\mbox{\hyperlink{namespaceddx__harmonics_a8f2ebf0050f757ce65ffe0f5d8bbc654}{fmm\_sph\_transform}}(params \% pl-\/1, zy\_coord\_transform, one, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02777}02777             \& work(1:params \% pl**2, isph), zero, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02778}02778             \& sph\_l\_grad(1:params \% pl**2, 2, isph))}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02779}02779 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02780}02780     \textcolor{comment}{! Set degree pl to zero to avoid problems if user actually uses it}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02781}02781     l = params \% pl}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02782}02782     indi = l*l + l + 1}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02783}02783     sph\_l\_grad(indi-\/l:indi+l, :, :) = zero}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02784}02784 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a0bbe738fff5a4d15f744dfa0b26938cf}{tree\_grad\_l2l}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02785}02785 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02786}02786 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02788}02788 \textcolor{comment}{!-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02789}\mbox{\hyperlink{namespaceddx__core_a1c6e9bf18af65b25aa115da10bb2e749}{02789}} \textcolor{keyword}{subroutine }\mbox{\hyperlink{namespaceddx__core_a1c6e9bf18af65b25aa115da10bb2e749}{print\_header}}(iprint,params)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02790}02790     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02791}02791     \textcolor{keywordtype}{integer},               \textcolor{keywordtype}{intent(in)} :: iprint}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02792}02792     \textcolor{keywordtype}{type}(\mbox{\hyperlink{structddx__parameters_1_1ddx__params__type}{ddx\_params\_type}}), \textcolor{keywordtype}{intent(in)} :: params}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02793}02793 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02794}02794     \textcolor{keywordtype}{character (len=255)} :: string}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02795}02795 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02796}02796     1010 \textcolor{keyword}{format} (t5,a,3x,i20)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02797}02797     1020 \textcolor{keyword}{format} (t5,a,3x,f20.10)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02798}02798     string = \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02799}02799     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02800}02800     string = \textcolor{stringliteral}{"{}!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02801}02801     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02802}02802     string = \textcolor{stringliteral}{"{}!                                                                             !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02803}02803     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02804}02804     string = \textcolor{stringliteral}{"{}!                                                                             !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02805}02805     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02806}02806     string = \textcolor{stringliteral}{"{}!                              888      888 Y8b    d8Y                        !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02807}02807     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02808}02808     string = \textcolor{stringliteral}{"{}!                              888      888  Y8b  d8Y                         !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02809}02809     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02810}02810     string = \textcolor{stringliteral}{"{}!                              888      888   Y8888Y                          !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02811}02811     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02812}02812     string = \textcolor{stringliteral}{"{}!                          .d88888  .d88888    Y88Y                           !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02813}02813     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02814}02814     string = \textcolor{stringliteral}{"{}!                         d88  888 d88  888    d88b                           !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02815}02815     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02816}02816     string = \textcolor{stringliteral}{"{}!                         888  888 888  888   d8888b                          !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02817}02817     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02818}02818     string = \textcolor{stringliteral}{"{}!                         Y88b 888 Y88b 888  d8Y  Y8b                         !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02819}02819     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02820}02820     string = \textcolor{stringliteral}{"{}!                           Y88888   Y88888 d8Y    Y8b                        !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02821}02821     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02822}02822     string = \textcolor{stringliteral}{"{}!                                                                             !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02823}02823     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02824}02824     string = \textcolor{stringliteral}{"{}!                                                                             !"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02825}02825     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02826}02826     string = \textcolor{stringliteral}{"{}!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02827}02827     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02828}02828     string = \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02829}02829     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02830}02830     \textcolor{keywordflow}{if} (params \% model .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02831}02831         \textcolor{keywordflow}{if} (params \% force .eq. 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02832}02832             string = \textcolor{stringliteral}{"{} performing a ddCOSMO solvation energy calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02833}02833         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% force .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02834}02834             string = \textcolor{stringliteral}{"{} performing a ddCOSMO solvation energy and forces calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02835}02835 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02836}02836     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% model .eq. 2) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02837}02837         \textcolor{keywordflow}{if} (params \% force .eq. 0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02838}02838             string = \textcolor{stringliteral}{"{} performing a ddPCM solvation energy calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02839}02839         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% force .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02840}02840             string = \textcolor{stringliteral}{"{} performing a ddPCM solvation energy and forces calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02841}02841 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02842}02842     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% model .eq. 3) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02843}02843         \textcolor{keywordflow}{if} (params \% force .eq. 0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02844}02844             string = \textcolor{stringliteral}{"{} performing a ddLPB solvation energy calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02845}02845         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (params \% force .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02846}02846             string = \textcolor{stringliteral}{"{} performing a ddLPB solvation energy and forces calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02847}02847 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02848}02848 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02849}02849     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02850}02850 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02851}02851     \textcolor{keywordflow}{if} (params \% model .eq. 3) \textcolor{keywordflow}{then} }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02852}02852         \textcolor{keyword}{write} (string,\textcolor{stringliteral}{'(t3,A,F10.4,A,F10.4)'}) \textcolor{stringliteral}{'dielectric constant: '}, params \% eps, \&}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02853}02853                                            \textcolor{stringliteral}{' Debye-\/Hueckel constant: '}, params \% kappa}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02854}02854     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02855}02855         \textcolor{keyword}{write} (string,\textcolor{stringliteral}{'(t3,A,F10.4)'}) \textcolor{stringliteral}{'dielectric constant: '}, params \% eps}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02856}02856 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02857}02857 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02858}02858     \textcolor{keywordflow}{if} (params \% fmm .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02859}02859         string = \textcolor{stringliteral}{"{} using the fast multipole method to accelerate the calculation"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02860}02860         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02861}02861 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02862}02862 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02863}02863     \textcolor{keywordflow}{if} (iprint.gt.0) \textcolor{keywordflow}{then} }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02864}02864         string = \textcolor{stringliteral}{"{} using the following numerical parameters for the calculation:"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02865}02865         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02866}02866         \textcolor{keyword}{write}(string,1010) \textcolor{stringliteral}{'maximal degree of spherical harmonics for the model:'},params \% lmax}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02867}02867         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02868}02868         \textcolor{keyword}{write}(string,1010) \textcolor{stringliteral}{'number of lebedev points:                           '},params \% ngrid}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02869}02869         \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02870}02870         \textcolor{keywordflow}{if} (params \% fmm .eq. 1) \textcolor{keywordflow}{then} }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02871}02871             \textcolor{keyword}{write}(string,1010) \textcolor{stringliteral}{'maximal degree of FMM multipolar expansions:         '},params \% pm}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02872}02872             \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02873}02873             \textcolor{keyword}{write}(string,1010) \textcolor{stringliteral}{'maximal degree of FMM local expansions:              '},params \% pl}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02874}02874             \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02875}02875 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02876}02876 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02877}02877 \textcolor{comment}{!}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02878}02878     \textcolor{keywordflow}{if} (params \% itersolver .eq. 1) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02879}02879         string = \textcolor{stringliteral}{"{} using the Jacobi-\/DIIS iterative solver"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02880}02880     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02881}02881         string = \textcolor{stringliteral}{"{} using the GMRES iterative solver"{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02882}02882 \textcolor{keywordflow}{    end if}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02883}02883     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02884}02884     string = \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02885}02885     \textcolor{keyword}{call }params \% print\_func(string)}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02886}02886 \textcolor{keyword}{end subroutine }\mbox{\hyperlink{namespaceddx__core_a1c6e9bf18af65b25aa115da10bb2e749}{print\_header}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02887}02887 }
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02888}02888 \textcolor{keyword}{end module }\mbox{\hyperlink{namespaceddx__core}{ddx\_core}}}
\DoxyCodeLine{\Hypertarget{ddx__core_8f90_source_l02889}02889 }

\end{DoxyCode}
